---
title: "Uso de Herramientas y Servicios de Escaneo de Puertos"
subtitle: "Descubre las Mejores Herramientas y TÃ©cnicas de Escaneo de Puertos para Identificar Puertos Abiertos, Servicios y Vulnerabilidades Potenciales."
tags: ["escaneo-de-puertos"]
authors: ["blindma1den", "lorenagubaira"]

---

### Â¿QuÃ© es el escaneo de puertos?

El escaneo de puertos es un proceso mediante el cual, a travÃ©s de herramientas especializadas, se analizan los puertos de un sistema informÃ¡tico. Al escanear puertos se puede obtener informaciÃ³n como los puertos que estÃ¡n abiertos, los que estÃ¡n cerrados o aquellos que estÃ¡n protegidos con cortafuegos.

Este procedimiento se puede usar con distintas finalidades. Por ejemplo, los administradores de sistemas lo emplean para conocer los servicios que estÃ¡ ofreciendo la mÃ¡quina o para analizar el estado de los puertos y detectar y subsanar posibles vulnerabilidades.

Sin embargo, como veremos mÃ¡s adelante, el escaneo de puertos abiertos tambiÃ©n se puede usar con fines poco Ã©ticos. Del mismo modo que los administradores de redes lo pueden usar para detectar y corregir vulnerabilidades, los ciberdelincuentes lo pueden usar para explotar dichas brechas de seguridad.

## TÃ©cnicas de escaneo de puertos

A continuaciÃ³n vemos las tÃ©cnicas mÃ¡s habituales para realizar un scan de puertos.

- **TCP connect() scanning:** Es una de las tÃ©cnicas mÃ¡s comunes para realizar escaneos TCP y cuenta con las ventajas de que es un mÃ©todo muy rÃ¡pido y que apenas requiere privilegios. BÃ¡sicamente, consiste en usar la llamada a sistema `connect()`. Si se logra establecer conexiÃ³n, quiere decir que el puerto estÃ¡ abierto; si no se consigue conectar, significa que el puerto estÃ¡ cerrado.
- **TCP SYN scanning**: Este mÃ©todo se suele denominar â€œhalf-openâ€ o mitad abierta. En realidad, no se crea una conexiÃ³n TCP completa. En lugar de eso, se envÃ­an paquetes SYN como si se fuera a establecer una conexiÃ³n. Si se recibe como respuesta un SYN-ACK es que el puerto estÃ¡ abierto, pero si se recibe un RST es que el puerto estÃ¡ cerrado. El principal inconveniente de este mÃ©todo es que se requieren privilegios de ROOT para poder llevarlo a cabo.
- **TCP FIN scanning:** Es una tÃ©cnica de escaneo de puertos que permite penetrar en sistemas en los que los firewalls o packet filters podrÃ­an detectar el uso de paquetes SYN. Usando los paquetes SYN, puede pasar que la respuesta sea un RST si el puerto estÃ¡ cerrado, y que si estÃ¡ abierto el sistema no dÃ© una respuesta. Con los paquetes FIN esto no ocurre.
- **Fragmentation scanning:** No se trata de un mÃ©todo de escaneo de puertos propiamente dicho, sino que se basa en una modificaciÃ³n de tÃ©cnicas anteriores. Consiste en dividir o fragmentar los paquetes SYN o FIN que se envÃ­an, con el objetivo de que no sean detectados por los firewall o los filtradores de paquetes.
- **TCP reverse ident scanning:** Gracias al protocolo â€œidentâ€ se puede conocer el nombre de usuario y el dueÃ±o de los servicios que se estÃ¡n usando dentro de una conexiÃ³n TCP. Para ello es necesario establecer una conexiÃ³n TCP completa.
- **UDP ICMP port unreachable scanning:** Es una tÃ©cnica que se diferencia de las anteriores en que no se basa en el protocolo TCP, sino que usa el UDP. Este protocolo, aunque suele ser mÃ¡s sencillo, resulta mÃ¡s complejo a la hora de escanear puertos, por lo que el proceso se puede volver significativamente mÃ¡s lento.

## Â¿Escanear puertos es siempre legal?

No, el escaneo de puertos no siempre es legal. El port scanning se puede utilizar para fines legÃ­timos. Por ejemplo, para que los administradores de redes y sistemas comprueben el estado de los puertos, las conexiones y los programas o aplicaciones que estÃ¡ ofreciendo el equipo. TambiÃ©n se puede usar como un mÃ©todo para el anÃ¡lisis de vulnerabilidades y brechas de seguridad. Los administradores pueden escanear los puertos para crear un mapa de las conexiones y detectar posibles fallos o vulnerabilidades. Por ello, se puede decir que el escaneo de puertos es totalmente legal, siempre y cuando se tenga permiso para acceder al equipo y se realice con fines legÃ­timos.

Sin embargo, tambiÃ©n puede ser usado con objetivos poco Ã©ticos. Muchos atacantes emplean este tipo de tÃ©cnicas para aprovecharse de esos fallos de seguridad. Al final, los puertos abiertos pueden funcionar como una puerta de entrada a un equipo, para luego realizar otras actividades maliciosas, como ataques de denegaciÃ³n de servicio.

## Ataques de escaneo de puertos. QuÃ© son y cÃ³mo evitarlos

Al hilo del punto anterior, cabe decir que los ataques de escaneo de puertos son uno de los mÃ©todos mÃ¡s empleados por los crackers para descubrir vulnerabilidades en un sistema. De hecho, lo primero que harÃ¡ un cibercriminal antes de lanzar su ataque serÃ¡ un portscan, lo que le permitirÃ¡ saber informaciÃ³n como la arquitectura de la red, los servicios que ofrecemos en nuestros equipos y, por supuesto, buscar agujeros o brechas de seguridad en los mismos. Dicho de otro modo, cada puerto abierto es una potencial puerta de entrada al equipo, por lo que es necesario tomar ciertas medidas de seguridad.

Una de ellas es no abrir mÃ¡s puertos de los necesarios, Normalmente, los equipos ya vienen con una serie de puertos abiertos predeterminados para poder ofrecer los servicios y funciones bÃ¡sicas. TambiÃ©n es aconsejable el uso de firewall o filtradores de paquetes, los cuÃ¡les funcionan como una barrera que protege al equipo de intrusos. Otra recomendaciÃ³n es mantener siempre los equipos y sistemas actualizados a su Ãºltima versiÃ³n, ya que los desarrolladores suelen crear parches que subsanan posibles vulnerabilidades.

Por Ãºltimo, estÃ¡ la opciÃ³n de usar herramientas como PortScanDetector, que permite detectar cuÃ¡ndo se estÃ¡ realizando un rastreo de nuestros puertos. BÃ¡sicamente, avisa a los administradores en aquellos casos en los que han sido consultados mÃ¡s de 10 puertos, lo cual puede indicar que un hacker estÃ¡ intentando acceder al equipo.

El escaneo de puertos y servicios es una prÃ¡ctica comÃºn en pruebas de penetraciÃ³n y evaluaciones de seguridad para identificar servicios activos, puertos abiertos y posibles vulnerabilidades en un sistema. AquÃ­ hay pasos generales y algunas herramientas comunes utilizadas para realizar este tipo de escaneo:

## **Pasos Generales:**

- Definir el Alcance: Establecer el alcance de la prueba, identificando los sistemas o redes especÃ­ficas a escanear y obteniendo el consentimiento del propietario.
- Seleccionar Herramientas Apropiadas: Elegir herramientas de escaneo de puertos y servicios que se ajusten a los requisitos del proyecto y al entorno que se va a evaluar.
- Configurar ParÃ¡metros: Configurar los parÃ¡metros de la herramienta de escaneo, como rango de direcciones IP, rango de puertos y opciones de escaneo especÃ­ficas.
- Realizar el Escaneo: Ejecutar la herramienta de escaneo para identificar los puertos abiertos y los servicios en los sistemas objetivo.
- Analizar Resultados: Revisar los resultados del escaneo para identificar servicios, versiones de software y posibles vulnerabilidades asociadas a los puertos encontrados.
- Registrar y Documentar: Mantener registros detallados de los resultados del escaneo, incluyendo los servicios identificados, versiones y cualquier hallazgo relevante.

## Herramientas Comunes de Escaneo de Puertos y Servicios

**Nmap**: Herramienta versÃ¡til de escaneo de puertos y mapeo de redes.

Ejemplo de Uso: 

```bash
nmap -p 1-1000 192.168.1.1
```

**Masscan**: EscÃ¡ner de puertos de alto rendimiento.

Ejemplo de Uso: 

```bash
masscan -p1-65535 192.168.1.1
```

**Unicornscan:** Herramienta de escaneo de red y puertos con enfoque en velocidad y eficiencia.

Ejemplo de Uso: 

```bash
unicornscan -mU -Iv 192.168.1.1:a
```

**Hping3**: Herramienta avanzada de envÃ­o de paquetes, Ãºtil para escaneo de puertos.

Ejemplo de Uso: 

```bash
hping3 -S -p 80 192.168.1.1
```

**Netcat (nc)**: Herramienta de utilidad de red que puede utilizarse para escanear puertos.

Ejemplo de Uso: 

```bash
nc -zv 192.168.1.1 1-100
```

Es fundamental recordar que el escaneo de puertos y servicios debe llevarse a cabo de manera Ã©tica y legal, con el consentimiento explÃ­cito del propietario del sistema o la red objetivo.

## Reconocimiento y enumeraciÃ³n con Nmap

[Nmap](https://nmap.org/) es una utilidad completamente gratuita y de cÃ³digo abierto, nos permite descubrir redes y host, asÃ­ como realizar auditorÃ­a de seguridad. Este programa es compatible con sistemas operativos Linux, Windows y tambiÃ©n macOS, pero en todos ellos se utiliza a travÃ©s de la lÃ­nea de comandos, aunque tenemos la posibilidad de instalar ZenMap que es la utilidad grÃ¡fica de Nmap para hacer los escaneos de puertos a travÃ©s de la interfaz grÃ¡fica de usuario. Si no quieres pelearte con comandos a travÃ©s de consola, esta interfaz grÃ¡fica de usuario te podrÃ­a ser Ãºtil para los primeros pasos con este gran programa, no obstante, cuando tengas mÃ¡s experiencia seguramente ejecutes todas las Ã³rdenes directamente desde terminal.

Nmap nos permite detectar hosts de una red local, y tambiÃ©n a travÃ©s de Internet, de esta forma, podremos saber si dichos hosts (ordenadores, servidores, routers, switches, dispositivos IoT) estÃ¡n actualmente conectados a Internet o a la red local. Esta herramienta tambiÃ©n permite realizar un escaneo de puertos a los diferentes hosts, ver quÃ© servicios tenemos activos en dichos hosts gracias a que nos dirÃ¡ el estado de sus puertos, podremos saber quÃ© sistema operativo estÃ¡ utilizando un determinado equipo, e incluso podremos automatizar diferentes pruebas de pentesting para comprobar la seguridad de los equipos.

Nmap tiene diferentes tipos de escaneo de puertos, pueden ser a travÃ©s de segmentos TCP, datagramas UDP o paquetes ICMP, ademÃ¡s, permite realizar escaneos de forma oculta para que sean difÃ­ciles de detectar por los firewalls. Por supuesto, podremos hacer escaneo de puertos sobre ciertos puertos en concreto, entre rangos de puertos, rangos de direcciones IP, posibilidad de usar paquetes TCP null, FIN, Xmas y ACK ademÃ¡s de SYN, para localizar los puertos TCP abiertos.

Otras caracterÃ­sticas que nos brinda esta herramienta, es la posibilidad de hacer un completo inventario de red, e incluso comprobar si un determinado host o servicio sigue levantado y funcionando. Este programa fue diseÃ±ado para escanear una gran cantidad de hosts, por tanto, si necesitas escanear mÃºltiples objetivos no tendrÃ¡s problemas. Este programe es muy flexible, incorpora decenas de tÃ©cnicas avanzadas para escanear hosts y puertos, ademÃ¡s, tambiÃ©n permite realizar auditorÃ­as a travÃ©s de NSE (Nmap Search Engine), por lo que es realmente potente.

> ğŸ‘‰ Nmap tiene varios estados en los puertos que aparecerÃ¡n cuando hagamos un escaneo de puertos. Es fundamental saber quÃ© significa cada estado de Nmap, porque con cualquier escaneo de puertos, nos devolverÃ¡ diferentes estados.

## Principales usos de Nmap

Como has podido ver, Nmap es una herramienta muy versÃ¡til. Esta se puede utilizar para gran variedad de tareas, sobre todo relacionadas con la seguridad de la informaciÃ³n. Pero tambiÃ©n nos permite realizar administraciÃ³n de redes. Algunos de los usos mÃ¡s comunes para Nmap son:

- **Escaneo de puertos:** Se puede utilizar para realizar el escaneo de puertos abiertos en la red. Lo cual nos da la posibilidad de identificar posibles puntos en los que un atacante puede atacar nuestra red. TambiÃ©n se pueden realizar escaneos de puertos especÃ­ficos, o un rango de puertos. Lo cual nos dice los que estÃ¡n abiertos, y como tal, con posibilidad de ser atacados.
- **DetecciÃ³n de sistemas:** Nmap se puede utilizar para encontrar sistemas activos en una red. Esto puede incluir servidores y dispositivos de red. Esto se hace escaneando una direcciÃ³n IP, o un rango de direcciones para identificar los dispositivos en la red.
- **DetecciÃ³n de servicios:** Con Nmap es posible detectar los servicios que se estÃ¡n ejecutando en la red, lo cual nos ayuda en muchos casos a detectar vulnerabilidades. Podremos identificar servicios como HTTP, Telnet, FTP, SSH, entre otros muchos. Esto lo que permite es proporcionar informaciÃ³n muy detallada sobre los softwares que estÃ¡n siendo ejecutados, incluso las versiones de los mismos.
- **Mapeo de redes:** Se puede utilizar para mapear redes. Esto puede incluir varios factores como la ubicaciÃ³n de un dispositivo o la topologÃ­a de la propia red. AsÃ­ serÃ¡ mucho mÃ¡s sencillo crear un mapa visual de toda la infraestructura, identificando los dispositivos y como estÃ¡n conectados.
- **Pruebas de seguridad:** Con Nmap se pueden realizar pruebas de penetraciÃ³n y evaluaciones de seguridad. Esto nos permite identificar vulnerabilidades en los sistemas o la red. Esto estÃ¡ directamente ligado al escaneo de puertos.
- **MonitorizaciÃ³n:** Nmap tiene la capacidad de realizar una monitorizaciÃ³n de la disponibilidad de los servidores o dispositivos de la red. Lo cual nos ayuda a ver si estÃ¡n funcionando de la forma correcta.

## Para que escanear puertos

Como hemos visto, con nmap tenemos una herramienta especializada en analizar los puertos de los sistemas informÃ¡ticos, obteniendo informaciÃ³n sobre si estÃ¡n abiertos, cerrados o protegidos con cortafuegos. Esto se puede hacer con multitud de finalidades, como saber quÃ© servicios se estÃ¡n ofreciendo desde un equipo por los administradores o por seguridad, buscando solventar algÃºn problema que pueda llegar en forma de vulnerabilidad.

Pero esto tambiÃ©n se puede utilizar con fines maliciosos. Igual que los Administradores pueden analizarlos para buscar posibles vulnerabilidades, un atacante puede hacerlo por exactamente lo mismo, pero con la intenciÃ³n de aprovecharse de ello para infiltrarse en la red aprovechando una brecha en la seguridad.

## **Estado de los puertos con Nmap**

- **Open**: una aplicaciÃ³n estÃ¡ activamente aceptando conexiones TCP o UDP. El puerto estÃ¡ abierto y se puede utilizar, los pentesters podrÃ¡n utilizar este puerto abierto para explotar el sistema. Es el estado por defecto si no tenemos ningÃºn firewall bloqueando accesos.
- **Closed**: un puerto que estÃ¡ cerrado es accesible porque responde a Nmap, sin embargo, no hay ninguna aplicaciÃ³n funcionando en dicho puerto. Es Ãºtil para descubrir que un host estÃ¡ levantado, o como parte de la detecciÃ³n de un sistema operativo. De cara al administrador del sistema, es recomendable filtrar estos puertos con el firewall para que no sean accesibles. De cara al pentester, es recomendable dejar estos puertos â€œcerradosâ€ para analizar mÃ¡s tarde, por si ponen algÃºn servicio nuevo.
- **Filtered**: en este estado Nmap no puede determinar si el puerto estÃ¡ abierto, porque hay un firewall filtrando los paquetes de Nmap en dicho puerto. Estos puertos filtrados son los que aparecerÃ¡n cuando tengamos un firewall activado. Nmap intentarÃ¡ en varias ocasiones intentar conectar, lo que hace que el escaneo de puertos sea bastante lento.
- **Open/Filtered**: Nmap no sabe si el puerto estÃ¡ abierto o filtrado. Esto ocurre porque el puerto abierto no envÃ­a ninguna respuesta, y dicha falta de respuesta podrÃ­a ser por el firewall. Este estado aparece cuando usamos UDP y IP, y utilizamos escaneos FIN, NULL y Xmas.
- **Closed/Filtered**: en este estado no se sabe si el puerto estÃ¡ cerrado o filtrado. Solo se usa este estado en el IP Idle Scan.

## Efectividad de Nmap

Nmap es una herramienta que se considera altamente efectiva. Esto se debe a una combinaciÃ³n de funcionalidad y caracterÃ­sticas avanzadas, que hace de esta soluciÃ³n una de las mejores que podemos encontrarnos. Esta cuenta con la capacidad de realizar escaneos de vulnerabilidades, para identificar posibles debilidades en las configuraciones de los sistemas de seguridad. Por lo cual, de no ser efectiva, no serÃ­a una herramienta tan conocida. Por lo cual podrÃ­amos decir, que la propia fama de Nmap es un buen identificativo para la calidad que puede proporcionarnos en una gran variedad de situaciones diferentes.

Por otro lado, mÃ¡s allÃ¡ de su eficacia en identificaciÃ³n de dispositivos, servicios y vulnerabilidades, estÃ¡ su capacidad para trabajar con diferentes protocolos de red. Entre otros, TCP, UDP, ICMP e IP. Todo lo cual, se puede integrar con otras herramientas de seguridad y anÃ¡lisis. Pueden ser herramientas como Metasploit o incluso Wireshark. Lo cual hace de Nmap una herramienta muy versÃ¡til para todo tipo de sistemas.

En cambio, no estamos ante una soluciÃ³n que sea perfecta, ni que represente una medida de seguridad ante problemas. A pesar de que es muy efectiva y poderosa, requiere de cierto conocimiento por parte de los usuarios que la utilicen. AsÃ­ como la disposiciÃ³n de las habilidades necesarias para darle uso con todas las garantÃ­as, y aprovechando su rendimiento y funciones al mÃ¡ximo. TambiÃ©n debemos pensar que muchos dispositivos pueden contar con algÃºn tipo de protecciÃ³n contra los escaneos de las aplicaciones como Nmap, o pueden incluso ser complicados de detectar. Pero en estos casos, ya no serÃ­a un problema de la eficiencia de Nmap ni de sus funciones, sino de las medidas de protecciÃ³n establecidas en esos dispositivos. En todo caso, si buscamos una soluciÃ³n efectiva, fiable y con buena trayectoria, Nmap es una de las mejores soluciones actualmente.

## PersonalizaciÃ³n de NMAP

Como puedes ver, con NMAP estamos ante una herramienta de cÃ³digo abierto, por lo cual tiene una alta capacidad de personalizaciÃ³n. Lo cual la lleva a ser una soluciÃ³n altamente adaptable a las necesidades de cada usuario, en todo tipo de escenarios. Pero esto es algo que no se realiza a la ligera, sino que hay algunos factores que destacan por encima de otros. Empezando por las opciones de escaneo, donde la gama de opciones es muy amplia. Esta permite gestionar muchos parÃ¡metros y opciones avanzadas, que modifican por completo el funcionamiento de NMAP. El escaneo personalizado, permite disponer de informaciÃ³n muy valiosa, y de todo tipo al realizar anÃ¡lisis de puertos, por ejemplo.

Por otro lado, estÃ¡n los scripts NSE (Nmap Scripting Engine). Esta es una de las caracterÃ­sticas mÃ¡s potentes de NMAP, la cual permite ejecutar scripts muy personalizados durante el tiempo de escaneo. Al poder crear los scripts por nuestra parte, pueden ser todo lo complejos que sea necesario. Y como tal nos da ese aÃ±adido en personalizaciÃ³n, el cual no tendrÃ­amos sin esta secciÃ³n de NMAP. Todo se hace buscando la salida personalizada de datos, donde se pueden establecer muchos parÃ¡metros. Desde el formato de salida, generar informes HTML, y los resultados que vamos a necesitar que incluya el anÃ¡lisis que se realiza en la red.

Por Ãºltimo, NMAP cuenta con una gran capacidad de integraciÃ³n con otras herramientas. Una de las caracterÃ­sticas mÃ¡s llamativas, es el poder establecer NMAP como entrada para otras herramientas de seguridad que utilicemos, o incluso para detecciÃ³n de intrusos. Lo cual, de nuevo, se puede combinar con los scripts que mencionamos previamente. Una vez que hemos visto las principales caracterÃ­sticas de Nmap, y el estado de los puertos que tenemos disponibles, vamos a instalarlo y utilizarlo.

## Descarga e instalaciÃ³n de Nmap en cualquier sistema

Lo primero que tenemos que hacer para utilizar este programa tan potente, es descargarlo y posteriormente instalarlo. En la **[secciÃ³n de descargas de Nmap](https://nmap.org/download.html)** podÃ©s encontrar todos los enlaces, binarios y cÃ³digo fuente para su instalaciÃ³n en sistemas operativos Windows, Linux y MacOS. Este programa, actualmente lo tenemos disponible en todos los repositorios de los sistemas operativos basados en Linux, por lo que su instalaciÃ³n es realmente sencilla. En Kali Linux ya viene instalado, pero si en tu Linux no esta instalado simplemente ejecutando la orden de instalaciÃ³n seguido de Â«nmapÂ», instalaras el programa sin dificultades.

```bash
sudo apt install nmap
```
## Ejemplos de uso de Nmap

Nmap es un programa muy avanzado y complejo, con decenas de comandos y ataques que vamos a poder realizar, con el objetivo de descubrir todos los hosts que tengamos en una red local domÃ©stica o profesional, ademÃ¡s, tambiÃ©n es capaz de detectar hosts en Internet, es decir, vamos a poder escanear uno a uno cualquier direcciÃ³n IP de Internet e incluso subredes que sean pÃºblicas.

Una vez que hemos descubierto que el host estÃ¡ online, se le puede realizar un escaneo rÃ¡pido de puertos y comprobar si tiene un firewall filtrando todos los paquetes, o bien tenemos un puerto abierto para poder explotar alguna vulnerabilidad. Nmap permite utilizar tanto direcciones IPv4 privadas y pÃºblicas, como tambiÃ©n direcciones IPv6, con el objetivo de poder escanear los puertos de cualquier host.

A continuaciÃ³n, veremos algunos ejemplos de cÃ³mo se utiliza Nmap a nivel usuario, y tambiÃ©n con comandos algo mÃ¡s avanzados, y es que este programa nos permitirÃ¡ descubrir con cierta exactitud quÃ© sistema operativo estÃ¡ utilizando el host remoto, ideal para obtener la mÃ¡xima informaciÃ³n posible.

## Escaneo rÃ¡pido de puertos

Si quieres realizar un escaneo rÃ¡pido de puertos a un determinado host, debemos teclear el siguiente comando. Este comando bÃ¡sico se encargarÃ¡ de escanear los principales puertos a la direcciÃ³n IP privada o pÃºblica definida, un detalle muy importante es que no escanearÃ¡ todos los puertos, sino los mÃ¡s utilizados habitualmente.

```bash
nmap [ip]
```

Por ejemplo, si queremos realizar un escaneo rÃ¡pido de los principales puertos a un host con direcciÃ³n IP 192.168.1.1, la orden serÃ­a la siguiente:

```bash
nmap 192.168.1.1
```

El programa nos devolverÃ¡ los puertos que se encuentran abiertos en el equipo objetivo.

![Nmap escaneo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-escaneo.png?raw=true)

En el caso de querer escanear todos y cada uno de los puertos tendremos que recurrir al siguiente comando y poner un rango desde el puerto 1 hasta el 65535, de esta forma estaremos comprobando si todos y cada uno de los puertos estÃ¡n abiertos, cerrados o filtrados.

## Realizar escaneo de un rango de puertos

En lugar de realizar un escaneo de todos los puertos, podemos establecer un rango de puertos a comprobar. Para ello ejecutaremos:

```bash
nmap -p [rango] [ip]
```

Si queremos realizar un escaneo de puertos desde el 20 TCP hasta el 200 TCP en la direcciÃ³n IP 192.168.1.1, basta con ejecutar la siguiente orden:

```bash
nmap -p 20-200 192.168.1.1
```

El programa nos indicarÃ¡ dentro de ese rango quÃ© puertos estÃ¡n abiertos.

![Rango cuerpos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/rango-cuerpos.png?raw=true)

Dependiendo de la latencia de la conexiÃ³n entre nuestro equipo y el host remoto, y tambiÃ©n el nÃºmero de puertos a analizar, este proceso podrÃ­a durar desde varios segundos hasta unos 10 minutos aproximadamente.

## Detectar el sistema operativo y mÃ¡s datos del host

Podemos indicar a Nmap que detecte el sistema operativo. Esto lo realiza enviando paquetes y analizando la forma en que los devuelve, siendo en cada sistema totalmente diferente. Junto a esto, realizarÃ¡ una exploraciÃ³n de puertos y de los servicios en busca de vulnerabilidades. Asimismo, el escaneo devolverÃ¡ informaciÃ³n Ãºtil. Para ello debemos ejecutar:

```bash
nmap -A -v [ip]
```

Si queremos realizar este escaneo a la direcciÃ³n IP 192.168.1.1 podemos ejecutar la siguiente orden:

```bash
nmap -A -v 192.168.1.1
```

Esta prueba de detecciÃ³n del sistema operativo no es del todo fiable porque depende de muchos parÃ¡metros, en algunos casos la exactitud es muy buena, sobre todo en diferenciar si es Windows o Linux, pero dentro del mundo Linux es realmente complicado conocer quÃ© sistema operativo es en concreto.

![usuario operativo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/usuario-operativo.png?raw=true)

## Listado de todos los comandos

Este programa es realmente completo, hasta el momento hemos utilizado los comandos bÃ¡sicos para descubrir hosts y tambiÃ©n para ver si tiene los puertos abiertos, sin embargo, esto no se queda asÃ­, y tenemos un gran listado de comandos para exprimir al mÃ¡ximo esta herramienta.

### Seleccionar objetivos

Direcciones o rangos IP, nombres de sistemas, redes, etc.

- **Ejemplo:** scanme.nmap.org, microsoft.com/24, 192.168.0.1, 10.0.0-255.1-254.
- **iL** fichero lista en fichero -iR n elegir objetivos aleatoriamente, 0 nunca acaba.
- **â€“exclude â€“excludefile** fichero excluir sistemas desde fichero.

### Descubrir sistemas

- **PS** n tcp syn ping
- **PA** n ping TCP ACK
- **PU** n ping UDP
- **PM** Netmask Req
- **PP** Timestamp Req
- **PE** Echo Req
- **sL** anÃ¡lisis de listado
- **PO** ping por protocolo
- **PN** No hacer ping
- **n** no hacer DNS
- **R** Resolver DNS en todos los sistemas objetivo
- **â€“traceroute**: trazar ruta al sistema (para topologÃ­as de red)
- **sP** realizar ping, igual que con â€“PP â€“PM â€“PS443 â€“PA80

## TÃ©cnicas de anÃ¡lisis de puertos

En la mayorÃ­a de ocasiones, cuando los usuarios estÃ¡n empezando a utilizar esta herramienta, lo mÃ¡s probable es que intenten la resoluciÃ³n de la mayorÃ­a de problemas con el tipo de escaneo SYN porque es uno de los mÃ¡s versÃ¡tiles. Pero, a medida que avanzan y conocen la herramienta en profundidad, se darÃ¡n cuenta de que ampliarÃ¡n su abanico de soluciones y aquÃ­ abajo explicamos un poco algunos de los comandos que resultan mÃ¡s Ãºtiles al momento de analizar puertos.

- **sS anÃ¡lisis utilizando TCP SYN:** Este tipo de escaneo, estÃ¡ basado en la velocidad de escaneo, de ahÃ­ la versatilidad que mencionamos anteriormente, ya que permite escanear miles de puertos por segundo en una red que se encuentre desprotegida o carezca de un firewall. AdemÃ¡s, en lo que a tÃ©rminos de privacidad se refiere, es una excelente tÃ©cnica, ya que no llega a completar las conexiones TCP y por lo tanto no llama la atenciÃ³n.
- **sT anÃ¡lisis utilizando TCP CONNECT:** Este tipo de exploraciÃ³n, podrÃ­amos decir que es la que se utiliza principalmente, sobre todo cuando no podemos ejecutar un escaneo tipo SYN, este tipo de anÃ¡lisis de conexiÃ³n, lo que hace es realizar o emitir una llamada al sistema de conexiÃ³n para que se establezca una conexiÃ³n con la red que estamos analizando. Luego, Nmap lo que hace es utilizar esta llamada para analizar la informaciÃ³n sobre cada intento de conexiÃ³n, la principal desventaja de este tipo de anÃ¡lisis es que nos toma un poco mÃ¡s de tiempo identificar los puertos que estÃ¡n abiertos que nos llevarÃ­a por ejemplo con el SYN.
- **sU anÃ¡lisis utilizando UDP:** Este tipo de escaneo es bastante simple, suele utilizarse sobre todo cuando queremos realizar un seguimiento de puertos como los DNS, SNMP y DHCP en nuestra red. Por supuesto, que sea sencillo no quita que son puertos bastante importantes, ya que suelen ser las Ã¡reas por donde suelen haber atacantes buscando vulnerabilidades para explotar.
- **sY** anÃ¡lisis utilizando SCTP INIT
- **sZ** utilizando COOKIE ECHO de SCTP
- **sO** protocolo IP
- **sW** ventana TCP -sN
- **â€“sF -sX** NULL, FIN, XMAS
- **â€“sA** TCP ACK

### Puertos a analizar y orden de anÃ¡lisis

- **p n-m** rango
- **pâ€“** todos los puertos
- **p n,m,z** especificados
- **p U:n-m,z T:n,m** U para UDP, T para TCP
- **F** rÃ¡pido, los 100 comunes
- **â€“top-ports n** analizar los puertos mÃ¡s utilizados
- **r** no aleatorio

### **DuraciÃ³n y ejecuciÃ³n:**

- **T0** paranoico
- **T1** sigiloso
- **T2** sofisticado
- **T3** normal
- **T4** agresivo
- **T5** locura
- **â€“min-hostgroup**
- **â€“max-hostgroup**
- **â€“min-rate**
- **â€“max-rate**
- **â€“min-parallelism**
- **â€“max-parallelism**
- **â€“min-rtt-timeout**
- **â€“max-rtt-timeout**
- **â€“initial-rtt-timeout**
- **â€“max-retries**
- **â€“host-timeout â€“scan-delay**

**DetecciÃ³n de servicios y versiones:**

- **sV:** detecciÃ³n de la versiÃ³n de servicios
- **â€“all-ports** no excluir puertos
- **â€“version-al**l probar cada exploraciÃ³n
- **â€“version**trace rastrear la actividad del anÃ¡lisis de versiÃ³n
- **O** activar detecciÃ³n del S. Operativo
- **â€“fuzzy** adivinar detecciÃ³n del SO
- **â€“max-os-tries** establecer nÃºmero mÃ¡ximo de intentos contra el sistema objetivo

**EvasiÃ³n de Firewalls/IDS**

- f fragmentar paquetes
- **D d1,d2** encubrir anÃ¡lisis con seÃ±uelos
- **S ip** falsear direcciÃ³n origen
- **â€“g source** falsear puerto origen
- **â€“randomize-hosts** orden
- **â€“spoof-mac mac** cambiar MAC de origen

**ParÃ¡metros de nivel de detalle y depuraciÃ³n**

- **v** Incrementar el nivel de detalle
- **â€“reason** motivos por sistema y puerto
- **d (1-9)** establecer nivel de depuraciÃ³n
- **â€“packet-trace** ruta de paquetes

**Otras opciones**

- **â€“resume file** continuar anÃ¡lisis abortado (tomando formatos de salida con -oN o -oG).
- **6** activar anÃ¡lisis IPV6.
- **A** agresivo, igual que con -O -sV -sC â€“traceroute.

**Opciones interactivas**

- **v/V** aumentar/disminuir nivel de detalle del anÃ¡lisis.
- **d/D** aumentar/disminuir nivel de depuraciÃ³n.
- **p/P** activar/desactivar traza de paquetes.

**Scripts**

- **sC** realizar anÃ¡lisis con los scripts por defecto.
- **â€“script file** ejecutar script (o todos).
- **â€“script-args n=v** proporcionar argumentos.
- **â€“script-trace** mostrar comunicaciÃ³n entrante y saliente.

**Formatos de salida**

- **oN** guardar en formato normal.
- **oX** guardar en formato XML.
- **oG** guardar en formato para posteriormente usar Grep.
- **oA** guardar en todos los formatos anteriores.

> ğŸ’¡ Principalmente estos son los comandos de que dispone Nmap. Antes de terminar, debemos decir que Nmap dispone de multitud de opciones con las que poder realizar completos anÃ¡lisis de redes. Podemos consultar todas las opciones disponibles tecleando:

```bash
nmap --help
```

![nmap help](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/nmap-help.png?raw=true)

Nmap es sin duda una herramienta muy sencilla y completa para realizar auditorÃ­as de redes, pero esto no acaba aquÃ­, tambiÃ©n tenemos disponible Nmap NSE para realizar pentesting avanzados.

**Otras tÃ©cnicas de escaneo**

Como hemos visto, nmap ofrece muchos parÃ¡metros para realizar un escaneo mÃ¡s a medida, pero actualmente existen otros mÃ©todos para realizar esta tarea los cuales pueden ser interesantes. Cada uno de ellos tiene sus propias caracterÃ­sticas, y pueden variar en efectividad.

- **TCP connect()scanning:** Es una de la formas de escaneo mÃ¡s comunes, porque es rÃ¡pido y no son necesarios demasiados privilegios en el equipo.
- **TCP SYN scanning:** TambiÃ©n conocido como Â«half-openÂ». Este no llega a crear una conexiÃ³n TCP, si no que utiliza el envÃ­o de paquetes SYN. Puede obtener dos respuestas diferentes, un SYN-ACK que indica que el puerto estÃ¡ abierto, y un RST que estÃ¡ cerrado.
- **TCP FIN scanning:** Permite realizar escaneos de puertos en aquellos sistemas que cuentan con firewalls o filtros de paquetes SYN.
- **Fragmentation Scanning:** AquÃ­ no estamos ante un escaneo como tal, sino que estÃ¡ para modificar las tÃ©cnicas anteriores mediante la divisiÃ³n o fragmentaciÃ³n de paquetes SYN o FIN. Esto se hace para que no sean detectados por firewall o filtros de paquetes.
- **TCP reverse ident scanning:** Con este identificador, es posible conocer datos sobre el responsable de los servicios que estÃ¡n usando una determinada conexiÃ³n TCP. Requiere una conexiÃ³n completa.

> Gracias a estas tÃ©cnicas de escaneo avanzadas, pordemos determinar si los puertos estÃ¡n abiertos o cerrados.

## Nmap NSE: quÃ© es y para quÃ© sirve

**Nmap Search Engine** o tambiÃ©n conocido como **Nmap NSE**, es una gran base de datos con miles de scripts que nos permitirÃ¡ automatizar la realizaciÃ³n de pentesting a sistemas y redes. El primer paso de cualquier pentesting es realizar un escaneo de puertos, una vez realizado este escaneo de puertos, podremos intentar explotar vulnerabilidades en los servicios que hay funcionando detrÃ¡s de un determinado puerto, por ejemplo, podrÃ­amos atacar servidores web, servidores Samba, FTP, servidores SSH, servidores DNS, comprobar si los diferentes servicios tienen vulnerabilidades conocidas o directamente intentar autenticarnos en ellos, si es que tienen autenticaciÃ³n como en el FTP o SSH.

NMAP NSE es un conjunto de scripts que nos permitirÃ¡ automatizar muchas acciones, como realizar ataques de fuerza bruta a servidores Samba, con el objetivo de intentar acceder a ellos y hacernos con el control, aunque tambiÃ©n podrÃ­amos atacarlo para realizarle un ataque de denegaciÃ³n de servicio y que el servicio no estÃ© disponible. Lo mismo podrÃ­amos hacer con los servidores FTP, servidores SSH y mucho mÃ¡s, sobre todo, los servidores web que deben tener un puerto abierto en el firewall son los que mÃ¡s se deben proteger para evitar o mitigar los ataques que nos puedan realizar.

Por ejemplo, si queremos realizar un ataque de fuerza bruta, basado en un listado de usuarios (con un archivo que se llame usuarios.txt) y con un listado de contraseÃ±as a probar (con un archivo que se llame claves.txt) a un servidor SSH de un determinado equipo que tiene la IP 192.168.25.01, podemos poner el siguiente comando:

```bash
nmap -p 22 --script ssh-brute --script-args userdb=usarios.txt,passdb=claves.txt --script-args ssh-brute.timeout=4s 192.168.25.01
```

Si queremos saber si un servidor FTP tiene habilitado la autenticaciÃ³n anÃ³nima, podremos hacerlo fÃ¡cilmente poniendo la siguiente orden:

```bash
nmap -sV -sC -p21 192.168.25.01
```

Si queremos realizar un ataque de fuerza bruta a un servidor FTP a un servidor con la IP 99.99.99.99, podemos poner el siguiente comando:

```bash
nmap -p 21 --script ftp-brute 192.168.25.01
```

Disponemos de una grandÃ­sima cantidad de scripts dentro de Nmap NSE con el objetivo de comprobar la seguridad de decenas de servicios, porque no solamente tendremos los tÃ­picos de servidores Samba, FTP, SSH y mÃ¡s, sino que tambiÃ©n podremos atacar de forma muy concreta un servidor web con cabeceras HTTP especiales para ver si hay vulnerabilidades, por supuesto, tendremos scripts especÃ­ficos que nos permitirÃ¡ explotar vulnerabilidades al PHP de los servidores web, por supuesto, tambiÃ©n podremos explotar vulnerabilidades a los diferentes servidores Samba, FTP y SSH, es decir, vulnerabilidades conocidas que ya han sido solucionadas, pero que es posible que todavÃ­a el objetivo las tenga operativas. Por este motivo es tan importante actualizar cuanto antes todos los servicios que tengamos expuestos a Internet, y tambiÃ©n servicios que tengamos expuestos a la red local, porque con un malware podrÃ­a explotar una vulnerabilidad y convertirse el ataque de penetraciÃ³n en un ataque de ransomware para cifrar todos los archivos y carpetas.

Recomiendo visitar la **[web oficial de uso de NSE](https://nmap.org/book/nse-usage.html)** donde encontrÃ¡s todos los scripts que hay actualmente en esta gran base de datos, ademÃ¡s, tendrÃ¡s ejemplos de cÃ³mo utilizarlos.

## Zenmap, la interfaz grÃ¡fica de Nmap

Zenmap es una herramienta gratuita que podemos utilizar para **escanear los puertos**. Podemos saber cuÃ¡les tenemos abiertos, para evitar problemas a la hora de usar algunos programas o acceder a un servidor. Se trata de la interfaz grÃ¡fica del popular programa de cÃ³digo abierto Nmap, que permite hacer un escaneo de puertos completo de cualquier equipo conectado. Hay que indicar que esta herramienta, que es totalmente gratuita, estÃ¡ disponible para **diferentes sistemas operativos** como Microsoft Windows, Linux o macOS. Permite a los usuarios ejecutar diferentes tipos de anÃ¡lisis de puertos. Es ideal tanto para usuarios menos experimentados como tambiÃ©n para los mÃ¡s avanzados.

Para comenzar a utilizar Zenmap lo primero que tenemos que hacer es **descargarlo**. Podemos hacerlo desde la [pÃ¡gina oficial](https://nmap.org/download.html) de Nmap. AllÃ­ encontraremos las diferentes versiones, segÃºn el sistema operativo que estemos utilizando. El proceso de instalaciÃ³n es sencillo, rÃ¡pido e intuitivo. En unos segundos lo tendremos listo para utilizar.

![zenmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/zenmap.png?raw=true)

Cuando lo hayamos instalado simplemente tendremos que ejecutarlo. Nos encontraremos con una imagen como la de arriba. Podemos elegir un escaneo de puertos a fondo, escaneo rÃ¡pido, puertos TCP, UDP, etc. Con Zenmap podemos ver **quÃ© puertos hay abiertos** en cualquier dispositivo. En el apartado de Objetivo tenemos que poner la direcciÃ³n IP que corresponde a ese equipo para, posteriormente, realizar el escaneo para que muestre cuÃ¡les estÃ¡n abiertos. Por tanto lo primero que tenemos que hacer es saber **cuÃ¡l es la direcciÃ³n IP** de nuestro equipo.

En Windows este proceso es muy sencillo. Simplemente tenemos que ir a Inicio, ejecutamos el SÃ­mbolo del sistema y posteriormente ipconfig. Nos mostrarÃ¡ una serie de informaciÃ³n entre las que podemos ver la puerta de enlace predeterminada (generalmente 192.168.1.1) asÃ­ como la direcciÃ³n IP de ese equipo. Cuando sepamos cuÃ¡l es la direcciÃ³n tendremos que ponerla en el apartado de Objetivo, en Zenmap. Posteriormente tendremos que elegir el tipo de escaneo que queremos realizar, como podrÃ­a ser por ejemplo un escaneo completo de todos los puertos TCP.

![Puertos TCP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/puertos-tcp.png?raw=true)

En Zenmap, en la parte de arriba, encontraremos **diferentes pestaÃ±as**. Veremos Salida Nmap, Puertos/Servidores, TopologÃ­a, Detalles del servidor y Escaneos. Todos ellos nos aporta informaciÃ³n, asÃ­ como poder elegir el tipo de servicio en la parte de la izquierda. Cuando le damos a Puertos/Servidores nos aparecerÃ¡ una recopilaciÃ³n de todos los puertos abiertos y filtrados que hay en ese host. Hay que tener en cuenta que nos aparecerÃ¡n mÃ¡s o menos puertos en funciÃ³n del tipo de escaneo que hayamos realizado.

![Salida Nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/salida-nmap.png?raw=true)

Si pinchamos en **Escaneos** nos aparecerÃ¡n todos los escaneos que hemos realizado. Los podemos guardar para poder analizar los datos en otra ocasiÃ³n, asÃ­ como tambiÃ©n eliminarlos y que no aparezcan ahÃ­.

Esto lo podemos hacer con cualquier otro equipo que tengamos conectado a la red. Por ejemplo, podemos comprobar tambiÃ©n los **puertos abiertos** y hacer un escaneo a nuestro telÃ©fono mÃ³vil. Ãšnicamente vamos a necesitar conocer cuÃ¡l es la direcciÃ³n IP. Eso sÃ­, hay que tener en cuenta que este proceso puede tardar mÃ¡s o menos segÃºn el tipo de dispositivo.

En definitiva, Zenmap es un programa interesante con el que podemos hacer escaneos de puertos. Lo podemos usar en Windows, que es el sistema operativo mÃ¡s utilizado en equipos de escritorio, asÃ­ como en Linux y macOS. Su uso es sencillo e intuitivo y podremos tener un mayor control sobre quÃ© puertos tenemos abiertos, especialmente cuando necesitamos conocer si un equipo va a funcionar correctamente al hacer uso de alguna aplicaciÃ³n que requiera de ciertos puertos abiertos.

## ImplementaciÃ³n en empresas

Muchas empresas deciden implementar estos sistemas para tener un poco mÃ¡s de control sobre sus redes. Pero esto es algo que se debe estudiar de forma detenida, y siguiendo unos pasos para que todo el proceso sea totalmente eficiente. Estos pasos son:

- **EvaluaciÃ³n de necesidades:** Siempre y cuando se implemente un nuevo sistema en una empresa, es necesario realizar una evaluaciÃ³n de las necesidades que vamos a tener dentro de la organizaciÃ³n. Tendremos que identificar los objetivos, los activos crÃ­ticos de la red, y todos y cada uno de los requisitos de seguridad que vamos a necesitar solucionar con NMAP.
- **InstalaciÃ³n y configuraciÃ³n:** En cualquier entorno, lo mÃ¡s recomendable es acudir siempre a los sitios oficiales para obtener la herramienta. Esto harÃ¡ que el proceso sea totalmente seguro. Una vez disponemos de ella, tendremos que configurar correctamente los ajustes y opciones en NMAP para que esta cumpla con los requisitos especÃ­ficos.
- **PolÃ­ticas y procedimientos:** Las polÃ­ticas que se establezcan en NMAP, deben ser claras y concisas. AquÃ­ podremos configurar los escaneos y los tipos, asÃ­ como los protocolos de notificaciÃ³n y reporte de hallazgos.
- **CapacitaciÃ³n:** Todo el personal que utilice NMAP, debe estar correctamente formado y capacitado para utilizarlo. SerÃ¡ necesario comprender cÃ³mo se utiliza la herramienta de forma segura y efectiva, y que siempre deben estar al tanto de todas las polÃ­ticas y procedimientos.
- **AnÃ¡lisis:** Como es normal, NMAP nos va a dar unos resultados. Estos deben ser analizados, y como tal serÃ¡ necesario tener un procedimiento para ello. Esto harÃ¡ que el anÃ¡lisis sea mucho mÃ¡s efectivo, y tengamos la informaciÃ³n adecuada en todo momento.
- **Actualizaciones:** Una vez disponemos de la herramienta instalada y configurada, tendremos que establecer la forma en la cual vamos a mantenerla actualizada. Esto es algo crÃ­tico, ya que serÃ¡ necesario para que todo se mantenga lo mÃ¡s segura posible y con el funcionamiento mÃ¡s Ã³ptimo.

> ğŸ‘‰ Como podemos ver, Nmap es una herramienta tremendamente Ãºtil, que nos puede dar muchas facilidades a la hora de gestionar redes.


