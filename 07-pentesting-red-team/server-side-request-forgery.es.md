---
title: "Server-Side Request Forgery (SSRF): Entendiendo y Mitigando una Vulnerabilidad Cr铆tica en la Web"
description: "Aprende sobre Server-Side Request Forgery (SSRF), su impacto en la seguridad web y c贸mo protegerte contra esta peligrosa vulnerabilidad. Incluye ejemplos del mundo real y t茅cnicas de prevenci贸n."
tags: ["ciberseguridad", "OWASP top 10", "pentesting", "red-team", "SSRF"]
seo_target_keyword: "Server-Side Request Forgery"
---

En 2019, Capital One (uno de los bancos mas grandes de USA) sufri贸 una violaci贸n de datos masiva que expuso la informaci贸n personal de m谩s de **100 millones** de clientes. El ataque, que result贸 en el robo de solicitudes de tarjetas de cr茅dito, n煤meros de seguridad social y cuentas bancarias, fue posible gracias a una vulnerabilidad de Server-Side Request Forgery (SSRF). Este incidente destaca las graves consecuencias del SSRF y subraya la importancia de entender y mitigar esta cr铆tica falla de seguridad web. Es por esto que SSRF es el segundo problema mas grave del [OWASP top 10](https://4geeks.com/es/lesson/que-es-owasp-top-10).

Server-Side Request Forgery es una vulnerabilidad de seguridad web que permite a un atacante inducir a una aplicaci贸n del lado del servidor a realizar solicitudes HTTP a un dominio arbitrario elegido por el atacante. En esta lecci贸n, exploraremos el concepto de SSRF, su impacto y c贸mo prevenir este tipo de fallas de seguridad devastadoras.

## Un Ejemplo T茅cnico Espec铆fico de SSRF

Veamos un ejemplo concreto de una vulnerabilidad SSRF en una aplicaci贸n web. Considera el siguiente escenario que involucra una funcionalidad defectuosa de procesamiento de im谩genes:

Imagina una aplicaci贸n web que permite a los usuarios enviar una URL de una imagen, que el servidor luego recupera, procesa y muestra de nuevo al usuario. El proceso funciona de la siguiente manera:

1. El usuario env铆a una URL a trav茅s de un formulario en el sitio web.
2. El servidor recibe la URL y realiza una solicitud para recuperar la imagen.
3. El servidor procesa la imagen (por ejemplo, redimensiona o aplica filtros).
4. La imagen procesada se muestra de nuevo al usuario.

```python
from flask import Flask, request, Response
import requests

app = Flask(__name__)

@app.route('/fetch_image', methods=['POST'])
def fetch_image():
    image_url = request.form.get('image_url')
    if image_url:
        # Recupera la imagen desde la URL proporcionada por el usuario
        response = requests.get(image_url)
        image = response.content

        # Procesar la imagen (ej., redimensionar o aplicar filtros)
        # Por simplicidad, solo mostraremos la imagen sin procesarla
        return Response(image, content_type='image/jpeg')

if __name__ == '__main__':
    app.run()
```

```node
const express = require('express');
const axios = require('axios');
const app = express();

app.use(express.urlencoded({ extended: true }));

app.post('/fetch_image', async (req, res) => {
    const imageUrl = req.body.image_url;
    if (imageUrl) {
        try {
            // Recupera la imagen desde la URL proporcionada por el usuario
            const response = await axios.get(imageUrl, { responseType: 'arraybuffer' });
            const image = response.data;

            // Procesar la imagen (ej., redimensionar o aplicar filtros)
            // Por simplicidad, solo mostraremos la imagen sin procesarla
            res.contentType('image/jpeg');
            res.send(image);
        } catch (error) {
            res.status(500).send('Error al recuperar la imagen');
        }
    } else {
        res.status(400).send('No se proporcion贸 una URL de imagen');
    }
});

const PORT = 3000;
app.listen(PORT, () => {
    console.log(`Servidor corriendo en el puerto ${PORT}`);
});
```

Como puedes ver, se recibe `image_url` y se usa para recuperar una supuesta imagen de internet. El problema aqu铆 es que confiamos en que esta `image_url` sea una imagen v谩lida y no alg煤n punto interno. Nuestro servidor est谩 haciendo una solicitud a esta `image_url` y devolviendo la respuesta. Estamos permitiendo que los hackers proporcionen una URL que estamos recuperando.  驴Qu茅 pasa si proporcionan una URL a nuestra intranet?

Aunque este c贸digo parece simple, es vulnerable a SSRF. Un atacante podr铆a explotar esta funcionalidad enviando una URL maliciosa que apunte a servicios o puntos internos, obteniendo acceso no autorizado a datos sensibles o realizando acciones que el servidor tiene permitido hacer en su red.

Por ejemplo, el atacante podr铆a enviar la siguiente URL:

```url
http://localhost/admin/internal/secret
```

Si el servidor que ejecuta este c贸digo tiene acceso a la interfaz interna `localhost`, intentar谩 recuperar el recurso, posiblemente filtrando informaci贸n interna sensible.

## Impacto del SSRF

El da帽o potencial causado por un ataque SSRF depende de los permisos y el acceso a la red del servidor vulnerable. Aqu铆 algunos de los riesgos:

- **Acceso a servicios internos:** SSRF puede permitir a los atacantes acceder a servicios que de otro modo ser铆an inaccesibles desde internet, como bases de datos internas, puntos de metadata en la nube o interfaces de administraci贸n.
- **Exfiltraci贸n de datos:** Datos sensibles almacenados en servidores internos pueden ser filtrados al atacante.
- **Ejecuci贸n remota de c贸digo:** En algunos casos, SSRF puede llevar a ataques adicionales como la ejecuci贸n remota de c贸digo (RCE) si el atacante puede explotar otras vulnerabilidades en la red interna.

La violaci贸n de Capital One es un ejemplo perfecto de c贸mo una vulnerabilidad SSRF puede ser utilizada para acceder a metadata interna de AWS, lo que result贸 en el robo de datos sensibles de los clientes.

## Prevenci贸n de Ataques SSRF

Para mitigar el riesgo de vulnerabilidades SSRF, considera las siguientes mejores pr谩cticas:

1. **Validaci贸n de entradas y listas blancas:** Solo permite solicitudes a dominios de confianza implementando listas blancas estrictas. Evita permitir a los usuarios enviar URLs arbitrarias.
2. **Segmentaci贸n de la red:** Aseg煤rate de que los servicios internos no sean accesibles directamente desde la aplicaci贸n web. Limita la capacidad del servidor para realizar solicitudes salientes a redes internas.
3. **Deshabilitar protocolos innecesarios:** Prev茅n el uso de protocolos como `file://`, `gopher://` u otros que puedan introducir riesgos adicionales.
4. **Usar un firewall o proxy:** Rutea las solicitudes salientes a trav茅s de un firewall o proxy para bloquear intentos de acceso a recursos internos.
5. **Protecci贸n de metadata en la nube:** Si utilizas servicios en la nube como AWS, aseg煤rate de que los puntos de metadata est茅n correctamente restringidos para prevenir accesos no autorizados.

Al adoptar estas medidas, las organizaciones pueden reducir significativamente el riesgo de ataques SSRF y proteger los datos sensibles de actores malintencionados.

## Herramientas para Detectar SSRF

Detectar vulnerabilidades SSRF puede ser desafiante, pero existen varias herramientas y t茅cnicas que pueden ayudar a identificar y mitigar estos riesgos:

1. **Burp Suite:**
   Burp Suite es un esc谩ner de vulnerabilidades web popular que incluye funciones para detectar SSRF. Para usar Burp Suite en la detecci贸n de SSRF:
   - Configura Burp Suite como proxy y configura tu navegador para usarlo.
   - Intercepta y analiza las solicitudes HTTP realizadas por la aplicaci贸n.
   - Busca solicitudes que incluyan URLs proporcionadas por el usuario o par谩metros que puedan ser manipulados.
   - Usa la herramienta Intruder de Burp Suite para probar varios payloads y observar la respuesta del servidor.

2. **OWASP ZAP:**
   El OWASP Zed Attack Proxy (ZAP) es un esc谩ner de seguridad de aplicaciones web de c贸digo abierto. Para usar OWASP ZAP en la detecci贸n de SSRF:
   - Configura ZAP como proxy y configura tu navegador para usarlo.
   - Rastrea la aplicaci贸n para descubrir todos los puntos finales.
   - Usa la funci贸n de Escaneo Activo para probar vulnerabilidades SSRF inyectando payloads en los par谩metros de URL.
   - Revisa los resultados del escaneo para detectar posibles vulnerabilidades SSRF.

3. **Nmap:**
   Nmap es una herramienta de escaneo de redes que puede ser usada para descubrir puertos abiertos y servicios en una red. Para usar Nmap en la detecci贸n de SSRF:
   - Ejecuta Nmap para escanear la red interna y detectar puertos y servicios abiertos.
   - Usa la informaci贸n recopilada para identificar servicios internos potenciales que podr铆an ser objetivos de ataques SSRF.
   - Prueba la aplicaci贸n intentando acceder a estos servicios internos a trav茅s de URLs proporcionadas por el usuario.

4. **SSRFmap:**
   SSRFmap es una herramienta especializada dise帽ada para automatizar la detecci贸n y explotaci贸n de vulnerabilidades SSRF. Para usar SSRFmap:
   - Instala SSRFmap y config煤ralo con la URL de destino y los par谩metros.
   - Ejecuta SSRFmap para escanear vulnerabilidades SSRF y probar varios payloads.
   - Revisa los resultados para identificar posibles explotaciones exitosas de SSRF.

5. **Amass:**
   Amass es una herramienta para el mapeo de redes y descubrimiento de superficies de ataque. Para usar Amass en la detecci贸n de SSRF:
   - Ejecuta Amass para mapear la red y descubrir servicios y puntos finales internos.
   - Usa la informaci贸n recopilada para identificar posibles objetivos de ataques SSRF.
   - Prueba la aplicaci贸n intentando acceder a estos servicios internos a trav茅s de URLs proporcionadas por el usuario.

6. **Scripts Personalizados:**
   Los profesionales de la seguridad tambi茅n pueden escribir scripts personalizados

 para probar vulnerabilidades SSRF. Para usar scripts personalizados:
   - Identifica los par谩metros de URL proporcionados por el usuario en la aplicaci贸n.
   - Escribe scripts para inyectar varios payloads en estos par谩metros y observa la respuesta del servidor.
   - Analiza las respuestas para determinar si la aplicaci贸n es vulnerable a SSRF.

Al utilizar estas herramientas y t茅cnicas, las organizaciones pueden identificar proactivamente y abordar vulnerabilidades SSRF, reduciendo el riesgo de explotaci贸n por actores malintencionados.